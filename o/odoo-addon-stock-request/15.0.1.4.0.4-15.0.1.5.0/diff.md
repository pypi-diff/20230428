# Comparing `tmp/odoo_addon_stock_request-15.0.1.4.0.4-py3-none-any.whl.zip` & `tmp/odoo_addon_stock_request-15.0.1.5.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,75 +1,75 @@
-Zip file size: 201908 bytes, number of entries: 73
--rw-r--r--  2.0 unx     4628 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/README.rst
--rw-r--r--  2.0 unx       21 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/__init__.py
--rw-r--r--  2.0 unx      951 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/__manifest__.py
--rw-r--r--  2.0 unx      683 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/data/stock_request_sequence_data.xml
--rw-r--r--  2.0 unx    45488 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/ca.po
--rw-r--r--  2.0 unx    50412 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/de.po
--rw-r--r--  2.0 unx    45508 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/el_GR.po
--rw-r--r--  2.0 unx    52200 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/es.po
--rw-r--r--  2.0 unx    45505 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/es_ES.po
--rw-r--r--  2.0 unx    45488 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/eu.po
--rw-r--r--  2.0 unx    45485 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/fi.po
--rw-r--r--  2.0 unx    45485 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/fr.po
--rw-r--r--  2.0 unx    45508 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/fr_CH.po
--rw-r--r--  2.0 unx    45503 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/fr_FR.po
--rw-r--r--  2.0 unx    45488 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/gl.po
--rw-r--r--  2.0 unx    45564 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/hr.po
--rw-r--r--  2.0 unx    45583 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/hr_HR.po
--rw-r--r--  2.0 unx    45488 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/it.po
--rw-r--r--  2.0 unx    45249 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/ja.po
--rw-r--r--  2.0 unx    45252 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/ja_JP.po
--rw-r--r--  2.0 unx    45485 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/nl.po
--rw-r--r--  2.0 unx    45508 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/nl_NL.po
--rw-r--r--  2.0 unx    45490 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/pt.po
--rw-r--r--  2.0 unx    45507 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/pt_BR.po
--rw-r--r--  2.0 unx    45531 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/ro.po
--rw-r--r--  2.0 unx    45647 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/ru.po
--rw-r--r--  2.0 unx    45545 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/sl.po
--rw-r--r--  2.0 unx    45184 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/stock_request.pot
--rw-r--r--  2.0 unx    45485 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/tr.po
--rw-r--r--  2.0 unx    45503 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/tr_TR.po
--rw-r--r--  2.0 unx    45508 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/vi_VN.po
--rw-r--r--  2.0 unx    50529 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/i18n/zh_CN.po
--rw-r--r--  2.0 unx      524 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/migrations/15.0.1.4.0/noupdate_changes.xml
--rw-r--r--  2.0 unx      315 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/migrations/15.0.1.4.0/post-migration.py
--rw-r--r--  2.0 unx      432 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/__init__.py
--rw-r--r--  2.0 unx     1085 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/procurement_group.py
--rw-r--r--  2.0 unx      350 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/res_company.py
--rw-r--r--  2.0 unx     1234 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/res_config_settings.py
--rw-r--r--  2.0 unx     1474 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/stock_location.py
--rw-r--r--  2.0 unx      870 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/stock_location_route.py
--rw-r--r--  2.0 unx     2544 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/stock_move.py
--rw-r--r--  2.0 unx     2773 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/stock_move_line.py
--rw-r--r--  2.0 unx     1343 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/stock_picking.py
--rw-r--r--  2.0 unx    13062 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/stock_request.py
--rw-r--r--  2.0 unx     9501 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/stock_request_abstract.py
--rw-r--r--  2.0 unx     2867 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/stock_request_allocation.py
--rw-r--r--  2.0 unx    12289 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/stock_request_order.py
--rw-r--r--  2.0 unx     1048 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/stock_rule.py
--rw-r--r--  2.0 unx     1476 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/models/stock_warehouse.py
--rw-r--r--  2.0 unx      409 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/readme/CONFIGURE.rst
--rw-r--r--  2.0 unx      616 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx      147 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx      242 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/readme/ROADMAP.rst
--rw-r--r--  2.0 unx      493 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/readme/USAGE.rst
--rw-r--r--  2.0 unx     1994 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/security/ir.model.access.csv
--rw-r--r--  2.0 unx     6135 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/security/stock_request_security.xml
--rw-r--r--  2.0 unx    15218 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/static/description/icon.png
--rw-r--r--  2.0 unx     9771 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/static/description/icon.svg
--rw-r--r--  2.0 unx    15507 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/static/description/index.html
--rw-r--r--  2.0 unx       33 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/tests/__init__.py
--rw-r--r--  2.0 unx    45381 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/tests/test_stock_request.py
--rw-r--r--  2.0 unx     1517 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/views/product.xml
--rw-r--r--  2.0 unx     7735 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/views/res_config_settings_views.xml
--rw-r--r--  2.0 unx     1072 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/views/stock_move_views.xml
--rw-r--r--  2.0 unx     1036 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/views/stock_picking_views.xml
--rw-r--r--  2.0 unx     2615 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/views/stock_request_allocation_views.xml
--rw-r--r--  2.0 unx     1308 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/views/stock_request_menu.xml
--rw-r--r--  2.0 unx     9931 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/views/stock_request_order_views.xml
--rw-r--r--  2.0 unx    11319 b- defN 23-Mar-07 08:17 odoo/addons/stock_request/views/stock_request_views.xml
--rw-r--r--  2.0 unx     5187 b- defN 23-Mar-07 08:17 odoo_addon_stock_request-15.0.1.4.0.4.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Mar-07 08:17 odoo_addon_stock_request-15.0.1.4.0.4.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 23-Mar-07 08:17 odoo_addon_stock_request-15.0.1.4.0.4.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     7524 b- defN 23-Mar-07 08:17 odoo_addon_stock_request-15.0.1.4.0.4.dist-info/RECORD
-73 files, 1494885 bytes uncompressed, 189530 bytes compressed:  87.3%
+Zip file size: 202033 bytes, number of entries: 73
+-rw-r--r--  2.0 unx     4628 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/README.rst
+-rw-r--r--  2.0 unx       21 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/__init__.py
+-rw-r--r--  2.0 unx      951 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/__manifest__.py
+-rw-r--r--  2.0 unx      683 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/data/stock_request_sequence_data.xml
+-rw-r--r--  2.0 unx    45488 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/ca.po
+-rw-r--r--  2.0 unx    50412 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/de.po
+-rw-r--r--  2.0 unx    45508 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/el_GR.po
+-rw-r--r--  2.0 unx    52200 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/es.po
+-rw-r--r--  2.0 unx    45505 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/es_ES.po
+-rw-r--r--  2.0 unx    45488 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/eu.po
+-rw-r--r--  2.0 unx    45485 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/fi.po
+-rw-r--r--  2.0 unx    45485 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/fr.po
+-rw-r--r--  2.0 unx    45508 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/fr_CH.po
+-rw-r--r--  2.0 unx    45503 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/fr_FR.po
+-rw-r--r--  2.0 unx    45488 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/gl.po
+-rw-r--r--  2.0 unx    45564 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/hr.po
+-rw-r--r--  2.0 unx    45583 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/hr_HR.po
+-rw-r--r--  2.0 unx    45488 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/it.po
+-rw-r--r--  2.0 unx    45249 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/ja.po
+-rw-r--r--  2.0 unx    45252 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/ja_JP.po
+-rw-r--r--  2.0 unx    45485 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/nl.po
+-rw-r--r--  2.0 unx    45508 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/nl_NL.po
+-rw-r--r--  2.0 unx    45490 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/pt.po
+-rw-r--r--  2.0 unx    45507 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/pt_BR.po
+-rw-r--r--  2.0 unx    45531 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/ro.po
+-rw-r--r--  2.0 unx    45647 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/ru.po
+-rw-r--r--  2.0 unx    45545 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/sl.po
+-rw-r--r--  2.0 unx    45184 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/stock_request.pot
+-rw-r--r--  2.0 unx    45485 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/tr.po
+-rw-r--r--  2.0 unx    45503 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/tr_TR.po
+-rw-r--r--  2.0 unx    45508 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/vi_VN.po
+-rw-r--r--  2.0 unx    50529 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/i18n/zh_CN.po
+-rw-r--r--  2.0 unx      524 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/migrations/15.0.1.4.0/noupdate_changes.xml
+-rw-r--r--  2.0 unx      315 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/migrations/15.0.1.4.0/post-migration.py
+-rw-r--r--  2.0 unx      432 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/__init__.py
+-rw-r--r--  2.0 unx     1085 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/procurement_group.py
+-rw-r--r--  2.0 unx      350 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/res_company.py
+-rw-r--r--  2.0 unx     1234 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/res_config_settings.py
+-rw-r--r--  2.0 unx     1474 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/stock_location.py
+-rw-r--r--  2.0 unx      870 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/stock_location_route.py
+-rw-r--r--  2.0 unx     2546 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/stock_move.py
+-rw-r--r--  2.0 unx     2773 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/stock_move_line.py
+-rw-r--r--  2.0 unx     1343 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/stock_picking.py
+-rw-r--r--  2.0 unx    13469 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/stock_request.py
+-rw-r--r--  2.0 unx     9501 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/stock_request_abstract.py
+-rw-r--r--  2.0 unx     2867 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/stock_request_allocation.py
+-rw-r--r--  2.0 unx    12487 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/stock_request_order.py
+-rw-r--r--  2.0 unx     1048 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/stock_rule.py
+-rw-r--r--  2.0 unx     1476 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/models/stock_warehouse.py
+-rw-r--r--  2.0 unx      409 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/readme/CONFIGURE.rst
+-rw-r--r--  2.0 unx      616 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx      147 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx      242 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/readme/ROADMAP.rst
+-rw-r--r--  2.0 unx      493 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/readme/USAGE.rst
+-rw-r--r--  2.0 unx     1994 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/security/ir.model.access.csv
+-rw-r--r--  2.0 unx     6135 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/security/stock_request_security.xml
+-rw-r--r--  2.0 unx    15218 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/static/description/icon.png
+-rw-r--r--  2.0 unx     9771 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/static/description/icon.svg
+-rw-r--r--  2.0 unx    15507 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/static/description/index.html
+-rw-r--r--  2.0 unx       33 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/tests/__init__.py
+-rw-r--r--  2.0 unx    45373 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/tests/test_stock_request.py
+-rw-r--r--  2.0 unx     1517 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/views/product.xml
+-rw-r--r--  2.0 unx     7735 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/views/res_config_settings_views.xml
+-rw-r--r--  2.0 unx     1072 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/views/stock_move_views.xml
+-rw-r--r--  2.0 unx     1036 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/views/stock_picking_views.xml
+-rw-r--r--  2.0 unx     2615 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/views/stock_request_allocation_views.xml
+-rw-r--r--  2.0 unx     1308 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/views/stock_request_menu.xml
+-rw-r--r--  2.0 unx     9931 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/views/stock_request_order_views.xml
+-rw-r--r--  2.0 unx    11319 b- defN 23-Apr-28 08:15 odoo/addons/stock_request/views/stock_request_views.xml
+-rw-r--r--  2.0 unx     5185 b- defN 23-Apr-28 08:15 odoo_addon_stock_request-15.0.1.5.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-28 08:15 odoo_addon_stock_request-15.0.1.5.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-Apr-28 08:15 odoo_addon_stock_request-15.0.1.5.0.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     7516 b- defN 23-Apr-28 08:15 odoo_addon_stock_request-15.0.1.5.0.dist-info/RECORD
+73 files, 1495474 bytes uncompressed, 189671 bytes compressed:  87.3%
```

## zipnote {}

```diff
@@ -201,20 +201,20 @@
 
 Filename: odoo/addons/stock_request/views/stock_request_order_views.xml
 Comment: 
 
 Filename: odoo/addons/stock_request/views/stock_request_views.xml
 Comment: 
 
-Filename: odoo_addon_stock_request-15.0.1.4.0.4.dist-info/METADATA
+Filename: odoo_addon_stock_request-15.0.1.5.0.dist-info/METADATA
 Comment: 
 
-Filename: odoo_addon_stock_request-15.0.1.4.0.4.dist-info/WHEEL
+Filename: odoo_addon_stock_request-15.0.1.5.0.dist-info/WHEEL
 Comment: 
 
-Filename: odoo_addon_stock_request-15.0.1.4.0.4.dist-info/top_level.txt
+Filename: odoo_addon_stock_request-15.0.1.5.0.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo_addon_stock_request-15.0.1.4.0.4.dist-info/RECORD
+Filename: odoo_addon_stock_request-15.0.1.5.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/stock_request/__manifest__.py

```diff
@@ -1,14 +1,14 @@
 # Copyright 2017-2021 ForgeFlow, S.L.
 # License LGPL-3.0 or later (https://www.gnu.org/licenses/lgpl.html).
 
 {
     "name": "Stock Request",
     "summary": "Internal request for stock",
-    "version": "15.0.1.4.0",
+    "version": "15.0.1.5.0",
     "license": "LGPL-3",
     "website": "https://github.com/OCA/stock-logistics-warehouse",
     "author": "ForgeFlow, Odoo Community Association (OCA)",
     "category": "Warehouse Management",
     "depends": ["stock"],
     "data": [
         "security/stock_request_security.xml",
```

## odoo/addons/stock_request/models/stock_move.py

```diff
@@ -65,14 +65,14 @@
                     },
                 )
             )
         return super(StockMove, self).copy_data(default)
 
     def _action_cancel(self):
         res = super()._action_cancel()
-        self.mapped("allocation_ids.stock_request_id").check_done()
+        self.mapped("allocation_ids.stock_request_id").check_cancel()
         return res
 
     def _action_done(self, cancel_backorder=False):
         res = super()._action_done(cancel_backorder=cancel_backorder)
         self.mapped("allocation_ids.stock_request_id").check_done()
         return res
```

## odoo/addons/stock_request/models/stock_request.py

```diff
@@ -227,21 +227,28 @@
     def action_draft(self):
         self.write({"state": "draft"})
         return True
 
     def action_cancel(self):
         self.sudo().mapped("move_ids")._action_cancel()
         self.write({"state": "cancel"})
+        self.mapped("order_id").check_cancel()
         return True
 
     def action_done(self):
         self.write({"state": "done"})
         self.mapped("order_id").check_done()
         return True
 
+    def check_cancel(self):
+        for request in self:
+            if request._check_cancel_allocation():
+                request.write({"state": "cancel"})
+                request.mapped("order_id").check_cancel()
+
     def check_done(self):
         precision = self.env["decimal.precision"].precision_get(
             "Product Unit of Measure"
         )
         for request in self:
             allocated_qty = sum(request.allocation_ids.mapped("allocated_product_qty"))
             qty_done = request.product_id.uom_id._compute_quantity(
@@ -250,19 +257,21 @@
             if (
                 float_compare(
                     qty_done, request.product_uom_qty, precision_digits=precision
                 )
                 >= 0
             ):
                 request.action_done()
-            elif request._check_done_allocation():
-                request.action_done()
+            elif request._check_cancel_allocation():
+                # If qty_done=0 and qty_cancelled>0 it's cancelled
+                request.write({"state": "cancel"})
+                request.mapped("order_id").check_cancel()
         return True
 
-    def _check_done_allocation(self):
+    def _check_cancel_allocation(self):
         precision = self.env["decimal.precision"].precision_get(
             "Product Unit of Measure"
         )
         self.ensure_one()
         return (
             self.allocation_ids
             and float_compare(self.qty_cancelled, 0, precision_digits=precision) > 0
```

## odoo/addons/stock_request/models/stock_request_order.py

```diff
@@ -242,14 +242,20 @@
 
     def check_done(self):
         for rec in self:
             if not rec.stock_request_ids.filtered(lambda r: r.state != "done"):
                 rec.action_done()
         return
 
+    def check_cancel(self):
+        for rec in self:
+            if not rec.stock_request_ids.filtered(lambda r: r.state != "cancel"):
+                rec.write({"state": "cancel"})
+        return
+
     def action_view_transfer(self):
         action = self.env["ir.actions.act_window"]._for_xml_id(
             "stock.action_picking_tree_all"
         )
 
         pickings = self.mapped("picking_ids")
         if len(pickings) > 1:
```

## odoo/addons/stock_request/tests/test_stock_request.py

```diff
@@ -1,34 +1,32 @@
 # Copyright 2017 ForgeFlow S.L.
+# Copyright 2022 Tecnativa - Víctor Martínez
 # License LGPL-3.0 or later (http://www.gnu.org/licenses/lgpl-3.0).
 
 from collections import Counter
 from datetime import datetime
 
 from odoo import exceptions, fields
 from odoo.tests import common, new_test_user
 
 
 class TestStockRequest(common.TransactionCase):
     def setUp(self):
         super().setUp()
-
         # common models
         self.stock_request = self.env["stock.request"]
         self.request_order = self.env["stock.request.order"]
-
         # refs
         self.stock_request_user_group = self.env.ref(
             "stock_request.group_stock_request_user"
         )
         self.main_company = self.env.ref("base.main_company")
         self.warehouse = self.env.ref("stock.warehouse0")
         self.categ_unit = self.env.ref("uom.product_uom_categ_unit")
         self.virtual_loc = self.env.ref("stock.stock_location_customers")
-
         # common data
         self.company_2 = self.env["res.company"].create(
             {"name": "Comp2", "parent_id": self.main_company.id}
         )
         self.company_2_address = (
             self.env["res.partner"]
             .with_context(company_id=self.company_2.id)
@@ -57,91 +55,65 @@
             company_ids=[(6, 0, [self.main_company.id, self.company_2.id])],
             context=ctx,
         )
         self.product = self._create_product("SH", "Shoes", False)
         self.product_company_2 = self._create_product(
             "SH_2", "Shoes", self.company_2.id
         )
-
-        self.ressuply_loc = self.env["stock.location"].create(
-            {
-                "name": "Ressuply",
-                "location_id": self.warehouse.view_location_id.id,
-                "usage": "internal",
-                "company_id": self.main_company.id,
-            }
-        )
-
-        self.ressuply_loc_2 = self.env["stock.location"].create(
-            {
-                "name": "Ressuply",
-                "location_id": self.wh2.view_location_id.id,
-                "usage": "internal",
-                "company_id": self.company_2.id,
-            }
+        self.ressuply_loc = self._create_location(
+            name="Ressuply",
+            location_id=self.warehouse.view_location_id.id,
+            company_id=self.main_company.id,
+        )
+        self.ressuply_loc_2 = self._create_location(
+            name="Ressuply",
+            location_id=self.wh2.view_location_id.id,
+            company_id=self.company_2.id,
         )
-
-        self.route = self.env["stock.location.route"].create(
-            {
-                "name": "Transfer",
-                "product_categ_selectable": False,
-                "product_selectable": True,
-                "company_id": self.main_company.id,
-                "sequence": 10,
-            }
+        self.route = self._create_location_route(
+            name="Transfer", company_id=self.main_company.id
         )
-
-        self.route_2 = self.env["stock.location.route"].create(
-            {
-                "name": "Transfer",
-                "product_categ_selectable": False,
-                "product_selectable": True,
-                "company_id": self.company_2.id,
-                "sequence": 10,
-            }
+        self.route_2 = self._create_location_route(
+            name="Transfer", company_id=self.company_2.id
         )
-
         self.uom_dozen = self.env["uom.uom"].create(
             {
                 "name": "Test-DozenA",
                 "category_id": self.categ_unit.id,
                 "factor_inv": 12,
                 "uom_type": "bigger",
                 "rounding": 0.001,
             }
         )
-
         self.env["stock.rule"].create(
             {
                 "name": "Transfer",
                 "route_id": self.route.id,
                 "location_src_id": self.ressuply_loc.id,
                 "location_id": self.warehouse.lot_stock_id.id,
                 "action": "pull",
                 "picking_type_id": self.warehouse.int_type_id.id,
                 "procure_method": "make_to_stock",
                 "warehouse_id": self.warehouse.id,
                 "company_id": self.main_company.id,
             }
         )
-
         self.env["stock.rule"].create(
             {
                 "name": "Transfer",
                 "route_id": self.route_2.id,
                 "location_src_id": self.ressuply_loc_2.id,
                 "location_id": self.wh2.lot_stock_id.id,
                 "action": "pull",
                 "picking_type_id": self.wh2.int_type_id.id,
                 "procure_method": "make_to_stock",
                 "warehouse_id": self.wh2.id,
                 "company_id": self.company_2.id,
             }
         )
-
         self.env["ir.config_parameter"].sudo().set_param(
             "stock.no_auto_scheduler", "True"
         )
 
     def _create_product(self, default_code, name, company_id, **vals):
         return self.env["product.product"].create(
             dict(
@@ -169,14 +141,27 @@
         return self.env["product.attribute.value"].create(
             {"name": name, "attribute_id": attribute}
         )
 
     def _create_product_attribute(self, name):
         return self.env["product.attribute"].create({"name": name})
 
+    def _create_location(self, **vals):
+        return self.env["stock.location"].create(dict(usage="internal", **vals))
+
+    def _create_location_route(self, **vals):
+        return self.env["stock.location.route"].create(
+            dict(
+                product_categ_selectable=False,
+                product_selectable=True,
+                sequence=10,
+                **vals
+            )
+        )
+
 
 class TestStockRequestBase(TestStockRequest):
     def setUp(self):
         super().setUp()
 
     def test_defaults(self):
         vals = {
@@ -710,15 +695,15 @@
         self.assertEqual(stock_request_1.qty_in_progress, 0)
         self.assertEqual(stock_request_1.qty_done, 4)
         self.assertEqual(stock_request_1.qty_cancelled, 0)
         self.assertEqual(stock_request_1.state, "done")
         self.assertEqual(stock_request_2.qty_in_progress, 0)
         self.assertEqual(stock_request_2.qty_done, 0)
         self.assertEqual(stock_request_2.qty_cancelled, 6)
-        self.assertEqual(stock_request_2.state, "done")
+        self.assertEqual(stock_request_2.state, "cancel")
 
     def test_cancel_request(self):
         expected_date = fields.Datetime.now()
         vals = {
             "company_id": self.main_company.id,
             "warehouse_id": self.warehouse.id,
             "location_id": self.warehouse.lot_stock_id.id,
@@ -1116,12 +1101,15 @@
         self.env["stock.backorder.confirmation"].with_context(
             button_validate_picking_ids=[picking.id]
         ).create({"pick_ids": [(4, picking.id)]}).process_cancel_backorder()
         sr1.refresh()
         sr2.refresh()
         sr3.refresh()
         self.assertEqual(sr1.state, "done")
+        self.assertEqual(sr1.qty_done, 5)
         self.assertEqual(sr1.qty_cancelled, 0)
-        self.assertEqual(sr2.state, "done")
+        self.assertEqual(sr2.state, "cancel")
+        self.assertEqual(sr2.qty_done, 1)
         self.assertEqual(sr2.qty_cancelled, 4)
-        self.assertEqual(sr3.state, "done")
+        self.assertEqual(sr3.state, "cancel")
+        self.assertEqual(sr3.qty_done, 0)
         self.assertEqual(sr3.qty_cancelled, 5)
```

## Comparing `odoo_addon_stock_request-15.0.1.4.0.4.dist-info/METADATA` & `odoo_addon_stock_request-15.0.1.5.0.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: odoo-addon-stock-request
-Version: 15.0.1.4.0.4
+Version: 15.0.1.5.0
 Summary: Internal request for stock
 Home-page: https://github.com/OCA/stock-logistics-warehouse
 Author: ForgeFlow, Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: LGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
```

## Comparing `odoo_addon_stock_request-15.0.1.4.0.4.dist-info/RECORD` & `odoo_addon_stock_request-15.0.1.5.0.dist-info/RECORD`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 odoo/addons/stock_request/README.rst,sha256=7dblhu1yrdzncb3xJ8Yekd9IUw_qZR8ZJKl0t9zSUG8,4628
 odoo/addons/stock_request/__init__.py,sha256=X9EJGOE2GtZbS0G82PtSXmWSZ_R8jEM0rlJTDliQjp4,21
-odoo/addons/stock_request/__manifest__.py,sha256=K3hb4qL55anMS-bVPB2_xwOXtn-G0A9yc_AaL3EaX70,951
+odoo/addons/stock_request/__manifest__.py,sha256=sav-D8w1y7-LtapS3NrjiVyyOcOLitt1en4VWSuAnng,951
 odoo/addons/stock_request/data/stock_request_sequence_data.xml,sha256=MKvzK__cH1gecmyqWK6Vj7yJ0o1-oKbqy2ydNoTUhs0,683
 odoo/addons/stock_request/i18n/ca.po,sha256=jnijgbwV_vTrdOg86tTN6by_HL5rMeBawoha_t35fYw,45488
 odoo/addons/stock_request/i18n/de.po,sha256=QGpQ6Ey5U_yyfyl6szLROxtFIe-3J5jBUEaMHBuRdW8,50412
 odoo/addons/stock_request/i18n/el_GR.po,sha256=AcuP5rhPzWDQOjkLYEDIsAAhrhZZVlw_i91JJFDJHU4,45508
 odoo/addons/stock_request/i18n/es.po,sha256=KlljhCDdMIXWjGmrPA31MISjeWzq4umLWRJhMD0VMvM,52200
 odoo/addons/stock_request/i18n/es_ES.po,sha256=OGv5zgVK9_mdwXhH1bj43KKs9XT3st1hKlwUgzP-S-8,45505
 odoo/addons/stock_request/i18n/eu.po,sha256=LxwTVYwBAsOCa4azbcbp47emp-bfqYAnXUYMMI-qIpw,45488
@@ -34,40 +34,40 @@
 odoo/addons/stock_request/migrations/15.0.1.4.0/post-migration.py,sha256=cYHRFqjoDAT8ZSci0UikmzR3iYa-155OGjXokK2Rsk0,315
 odoo/addons/stock_request/models/__init__.py,sha256=UectPmFQEw_3FXs6QynT2GyZWQjnDhVdBYIyxrDIVGM,432
 odoo/addons/stock_request/models/procurement_group.py,sha256=t4rDQT-nuHHl8AC5ZMg-MiEkNNao1QN0CoKyXsOaFjc,1085
 odoo/addons/stock_request/models/res_company.py,sha256=qhx4Bisbq5imAgrNYBHE5mb1I4tARWEDJkZCUejX8cQ,350
 odoo/addons/stock_request/models/res_config_settings.py,sha256=t64XhPCP5m0Px3bvdpmG_1WTo7MSZkdpSA-TMaYGHv8,1234
 odoo/addons/stock_request/models/stock_location.py,sha256=ckie9pUiJ2r_pU_-ojYZieaObCD3F2m1Xv4p3KYDGww,1474
 odoo/addons/stock_request/models/stock_location_route.py,sha256=ItW4v-ubi1brYvSFtKZFSdN5lX3XNJZ61xP4ejSegCw,870
-odoo/addons/stock_request/models/stock_move.py,sha256=FSsE6md4XZhQJwW1kvxfoJnVomrQDXD_o8AH45J7VHE,2544
+odoo/addons/stock_request/models/stock_move.py,sha256=2bbkqBfWWmp3rQogHhGDYFXCpi9vQba26Od8bPwh7Xo,2546
 odoo/addons/stock_request/models/stock_move_line.py,sha256=yG9lnTjfAdUBdcclnrsB5bzvpItmpV0wrCHIh7hdJDQ,2773
 odoo/addons/stock_request/models/stock_picking.py,sha256=65XbzhNNeliiaugeI13IxgZkPS5ixHanaXQVds7hhjo,1343
-odoo/addons/stock_request/models/stock_request.py,sha256=fS6az6oscdIaVjphQ7T-h3IUWtVyb6VrO1I1EZt7DF8,13062
+odoo/addons/stock_request/models/stock_request.py,sha256=e5PH55KwltNidBAKntl2P2Q41f9fNHsdnHO-OWcEqlY,13469
 odoo/addons/stock_request/models/stock_request_abstract.py,sha256=EBdv9gzul_2oYWebyCCRq6vY40AN6j5IyN9pUKkraew,9501
 odoo/addons/stock_request/models/stock_request_allocation.py,sha256=1c_OH1oWS-93lc__erTtlGxDr4FlOVffFMXRbRZxhEY,2867
-odoo/addons/stock_request/models/stock_request_order.py,sha256=2QD2ly3-iAYFpafArHoZxqQ5BRVh07v0vv1213ksmjk,12289
+odoo/addons/stock_request/models/stock_request_order.py,sha256=R_vSW-CEUhKuRlgRZ0pj73S6jhj6vZrbmD0R-5sXvog,12487
 odoo/addons/stock_request/models/stock_rule.py,sha256=bo-oD3LubsetGtFs7m3OpZxQ1QIPPBP9EoNByDKgisI,1048
 odoo/addons/stock_request/models/stock_warehouse.py,sha256=yiJG9Yw2A1dBXwi61ehdlRbyD8PnGJqiyfJxxyN8KQQ,1476
 odoo/addons/stock_request/readme/CONFIGURE.rst,sha256=oWuZKRYFvcvc6abPWiHAKiTqASkPxbsg1j8rP3MIL20,409
 odoo/addons/stock_request/readme/CONTRIBUTORS.rst,sha256=fFDNL4-SBextFuZYgQyAAehAJB9jycZgzssKO2Evfro,616
 odoo/addons/stock_request/readme/DESCRIPTION.rst,sha256=8FLFyvUAds5dVP7TaM5JTuKumXfvdJnusAUsbNRY5TI,147
 odoo/addons/stock_request/readme/ROADMAP.rst,sha256=0gooWv3yds0ZYbEvqbWCXhaNcmlEZnQs5vsqJFUqcb0,242
 odoo/addons/stock_request/readme/USAGE.rst,sha256=txX1WR6-6exib6YMrpcrShc2vzSvqm4VaGi_mXBknkc,493
 odoo/addons/stock_request/security/ir.model.access.csv,sha256=dsUwAR79-qQNVwCZhvCXyEvztUe4mNdw7QQOzx_aU3I,1994
 odoo/addons/stock_request/security/stock_request_security.xml,sha256=aXoOAmTMss_sLi_t57WYpZ-MfrO2_AmfcQ7JwB1Mi0w,6135
 odoo/addons/stock_request/static/description/icon.png,sha256=HZGM_z7Ta3zNQ2924BUiMfDuVSCWqrEwUQMWXBnK7yk,15218
 odoo/addons/stock_request/static/description/icon.svg,sha256=e3qo4KGYRy7Mfzhb_bCfVA-73Rk2Lx1z9_kz7tTjdO0,9771
 odoo/addons/stock_request/static/description/index.html,sha256=S_UyjGZ0jetX17oK_upmfC8uyYpSTe7-2tOl81esGws,15507
 odoo/addons/stock_request/tests/__init__.py,sha256=3NQ2fafGprBbsMjR2Y__yzyvFX5Vio1r0j6tT3FTbas,33
-odoo/addons/stock_request/tests/test_stock_request.py,sha256=o2h5QxXYlCmgQsbV_88lHNn3WCKI_w95NgiM6l0v_Zw,45381
+odoo/addons/stock_request/tests/test_stock_request.py,sha256=dlTdXkdq269rtliQaNwjVnYtjWPIJXFu9cyMtdJ5YPM,45373
 odoo/addons/stock_request/views/product.xml,sha256=CJ6RE5uGQLlIMDCPKxw8nhodb_rR3jaj-mF5ozCFUKI,1517
 odoo/addons/stock_request/views/res_config_settings_views.xml,sha256=Kz9EbzJWkVGW4YAPkPsWRlWxsuFW_IcFB1bY947urFA,7735
 odoo/addons/stock_request/views/stock_move_views.xml,sha256=Z5pNG0WfYz-CTlxgB-rma0BoT08VQDHnm3J_Ksu9BxA,1072
 odoo/addons/stock_request/views/stock_picking_views.xml,sha256=l0YKqO46QFDdiBoSzOoU7PBrLnNkFxPIHFbBcPWXTVk,1036
 odoo/addons/stock_request/views/stock_request_allocation_views.xml,sha256=NhoVR2RSOx_OuiKP34g5yzc4U0jNHbVwHySZsIF9BOc,2615
 odoo/addons/stock_request/views/stock_request_menu.xml,sha256=S_3HPkmYcHC_xtPjusHiZX7RUW5CGrJW3w52ScnJFNw,1308
 odoo/addons/stock_request/views/stock_request_order_views.xml,sha256=ErboT5H8T2Yx2kb_72M5fpEPQX9X4hWa-tXURJYcQtg,9931
 odoo/addons/stock_request/views/stock_request_views.xml,sha256=k6jts8SJz1WCqaeCod9dHABEC7i3W1fT-zajr-TUWHo,11319
-odoo_addon_stock_request-15.0.1.4.0.4.dist-info/METADATA,sha256=p86vB6OkUFCto2CWZ98HFfuG797Nb_Y2u-wAth9aFU8,5187
-odoo_addon_stock_request-15.0.1.4.0.4.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
-odoo_addon_stock_request-15.0.1.4.0.4.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo_addon_stock_request-15.0.1.4.0.4.dist-info/RECORD,,
+odoo_addon_stock_request-15.0.1.5.0.dist-info/METADATA,sha256=CMRFPIyLpY3ScXFO4PO-JXnS3RIlvS5yQ3KFGaWT3yI,5185
+odoo_addon_stock_request-15.0.1.5.0.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
+odoo_addon_stock_request-15.0.1.5.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo_addon_stock_request-15.0.1.5.0.dist-info/RECORD,,
```

