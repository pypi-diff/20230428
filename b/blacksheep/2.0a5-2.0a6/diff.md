# Comparing `tmp/blacksheep-2.0a5.tar.gz` & `tmp/blacksheep-2.0a6.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "blacksheep-2.0a5.tar", last modified: Sun Apr  2 15:04:54 2023, max compression
+gzip compressed data, was "blacksheep-2.0a6.tar", last modified: Fri Apr 28 06:03:13 2023, max compression
```

## Comparing `blacksheep-2.0a5.tar` & `blacksheep-2.0a6.tar`

### file list

```diff
@@ -1,176 +1,179 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.937207 blacksheep-2.0a5/
--rw-r--r--   0 runner    (1001) docker     (123)     1072 2023-04-02 15:02:14.000000 blacksheep-2.0a5/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)      233 2023-04-02 15:02:14.000000 blacksheep-2.0a5/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (123)    10288 2023-04-02 15:04:54.937207 blacksheep-2.0a5/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     9484 2023-04-02 15:02:14.000000 blacksheep-2.0a5/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.925207 blacksheep-2.0a5/blacksheep/
--rw-r--r--   0 runner    (1001) docker     (123)     3775 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      433 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/asgi.pyi
--rw-r--r--   0 runner    (1001) docker     (123)   701131 2023-04-02 15:03:30.000000 blacksheep-2.0a5/blacksheep/baseapp.c
--rw-r--r--   0 runner    (1001) docker     (123)      567 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/baseapp.pxd
--rw-r--r--   0 runner    (1001) docker     (123)     1535 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/baseapp.pyi
--rw-r--r--   0 runner    (1001) docker     (123)     6061 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/baseapp.pyx
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.925207 blacksheep-2.0a5/blacksheep/client/
--rw-r--r--   0 runner    (1001) docker     (123)      396 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/client/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    13126 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/client/connection.py
--rw-r--r--   0 runner    (1001) docker     (123)    10499 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/client/cookies.py
--rw-r--r--   0 runner    (1001) docker     (123)     2004 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/client/exceptions.py
--rw-r--r--   0 runner    (1001) docker     (123)     4632 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/client/pool.py
--rw-r--r--   0 runner    (1001) docker     (123)    15045 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/client/session.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.925207 blacksheep-2.0a5/blacksheep/common/
--rw-r--r--   0 runner    (1001) docker     (123)      397 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/common/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.925207 blacksheep-2.0a5/blacksheep/common/files/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/common/files/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     3370 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/common/files/asyncfs.py
--rw-r--r--   0 runner    (1001) docker     (123)      938 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/common/files/info.py
--rwxr-xr-x   0 runner    (1001) docker     (123)      679 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/common/files/pathsutils.py
--rw-r--r--   0 runner    (1001) docker     (123)     1457 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/common/types.py
--rw-r--r--   0 runner    (1001) docker     (123)   964597 2023-04-02 15:03:29.000000 blacksheep-2.0a5/blacksheep/contents.c
--rw-r--r--   0 runner    (1001) docker     (123)     1042 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/contents.pxd
--rw-r--r--   0 runner    (1001) docker     (123)     3061 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/contents.pyi
--rw-r--r--   0 runner    (1001) docker     (123)     7476 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/contents.pyx
--rw-r--r--   0 runner    (1001) docker     (123)   707655 2023-04-02 15:03:28.000000 blacksheep-2.0a5/blacksheep/cookies.c
--rw-r--r--   0 runner    (1001) docker     (123)      981 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/cookies.pxd
--rw-r--r--   0 runner    (1001) docker     (123)     1332 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/cookies.pyi
--rw-r--r--   0 runner    (1001) docker     (123)     6498 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/cookies.pyx
--rw-r--r--   0 runner    (1001) docker     (123)   699417 2023-04-02 15:03:27.000000 blacksheep-2.0a5/blacksheep/exceptions.c
--rw-r--r--   0 runner    (1001) docker     (123)      421 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/exceptions.pxd
--rw-r--r--   0 runner    (1001) docker     (123)     1707 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/exceptions.pyi
--rw-r--r--   0 runner    (1001) docker     (123)     1774 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/exceptions.pyx
--rw-r--r--   0 runner    (1001) docker     (123)   588643 2023-04-02 15:03:27.000000 blacksheep-2.0a5/blacksheep/headers.c
--rw-r--r--   0 runner    (1001) docker     (123)      798 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/headers.pxd
--rw-r--r--   0 runner    (1001) docker     (123)     1876 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/headers.pyi
--rw-r--r--   0 runner    (1001) docker     (123)     5660 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/headers.pyx
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.925207 blacksheep-2.0a5/blacksheep/includes/
--rw-r--r--   0 runner    (1001) docker     (123)       44 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/includes/consts.pxi
--rw-r--r--   0 runner    (1001) docker     (123)  1182750 2023-04-02 15:03:29.000000 blacksheep-2.0a5/blacksheep/messages.c
--rw-r--r--   0 runner    (1001) docker     (123)     2123 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/messages.pxd
--rw-r--r--   0 runner    (1001) docker     (123)     5566 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/messages.pyi
--rw-r--r--   0 runner    (1001) docker     (123)    18477 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/messages.pyx
--rw-r--r--   0 runner    (1001) docker     (123)      587 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/middlewares.py
--rw-r--r--   0 runner    (1001) docker     (123)     3320 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/multipart.py
--rw-r--r--   0 runner    (1001) docker     (123)      434 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/normalization.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/py.typed
--rw-r--r--   0 runner    (1001) docker     (123)     5564 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/ranges.py
--rw-r--r--   0 runner    (1001) docker     (123)   627544 2023-04-02 15:03:30.000000 blacksheep-2.0a5/blacksheep/scribe.c
--rw-r--r--   0 runner    (1001) docker     (123)      753 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/scribe.pxd
--rw-r--r--   0 runner    (1001) docker     (123)      841 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/scribe.pyi
--rw-r--r--   0 runner    (1001) docker     (123)     9277 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/scribe.pyx
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.929207 blacksheep-2.0a5/blacksheep/server/
--rw-r--r--   0 runner    (1001) docker     (123)      180 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    28718 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/application.py
--rw-r--r--   0 runner    (1001) docker     (123)     2537 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/asgi.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.929207 blacksheep-2.0a5/blacksheep/server/authentication/
--rw-r--r--   0 runner    (1001) docker     (123)     1838 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/authentication/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4376 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/authentication/cookie.py
--rw-r--r--   0 runner    (1001) docker     (123)     5124 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/authentication/jwt.py
--rw-r--r--   0 runner    (1001) docker     (123)    37888 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/authentication/oidc.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.929207 blacksheep-2.0a5/blacksheep/server/authorization/
--rw-r--r--   0 runner    (1001) docker     (123)     3344 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/authorization/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    27177 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/bindings.py
--rw-r--r--   0 runner    (1001) docker     (123)    13325 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/controllers.py
--rw-r--r--   0 runner    (1001) docker     (123)    11278 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/cors.py
--rw-r--r--   0 runner    (1001) docker     (123)    13278 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/csrf.py
--rw-r--r--   0 runner    (1001) docker     (123)     1581 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/dataprotection.py
--rw-r--r--   0 runner    (1001) docker     (123)     1932 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/di.py
--rw-r--r--   0 runner    (1001) docker     (123)      441 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/env.py
--rw-r--r--   0 runner    (1001) docker     (123)     1679 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/errors.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.929207 blacksheep-2.0a5/blacksheep/server/files/
--rw-r--r--   0 runner    (1001) docker     (123)     9368 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/files/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     8717 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/files/dynamic.py
--rw-r--r--   0 runner    (1001) docker     (123)     1134 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/files/static.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.929207 blacksheep-2.0a5/blacksheep/server/headers/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/headers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    11234 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/headers/cache.py
--rw-r--r--   0 runner    (1001) docker     (123)    19410 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/normalization.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.929207 blacksheep-2.0a5/blacksheep/server/openapi/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/openapi/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    13187 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/openapi/common.py
--rw-r--r--   0 runner    (1001) docker     (123)    16431 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/openapi/docstrings.py
--rw-r--r--   0 runner    (1001) docker     (123)      814 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/openapi/exceptions.py
--rw-r--r--   0 runner    (1001) docker     (123)     2831 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/openapi/ui.py
--rw-r--r--   0 runner    (1001) docker     (123)    37219 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/openapi/v3.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.929207 blacksheep-2.0a5/blacksheep/server/remotes/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/remotes/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    13119 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/remotes/forwarding.py
--rw-r--r--   0 runner    (1001) docker     (123)      963 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/remotes/hosts.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.929207 blacksheep-2.0a5/blacksheep/server/rendering/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/rendering/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      765 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/rendering/abc.py
--rw-r--r--   0 runner    (1001) docker     (123)     4016 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/rendering/jinja2.py
--rw-r--r--   0 runner    (1001) docker     (123)      417 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/rendering/models.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.933207 blacksheep-2.0a5/blacksheep/server/res/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/res/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1356 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/res/error.css
--rw-r--r--   0 runner    (1001) docker     (123)     1028 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/res/error.html
--rw-r--r--   0 runner    (1001) docker     (123)      331 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/res/fileslist.html
--rw-r--r--   0 runner    (1001) docker     (123)      590 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/res/redoc-ui.html
--rw-r--r--   0 runner    (1001) docker     (123)      841 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/res/swagger-ui.html
--rw-r--r--   0 runner    (1001) docker     (123)      263 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/resources.py
--rw-r--r--   0 runner    (1001) docker     (123)    10477 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/responses.py
--rw-r--r--   0 runner    (1001) docker     (123)    26785 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/routing.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.933207 blacksheep-2.0a5/blacksheep/server/security/
--rw-r--r--   0 runner    (1001) docker     (123)      417 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/security/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      832 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/security/hsts.py
--rw-r--r--   0 runner    (1001) docker     (123)     5352 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/server/websocket.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.933207 blacksheep-2.0a5/blacksheep/sessions/
--rw-r--r--   0 runner    (1001) docker     (123)     5399 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/sessions/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.933207 blacksheep-2.0a5/blacksheep/settings/
--rw-r--r--   0 runner    (1001) docker     (123)       76 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/settings/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      538 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/settings/di.py
--rw-r--r--   0 runner    (1001) docker     (123)     1073 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/settings/html.py
--rw-r--r--   0 runner    (1001) docker     (123)      894 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/settings/json.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.933207 blacksheep-2.0a5/blacksheep/testing/
--rw-r--r--   0 runner    (1001) docker     (123)      398 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/testing/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4379 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/testing/client.py
--rw-r--r--   0 runner    (1001) docker     (123)     3755 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/testing/helpers.py
--rw-r--r--   0 runner    (1001) docker     (123)     1440 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/testing/messages.py
--rw-r--r--   0 runner    (1001) docker     (123)     2659 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/testing/simulator.py
--rw-r--r--   0 runner    (1001) docker     (123)   417831 2023-04-02 15:03:26.000000 blacksheep-2.0a5/blacksheep/url.c
--rw-r--r--   0 runner    (1001) docker     (123)      751 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/url.pxd
--rw-r--r--   0 runner    (1001) docker     (123)      707 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/url.pyi
--rw-r--r--   0 runner    (1001) docker     (123)     4061 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/url.pyx
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.933207 blacksheep-2.0a5/blacksheep/utils/
--rw-r--r--   0 runner    (1001) docker     (123)      975 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/utils/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2733 2023-04-02 15:02:14.000000 blacksheep-2.0a5/blacksheep/utils/aio.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.925207 blacksheep-2.0a5/blacksheep.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)    10288 2023-04-02 15:04:54.000000 blacksheep-2.0a5/blacksheep.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     4242 2023-04-02 15:04:54.000000 blacksheep-2.0a5/blacksheep.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-02 15:04:54.000000 blacksheep-2.0a5/blacksheep.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-02 15:04:54.000000 blacksheep-2.0a5/blacksheep.egg-info/not-zip-safe
--rw-r--r--   0 runner    (1001) docker     (123)      374 2023-04-02 15:04:54.000000 blacksheep-2.0a5/blacksheep.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)       11 2023-04-02 15:04:54.000000 blacksheep-2.0a5/blacksheep.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (123)       38 2023-04-02 15:04:54.937207 blacksheep-2.0a5/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)     3496 2023-04-02 15:02:14.000000 blacksheep-2.0a5/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-02 15:04:54.937207 blacksheep-2.0a5/tests/
--rw-r--r--   0 runner    (1001) docker     (123)   113290 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_application.py
--rw-r--r--   0 runner    (1001) docker     (123)    18585 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_auth.py
--rw-r--r--   0 runner    (1001) docker     (123)     2294 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_auth_cookie.py
--rw-r--r--   0 runner    (1001) docker     (123)    19745 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_bindings.py
--rw-r--r--   0 runner    (1001) docker     (123)     3540 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_caching.py
--rw-r--r--   0 runner    (1001) docker     (123)     9781 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_contents.py
--rw-r--r--   0 runner    (1001) docker     (123)    26270 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_controllers.py
--rw-r--r--   0 runner    (1001) docker     (123)     7424 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_cookies.py
--rw-r--r--   0 runner    (1001) docker     (123)    20542 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_cors.py
--rw-r--r--   0 runner    (1001) docker     (123)    21340 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_csrf.py
--rw-r--r--   0 runner    (1001) docker     (123)     1427 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_dataprotection.py
--rw-r--r--   0 runner    (1001) docker     (123)      464 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_env.py
--rw-r--r--   0 runner    (1001) docker     (123)     5565 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_files_handler.py
--rw-r--r--   0 runner    (1001) docker     (123)    25887 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_files_serving.py
--rw-r--r--   0 runner    (1001) docker     (123)    20844 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_forwarding.py
--rw-r--r--   0 runner    (1001) docker     (123)     6298 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_headers.py
--rw-r--r--   0 runner    (1001) docker     (123)     5620 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_multipart.py
--rw-r--r--   0 runner    (1001) docker     (123)    19342 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_normalization.py
--rw-r--r--   0 runner    (1001) docker     (123)    28307 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_openapi_docstrings.py
--rw-r--r--   0 runner    (1001) docker     (123)    65012 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_openapi_v3.py
--rw-r--r--   0 runner    (1001) docker     (123)     1141 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_pathutils.py
--rw-r--r--   0 runner    (1001) docker     (123)     5288 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_ranges.py
--rw-r--r--   0 runner    (1001) docker     (123)    16338 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_requests.py
--rw-r--r--   0 runner    (1001) docker     (123)    28976 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_responses.py
--rw-r--r--   0 runner    (1001) docker     (123)    26915 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_router.py
--rw-r--r--   0 runner    (1001) docker     (123)     8607 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_sessions.py
--rw-r--r--   0 runner    (1001) docker     (123)     8666 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_templating.py
--rw-r--r--   0 runner    (1001) docker     (123)     7043 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_testing.py
--rw-r--r--   0 runner    (1001) docker     (123)     3220 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_url.py
--rw-r--r--   0 runner    (1001) docker     (123)     1401 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    12812 2023-04-02 15:02:14.000000 blacksheep-2.0a5/tests/test_websocket.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.771270 blacksheep-2.0a6/
+-rw-rw-rw-   0        0        0     1072 2023-04-28 05:59:52.000000 blacksheep-2.0a6/LICENSE
+-rw-rw-rw-   0        0        0      233 2023-04-28 05:59:52.000000 blacksheep-2.0a6/MANIFEST.in
+-rw-rw-rw-   0        0        0    10662 2023-04-28 06:03:13.771270 blacksheep-2.0a6/PKG-INFO
+-rw-rw-rw-   0        0        0     9484 2023-04-28 05:59:52.000000 blacksheep-2.0a6/README.md
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.708769 blacksheep-2.0a6/blacksheep/
+-rw-rw-rw-   0        0        0     4197 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/__init__.py
+-rw-rw-rw-   0        0        0      433 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/asgi.pyi
+-rw-rw-rw-   0        0        0   708668 2023-04-28 06:02:25.000000 blacksheep-2.0a6/blacksheep/baseapp.c
+-rw-rw-rw-   0        0        0      567 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/baseapp.pxd
+-rw-rw-rw-   0        0        0     1535 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/baseapp.pyi
+-rw-rw-rw-   0        0        0     6169 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/baseapp.pyx
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.708769 blacksheep-2.0a6/blacksheep/client/
+-rw-rw-rw-   0        0        0      396 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/client/__init__.py
+-rw-rw-rw-   0        0        0    13126 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/client/connection.py
+-rw-rw-rw-   0        0        0    10499 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/client/cookies.py
+-rw-rw-rw-   0        0        0     2004 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/client/exceptions.py
+-rw-rw-rw-   0        0        0     4753 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/client/pool.py
+-rw-rw-rw-   0        0        0    15045 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/client/session.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.724394 blacksheep-2.0a6/blacksheep/common/
+-rw-rw-rw-   0        0        0      397 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/common/__init__.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.724394 blacksheep-2.0a6/blacksheep/common/files/
+-rw-rw-rw-   0        0        0        0 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/common/files/__init__.py
+-rw-rw-rw-   0        0        0     3371 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/common/files/asyncfs.py
+-rw-rw-rw-   0        0        0      938 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/common/files/info.py
+-rw-rw-rw-   0        0        0      679 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/common/files/pathsutils.py
+-rw-rw-rw-   0        0        0     1457 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/common/types.py
+-rw-rw-rw-   0        0        0   966615 2023-04-28 06:02:22.000000 blacksheep-2.0a6/blacksheep/contents.c
+-rw-rw-rw-   0        0        0     1042 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/contents.pxd
+-rw-rw-rw-   0        0        0     3061 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/contents.pyi
+-rw-rw-rw-   0        0        0     7476 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/contents.pyx
+-rw-rw-rw-   0        0        0   709232 2023-04-28 06:02:21.000000 blacksheep-2.0a6/blacksheep/cookies.c
+-rw-rw-rw-   0        0        0      981 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/cookies.pxd
+-rw-rw-rw-   0        0        0     1332 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/cookies.pyi
+-rw-rw-rw-   0        0        0     6498 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/cookies.pyx
+-rw-rw-rw-   0        0        0   699602 2023-04-28 06:02:19.000000 blacksheep-2.0a6/blacksheep/exceptions.c
+-rw-rw-rw-   0        0        0      421 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/exceptions.pxd
+-rw-rw-rw-   0        0        0     1707 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/exceptions.pyi
+-rw-rw-rw-   0        0        0     1774 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/exceptions.pyx
+-rw-rw-rw-   0        0        0   588852 2023-04-28 06:02:20.000000 blacksheep-2.0a6/blacksheep/headers.c
+-rw-rw-rw-   0        0        0      798 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/headers.pxd
+-rw-rw-rw-   0        0        0     1876 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/headers.pyi
+-rw-rw-rw-   0        0        0     5660 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/headers.pyx
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.724394 blacksheep-2.0a6/blacksheep/includes/
+-rw-rw-rw-   0        0        0       44 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/includes/consts.pxi
+-rw-rw-rw-   0        0        0  1182891 2023-04-28 06:02:23.000000 blacksheep-2.0a6/blacksheep/messages.c
+-rw-rw-rw-   0        0        0     2123 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/messages.pxd
+-rw-rw-rw-   0        0        0     5566 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/messages.pyi
+-rw-rw-rw-   0        0        0    18461 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/messages.pyx
+-rw-rw-rw-   0        0        0      587 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/middlewares.py
+-rw-rw-rw-   0        0        0     3320 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/multipart.py
+-rw-rw-rw-   0        0        0      434 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/normalization.py
+-rw-rw-rw-   0        0        0        0 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/py.typed
+-rw-rw-rw-   0        0        0     5564 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/ranges.py
+-rw-rw-rw-   0        0        0   630854 2023-04-28 06:02:24.000000 blacksheep-2.0a6/blacksheep/scribe.c
+-rw-rw-rw-   0        0        0      753 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/scribe.pxd
+-rw-rw-rw-   0        0        0      841 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/scribe.pyi
+-rw-rw-rw-   0        0        0     9277 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/scribe.pyx
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.724394 blacksheep-2.0a6/blacksheep/server/
+-rw-rw-rw-   0        0        0      180 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/__init__.py
+-rw-rw-rw-   0        0        0    29511 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/application.py
+-rw-rw-rw-   0        0        0     2537 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/asgi.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.724394 blacksheep-2.0a6/blacksheep/server/authentication/
+-rw-rw-rw-   0        0        0     1838 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/authentication/__init__.py
+-rw-rw-rw-   0        0        0     4376 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/authentication/cookie.py
+-rw-rw-rw-   0        0        0     5125 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/authentication/jwt.py
+-rw-rw-rw-   0        0        0    37888 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/authentication/oidc.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.724394 blacksheep-2.0a6/blacksheep/server/authorization/
+-rw-rw-rw-   0        0        0     3345 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/authorization/__init__.py
+-rw-rw-rw-   0        0        0    27359 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/bindings.py
+-rw-rw-rw-   0        0        0     4337 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/compression.py
+-rw-rw-rw-   0        0        0    13325 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/controllers.py
+-rw-rw-rw-   0        0        0    11278 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/cors.py
+-rw-rw-rw-   0        0        0    13278 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/csrf.py
+-rw-rw-rw-   0        0        0     1581 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/dataprotection.py
+-rw-rw-rw-   0        0        0     1932 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/di.py
+-rw-rw-rw-   0        0        0     1316 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/env.py
+-rw-rw-rw-   0        0        0     1679 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/errors.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.740024 blacksheep-2.0a6/blacksheep/server/files/
+-rw-rw-rw-   0        0        0     9368 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/files/__init__.py
+-rw-rw-rw-   0        0        0     8717 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/files/dynamic.py
+-rw-rw-rw-   0        0        0     1134 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/files/static.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.740024 blacksheep-2.0a6/blacksheep/server/headers/
+-rw-rw-rw-   0        0        0        0 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/headers/__init__.py
+-rw-rw-rw-   0        0        0    11234 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/headers/cache.py
+-rw-rw-rw-   0        0        0    19420 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/normalization.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.740024 blacksheep-2.0a6/blacksheep/server/openapi/
+-rw-rw-rw-   0        0        0        0 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/openapi/__init__.py
+-rw-rw-rw-   0        0        0    13187 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/openapi/common.py
+-rw-rw-rw-   0        0        0    16431 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/openapi/docstrings.py
+-rw-rw-rw-   0        0        0      814 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/openapi/exceptions.py
+-rw-rw-rw-   0        0        0     2831 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/openapi/ui.py
+-rw-rw-rw-   0        0        0    38098 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/openapi/v3.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.740024 blacksheep-2.0a6/blacksheep/server/remotes/
+-rw-rw-rw-   0        0        0        0 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/remotes/__init__.py
+-rw-rw-rw-   0        0        0    13119 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/remotes/forwarding.py
+-rw-rw-rw-   0        0        0      963 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/remotes/hosts.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.740024 blacksheep-2.0a6/blacksheep/server/rendering/
+-rw-rw-rw-   0        0        0        0 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/rendering/__init__.py
+-rw-rw-rw-   0        0        0      765 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/rendering/abc.py
+-rw-rw-rw-   0        0        0     4016 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/rendering/jinja2.py
+-rw-rw-rw-   0        0        0      417 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/rendering/models.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.740024 blacksheep-2.0a6/blacksheep/server/res/
+-rw-rw-rw-   0        0        0        0 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/res/__init__.py
+-rw-rw-rw-   0        0        0     1356 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/res/error.css
+-rw-rw-rw-   0        0        0     1028 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/res/error.html
+-rw-rw-rw-   0        0        0      331 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/res/fileslist.html
+-rw-rw-rw-   0        0        0      590 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/res/redoc-ui.html
+-rw-rw-rw-   0        0        0      841 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/res/swagger-ui.html
+-rw-rw-rw-   0        0        0      263 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/resources.py
+-rw-rw-rw-   0        0        0    10477 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/responses.py
+-rw-rw-rw-   0        0        0    26805 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/routing.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.740024 blacksheep-2.0a6/blacksheep/server/security/
+-rw-rw-rw-   0        0        0      417 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/security/__init__.py
+-rw-rw-rw-   0        0        0      848 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/security/hsts.py
+-rw-rw-rw-   0        0        0     5352 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/server/websocket.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.740024 blacksheep-2.0a6/blacksheep/sessions/
+-rw-rw-rw-   0        0        0     5399 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/sessions/__init__.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.755643 blacksheep-2.0a6/blacksheep/settings/
+-rw-rw-rw-   0        0        0       76 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/settings/__init__.py
+-rw-rw-rw-   0        0        0      538 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/settings/di.py
+-rw-rw-rw-   0        0        0     1073 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/settings/html.py
+-rw-rw-rw-   0        0        0      894 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/settings/json.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.755643 blacksheep-2.0a6/blacksheep/testing/
+-rw-rw-rw-   0        0        0      398 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/testing/__init__.py
+-rw-rw-rw-   0        0        0     4379 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/testing/client.py
+-rw-rw-rw-   0        0        0     3755 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/testing/helpers.py
+-rw-rw-rw-   0        0        0     1440 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/testing/messages.py
+-rw-rw-rw-   0        0        0     2659 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/testing/simulator.py
+-rw-rw-rw-   0        0        0   417993 2023-04-28 06:02:19.000000 blacksheep-2.0a6/blacksheep/url.c
+-rw-rw-rw-   0        0        0      751 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/url.pxd
+-rw-rw-rw-   0        0        0      707 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/url.pyi
+-rw-rw-rw-   0        0        0     4061 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/url.pyx
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.755643 blacksheep-2.0a6/blacksheep/utils/
+-rw-rw-rw-   0        0        0     1115 2023-04-28 05:59:52.000000 blacksheep-2.0a6/blacksheep/utils/__init__.py
+-rw-rw-rw-   0        0        0     2733 2023-04-28 05:59:53.000000 blacksheep-2.0a6/blacksheep/utils/aio.py
+-rw-rw-rw-   0        0        0      693 2023-04-28 05:59:53.000000 blacksheep-2.0a6/blacksheep/utils/meta.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.708769 blacksheep-2.0a6/blacksheep.egg-info/
+-rw-rw-rw-   0        0        0    10662 2023-04-28 06:03:13.000000 blacksheep-2.0a6/blacksheep.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0     4301 2023-04-28 06:03:13.000000 blacksheep-2.0a6/blacksheep.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-04-28 06:03:13.000000 blacksheep-2.0a6/blacksheep.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0      268 2023-04-28 06:03:13.000000 blacksheep-2.0a6/blacksheep.egg-info/requires.txt
+-rw-rw-rw-   0        0        0       11 2023-04-28 06:03:13.000000 blacksheep-2.0a6/blacksheep.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0     1352 2023-04-28 05:59:53.000000 blacksheep-2.0a6/pyproject.toml
+-rw-rw-rw-   0        0        0       42 2023-04-28 06:03:13.771270 blacksheep-2.0a6/setup.cfg
+-rw-rw-rw-   0        0        0     1275 2023-04-28 05:59:53.000000 blacksheep-2.0a6/setup.py
+drwxrwxrwx   0        0        0        0 2023-04-28 06:03:13.771270 blacksheep-2.0a6/tests/
+-rw-rw-rw-   0        0        0   113290 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_application.py
+-rw-rw-rw-   0        0        0    18585 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_auth.py
+-rw-rw-rw-   0        0        0     2294 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_auth_cookie.py
+-rw-rw-rw-   0        0        0    19745 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_bindings.py
+-rw-rw-rw-   0        0        0     3540 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_caching.py
+-rw-rw-rw-   0        0        0     9781 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_contents.py
+-rw-rw-rw-   0        0        0    26270 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_controllers.py
+-rw-rw-rw-   0        0        0     7424 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_cookies.py
+-rw-rw-rw-   0        0        0    20542 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_cors.py
+-rw-rw-rw-   0        0        0    21340 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_csrf.py
+-rw-rw-rw-   0        0        0     1427 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_dataprotection.py
+-rw-rw-rw-   0        0        0      464 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_env.py
+-rw-rw-rw-   0        0        0     5565 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_files_handler.py
+-rw-rw-rw-   0        0        0    25887 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_files_serving.py
+-rw-rw-rw-   0        0        0    20844 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_forwarding.py
+-rw-rw-rw-   0        0        0     3531 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_gzip.py
+-rw-rw-rw-   0        0        0     6298 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_headers.py
+-rw-rw-rw-   0        0        0     5620 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_multipart.py
+-rw-rw-rw-   0        0        0    19342 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_normalization.py
+-rw-rw-rw-   0        0        0    28307 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_openapi_docstrings.py
+-rw-rw-rw-   0        0        0    70967 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_openapi_v3.py
+-rw-rw-rw-   0        0        0     1141 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_pathutils.py
+-rw-rw-rw-   0        0        0     5288 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_ranges.py
+-rw-rw-rw-   0        0        0    16338 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_requests.py
+-rw-rw-rw-   0        0        0    28976 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_responses.py
+-rw-rw-rw-   0        0        0    26915 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_router.py
+-rw-rw-rw-   0        0        0     8607 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_sessions.py
+-rw-rw-rw-   0        0        0     8666 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_templating.py
+-rw-rw-rw-   0        0        0     7043 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_testing.py
+-rw-rw-rw-   0        0        0     3220 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_url.py
+-rw-rw-rw-   0        0        0     1401 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_utils.py
+-rw-rw-rw-   0        0        0    12812 2023-04-28 05:59:53.000000 blacksheep-2.0a6/tests/test_websocket.py
```

### Comparing `blacksheep-2.0a5/LICENSE` & `blacksheep-2.0a6/LICENSE`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/PKG-INFO` & `blacksheep-2.0a6/README.md`

 * *Files 10% similar despite different names*

```diff
@@ -1,31 +1,7 @@
-Metadata-Version: 2.1
-Name: blacksheep
-Version: 2.0a5
-Summary: Fast web framework for Python asyncio
-Home-page: https://github.com/Neoteroi/BlackSheep
-Author: Roberto Prevato
-Author-email: roberto.prevato@gmail.com
-License: MIT
-Keywords: BlackSheep web framework
-Platform: *nix
-Classifier: Development Status :: 3 - Alpha
-Classifier: License :: OSI Approved :: MIT License
-Classifier: Programming Language :: Python :: 3.8
-Classifier: Programming Language :: Python :: 3.9
-Classifier: Programming Language :: Python :: 3.10
-Classifier: Programming Language :: Python :: 3.11
-Classifier: Environment :: Web Environment
-Classifier: Operating System :: OS Independent
-Classifier: Framework :: AsyncIO
-Description-Content-Type: text/markdown
-Provides-Extra: full
-Provides-Extra: jinja
-License-File: LICENSE
-
 [![Build](https://github.com/Neoteroi/BlackSheep/workflows/Main/badge.svg)](https://github.com/Neoteroi/BlackSheep/actions)
 [![pypi](https://img.shields.io/pypi/v/BlackSheep.svg?color=blue)](https://pypi.org/project/BlackSheep/)
 [![versions](https://img.shields.io/pypi/pyversions/blacksheep.svg)](https://github.com/robertoprevato/blacksheep)
 [![codecov](https://codecov.io/gh/Neoteroi/BlackSheep/branch/master/graph/badge.svg?token=Nzi29L0Eg1)](https://codecov.io/gh/Neoteroi/BlackSheep)
 [![license](https://img.shields.io/github/license/Neoteroi/blacksheep.svg)](https://github.com/Neoteroi/blacksheep/blob/main/LICENSE) [![Join the chat at https://gitter.im/Neoteroi/BlackSheep](https://badges.gitter.im/Neoteroi/BlackSheep.svg)](https://gitter.im/Neoteroi/BlackSheep?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge) [![documentation](https://img.shields.io/badge/📖-docs-purple)](https://www.neoteroi.dev/blacksheep/)
 
 # BlackSheep
```

### Comparing `blacksheep-2.0a5/README.md` & `blacksheep-2.0a6/PKG-INFO`

 * *Files 22% similar despite different names*

```diff
@@ -1,593 +1,667 @@
-00000000: 5b21 5b42 7569 6c64 5d28 6874 7470 733a  [![Build](https:
-00000010: 2f2f 6769 7468 7562 2e63 6f6d 2f4e 656f  //github.com/Neo
-00000020: 7465 726f 692f 426c 6163 6b53 6865 6570  teroi/BlackSheep
-00000030: 2f77 6f72 6b66 6c6f 7773 2f4d 6169 6e2f  /workflows/Main/
-00000040: 6261 6467 652e 7376 6729 5d28 6874 7470  badge.svg)](http
-00000050: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f4e  s://github.com/N
-00000060: 656f 7465 726f 692f 426c 6163 6b53 6865  eoteroi/BlackShe
-00000070: 6570 2f61 6374 696f 6e73 290a 5b21 5b70  ep/actions).[![p
-00000080: 7970 695d 2868 7474 7073 3a2f 2f69 6d67  ypi](https://img
-00000090: 2e73 6869 656c 6473 2e69 6f2f 7079 7069  .shields.io/pypi
-000000a0: 2f76 2f42 6c61 636b 5368 6565 702e 7376  /v/BlackSheep.sv
-000000b0: 673f 636f 6c6f 723d 626c 7565 295d 2868  g?color=blue)](h
-000000c0: 7474 7073 3a2f 2f70 7970 692e 6f72 672f  ttps://pypi.org/
-000000d0: 7072 6f6a 6563 742f 426c 6163 6b53 6865  project/BlackShe
-000000e0: 6570 2f29 0a5b 215b 7665 7273 696f 6e73  ep/).[![versions
-000000f0: 5d28 6874 7470 733a 2f2f 696d 672e 7368  ](https://img.sh
-00000100: 6965 6c64 732e 696f 2f70 7970 692f 7079  ields.io/pypi/py
-00000110: 7665 7273 696f 6e73 2f62 6c61 636b 7368  versions/blacksh
-00000120: 6565 702e 7376 6729 5d28 6874 7470 733a  eep.svg)](https:
-00000130: 2f2f 6769 7468 7562 2e63 6f6d 2f72 6f62  //github.com/rob
-00000140: 6572 746f 7072 6576 6174 6f2f 626c 6163  ertoprevato/blac
-00000150: 6b73 6865 6570 290a 5b21 5b63 6f64 6563  ksheep).[![codec
-00000160: 6f76 5d28 6874 7470 733a 2f2f 636f 6465  ov](https://code
-00000170: 636f 762e 696f 2f67 682f 4e65 6f74 6572  cov.io/gh/Neoter
-00000180: 6f69 2f42 6c61 636b 5368 6565 702f 6272  oi/BlackSheep/br
-00000190: 616e 6368 2f6d 6173 7465 722f 6772 6170  anch/master/grap
-000001a0: 682f 6261 6467 652e 7376 673f 746f 6b65  h/badge.svg?toke
-000001b0: 6e3d 4e7a 6932 394c 3045 6731 295d 2868  n=Nzi29L0Eg1)](h
-000001c0: 7474 7073 3a2f 2f63 6f64 6563 6f76 2e69  ttps://codecov.i
-000001d0: 6f2f 6768 2f4e 656f 7465 726f 692f 426c  o/gh/Neoteroi/Bl
-000001e0: 6163 6b53 6865 6570 290a 5b21 5b6c 6963  ackSheep).[![lic
-000001f0: 656e 7365 5d28 6874 7470 733a 2f2f 696d  ense](https://im
-00000200: 672e 7368 6965 6c64 732e 696f 2f67 6974  g.shields.io/git
-00000210: 6875 622f 6c69 6365 6e73 652f 4e65 6f74  hub/license/Neot
-00000220: 6572 6f69 2f62 6c61 636b 7368 6565 702e  eroi/blacksheep.
-00000230: 7376 6729 5d28 6874 7470 733a 2f2f 6769  svg)](https://gi
-00000240: 7468 7562 2e63 6f6d 2f4e 656f 7465 726f  thub.com/Neotero
-00000250: 692f 626c 6163 6b73 6865 6570 2f62 6c6f  i/blacksheep/blo
-00000260: 622f 6d61 696e 2f4c 4943 454e 5345 2920  b/main/LICENSE) 
-00000270: 5b21 5b4a 6f69 6e20 7468 6520 6368 6174  [![Join the chat
-00000280: 2061 7420 6874 7470 733a 2f2f 6769 7474   at https://gitt
-00000290: 6572 2e69 6d2f 4e65 6f74 6572 6f69 2f42  er.im/Neoteroi/B
-000002a0: 6c61 636b 5368 6565 705d 2868 7474 7073  lackSheep](https
-000002b0: 3a2f 2f62 6164 6765 732e 6769 7474 6572  ://badges.gitter
-000002c0: 2e69 6d2f 4e65 6f74 6572 6f69 2f42 6c61  .im/Neoteroi/Bla
-000002d0: 636b 5368 6565 702e 7376 6729 5d28 6874  ckSheep.svg)](ht
-000002e0: 7470 733a 2f2f 6769 7474 6572 2e69 6d2f  tps://gitter.im/
-000002f0: 4e65 6f74 6572 6f69 2f42 6c61 636b 5368  Neoteroi/BlackSh
-00000300: 6565 703f 7574 6d5f 736f 7572 6365 3d62  eep?utm_source=b
-00000310: 6164 6765 2675 746d 5f6d 6564 6975 6d3d  adge&utm_medium=
-00000320: 6261 6467 6526 7574 6d5f 6361 6d70 6169  badge&utm_campai
-00000330: 676e 3d70 722d 6261 6467 6526 7574 6d5f  gn=pr-badge&utm_
-00000340: 636f 6e74 656e 743d 6261 6467 6529 205b  content=badge) [
-00000350: 215b 646f 6375 6d65 6e74 6174 696f 6e5d  ![documentation]
-00000360: 2868 7474 7073 3a2f 2f69 6d67 2e73 6869  (https://img.shi
-00000370: 656c 6473 2e69 6f2f 6261 6467 652f f09f  elds.io/badge/..
-00000380: 9396 2d64 6f63 732d 7075 7270 6c65 295d  ..-docs-purple)]
-00000390: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
-000003a0: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
-000003b0: 6865 6570 2f29 0a0a 2320 426c 6163 6b53  heep/)..# BlackS
-000003c0: 6865 6570 0a42 6c61 636b 5368 6565 7020  heep.BlackSheep 
-000003d0: 6973 2061 6e20 6173 796e 6368 726f 6e6f  is an asynchrono
-000003e0: 7573 2077 6562 2066 7261 6d65 776f 726b  us web framework
-000003f0: 2074 6f20 6275 696c 6420 6576 656e 7420   to build event 
-00000400: 6261 7365 6420 7765 620a 6170 706c 6963  based web.applic
-00000410: 6174 696f 6e73 2077 6974 6820 5079 7468  ations with Pyth
-00000420: 6f6e 2e20 4974 2069 7320 696e 7370 6972  on. It is inspir
-00000430: 6564 2062 790a 5b46 6c61 736b 5d28 6874  ed by.[Flask](ht
-00000440: 7470 733a 2f2f 7061 6c6c 6574 7370 726f  tps://palletspro
-00000450: 6a65 6374 732e 636f 6d2f 702f 666c 6173  jects.com/p/flas
-00000460: 6b2f 292c 205b 4153 502e 4e45 540a 436f  k/), [ASP.NET.Co
-00000470: 7265 5d28 6874 7470 733a 2f2f 646f 6373  re](https://docs
-00000480: 2e6d 6963 726f 736f 6674 2e63 6f6d 2f65  .microsoft.com/e
-00000490: 6e2d 7573 2f61 7370 6e65 742f 636f 7265  n-us/aspnet/core
-000004a0: 2f29 2c20 616e 6420 7468 6520 776f 726b  /), and the work
-000004b0: 2062 7920 5b59 7572 790a 5365 6c69 7661   by [Yury.Seliva
-000004c0: 6e6f 765d 2868 7474 7073 3a2f 2f6d 6167  nov](https://mag
-000004d0: 6963 2e69 6f2f 626c 6f67 2f75 766c 6f6f  ic.io/blog/uvloo
-000004e0: 702d 626c 617a 696e 672d 6661 7374 2d70  p-blazing-fast-p
-000004f0: 7974 686f 6e2d 6e65 7477 6f72 6b69 6e67  ython-networking
-00000500: 2f29 2e0a 0a3c 7020 616c 6967 6e3d 226c  /)...<p align="l
-00000510: 6566 7422 3e0a 2020 3c61 2068 7265 663d  eft">.  <a href=
-00000520: 2223 626c 6163 6b73 6865 6570 223e 3c69  "#blacksheep"><i
-00000530: 6d67 2077 6964 7468 3d22 3332 3022 2068  mg width="320" h
-00000540: 6569 6768 743d 2232 3731 2220 7372 633d  eight="271" src=
-00000550: 2268 7474 7073 3a2f 2f77 7777 2e6e 656f  "https://www.neo
-00000560: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
-00000570: 6865 6570 2f69 6d67 2f62 6c61 636b 7368  heep/img/blacksh
-00000580: 6565 702e 706e 6722 2061 6c74 3d22 426c  eep.png" alt="Bl
-00000590: 6163 6b20 5368 6565 7022 3e3c 2f61 3e0a  ack Sheep"></a>.
-000005a0: 3c2f 703e 0a0a 6060 6062 6173 680a 7069  </p>..```bash.pi
-000005b0: 7020 696e 7374 616c 6c20 626c 6163 6b73  p install blacks
-000005c0: 6865 6570 0a60 6060 0a0a 2d2d 2d0a 0a60  heep.```..---..`
-000005d0: 6060 7079 7468 6f6e 0a66 726f 6d20 6461  ``python.from da
-000005e0: 7465 7469 6d65 2069 6d70 6f72 7420 6461  tetime import da
-000005f0: 7465 7469 6d65 0a0a 6672 6f6d 2062 6c61  tetime..from bla
-00000600: 636b 7368 6565 7020 696d 706f 7274 2041  cksheep import A
-00000610: 7070 6c69 6361 7469 6f6e 0a0a 0a61 7070  pplication...app
-00000620: 203d 2041 7070 6c69 6361 7469 6f6e 2829   = Application()
-00000630: 0a0a 4061 7070 2e72 6f75 7465 2822 2f22  ..@app.route("/"
-00000640: 290a 6173 796e 6320 6465 6620 686f 6d65  ).async def home
-00000650: 2829 3a0a 2020 2020 7265 7475 726e 2066  ():.    return f
-00000660: 2248 656c 6c6f 2c20 576f 726c 6421 207b  "Hello, World! {
-00000670: 6461 7465 7469 6d65 2e75 7463 6e6f 7728  datetime.utcnow(
-00000680: 292e 6973 6f66 6f72 6d61 7428 297d 220a  ).isoformat()}".
-00000690: 0a60 6060 0a0a 2323 2047 6574 7469 6e67  .```..## Getting
-000006a0: 2073 7461 7274 6564 0a0a 5468 6520 646f   started..The do
-000006b0: 6375 6d65 6e74 6174 696f 6e20 6f66 6665  cumentation offe
-000006c0: 7273 2067 6574 7469 6e67 2073 7461 7274  rs getting start
-000006d0: 6564 2074 7574 6f72 6961 6c73 3a0a 2a20  ed tutorials:.* 
-000006e0: 5b47 6574 7469 6e67 2073 7461 7274 6564  [Getting started
-000006f0: 3a0a 2020 6261 7369 6373 5d28 6874 7470  :.  basics](http
-00000700: 733a 2f2f 7777 772e 6e65 6f74 6572 6f69  s://www.neoteroi
-00000710: 2e64 6576 2f62 6c61 636b 7368 6565 702f  .dev/blacksheep/
-00000720: 6765 7474 696e 672d 7374 6172 7465 642f  getting-started/
-00000730: 290a 2a20 5b47 6574 7469 6e67 2073 7461  ).* [Getting sta
-00000740: 7274 6564 3a20 7468 6520 4d56 4320 7072  rted: the MVC pr
-00000750: 6f6a 6563 740a 2020 7465 6d70 6c61 7465  oject.  template
-00000760: 5d28 6874 7470 733a 2f2f 7777 772e 6e65  ](https://www.ne
-00000770: 6f74 6572 6f69 2e64 6576 2f62 6c61 636b  oteroi.dev/black
-00000780: 7368 6565 702f 6d76 632d 7072 6f6a 6563  sheep/mvc-projec
-00000790: 742d 7465 6d70 6c61 7465 2f29 0a0a 5468  t-template/)..Th
-000007a0: 6573 6520 7072 6f6a 6563 7420 7465 6d70  ese project temp
-000007b0: 6c61 7465 7320 6361 6e20 6265 2075 7365  lates can be use
-000007c0: 6420 746f 2073 7461 7274 206e 6577 2061  d to start new a
-000007d0: 7070 6c69 6361 7469 6f6e 7320 6661 7374  pplications fast
-000007e0: 6572 3a0a 0a2a 205b 4d56 4320 7072 6f6a  er:..* [MVC proj
-000007f0: 6563 740a 2020 7465 6d70 6c61 7465 5d28  ect.  template](
-00000800: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-00000810: 6f6d 2f4e 656f 7465 726f 692f 426c 6163  om/Neoteroi/Blac
-00000820: 6b53 6865 6570 4d56 4329 0a2a 205b 456d  kSheepMVC).* [Em
-00000830: 7074 7920 7072 6f6a 6563 740a 2020 7465  pty project.  te
-00000840: 6d70 6c61 7465 5d28 6874 7470 733a 2f2f  mplate](https://
-00000850: 6769 7468 7562 2e63 6f6d 2f4e 656f 7465  github.com/Neote
-00000860: 726f 692f 426c 6163 6b53 6865 6570 456d  roi/BlackSheepEm
-00000870: 7074 7950 726f 6a65 6374 290a 0a23 2320  ptyProject)..## 
-00000880: 5265 7175 6972 656d 656e 7473 0a0a 5b50  Requirements..[P
-00000890: 7974 686f 6e5d 2868 7474 7073 3a2f 2f77  ython](https://w
-000008a0: 7777 2e70 7974 686f 6e2e 6f72 6729 3a20  ww.python.org): 
-000008b0: 616e 7920 7665 7273 696f 6e20 6c69 7374  any version list
-000008c0: 6564 2069 6e20 7468 6520 7072 6f6a 6563  ed in the projec
-000008d0: 7427 730a 636c 6173 7369 6669 6572 732e  t's.classifiers.
-000008e0: 2054 6865 2063 7572 7265 6e74 206c 6973   The current lis
-000008f0: 7420 6973 3a0a 0a5b 215b 7665 7273 696f  t is:..[![versio
-00000900: 6e73 5d28 6874 7470 733a 2f2f 696d 672e  ns](https://img.
-00000910: 7368 6965 6c64 732e 696f 2f70 7970 692f  shields.io/pypi/
-00000920: 7079 7665 7273 696f 6e73 2f62 6c61 636b  pyversions/black
-00000930: 7368 6565 702e 7376 6729 5d28 6874 7470  sheep.svg)](http
-00000940: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f72  s://github.com/r
-00000950: 6f62 6572 746f 7072 6576 6174 6f2f 626c  obertoprevato/bl
-00000960: 6163 6b73 6865 6570 290a 0a0a 426c 6163  acksheep)...Blac
-00000970: 6b53 6865 6570 2062 656c 6f6e 6773 2074  kSheep belongs t
-00000980: 6f20 7468 6520 6361 7465 676f 7279 206f  o the category o
-00000990: 660a 5b41 5347 495d 2868 7474 7073 3a2f  f.[ASGI](https:/
-000009a0: 2f61 7367 692e 7265 6164 7468 6564 6f63  /asgi.readthedoc
-000009b0: 732e 696f 2f65 6e2f 6c61 7465 7374 2f29  s.io/en/latest/)
-000009c0: 2077 6562 2066 7261 6d65 776f 726b 732c   web frameworks,
-000009d0: 2073 6f20 6974 2072 6571 7569 7265 730a   so it requires.
-000009e0: 616e 2041 5347 4920 4854 5450 2073 6572  an ASGI HTTP ser
-000009f0: 7665 7220 746f 2072 756e 2c20 7375 6368  ver to run, such
-00000a00: 2061 7320 5b75 7669 636f 726e 5d28 6874   as [uvicorn](ht
-00000a10: 7470 3a2f 2f77 7777 2e75 7669 636f 726e  tp://www.uvicorn
-00000a20: 2e6f 7267 2f29 2c20 6f72 0a5b 6879 7065  .org/), or.[hype
-00000a30: 7263 6f72 6e5d 2868 7474 7073 3a2f 2f70  rcorn](https://p
-00000a40: 676a 6f6e 6573 2e67 6974 6c61 622e 696f  gjones.gitlab.io
-00000a50: 2f68 7970 6572 636f 726e 2f29 2e20 466f  /hypercorn/). Fo
-00000a60: 7220 6578 616d 706c 652c 2074 6f20 7573  r example, to us
-00000a70: 6520 6974 2077 6974 680a 7576 6963 6f72  e it with.uvicor
-00000a80: 6e3a 0a0a 6060 6062 6173 680a 2420 7069  n:..```bash.$ pi
-00000a90: 7020 696e 7374 616c 6c20 7576 6963 6f72  p install uvicor
-00000aa0: 6e0a 6060 600a 0a54 6f20 7275 6e20 616e  n.```..To run an
-00000ab0: 2061 7070 6c69 6361 7469 6f6e 206c 696b   application lik
-00000ac0: 6520 696e 2074 6865 2065 7861 6d70 6c65  e in the example
-00000ad0: 2061 626f 7665 2c20 7573 6520 7468 6520   above, use the 
-00000ae0: 6d65 7468 6f64 7320 7072 6f76 6964 6564  methods provided
-00000af0: 2062 790a 7468 6520 4153 4749 2048 5454   by.the ASGI HTT
-00000b00: 5020 5365 7276 6572 3a0a 0a60 6060 6261  P Server:..```ba
-00000b10: 7368 0a23 2069 6620 7468 6520 426c 6163  sh.# if the Blac
-00000b20: 6b53 6865 6570 2061 7070 2069 7320 6465  kSheep app is de
-00000b30: 6669 6e65 6420 696e 2061 2066 696c 6520  fined in a file 
-00000b40: 6073 6572 7665 722e 7079 600a 0a24 2075  `server.py`..$ u
-00000b50: 7669 636f 726e 2073 6572 7665 723a 6170  vicorn server:ap
-00000b60: 700a 6060 600a 0a54 6f20 7275 6e20 666f  p.```..To run fo
-00000b70: 7220 7072 6f64 7563 7469 6f6e 2c20 7265  r production, re
-00000b80: 6665 7220 746f 2074 6865 2064 6f63 756d  fer to the docum
-00000b90: 656e 7461 7469 6f6e 206f 6620 7468 6520  entation of the 
-00000ba0: 6368 6f73 656e 2041 5347 4920 7365 7276  chosen ASGI serv
-00000bb0: 6572 0a28 692e 652e 2066 6f72 205b 7576  er.(i.e. for [uv
-00000bc0: 6963 6f72 6e5d 2868 7474 7073 3a2f 2f77  icorn](https://w
-00000bd0: 7777 2e75 7669 636f 726e 2e6f 7267 2f23  ww.uvicorn.org/#
-00000be0: 7275 6e6e 696e 672d 7769 7468 2d67 756e  running-with-gun
-00000bf0: 6963 6f72 6e29 292e 0a0a 2323 2041 7574  icorn))...## Aut
-00000c00: 6f6d 6174 6963 2062 696e 6469 6e67 7320  omatic bindings 
-00000c10: 616e 6420 6465 7065 6e64 656e 6379 2069  and dependency i
-00000c20: 6e6a 6563 7469 6f6e 0a42 6c61 636b 5368  njection.BlackSh
-00000c30: 6565 7020 7375 7070 6f72 7473 2061 7574  eep supports aut
-00000c40: 6f6d 6174 6963 2062 696e 6469 6e67 206f  omatic binding o
-00000c50: 6620 7661 6c75 6573 2066 6f72 2072 6571  f values for req
-00000c60: 7565 7374 2068 616e 646c 6572 732c 2062  uest handlers, b
-00000c70: 7920 7479 7065 0a61 6e6e 6f74 6174 696f  y type.annotatio
-00000c80: 6e20 6f72 2062 7920 636f 6e76 656e 7469  n or by conventi
-00000c90: 6f6e 732e 2053 6565 205b 6d6f 7265 0a68  ons. See [more.h
-00000ca0: 6572 655d 2868 7474 7073 3a2f 2f77 7777  ere](https://www
-00000cb0: 2e6e 656f 7465 726f 692e 6465 762f 626c  .neoteroi.dev/bl
-00000cc0: 6163 6b73 6865 6570 2f72 6571 7565 7374  acksheep/request
-00000cd0: 732f 292e 0a0a 6060 6070 7974 686f 6e0a  s/)...```python.
-00000ce0: 6672 6f6d 2064 6174 6163 6c61 7373 6573  from dataclasses
-00000cf0: 2069 6d70 6f72 7420 6461 7461 636c 6173   import dataclas
-00000d00: 730a 0a66 726f 6d20 626c 6163 6b73 6865  s..from blackshe
-00000d10: 6570 2069 6d70 6f72 7420 4170 706c 6963  ep import Applic
-00000d20: 6174 696f 6e2c 2046 726f 6d4a 534f 4e2c  ation, FromJSON,
-00000d30: 2046 726f 6d51 7565 7279 0a0a 0a61 7070   FromQuery...app
-00000d40: 203d 2041 7070 6c69 6361 7469 6f6e 2829   = Application()
-00000d50: 0a0a 0a40 6461 7461 636c 6173 730a 636c  ...@dataclass.cl
-00000d60: 6173 7320 4372 6561 7465 4361 7449 6e70  ass CreateCatInp
-00000d70: 7574 3a0a 2020 2020 6e61 6d65 3a20 7374  ut:.    name: st
-00000d80: 720a 0a0a 4061 7070 2e72 6f75 7465 722e  r...@app.router.
-00000d90: 706f 7374 2822 2f61 7069 2f63 6174 7322  post("/api/cats"
-00000da0: 290a 6173 796e 6320 6465 6620 6578 616d  ).async def exam
-00000db0: 706c 6528 6461 7461 3a20 4672 6f6d 4a53  ple(data: FromJS
-00000dc0: 4f4e 5b43 7265 6174 6543 6174 496e 7075  ON[CreateCatInpu
-00000dd0: 745d 293a 0a20 2020 2023 2069 6e20 7468  t]):.    # in th
-00000de0: 6973 2065 7861 6d70 6c65 2c20 6461 7461  is example, data
-00000df0: 2069 7320 626f 756e 6420 6175 746f 6d61   is bound automa
-00000e00: 7469 6361 6c6c 7920 7265 6164 696e 6720  tically reading 
-00000e10: 7468 6520 4a53 4f4e 0a20 2020 2023 2070  the JSON.    # p
-00000e20: 6179 6c6f 6164 2061 6e64 2063 7265 6174  ayload and creat
-00000e30: 696e 6720 616e 2069 6e73 7461 6e63 6520  ing an instance 
-00000e40: 6f66 2060 4372 6561 7465 4361 7449 6e70  of `CreateCatInp
-00000e50: 7574 600a 2020 2020 2e2e 2e0a 0a0a 4061  ut`.    ......@a
-00000e60: 7070 2e72 6f75 7465 722e 6765 7428 222f  pp.router.get("/
-00000e70: 3a63 756c 7475 7265 5f63 6f64 652f 3a61  :culture_code/:a
-00000e80: 7265 6122 290a 6173 796e 6320 6465 6620  rea").async def 
-00000e90: 686f 6d65 2863 756c 7475 7265 5f63 6f64  home(culture_cod
-00000ea0: 652c 2061 7265 6129 3a0a 2020 2020 2320  e, area):.    # 
-00000eb0: 696e 2074 6869 7320 6578 616d 706c 652c  in this example,
-00000ec0: 2062 6f74 6820 7061 7261 6d65 7465 7273   both parameters
-00000ed0: 2061 7265 206f 6274 6169 6e65 6420 6672   are obtained fr
-00000ee0: 6f6d 2072 6f75 7465 7320 7769 7468 0a20  om routes with. 
-00000ef0: 2020 2023 206d 6174 6368 696e 6720 6e61     # matching na
-00000f00: 6d65 730a 2020 2020 7265 7475 726e 2066  mes.    return f
-00000f10: 2252 6571 7565 7374 2066 6f72 3a20 7b63  "Request for: {c
-00000f20: 756c 7475 7265 5f63 6f64 657d 207b 6172  ulture_code} {ar
-00000f30: 6561 7d22 0a0a 0a40 6170 702e 726f 7574  ea}"...@app.rout
-00000f40: 6572 2e67 6574 2822 2f61 7069 2f70 726f  er.get("/api/pro
-00000f50: 6475 6374 7322 290a 6465 6620 6765 745f  ducts").def get_
-00000f60: 7072 6f64 7563 7473 280a 2020 2020 7061  products(.    pa
-00000f70: 6765 3a20 696e 7420 3d20 312c 0a20 2020  ge: int = 1,.   
-00000f80: 2073 697a 653a 2069 6e74 203d 2033 302c   size: int = 30,
-00000f90: 0a20 2020 2073 6561 7263 683a 2073 7472  .    search: str
-00000fa0: 203d 2022 222c 0a29 3a0a 2020 2020 2320   = "",.):.    # 
-00000fb0: 7468 6973 2065 7861 6d70 6c65 2069 6c6c  this example ill
-00000fc0: 7573 7472 6174 6573 2073 7570 706f 7274  ustrates support
-00000fd0: 2066 6f72 2069 6d70 6c69 6369 7420 7175   for implicit qu
-00000fe0: 6572 7920 7061 7261 6d65 7465 7273 2077  ery parameters w
-00000ff0: 6974 680a 2020 2020 2320 6465 6661 756c  ith.    # defaul
-00001000: 7420 7661 6c75 6573 0a20 2020 2023 2073  t values.    # s
-00001010: 696e 6365 2074 6865 2073 6f75 7263 6520  ince the source 
-00001020: 6f66 2070 6167 652c 2073 697a 652c 2061  of page, size, a
-00001030: 6e64 2073 6561 7263 6820 6973 206e 6f74  nd search is not
-00001040: 2073 7065 6369 6669 6564 2061 6e64 206e   specified and n
-00001050: 6f0a 2020 2020 2320 726f 7574 6520 7061  o.    # route pa
-00001060: 7261 6d65 7465 7220 6d61 7463 6865 7320  rameter matches 
-00001070: 7468 6569 7220 6e61 6d65 2c20 7468 6579  their name, they
-00001080: 2061 7265 206f 6274 6169 6e65 6420 6672   are obtained fr
-00001090: 6f6d 2071 7565 7279 2073 7472 696e 670a  om query string.
-000010a0: 2020 2020 2e2e 2e0a 0a0a 4061 7070 2e72      ......@app.r
-000010b0: 6f75 7465 722e 6765 7428 222f 6170 692f  outer.get("/api/
-000010c0: 7072 6f64 7563 7473 3222 290a 6465 6620  products2").def 
-000010d0: 6765 745f 7072 6f64 7563 7473 3228 0a20  get_products2(. 
-000010e0: 2020 2070 6167 653a 2046 726f 6d51 7565     page: FromQue
-000010f0: 7279 5b69 6e74 5d20 3d20 4672 6f6d 5175  ry[int] = FromQu
-00001100: 6572 7928 3129 2c0a 2020 2020 7369 7a65  ery(1),.    size
-00001110: 3a20 4672 6f6d 5175 6572 795b 696e 745d  : FromQuery[int]
-00001120: 203d 2046 726f 6d51 7565 7279 2833 3029   = FromQuery(30)
-00001130: 2c0a 2020 2020 7365 6172 6368 3a20 4672  ,.    search: Fr
-00001140: 6f6d 5175 6572 795b 7374 725d 203d 2046  omQuery[str] = F
-00001150: 726f 6d51 7565 7279 2822 2229 2c0a 293a  romQuery(""),.):
-00001160: 0a20 2020 2023 2074 6869 7320 6578 616d  .    # this exam
-00001170: 706c 6520 696c 6c75 7374 7261 7465 7320  ple illustrates 
-00001180: 7375 7070 6f72 7420 666f 7220 6578 706c  support for expl
-00001190: 6963 6974 2071 7565 7279 2070 6172 616d  icit query param
-000011a0: 6574 6572 7320 7769 7468 0a20 2020 2023  eters with.    #
-000011b0: 2064 6566 6175 6c74 2076 616c 7565 730a   default values.
-000011c0: 2020 2020 2320 696e 2074 6869 7320 6361      # in this ca
-000011d0: 7365 2c20 7061 7261 6d65 7465 7273 2061  se, parameters a
-000011e0: 7265 2065 7870 6c69 6369 746c 7920 7265  re explicitly re
-000011f0: 6164 2066 726f 6d20 7175 6572 7920 7374  ad from query st
-00001200: 7269 6e67 0a20 2020 202e 2e2e 0a0a 6060  ring.    .....``
-00001210: 600a 0a49 7420 616c 736f 2073 7570 706f  `..It also suppo
-00001220: 7274 7320 5b64 6570 656e 6465 6e63 790a  rts [dependency.
-00001230: 696e 6a65 6374 696f 6e5d 2868 7474 7073  injection](https
-00001240: 3a2f 2f77 7777 2e6e 656f 7465 726f 692e  ://www.neoteroi.
-00001250: 6465 762f 626c 6163 6b73 6865 6570 2f64  dev/blacksheep/d
-00001260: 6570 656e 6465 6e63 792d 696e 6a65 6374  ependency-inject
-00001270: 696f 6e2f 292c 2061 0a66 6561 7475 7265  ion/), a.feature
-00001280: 2074 6861 7420 7072 6f76 6964 6573 2061   that provides a
-00001290: 2063 6f6e 7369 7374 656e 7420 616e 6420   consistent and 
-000012a0: 636c 6561 6e20 7761 7920 746f 2075 7365  clean way to use
-000012b0: 2064 6570 656e 6465 6e63 6965 7320 696e   dependencies in
-000012c0: 2072 6571 7565 7374 0a68 616e 646c 6572   request.handler
-000012d0: 732e 0a0a 2323 2047 656e 6572 6174 696f  s...## Generatio
-000012e0: 6e20 6f66 204f 7065 6e41 5049 2044 6f63  n of OpenAPI Doc
-000012f0: 756d 656e 7461 7469 6f6e 0a5b 4765 6e65  umentation.[Gene
-00001300: 7261 7469 6f6e 206f 6620 4f70 656e 4150  ration of OpenAP
-00001310: 4920 446f 6375 6d65 6e74 6174 696f 6e5d  I Documentation]
-00001320: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
-00001330: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
-00001340: 6865 6570 2f6f 7065 6e61 7069 2f29 2e0a  heep/openapi/)..
-00001350: 0a23 2320 5374 7261 7465 6769 6573 2074  .## Strategies t
-00001360: 6f20 6861 6e64 6c65 2061 7574 6865 6e74  o handle authent
-00001370: 6963 6174 696f 6e20 616e 6420 6175 7468  ication and auth
-00001380: 6f72 697a 6174 696f 6e0a 426c 6163 6b53  orization.BlackS
-00001390: 6865 6570 2069 6d70 6c65 6d65 6e74 7320  heep implements 
-000013a0: 7374 7261 7465 6769 6573 2074 6f20 6861  strategies to ha
-000013b0: 6e64 6c65 2061 7574 6865 6e74 6963 6174  ndle authenticat
-000013c0: 696f 6e20 616e 6420 6175 7468 6f72 697a  ion and authoriz
-000013d0: 6174 696f 6e2e 0a54 6865 7365 2066 6561  ation..These fea
-000013e0: 7475 7265 7320 6172 6520 646f 6375 6d65  tures are docume
-000013f0: 6e74 6564 2068 6572 653a 0a0a 2a20 5b41  nted here:..* [A
-00001400: 7574 6865 6e74 6963 6174 696f 6e5d 2868  uthentication](h
-00001410: 7474 7073 3a2f 2f77 7777 2e6e 656f 7465  ttps://www.neote
-00001420: 726f 692e 6465 762f 626c 6163 6b73 6865  roi.dev/blackshe
-00001430: 6570 2f61 7574 6865 6e74 6963 6174 696f  ep/authenticatio
-00001440: 6e2f 290a 2a20 5b41 7574 686f 7269 7a61  n/).* [Authoriza
-00001450: 7469 6f6e 5d28 6874 7470 733a 2f2f 7777  tion](https://ww
-00001460: 772e 6e65 6f74 6572 6f69 2e64 6576 2f62  w.neoteroi.dev/b
-00001470: 6c61 636b 7368 6565 702f 6175 7468 6f72  lacksheep/author
-00001480: 697a 6174 696f 6e2f 290a 0a60 6060 7079  ization/)..```py
-00001490: 7468 6f6e 0a61 7070 2e75 7365 5f61 7574  thon.app.use_aut
-000014a0: 6865 6e74 6963 6174 696f 6e28 295c 0a20  hentication()\. 
-000014b0: 2020 202e 6164 6428 4578 616d 706c 6541     .add(ExampleA
-000014c0: 7574 6865 6e74 6963 6174 696f 6e48 616e  uthenticationHan
-000014d0: 646c 6572 2829 290a 0a0a 6170 702e 7573  dler())...app.us
-000014e0: 655f 6175 7468 6f72 697a 6174 696f 6e28  e_authorization(
-000014f0: 295c 0a20 2020 202e 6164 6428 4164 6d69  )\.    .add(Admi
-00001500: 6e73 506f 6c69 6379 2829 290a 0a0a 4061  nsPolicy())...@a
-00001510: 7574 6828 2261 646d 696e 2229 0a40 6170  uth("admin").@ap
-00001520: 702e 726f 7574 6572 2e67 6574 2822 2f22  p.router.get("/"
-00001530: 290a 6173 796e 6320 6465 6620 6f6e 6c79  ).async def only
-00001540: 5f66 6f72 5f61 646d 696e 7328 293a 0a20  _for_admins():. 
-00001550: 2020 202e 2e2e 0a0a 0a40 6175 7468 2829     ......@auth()
-00001560: 0a40 6170 702e 726f 7574 6572 2e67 6574  .@app.router.get
-00001570: 2822 2f22 290a 6173 796e 6320 6465 6620  ("/").async def 
-00001580: 6f6e 6c79 5f66 6f72 5f61 7574 6865 6e74  only_for_authent
-00001590: 6963 6174 6564 5f75 7365 7273 2829 3a0a  icated_users():.
-000015a0: 2020 2020 2e2e 2e0a 6060 600a 0a53 696e      ....```..Sin
-000015b0: 6365 2076 6572 7369 6f6e 2060 312e 322e  ce version `1.2.
-000015c0: 3160 2c20 426c 6163 6b53 6865 6570 2069  1`, BlackSheep i
-000015d0: 6d70 6c65 6d65 6e74 733a 0a0a 2a20 5b42  mplements:..* [B
-000015e0: 7569 6c74 2d69 6e20 7375 7070 6f72 7420  uilt-in support 
-000015f0: 666f 7220 4f70 656e 4944 2043 6f6e 6e65  for OpenID Conne
-00001600: 6374 2061 7574 6865 6e74 6963 6174 696f  ct authenticatio
-00001610: 6e5d 2868 7474 7073 3a2f 2f77 7777 2e6e  n](https://www.n
-00001620: 656f 7465 726f 692e 6465 762f 626c 6163  eoteroi.dev/blac
-00001630: 6b73 6865 6570 2f61 7574 6865 6e74 6963  ksheep/authentic
-00001640: 6174 696f 6e2f 236f 6964 6329 0a2a 205b  ation/#oidc).* [
-00001650: 4275 696c 742d 696e 2073 7570 706f 7274  Built-in support
-00001660: 2066 6f72 204a 5754 2042 6561 7265 7220   for JWT Bearer 
-00001670: 6175 7468 656e 7469 6361 7469 6f6e 5d28  authentication](
-00001680: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
-00001690: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
-000016a0: 6565 702f 6175 7468 656e 7469 6361 7469  eep/authenticati
-000016b0: 6f6e 2f23 6a77 742d 6265 6172 6572 290a  on/#jwt-bearer).
-000016c0: 0a4d 6561 6e69 6e67 2074 6861 7420 6974  .Meaning that it
-000016d0: 2069 7320 6561 7379 2074 6f20 696e 7465   is easy to inte
-000016e0: 6772 6174 6520 7769 7468 2073 6572 7669  grate with servi
-000016f0: 6365 7320 7375 6368 2061 733a 0a2a 205b  ces such as:.* [
-00001700: 4175 7468 305d 2868 7474 7073 3a2f 2f61  Auth0](https://a
-00001710: 7574 6830 2e63 6f6d 290a 2a20 5b41 7a75  uth0.com).* [Azu
-00001720: 7265 2041 6374 6976 6520 4469 7265 6374  re Active Direct
-00001730: 6f72 795d 2868 7474 7073 3a2f 2f61 7a75  ory](https://azu
-00001740: 7265 2e6d 6963 726f 736f 6674 2e63 6f6d  re.microsoft.com
-00001750: 2f65 6e2d 7573 2f73 6572 7669 6365 732f  /en-us/services/
-00001760: 6163 7469 7665 2d64 6972 6563 746f 7279  active-directory
-00001770: 2f29 0a2a 205b 417a 7572 6520 4163 7469  /).* [Azure Acti
-00001780: 7665 2044 6972 6563 746f 7279 2042 3243  ve Directory B2C
-00001790: 5d28 6874 7470 733a 2f2f 646f 6373 2e6d  ](https://docs.m
-000017a0: 6963 726f 736f 6674 2e63 6f6d 2f65 6e2d  icrosoft.com/en-
-000017b0: 7573 2f61 7a75 7265 2f61 6374 6976 652d  us/azure/active-
-000017c0: 6469 7265 6374 6f72 792d 6232 632f 6f76  directory-b2c/ov
-000017d0: 6572 7669 6577 290a 2a20 5b4f 6b74 615d  erview).* [Okta]
-000017e0: 2868 7474 7073 3a2f 2f77 7777 2e6f 6b74  (https://www.okt
-000017f0: 612e 636f 6d29 0a0a 5265 6665 7220 746f  a.com)..Refer to
-00001800: 2074 6865 2064 6f63 756d 656e 7461 7469   the documentati
-00001810: 6f6e 2066 6f72 206d 6f72 6520 6465 7461  on for more deta
-00001820: 696c 7320 616e 6420 6578 616d 706c 6573  ils and examples
-00001830: 2e0a 0a23 2320 5765 6220 6672 616d 6577  ...## Web framew
-00001840: 6f72 6b20 6665 6174 7572 6573 0a0a 2a20  ork features..* 
-00001850: 5b41 5347 4920 636f 6d70 6174 6962 696c  [ASGI compatibil
-00001860: 6974 795d 2868 7474 7073 3a2f 2f77 7777  ity](https://www
-00001870: 2e6e 656f 7465 726f 692e 6465 762f 626c  .neoteroi.dev/bl
-00001880: 6163 6b73 6865 6570 2f61 7367 692f 290a  acksheep/asgi/).
-00001890: 2a20 5b52 6f75 7469 6e67 5d28 6874 7470  * [Routing](http
-000018a0: 733a 2f2f 7777 772e 6e65 6f74 6572 6f69  s://www.neoteroi
-000018b0: 2e64 6576 2f62 6c61 636b 7368 6565 702f  .dev/blacksheep/
-000018c0: 726f 7574 696e 672f 290a 2a20 5265 7175  routing/).* Requ
-000018d0: 6573 7420 6861 6e64 6c65 7273 2063 616e  est handlers can
-000018e0: 2062 6520 5b64 6566 696e 6564 2061 730a   be [defined as.
-000018f0: 2020 6675 6e63 7469 6f6e 735d 2868 7474    functions](htt
-00001900: 7073 3a2f 2f77 7777 2e6e 656f 7465 726f  ps://www.neotero
-00001910: 692e 6465 762f 626c 6163 6b73 6865 6570  i.dev/blacksheep
-00001920: 2f72 6571 7565 7374 2d68 616e 646c 6572  /request-handler
-00001930: 732f 292c 206f 7220 5b63 6c61 7373 0a20  s/), or [class. 
-00001940: 206d 6574 686f 6473 5d28 6874 7470 733a   methods](https:
-00001950: 2f2f 7777 772e 6e65 6f74 6572 6f69 2e64  //www.neoteroi.d
-00001960: 6576 2f62 6c61 636b 7368 6565 702f 636f  ev/blacksheep/co
-00001970: 6e74 726f 6c6c 6572 732f 290a 2a20 5b4d  ntrollers/).* [M
-00001980: 6964 646c 6577 6172 6573 5d28 6874 7470  iddlewares](http
-00001990: 733a 2f2f 7777 772e 6e65 6f74 6572 6f69  s://www.neoteroi
-000019a0: 2e64 6576 2f62 6c61 636b 7368 6565 702f  .dev/blacksheep/
-000019b0: 6d69 6464 6c65 7761 7265 732f 290a 2a20  middlewares/).* 
-000019c0: 5b57 6562 536f 636b 6574 5d28 6874 7470  [WebSocket](http
-000019d0: 733a 2f2f 7777 772e 6e65 6f74 6572 6f69  s://www.neoteroi
-000019e0: 2e64 6576 2f62 6c61 636b 7368 6565 702f  .dev/blacksheep/
-000019f0: 7765 6273 6f63 6b65 742f 290a 2a20 5b42  websocket/).* [B
-00001a00: 7569 6c74 2d69 6e20 7375 7070 6f72 7420  uilt-in support 
-00001a10: 666f 7220 6465 7065 6e64 656e 6379 0a20  for dependency. 
-00001a20: 2069 6e6a 6563 7469 6f6e 5d28 6874 7470   injection](http
-00001a30: 733a 2f2f 7777 772e 6e65 6f74 6572 6f69  s://www.neoteroi
-00001a40: 2e64 6576 2f62 6c61 636b 7368 6565 702f  .dev/blacksheep/
-00001a50: 6465 7065 6e64 656e 6379 2d69 6e6a 6563  dependency-injec
-00001a60: 7469 6f6e 2f29 0a2a 205b 5375 7070 6f72  tion/).* [Suppor
-00001a70: 7420 666f 7220 6175 746f 6d61 7469 6320  t for automatic 
-00001a80: 6269 6e64 696e 6720 6f66 2072 6f75 7465  binding of route
-00001a90: 2061 6e64 2071 7565 7279 2070 6172 616d   and query param
-00001aa0: 6574 6572 7320 746f 2072 6571 7565 7374  eters to request
-00001ab0: 0a20 2068 616e 646c 6572 7320 6d65 7468  .  handlers meth
-00001ac0: 6f64 730a 2020 6361 6c6c 735d 2868 7474  ods.  calls](htt
-00001ad0: 7073 3a2f 2f77 7777 2e6e 656f 7465 726f  ps://www.neotero
-00001ae0: 692e 6465 762f 626c 6163 6b73 6865 6570  i.dev/blacksheep
-00001af0: 2f67 6574 7469 6e67 2d73 7461 7274 6564  /getting-started
-00001b00: 2f23 6861 6e64 6c69 6e67 2d72 6f75 7465  /#handling-route
-00001b10: 2d70 6172 616d 6574 6572 7329 0a2a 205b  -parameters).* [
-00001b20: 5374 7261 7465 6779 2074 6f20 6861 6e64  Strategy to hand
-00001b30: 6c65 0a20 2065 7863 6570 7469 6f6e 735d  le.  exceptions]
-00001b40: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
-00001b50: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
-00001b60: 6865 6570 2f61 7070 6c69 6361 7469 6f6e  heep/application
-00001b70: 2f23 636f 6e66 6967 7572 696e 672d 6578  /#configuring-ex
-00001b80: 6365 7074 696f 6e73 2d68 616e 646c 6572  ceptions-handler
-00001b90: 7329 0a2a 205b 5374 7261 7465 6779 2074  s).* [Strategy t
-00001ba0: 6f20 6861 6e64 6c65 2061 7574 6865 6e74  o handle authent
-00001bb0: 6963 6174 696f 6e20 616e 640a 2020 6175  ication and.  au
-00001bc0: 7468 6f72 697a 6174 696f 6e5d 2868 7474  thorization](htt
-00001bd0: 7073 3a2f 2f77 7777 2e6e 656f 7465 726f  ps://www.neotero
-00001be0: 692e 6465 762f 626c 6163 6b73 6865 6570  i.dev/blacksheep
-00001bf0: 2f61 7574 6865 6e74 6963 6174 696f 6e2f  /authentication/
-00001c00: 290a 2a20 5b42 7569 6c74 2d69 6e20 7375  ).* [Built-in su
-00001c10: 7070 6f72 7420 666f 7220 4f70 656e 4944  pport for OpenID
-00001c20: 2043 6f6e 6e65 6374 2061 7574 6865 6e74   Connect authent
-00001c30: 6963 6174 696f 6e20 7573 696e 6720 4f49  ication using OI
-00001c40: 4443 0a20 2064 6973 636f 7665 7279 5d28  DC.  discovery](
-00001c50: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
-00001c60: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
-00001c70: 6565 702f 6175 7468 656e 7469 6361 7469  eep/authenticati
-00001c80: 6f6e 2f23 6f69 6463 290a 2a20 5b42 7569  on/#oidc).* [Bui
-00001c90: 6c74 2d69 6e20 7375 7070 6f72 7420 666f  lt-in support fo
-00001ca0: 7220 4a57 5420 4265 6172 6572 2061 7574  r JWT Bearer aut
-00001cb0: 6865 6e74 6963 6174 696f 6e20 7573 696e  hentication usin
-00001cc0: 6720 4f49 4443 2064 6973 636f 7665 7279  g OIDC discovery
-00001cd0: 2061 6e64 0a20 206f 7468 6572 2073 6f75   and.  other sou
-00001ce0: 7263 6573 206f 660a 2020 4a57 4b53 5d28  rces of.  JWKS](
-00001cf0: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
-00001d00: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
-00001d10: 6565 702f 6175 7468 656e 7469 6361 7469  eep/authenticati
-00001d20: 6f6e 2f23 6a77 742d 6265 6172 6572 290a  on/#jwt-bearer).
-00001d30: 2a20 5b48 616e 646c 6572 730a 2020 6e6f  * [Handlers.  no
-00001d40: 726d 616c 697a 6174 696f 6e5d 2868 7474  rmalization](htt
-00001d50: 7073 3a2f 2f77 7777 2e6e 656f 7465 726f  ps://www.neotero
-00001d60: 692e 6465 762f 626c 6163 6b73 6865 6570  i.dev/blacksheep
-00001d70: 2f72 6571 7565 7374 2d68 616e 646c 6572  /request-handler
-00001d80: 732f 290a 2a20 5b53 6572 7669 6e67 2073  s/).* [Serving s
-00001d90: 7461 7469 630a 2020 6669 6c65 735d 2868  tatic.  files](h
-00001da0: 7474 7073 3a2f 2f77 7777 2e6e 656f 7465  ttps://www.neote
-00001db0: 726f 692e 6465 762f 626c 6163 6b73 6865  roi.dev/blackshe
-00001dc0: 6570 2f73 7461 7469 632d 6669 6c65 732f  ep/static-files/
-00001dd0: 290a 2a20 5b49 6e74 6567 7261 7469 6f6e  ).* [Integration
-00001de0: 2077 6974 680a 2020 4a69 6e6a 6132 5d28   with.  Jinja2](
-00001df0: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
-00001e00: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
-00001e10: 6565 702f 7465 6d70 6c61 7469 6e67 2f29  eep/templating/)
-00001e20: 0a2a 205b 5375 7070 6f72 7420 666f 7220  .* [Support for 
-00001e30: 7365 7276 696e 6720 5350 4173 2074 6861  serving SPAs tha
-00001e40: 7420 7573 6520 4854 4d4c 3520 4869 7374  t use HTML5 Hist
-00001e50: 6f72 7920 4150 4920 666f 7220 636c 6965  ory API for clie
-00001e60: 6e74 2073 6964 650a 2020 726f 7574 696e  nt side.  routin
-00001e70: 675d 2868 7474 7073 3a2f 2f77 7777 2e6e  g](https://www.n
-00001e80: 656f 7465 726f 692e 6465 762f 626c 6163  eoteroi.dev/blac
-00001e90: 6b73 6865 6570 2f73 7461 7469 632d 6669  ksheep/static-fi
-00001ea0: 6c65 732f 2368 6f77 2d74 6f2d 7365 7276  les/#how-to-serv
-00001eb0: 652d 7370 6173 2d74 6861 742d 7573 652d  e-spas-that-use-
-00001ec0: 6874 6d6c 352d 6869 7374 6f72 792d 6170  html5-history-ap
-00001ed0: 6929 0a2a 205b 5375 7070 6f72 7420 666f  i).* [Support fo
-00001ee0: 7220 6175 746f 6d61 7469 6320 6765 6e65  r automatic gene
-00001ef0: 7261 7469 6f6e 206f 6620 4f70 656e 4150  ration of OpenAP
-00001f00: 490a 2020 446f 6375 6d65 6e74 6174 696f  I.  Documentatio
-00001f10: 6e5d 2868 7474 7073 3a2f 2f77 7777 2e6e  n](https://www.n
-00001f20: 656f 7465 726f 692e 6465 762f 626c 6163  eoteroi.dev/blac
-00001f30: 6b73 6865 6570 2f6f 7065 6e61 7069 2f29  ksheep/openapi/)
-00001f40: 0a2a 205b 5374 7261 7465 6779 2074 6f20  .* [Strategy to 
-00001f50: 6861 6e64 6c65 2043 4f52 5320 7365 7474  handle CORS sett
-00001f60: 696e 6773 5d28 6874 7470 733a 2f2f 7777  ings](https://ww
-00001f70: 772e 6e65 6f74 6572 6f69 2e64 6576 2f62  w.neoteroi.dev/b
-00001f80: 6c61 636b 7368 6565 702f 636f 7273 2f29  lacksheep/cors/)
-00001f90: 0a2a 205b 5365 7373 696f 6e73 5d28 6874  .* [Sessions](ht
-00001fa0: 7470 733a 2f2f 7777 772e 6e65 6f74 6572  tps://www.neoter
-00001fb0: 6f69 2e64 6576 2f62 6c61 636b 7368 6565  oi.dev/blackshee
-00001fc0: 702f 7365 7373 696f 6e73 2f29 0a2a 2053  p/sessions/).* S
-00001fd0: 7570 706f 7274 2066 6f72 2061 7574 6f6d  upport for autom
-00001fe0: 6174 6963 2062 696e 6469 6e67 206f 6620  atic binding of 
-00001ff0: 6064 6174 6163 6c61 7373 6573 6020 616e  `dataclasses` an
-00002000: 640a 2020 5b60 7079 6461 6e74 6963 605d  d.  [`pydantic`]
-00002010: 2868 7474 7073 3a2f 2f70 7964 616e 7469  (https://pydanti
-00002020: 632d 646f 6373 2e68 656c 706d 616e 7561  c-docs.helpmanua
-00002030: 6c2e 696f 2920 6d6f 6465 6c73 2074 6f20  l.io) models to 
-00002040: 6861 6e64 6c65 2074 6865 0a20 2072 6571  handle the.  req
-00002050: 7565 7374 2062 6f64 7920 7061 796c 6f61  uest body payloa
-00002060: 6420 6578 7065 6374 6564 2062 7920 7265  d expected by re
-00002070: 7175 6573 7420 6861 6e64 6c65 7273 0a2a  quest handlers.*
-00002080: 205b 6054 6573 7443 6c69 656e 7460 2063   [`TestClient` c
-00002090: 6c61 7373 2074 6f20 7369 6d70 6c69 6679  lass to simplify
-000020a0: 2074 6573 7469 6e67 206f 6620 6170 706c   testing of appl
-000020b0: 6963 6174 696f 6e73 5d28 6874 7470 733a  ications](https:
-000020c0: 2f2f 7777 772e 6e65 6f74 6572 6f69 2e64  //www.neoteroi.d
-000020d0: 6576 2f62 6c61 636b 7368 6565 702f 7465  ev/blacksheep/te
-000020e0: 7374 696e 672f 290a 2a20 5b41 6e74 6920  sting/).* [Anti 
-000020f0: 466f 7267 6572 7920 7661 6c69 6461 7469  Forgery validati
-00002100: 6f6e 5d28 6874 7470 733a 2f2f 7777 772e  on](https://www.
-00002110: 6e65 6f74 6572 6f69 2e64 6576 2f62 6c61  neoteroi.dev/bla
-00002120: 636b 7368 6565 702f 616e 7469 2d72 6571  cksheep/anti-req
-00002130: 7565 7374 2d66 6f72 6765 7279 2920 746f  uest-forgery) to
-00002140: 2070 726f 7465 6374 2061 6761 696e 7374   protect against
-00002150: 2043 726f 7373 2d53 6974 6520 5265 7175   Cross-Site Requ
-00002160: 6573 7420 466f 7267 6572 7920 2858 5352  est Forgery (XSR
-00002170: 462f 4353 5246 2920 6174 7461 636b 730a  F/CSRF) attacks.
-00002180: 0a23 2320 436c 6965 6e74 2066 6561 7475  .## Client featu
-00002190: 7265 730a 0a42 6c61 636b 5368 6565 7020  res..BlackSheep 
-000021a0: 696e 636c 7564 6573 2061 6e20 4854 5450  includes an HTTP
-000021b0: 2043 6c69 656e 742e 0a0a 2a2a 4578 616d   Client...**Exam
-000021c0: 706c 653a 2a2a 0a60 6060 7079 7468 6f6e  ple:**.```python
-000021d0: 0a69 6d70 6f72 7420 6173 796e 6369 6f0a  .import asyncio.
-000021e0: 0a66 726f 6d20 626c 6163 6b73 6865 6570  .from blacksheep
-000021f0: 2e63 6c69 656e 7420 696d 706f 7274 2043  .client import C
-00002200: 6c69 656e 7453 6573 7369 6f6e 0a0a 0a61  lientSession...a
-00002210: 7379 6e63 2064 6566 2063 6c69 656e 745f  sync def client_
-00002220: 6578 616d 706c 6528 293a 0a20 2020 2061  example():.    a
-00002230: 7379 6e63 2077 6974 6820 436c 6965 6e74  sync with Client
-00002240: 5365 7373 696f 6e28 2920 6173 2063 6c69  Session() as cli
-00002250: 656e 743a 0a20 2020 2020 2020 2072 6573  ent:.        res
-00002260: 706f 6e73 6520 3d20 6177 6169 7420 636c  ponse = await cl
-00002270: 6965 6e74 2e67 6574 2822 6874 7470 733a  ient.get("https:
-00002280: 2f2f 646f 6373 2e70 7974 686f 6e2e 6f72  //docs.python.or
-00002290: 672f 332f 2229 0a0a 2020 2020 2020 2020  g/3/")..        
-000022a0: 6173 7365 7274 2072 6573 706f 6e73 6520  assert response 
-000022b0: 6973 206e 6f74 204e 6f6e 650a 2020 2020  is not None.    
-000022c0: 2020 2020 7465 7874 203d 2061 7761 6974      text = await
-000022d0: 2072 6573 706f 6e73 652e 7465 7874 2829   response.text()
-000022e0: 0a20 2020 2020 2020 2070 7269 6e74 2874  .        print(t
-000022f0: 6578 7429 0a0a 0a61 7379 6e63 696f 2e72  ext)...asyncio.r
-00002300: 756e 2863 6c69 656e 745f 6578 616d 706c  un(client_exampl
-00002310: 6528 2929 0a60 6060 0a0a 2323 2053 7570  e()).```..## Sup
-00002320: 706f 7274 6564 2070 6c61 7466 6f72 6d73  ported platforms
-00002330: 2061 6e64 2072 756e 7469 6d65 730a 2a20   and runtimes.* 
-00002340: 5079 7468 6f6e 3a20 616c 6c20 7665 7273  Python: all vers
-00002350: 696f 6e73 2069 6e63 6c75 6465 6420 696e  ions included in
-00002360: 2074 6865 2062 7569 6c64 206d 6174 7269   the build matri
-00002370: 780a 2a20 5562 756e 7475 0a2a 2057 696e  x.* Ubuntu.* Win
-00002380: 646f 7773 2031 300a 2a20 6d61 634f 530a  dows 10.* macOS.
-00002390: 0a23 2320 446f 6375 6d65 6e74 6174 696f  .## Documentatio
-000023a0: 6e0a 506c 6561 7365 2072 6566 6572 2074  n.Please refer t
-000023b0: 6f20 7468 6520 5b64 6f63 756d 656e 7461  o the [documenta
-000023c0: 7469 6f6e 2077 6562 7369 7465 5d28 6874  tion website](ht
-000023d0: 7470 733a 2f2f 7777 772e 6e65 6f74 6572  tps://www.neoter
-000023e0: 6f69 2e64 6576 2f62 6c61 636b 7368 6565  oi.dev/blackshee
-000023f0: 702f 292e 0a0a 2323 2043 6f6d 6d75 6e69  p/)...## Communi
-00002400: 6361 7469 6f6e 0a5b 426c 6163 6b53 6865  cation.[BlackShe
-00002410: 6570 2063 6f6d 6d75 6e69 7479 2069 6e20  ep community in 
-00002420: 4769 7474 6572 5d28 6874 7470 733a 2f2f  Gitter](https://
-00002430: 6769 7474 6572 2e69 6d2f 4e65 6f74 6572  gitter.im/Neoter
-00002440: 6f69 2f42 6c61 636b 5368 6565 7029 2e0a  oi/BlackSheep)..
-00002450: 0a23 2320 4272 616e 6368 6573 0a54 6865  .## Branches.The
-00002460: 205f 6d61 696e 5f20 6272 616e 6368 2063   _main_ branch c
-00002470: 6f6e 7461 696e 7320 7468 6520 6375 7272  ontains the curr
-00002480: 656e 746c 7920 6465 7665 6c6f 7065 6420  ently developed 
-00002490: 7665 7273 696f 6e2c 2077 6869 6368 2069  version, which i
-000024a0: 7320 7665 7273 696f 6e20 320a 616c 7068  s version 2.alph
-000024b0: 612e 2054 6865 205f 7631 5f20 6272 616e  a. The _v1_ bran
-000024c0: 6368 2063 6f6e 7461 696e 7320 7665 7273  ch contains vers
-000024d0: 696f 6e20 3120 6f66 2074 6865 2077 6562  ion 1 of the web
-000024e0: 2066 7261 6d65 776f 726b 2c20 666f 7220   framework, for 
-000024f0: 6275 6773 2066 6978 6573 0a61 6e64 206d  bugs fixes.and m
-00002500: 6169 6e74 656e 616e 6365 2e0a            aintenance..
+00000000: 4d65 7461 6461 7461 2d56 6572 7369 6f6e  Metadata-Version
+00000010: 3a20 322e 310d 0a4e 616d 653a 2062 6c61  : 2.1..Name: bla
+00000020: 636b 7368 6565 700d 0a56 6572 7369 6f6e  cksheep..Version
+00000030: 3a20 322e 3061 360d 0a53 756d 6d61 7279  : 2.0a6..Summary
+00000040: 3a20 4661 7374 2077 6562 2066 7261 6d65  : Fast web frame
+00000050: 776f 726b 2066 6f72 2050 7974 686f 6e20  work for Python 
+00000060: 6173 796e 6369 6f0d 0a41 7574 686f 722d  asyncio..Author-
+00000070: 656d 6169 6c3a 2052 6f62 6572 746f 2050  email: Roberto P
+00000080: 7265 7661 746f 203c 726f 6265 7274 6f2e  revato <roberto.
+00000090: 7072 6576 6174 6f40 676d 6169 6c2e 636f  prevato@gmail.co
+000000a0: 6d3e 0d0a 5072 6f6a 6563 742d 5552 4c3a  m>..Project-URL:
+000000b0: 2048 6f6d 6570 6167 652c 2068 7474 7073   Homepage, https
+000000c0: 3a2f 2f67 6974 6875 622e 636f 6d2f 4e65  ://github.com/Ne
+000000d0: 6f74 6572 6f69 2f42 6c61 636b 5368 6565  oteroi/BlackShee
+000000e0: 700d 0a50 726f 6a65 6374 2d55 524c 3a20  p..Project-URL: 
+000000f0: 4275 6720 5472 6163 6b65 722c 2068 7474  Bug Tracker, htt
+00000100: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+00000110: 4e65 6f74 6572 6f69 2f42 6c61 636b 5368  Neoteroi/BlackSh
+00000120: 6565 702f 6973 7375 6573 0d0a 4b65 7977  eep/issues..Keyw
+00000130: 6f72 6473 3a20 626c 6163 6b73 6865 6570  ords: blacksheep
+00000140: 2c77 6562 2066 7261 6d65 776f 726b 2c61  ,web framework,a
+00000150: 7379 6e63 696f 0d0a 436c 6173 7369 6669  syncio..Classifi
+00000160: 6572 3a20 4465 7665 6c6f 706d 656e 7420  er: Development 
+00000170: 5374 6174 7573 203a 3a20 3320 2d20 416c  Status :: 3 - Al
+00000180: 7068 610d 0a43 6c61 7373 6966 6965 723a  pha..Classifier:
+00000190: 204c 6963 656e 7365 203a 3a20 4f53 4920   License :: OSI 
+000001a0: 4170 7072 6f76 6564 203a 3a20 4d49 5420  Approved :: MIT 
+000001b0: 4c69 6365 6e73 650d 0a43 6c61 7373 6966  License..Classif
+000001c0: 6965 723a 2050 726f 6772 616d 6d69 6e67  ier: Programming
+000001d0: 204c 616e 6775 6167 6520 3a3a 2050 7974   Language :: Pyt
+000001e0: 686f 6e20 3a3a 2033 2e38 0d0a 436c 6173  hon :: 3.8..Clas
+000001f0: 7369 6669 6572 3a20 5072 6f67 7261 6d6d  sifier: Programm
+00000200: 696e 6720 4c61 6e67 7561 6765 203a 3a20  ing Language :: 
+00000210: 5079 7468 6f6e 203a 3a20 332e 390d 0a43  Python :: 3.9..C
+00000220: 6c61 7373 6966 6965 723a 2050 726f 6772  lassifier: Progr
+00000230: 616d 6d69 6e67 204c 616e 6775 6167 6520  amming Language 
+00000240: 3a3a 2050 7974 686f 6e20 3a3a 2033 2e31  :: Python :: 3.1
+00000250: 300d 0a43 6c61 7373 6966 6965 723a 2050  0..Classifier: P
+00000260: 726f 6772 616d 6d69 6e67 204c 616e 6775  rogramming Langu
+00000270: 6167 6520 3a3a 2050 7974 686f 6e20 3a3a  age :: Python ::
+00000280: 2033 2e31 310d 0a43 6c61 7373 6966 6965   3.11..Classifie
+00000290: 723a 2045 6e76 6972 6f6e 6d65 6e74 203a  r: Environment :
+000002a0: 3a20 5765 6220 456e 7669 726f 6e6d 656e  : Web Environmen
+000002b0: 740d 0a43 6c61 7373 6966 6965 723a 204f  t..Classifier: O
+000002c0: 7065 7261 7469 6e67 2053 7973 7465 6d20  perating System 
+000002d0: 3a3a 204f 5320 496e 6465 7065 6e64 656e  :: OS Independen
+000002e0: 740d 0a43 6c61 7373 6966 6965 723a 2046  t..Classifier: F
+000002f0: 7261 6d65 776f 726b 203a 3a20 4173 796e  ramework :: Asyn
+00000300: 6349 4f0d 0a52 6571 7569 7265 732d 5079  cIO..Requires-Py
+00000310: 7468 6f6e 3a20 3e3d 332e 370d 0a44 6573  thon: >=3.7..Des
+00000320: 6372 6970 7469 6f6e 2d43 6f6e 7465 6e74  cription-Content
+00000330: 2d54 7970 653a 2074 6578 742f 6d61 726b  -Type: text/mark
+00000340: 646f 776e 0d0a 5072 6f76 6964 6573 2d45  down..Provides-E
+00000350: 7874 7261 3a20 6a69 6e6a 610d 0a50 726f  xtra: jinja..Pro
+00000360: 7669 6465 732d 4578 7472 613a 2066 756c  vides-Extra: ful
+00000370: 6c0d 0a4c 6963 656e 7365 2d46 696c 653a  l..License-File:
+00000380: 204c 4943 454e 5345 0d0a 0d0a 5b21 5b42   LICENSE....[![B
+00000390: 7569 6c64 5d28 6874 7470 733a 2f2f 6769  uild](https://gi
+000003a0: 7468 7562 2e63 6f6d 2f4e 656f 7465 726f  thub.com/Neotero
+000003b0: 692f 426c 6163 6b53 6865 6570 2f77 6f72  i/BlackSheep/wor
+000003c0: 6b66 6c6f 7773 2f4d 6169 6e2f 6261 6467  kflows/Main/badg
+000003d0: 652e 7376 6729 5d28 6874 7470 733a 2f2f  e.svg)](https://
+000003e0: 6769 7468 7562 2e63 6f6d 2f4e 656f 7465  github.com/Neote
+000003f0: 726f 692f 426c 6163 6b53 6865 6570 2f61  roi/BlackSheep/a
+00000400: 6374 696f 6e73 290d 0a5b 215b 7079 7069  ctions)..[![pypi
+00000410: 5d28 6874 7470 733a 2f2f 696d 672e 7368  ](https://img.sh
+00000420: 6965 6c64 732e 696f 2f70 7970 692f 762f  ields.io/pypi/v/
+00000430: 426c 6163 6b53 6865 6570 2e73 7667 3f63  BlackSheep.svg?c
+00000440: 6f6c 6f72 3d62 6c75 6529 5d28 6874 7470  olor=blue)](http
+00000450: 733a 2f2f 7079 7069 2e6f 7267 2f70 726f  s://pypi.org/pro
+00000460: 6a65 6374 2f42 6c61 636b 5368 6565 702f  ject/BlackSheep/
+00000470: 290d 0a5b 215b 7665 7273 696f 6e73 5d28  )..[![versions](
+00000480: 6874 7470 733a 2f2f 696d 672e 7368 6965  https://img.shie
+00000490: 6c64 732e 696f 2f70 7970 692f 7079 7665  lds.io/pypi/pyve
+000004a0: 7273 696f 6e73 2f62 6c61 636b 7368 6565  rsions/blackshee
+000004b0: 702e 7376 6729 5d28 6874 7470 733a 2f2f  p.svg)](https://
+000004c0: 6769 7468 7562 2e63 6f6d 2f72 6f62 6572  github.com/rober
+000004d0: 746f 7072 6576 6174 6f2f 626c 6163 6b73  toprevato/blacks
+000004e0: 6865 6570 290d 0a5b 215b 636f 6465 636f  heep)..[![codeco
+000004f0: 765d 2868 7474 7073 3a2f 2f63 6f64 6563  v](https://codec
+00000500: 6f76 2e69 6f2f 6768 2f4e 656f 7465 726f  ov.io/gh/Neotero
+00000510: 692f 426c 6163 6b53 6865 6570 2f62 7261  i/BlackSheep/bra
+00000520: 6e63 682f 6d61 7374 6572 2f67 7261 7068  nch/master/graph
+00000530: 2f62 6164 6765 2e73 7667 3f74 6f6b 656e  /badge.svg?token
+00000540: 3d4e 7a69 3239 4c30 4567 3129 5d28 6874  =Nzi29L0Eg1)](ht
+00000550: 7470 733a 2f2f 636f 6465 636f 762e 696f  tps://codecov.io
+00000560: 2f67 682f 4e65 6f74 6572 6f69 2f42 6c61  /gh/Neoteroi/Bla
+00000570: 636b 5368 6565 7029 0d0a 5b21 5b6c 6963  ckSheep)..[![lic
+00000580: 656e 7365 5d28 6874 7470 733a 2f2f 696d  ense](https://im
+00000590: 672e 7368 6965 6c64 732e 696f 2f67 6974  g.shields.io/git
+000005a0: 6875 622f 6c69 6365 6e73 652f 4e65 6f74  hub/license/Neot
+000005b0: 6572 6f69 2f62 6c61 636b 7368 6565 702e  eroi/blacksheep.
+000005c0: 7376 6729 5d28 6874 7470 733a 2f2f 6769  svg)](https://gi
+000005d0: 7468 7562 2e63 6f6d 2f4e 656f 7465 726f  thub.com/Neotero
+000005e0: 692f 626c 6163 6b73 6865 6570 2f62 6c6f  i/blacksheep/blo
+000005f0: 622f 6d61 696e 2f4c 4943 454e 5345 2920  b/main/LICENSE) 
+00000600: 5b21 5b4a 6f69 6e20 7468 6520 6368 6174  [![Join the chat
+00000610: 2061 7420 6874 7470 733a 2f2f 6769 7474   at https://gitt
+00000620: 6572 2e69 6d2f 4e65 6f74 6572 6f69 2f42  er.im/Neoteroi/B
+00000630: 6c61 636b 5368 6565 705d 2868 7474 7073  lackSheep](https
+00000640: 3a2f 2f62 6164 6765 732e 6769 7474 6572  ://badges.gitter
+00000650: 2e69 6d2f 4e65 6f74 6572 6f69 2f42 6c61  .im/Neoteroi/Bla
+00000660: 636b 5368 6565 702e 7376 6729 5d28 6874  ckSheep.svg)](ht
+00000670: 7470 733a 2f2f 6769 7474 6572 2e69 6d2f  tps://gitter.im/
+00000680: 4e65 6f74 6572 6f69 2f42 6c61 636b 5368  Neoteroi/BlackSh
+00000690: 6565 703f 7574 6d5f 736f 7572 6365 3d62  eep?utm_source=b
+000006a0: 6164 6765 2675 746d 5f6d 6564 6975 6d3d  adge&utm_medium=
+000006b0: 6261 6467 6526 7574 6d5f 6361 6d70 6169  badge&utm_campai
+000006c0: 676e 3d70 722d 6261 6467 6526 7574 6d5f  gn=pr-badge&utm_
+000006d0: 636f 6e74 656e 743d 6261 6467 6529 205b  content=badge) [
+000006e0: 215b 646f 6375 6d65 6e74 6174 696f 6e5d  ![documentation]
+000006f0: 2868 7474 7073 3a2f 2f69 6d67 2e73 6869  (https://img.shi
+00000700: 656c 6473 2e69 6f2f 6261 6467 652f f09f  elds.io/badge/..
+00000710: 9396 2d64 6f63 732d 7075 7270 6c65 295d  ..-docs-purple)]
+00000720: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
+00000730: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
+00000740: 6865 6570 2f29 0d0a 0d0a 2320 426c 6163  heep/)....# Blac
+00000750: 6b53 6865 6570 0d0a 426c 6163 6b53 6865  kSheep..BlackShe
+00000760: 6570 2069 7320 616e 2061 7379 6e63 6872  ep is an asynchr
+00000770: 6f6e 6f75 7320 7765 6220 6672 616d 6577  onous web framew
+00000780: 6f72 6b20 746f 2062 7569 6c64 2065 7665  ork to build eve
+00000790: 6e74 2062 6173 6564 2077 6562 0d0a 6170  nt based web..ap
+000007a0: 706c 6963 6174 696f 6e73 2077 6974 6820  plications with 
+000007b0: 5079 7468 6f6e 2e20 4974 2069 7320 696e  Python. It is in
+000007c0: 7370 6972 6564 2062 790d 0a5b 466c 6173  spired by..[Flas
+000007d0: 6b5d 2868 7474 7073 3a2f 2f70 616c 6c65  k](https://palle
+000007e0: 7473 7072 6f6a 6563 7473 2e63 6f6d 2f70  tsprojects.com/p
+000007f0: 2f66 6c61 736b 2f29 2c20 5b41 5350 2e4e  /flask/), [ASP.N
+00000800: 4554 0d0a 436f 7265 5d28 6874 7470 733a  ET..Core](https:
+00000810: 2f2f 646f 6373 2e6d 6963 726f 736f 6674  //docs.microsoft
+00000820: 2e63 6f6d 2f65 6e2d 7573 2f61 7370 6e65  .com/en-us/aspne
+00000830: 742f 636f 7265 2f29 2c20 616e 6420 7468  t/core/), and th
+00000840: 6520 776f 726b 2062 7920 5b59 7572 790d  e work by [Yury.
+00000850: 0a53 656c 6976 616e 6f76 5d28 6874 7470  .Selivanov](http
+00000860: 733a 2f2f 6d61 6769 632e 696f 2f62 6c6f  s://magic.io/blo
+00000870: 672f 7576 6c6f 6f70 2d62 6c61 7a69 6e67  g/uvloop-blazing
+00000880: 2d66 6173 742d 7079 7468 6f6e 2d6e 6574  -fast-python-net
+00000890: 776f 726b 696e 672f 292e 0d0a 0d0a 3c70  working/).....<p
+000008a0: 2061 6c69 676e 3d22 6c65 6674 223e 0d0a   align="left">..
+000008b0: 2020 3c61 2068 7265 663d 2223 626c 6163    <a href="#blac
+000008c0: 6b73 6865 6570 223e 3c69 6d67 2077 6964  ksheep"><img wid
+000008d0: 7468 3d22 3332 3022 2068 6569 6768 743d  th="320" height=
+000008e0: 2232 3731 2220 7372 633d 2268 7474 7073  "271" src="https
+000008f0: 3a2f 2f77 7777 2e6e 656f 7465 726f 692e  ://www.neoteroi.
+00000900: 6465 762f 626c 6163 6b73 6865 6570 2f69  dev/blacksheep/i
+00000910: 6d67 2f62 6c61 636b 7368 6565 702e 706e  mg/blacksheep.pn
+00000920: 6722 2061 6c74 3d22 426c 6163 6b20 5368  g" alt="Black Sh
+00000930: 6565 7022 3e3c 2f61 3e0d 0a3c 2f70 3e0d  eep"></a>..</p>.
+00000940: 0a0d 0a60 6060 6261 7368 0d0a 7069 7020  ...```bash..pip 
+00000950: 696e 7374 616c 6c20 626c 6163 6b73 6865  install blackshe
+00000960: 6570 0d0a 6060 600d 0a0d 0a2d 2d2d 0d0a  ep..```....---..
+00000970: 0d0a 6060 6070 7974 686f 6e0d 0a66 726f  ..```python..fro
+00000980: 6d20 6461 7465 7469 6d65 2069 6d70 6f72  m datetime impor
+00000990: 7420 6461 7465 7469 6d65 0d0a 0d0a 6672  t datetime....fr
+000009a0: 6f6d 2062 6c61 636b 7368 6565 7020 696d  om blacksheep im
+000009b0: 706f 7274 2041 7070 6c69 6361 7469 6f6e  port Application
+000009c0: 0d0a 0d0a 0d0a 6170 7020 3d20 4170 706c  ......app = Appl
+000009d0: 6963 6174 696f 6e28 290d 0a0d 0a40 6170  ication()....@ap
+000009e0: 702e 726f 7574 6528 222f 2229 0d0a 6173  p.route("/")..as
+000009f0: 796e 6320 6465 6620 686f 6d65 2829 3a0d  ync def home():.
+00000a00: 0a20 2020 2072 6574 7572 6e20 6622 4865  .    return f"He
+00000a10: 6c6c 6f2c 2057 6f72 6c64 2120 7b64 6174  llo, World! {dat
+00000a20: 6574 696d 652e 7574 636e 6f77 2829 2e69  etime.utcnow().i
+00000a30: 736f 666f 726d 6174 2829 7d22 0d0a 0d0a  soformat()}"....
+00000a40: 6060 600d 0a0d 0a23 2320 4765 7474 696e  ```....## Gettin
+00000a50: 6720 7374 6172 7465 640d 0a0d 0a54 6865  g started....The
+00000a60: 2064 6f63 756d 656e 7461 7469 6f6e 206f   documentation o
+00000a70: 6666 6572 7320 6765 7474 696e 6720 7374  ffers getting st
+00000a80: 6172 7465 6420 7475 746f 7269 616c 733a  arted tutorials:
+00000a90: 0d0a 2a20 5b47 6574 7469 6e67 2073 7461  ..* [Getting sta
+00000aa0: 7274 6564 3a0d 0a20 2062 6173 6963 735d  rted:..  basics]
+00000ab0: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
+00000ac0: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
+00000ad0: 6865 6570 2f67 6574 7469 6e67 2d73 7461  heep/getting-sta
+00000ae0: 7274 6564 2f29 0d0a 2a20 5b47 6574 7469  rted/)..* [Getti
+00000af0: 6e67 2073 7461 7274 6564 3a20 7468 6520  ng started: the 
+00000b00: 4d56 4320 7072 6f6a 6563 740d 0a20 2074  MVC project..  t
+00000b10: 656d 706c 6174 655d 2868 7474 7073 3a2f  emplate](https:/
+00000b20: 2f77 7777 2e6e 656f 7465 726f 692e 6465  /www.neoteroi.de
+00000b30: 762f 626c 6163 6b73 6865 6570 2f6d 7663  v/blacksheep/mvc
+00000b40: 2d70 726f 6a65 6374 2d74 656d 706c 6174  -project-templat
+00000b50: 652f 290d 0a0d 0a54 6865 7365 2070 726f  e/)....These pro
+00000b60: 6a65 6374 2074 656d 706c 6174 6573 2063  ject templates c
+00000b70: 616e 2062 6520 7573 6564 2074 6f20 7374  an be used to st
+00000b80: 6172 7420 6e65 7720 6170 706c 6963 6174  art new applicat
+00000b90: 696f 6e73 2066 6173 7465 723a 0d0a 0d0a  ions faster:....
+00000ba0: 2a20 5b4d 5643 2070 726f 6a65 6374 0d0a  * [MVC project..
+00000bb0: 2020 7465 6d70 6c61 7465 5d28 6874 7470    template](http
+00000bc0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f4e  s://github.com/N
+00000bd0: 656f 7465 726f 692f 426c 6163 6b53 6865  eoteroi/BlackShe
+00000be0: 6570 4d56 4329 0d0a 2a20 5b45 6d70 7479  epMVC)..* [Empty
+00000bf0: 2070 726f 6a65 6374 0d0a 2020 7465 6d70   project..  temp
+00000c00: 6c61 7465 5d28 6874 7470 733a 2f2f 6769  late](https://gi
+00000c10: 7468 7562 2e63 6f6d 2f4e 656f 7465 726f  thub.com/Neotero
+00000c20: 692f 426c 6163 6b53 6865 6570 456d 7074  i/BlackSheepEmpt
+00000c30: 7950 726f 6a65 6374 290d 0a0d 0a23 2320  yProject)....## 
+00000c40: 5265 7175 6972 656d 656e 7473 0d0a 0d0a  Requirements....
+00000c50: 5b50 7974 686f 6e5d 2868 7474 7073 3a2f  [Python](https:/
+00000c60: 2f77 7777 2e70 7974 686f 6e2e 6f72 6729  /www.python.org)
+00000c70: 3a20 616e 7920 7665 7273 696f 6e20 6c69  : any version li
+00000c80: 7374 6564 2069 6e20 7468 6520 7072 6f6a  sted in the proj
+00000c90: 6563 7427 730d 0a63 6c61 7373 6966 6965  ect's..classifie
+00000ca0: 7273 2e20 5468 6520 6375 7272 656e 7420  rs. The current 
+00000cb0: 6c69 7374 2069 733a 0d0a 0d0a 5b21 5b76  list is:....[![v
+00000cc0: 6572 7369 6f6e 735d 2868 7474 7073 3a2f  ersions](https:/
+00000cd0: 2f69 6d67 2e73 6869 656c 6473 2e69 6f2f  /img.shields.io/
+00000ce0: 7079 7069 2f70 7976 6572 7369 6f6e 732f  pypi/pyversions/
+00000cf0: 626c 6163 6b73 6865 6570 2e73 7667 295d  blacksheep.svg)]
+00000d00: 2868 7474 7073 3a2f 2f67 6974 6875 622e  (https://github.
+00000d10: 636f 6d2f 726f 6265 7274 6f70 7265 7661  com/robertopreva
+00000d20: 746f 2f62 6c61 636b 7368 6565 7029 0d0a  to/blacksheep)..
+00000d30: 0d0a 0d0a 426c 6163 6b53 6865 6570 2062  ....BlackSheep b
+00000d40: 656c 6f6e 6773 2074 6f20 7468 6520 6361  elongs to the ca
+00000d50: 7465 676f 7279 206f 660d 0a5b 4153 4749  tegory of..[ASGI
+00000d60: 5d28 6874 7470 733a 2f2f 6173 6769 2e72  ](https://asgi.r
+00000d70: 6561 6474 6865 646f 6373 2e69 6f2f 656e  eadthedocs.io/en
+00000d80: 2f6c 6174 6573 742f 2920 7765 6220 6672  /latest/) web fr
+00000d90: 616d 6577 6f72 6b73 2c20 736f 2069 7420  ameworks, so it 
+00000da0: 7265 7175 6972 6573 0d0a 616e 2041 5347  requires..an ASG
+00000db0: 4920 4854 5450 2073 6572 7665 7220 746f  I HTTP server to
+00000dc0: 2072 756e 2c20 7375 6368 2061 7320 5b75   run, such as [u
+00000dd0: 7669 636f 726e 5d28 6874 7470 3a2f 2f77  vicorn](http://w
+00000de0: 7777 2e75 7669 636f 726e 2e6f 7267 2f29  ww.uvicorn.org/)
+00000df0: 2c20 6f72 0d0a 5b68 7970 6572 636f 726e  , or..[hypercorn
+00000e00: 5d28 6874 7470 733a 2f2f 7067 6a6f 6e65  ](https://pgjone
+00000e10: 732e 6769 746c 6162 2e69 6f2f 6879 7065  s.gitlab.io/hype
+00000e20: 7263 6f72 6e2f 292e 2046 6f72 2065 7861  rcorn/). For exa
+00000e30: 6d70 6c65 2c20 746f 2075 7365 2069 7420  mple, to use it 
+00000e40: 7769 7468 0d0a 7576 6963 6f72 6e3a 0d0a  with..uvicorn:..
+00000e50: 0d0a 6060 6062 6173 680d 0a24 2070 6970  ..```bash..$ pip
+00000e60: 2069 6e73 7461 6c6c 2075 7669 636f 726e   install uvicorn
+00000e70: 0d0a 6060 600d 0a0d 0a54 6f20 7275 6e20  ..```....To run 
+00000e80: 616e 2061 7070 6c69 6361 7469 6f6e 206c  an application l
+00000e90: 696b 6520 696e 2074 6865 2065 7861 6d70  ike in the examp
+00000ea0: 6c65 2061 626f 7665 2c20 7573 6520 7468  le above, use th
+00000eb0: 6520 6d65 7468 6f64 7320 7072 6f76 6964  e methods provid
+00000ec0: 6564 2062 790d 0a74 6865 2041 5347 4920  ed by..the ASGI 
+00000ed0: 4854 5450 2053 6572 7665 723a 0d0a 0d0a  HTTP Server:....
+00000ee0: 6060 6062 6173 680d 0a23 2069 6620 7468  ```bash..# if th
+00000ef0: 6520 426c 6163 6b53 6865 6570 2061 7070  e BlackSheep app
+00000f00: 2069 7320 6465 6669 6e65 6420 696e 2061   is defined in a
+00000f10: 2066 696c 6520 6073 6572 7665 722e 7079   file `server.py
+00000f20: 600d 0a0d 0a24 2075 7669 636f 726e 2073  `....$ uvicorn s
+00000f30: 6572 7665 723a 6170 700d 0a60 6060 0d0a  erver:app..```..
+00000f40: 0d0a 546f 2072 756e 2066 6f72 2070 726f  ..To run for pro
+00000f50: 6475 6374 696f 6e2c 2072 6566 6572 2074  duction, refer t
+00000f60: 6f20 7468 6520 646f 6375 6d65 6e74 6174  o the documentat
+00000f70: 696f 6e20 6f66 2074 6865 2063 686f 7365  ion of the chose
+00000f80: 6e20 4153 4749 2073 6572 7665 720d 0a28  n ASGI server..(
+00000f90: 692e 652e 2066 6f72 205b 7576 6963 6f72  i.e. for [uvicor
+00000fa0: 6e5d 2868 7474 7073 3a2f 2f77 7777 2e75  n](https://www.u
+00000fb0: 7669 636f 726e 2e6f 7267 2f23 7275 6e6e  vicorn.org/#runn
+00000fc0: 696e 672d 7769 7468 2d67 756e 6963 6f72  ing-with-gunicor
+00000fd0: 6e29 292e 0d0a 0d0a 2323 2041 7574 6f6d  n)).....## Autom
+00000fe0: 6174 6963 2062 696e 6469 6e67 7320 616e  atic bindings an
+00000ff0: 6420 6465 7065 6e64 656e 6379 2069 6e6a  d dependency inj
+00001000: 6563 7469 6f6e 0d0a 426c 6163 6b53 6865  ection..BlackShe
+00001010: 6570 2073 7570 706f 7274 7320 6175 746f  ep supports auto
+00001020: 6d61 7469 6320 6269 6e64 696e 6720 6f66  matic binding of
+00001030: 2076 616c 7565 7320 666f 7220 7265 7175   values for requ
+00001040: 6573 7420 6861 6e64 6c65 7273 2c20 6279  est handlers, by
+00001050: 2074 7970 650d 0a61 6e6e 6f74 6174 696f   type..annotatio
+00001060: 6e20 6f72 2062 7920 636f 6e76 656e 7469  n or by conventi
+00001070: 6f6e 732e 2053 6565 205b 6d6f 7265 0d0a  ons. See [more..
+00001080: 6865 7265 5d28 6874 7470 733a 2f2f 7777  here](https://ww
+00001090: 772e 6e65 6f74 6572 6f69 2e64 6576 2f62  w.neoteroi.dev/b
+000010a0: 6c61 636b 7368 6565 702f 7265 7175 6573  lacksheep/reques
+000010b0: 7473 2f29 2e0d 0a0d 0a60 6060 7079 7468  ts/).....```pyth
+000010c0: 6f6e 0d0a 6672 6f6d 2064 6174 6163 6c61  on..from datacla
+000010d0: 7373 6573 2069 6d70 6f72 7420 6461 7461  sses import data
+000010e0: 636c 6173 730d 0a0d 0a66 726f 6d20 626c  class....from bl
+000010f0: 6163 6b73 6865 6570 2069 6d70 6f72 7420  acksheep import 
+00001100: 4170 706c 6963 6174 696f 6e2c 2046 726f  Application, Fro
+00001110: 6d4a 534f 4e2c 2046 726f 6d51 7565 7279  mJSON, FromQuery
+00001120: 0d0a 0d0a 0d0a 6170 7020 3d20 4170 706c  ......app = Appl
+00001130: 6963 6174 696f 6e28 290d 0a0d 0a0d 0a40  ication()......@
+00001140: 6461 7461 636c 6173 730d 0a63 6c61 7373  dataclass..class
+00001150: 2043 7265 6174 6543 6174 496e 7075 743a   CreateCatInput:
+00001160: 0d0a 2020 2020 6e61 6d65 3a20 7374 720d  ..    name: str.
+00001170: 0a0d 0a0d 0a40 6170 702e 726f 7574 6572  .....@app.router
+00001180: 2e70 6f73 7428 222f 6170 692f 6361 7473  .post("/api/cats
+00001190: 2229 0d0a 6173 796e 6320 6465 6620 6578  ")..async def ex
+000011a0: 616d 706c 6528 6461 7461 3a20 4672 6f6d  ample(data: From
+000011b0: 4a53 4f4e 5b43 7265 6174 6543 6174 496e  JSON[CreateCatIn
+000011c0: 7075 745d 293a 0d0a 2020 2020 2320 696e  put]):..    # in
+000011d0: 2074 6869 7320 6578 616d 706c 652c 2064   this example, d
+000011e0: 6174 6120 6973 2062 6f75 6e64 2061 7574  ata is bound aut
+000011f0: 6f6d 6174 6963 616c 6c79 2072 6561 6469  omatically readi
+00001200: 6e67 2074 6865 204a 534f 4e0d 0a20 2020  ng the JSON..   
+00001210: 2023 2070 6179 6c6f 6164 2061 6e64 2063   # payload and c
+00001220: 7265 6174 696e 6720 616e 2069 6e73 7461  reating an insta
+00001230: 6e63 6520 6f66 2060 4372 6561 7465 4361  nce of `CreateCa
+00001240: 7449 6e70 7574 600d 0a20 2020 202e 2e2e  tInput`..    ...
+00001250: 0d0a 0d0a 0d0a 4061 7070 2e72 6f75 7465  ......@app.route
+00001260: 722e 6765 7428 222f 3a63 756c 7475 7265  r.get("/:culture
+00001270: 5f63 6f64 652f 3a61 7265 6122 290d 0a61  _code/:area")..a
+00001280: 7379 6e63 2064 6566 2068 6f6d 6528 6375  sync def home(cu
+00001290: 6c74 7572 655f 636f 6465 2c20 6172 6561  lture_code, area
+000012a0: 293a 0d0a 2020 2020 2320 696e 2074 6869  ):..    # in thi
+000012b0: 7320 6578 616d 706c 652c 2062 6f74 6820  s example, both 
+000012c0: 7061 7261 6d65 7465 7273 2061 7265 206f  parameters are o
+000012d0: 6274 6169 6e65 6420 6672 6f6d 2072 6f75  btained from rou
+000012e0: 7465 7320 7769 7468 0d0a 2020 2020 2320  tes with..    # 
+000012f0: 6d61 7463 6869 6e67 206e 616d 6573 0d0a  matching names..
+00001300: 2020 2020 7265 7475 726e 2066 2252 6571      return f"Req
+00001310: 7565 7374 2066 6f72 3a20 7b63 756c 7475  uest for: {cultu
+00001320: 7265 5f63 6f64 657d 207b 6172 6561 7d22  re_code} {area}"
+00001330: 0d0a 0d0a 0d0a 4061 7070 2e72 6f75 7465  ......@app.route
+00001340: 722e 6765 7428 222f 6170 692f 7072 6f64  r.get("/api/prod
+00001350: 7563 7473 2229 0d0a 6465 6620 6765 745f  ucts")..def get_
+00001360: 7072 6f64 7563 7473 280d 0a20 2020 2070  products(..    p
+00001370: 6167 653a 2069 6e74 203d 2031 2c0d 0a20  age: int = 1,.. 
+00001380: 2020 2073 697a 653a 2069 6e74 203d 2033     size: int = 3
+00001390: 302c 0d0a 2020 2020 7365 6172 6368 3a20  0,..    search: 
+000013a0: 7374 7220 3d20 2222 2c0d 0a29 3a0d 0a20  str = "",..):.. 
+000013b0: 2020 2023 2074 6869 7320 6578 616d 706c     # this exampl
+000013c0: 6520 696c 6c75 7374 7261 7465 7320 7375  e illustrates su
+000013d0: 7070 6f72 7420 666f 7220 696d 706c 6963  pport for implic
+000013e0: 6974 2071 7565 7279 2070 6172 616d 6574  it query paramet
+000013f0: 6572 7320 7769 7468 0d0a 2020 2020 2320  ers with..    # 
+00001400: 6465 6661 756c 7420 7661 6c75 6573 0d0a  default values..
+00001410: 2020 2020 2320 7369 6e63 6520 7468 6520      # since the 
+00001420: 736f 7572 6365 206f 6620 7061 6765 2c20  source of page, 
+00001430: 7369 7a65 2c20 616e 6420 7365 6172 6368  size, and search
+00001440: 2069 7320 6e6f 7420 7370 6563 6966 6965   is not specifie
+00001450: 6420 616e 6420 6e6f 0d0a 2020 2020 2320  d and no..    # 
+00001460: 726f 7574 6520 7061 7261 6d65 7465 7220  route parameter 
+00001470: 6d61 7463 6865 7320 7468 6569 7220 6e61  matches their na
+00001480: 6d65 2c20 7468 6579 2061 7265 206f 6274  me, they are obt
+00001490: 6169 6e65 6420 6672 6f6d 2071 7565 7279  ained from query
+000014a0: 2073 7472 696e 670d 0a20 2020 202e 2e2e   string..    ...
+000014b0: 0d0a 0d0a 0d0a 4061 7070 2e72 6f75 7465  ......@app.route
+000014c0: 722e 6765 7428 222f 6170 692f 7072 6f64  r.get("/api/prod
+000014d0: 7563 7473 3222 290d 0a64 6566 2067 6574  ucts2")..def get
+000014e0: 5f70 726f 6475 6374 7332 280d 0a20 2020  _products2(..   
+000014f0: 2070 6167 653a 2046 726f 6d51 7565 7279   page: FromQuery
+00001500: 5b69 6e74 5d20 3d20 4672 6f6d 5175 6572  [int] = FromQuer
+00001510: 7928 3129 2c0d 0a20 2020 2073 697a 653a  y(1),..    size:
+00001520: 2046 726f 6d51 7565 7279 5b69 6e74 5d20   FromQuery[int] 
+00001530: 3d20 4672 6f6d 5175 6572 7928 3330 292c  = FromQuery(30),
+00001540: 0d0a 2020 2020 7365 6172 6368 3a20 4672  ..    search: Fr
+00001550: 6f6d 5175 6572 795b 7374 725d 203d 2046  omQuery[str] = F
+00001560: 726f 6d51 7565 7279 2822 2229 2c0d 0a29  romQuery(""),..)
+00001570: 3a0d 0a20 2020 2023 2074 6869 7320 6578  :..    # this ex
+00001580: 616d 706c 6520 696c 6c75 7374 7261 7465  ample illustrate
+00001590: 7320 7375 7070 6f72 7420 666f 7220 6578  s support for ex
+000015a0: 706c 6963 6974 2071 7565 7279 2070 6172  plicit query par
+000015b0: 616d 6574 6572 7320 7769 7468 0d0a 2020  ameters with..  
+000015c0: 2020 2320 6465 6661 756c 7420 7661 6c75    # default valu
+000015d0: 6573 0d0a 2020 2020 2320 696e 2074 6869  es..    # in thi
+000015e0: 7320 6361 7365 2c20 7061 7261 6d65 7465  s case, paramete
+000015f0: 7273 2061 7265 2065 7870 6c69 6369 746c  rs are explicitl
+00001600: 7920 7265 6164 2066 726f 6d20 7175 6572  y read from quer
+00001610: 7920 7374 7269 6e67 0d0a 2020 2020 2e2e  y string..    ..
+00001620: 2e0d 0a0d 0a60 6060 0d0a 0d0a 4974 2061  .....```....It a
+00001630: 6c73 6f20 7375 7070 6f72 7473 205b 6465  lso supports [de
+00001640: 7065 6e64 656e 6379 0d0a 696e 6a65 6374  pendency..inject
+00001650: 696f 6e5d 2868 7474 7073 3a2f 2f77 7777  ion](https://www
+00001660: 2e6e 656f 7465 726f 692e 6465 762f 626c  .neoteroi.dev/bl
+00001670: 6163 6b73 6865 6570 2f64 6570 656e 6465  acksheep/depende
+00001680: 6e63 792d 696e 6a65 6374 696f 6e2f 292c  ncy-injection/),
+00001690: 2061 0d0a 6665 6174 7572 6520 7468 6174   a..feature that
+000016a0: 2070 726f 7669 6465 7320 6120 636f 6e73   provides a cons
+000016b0: 6973 7465 6e74 2061 6e64 2063 6c65 616e  istent and clean
+000016c0: 2077 6179 2074 6f20 7573 6520 6465 7065   way to use depe
+000016d0: 6e64 656e 6369 6573 2069 6e20 7265 7175  ndencies in requ
+000016e0: 6573 740d 0a68 616e 646c 6572 732e 0d0a  est..handlers...
+000016f0: 0d0a 2323 2047 656e 6572 6174 696f 6e20  ..## Generation 
+00001700: 6f66 204f 7065 6e41 5049 2044 6f63 756d  of OpenAPI Docum
+00001710: 656e 7461 7469 6f6e 0d0a 5b47 656e 6572  entation..[Gener
+00001720: 6174 696f 6e20 6f66 204f 7065 6e41 5049  ation of OpenAPI
+00001730: 2044 6f63 756d 656e 7461 7469 6f6e 5d28   Documentation](
+00001740: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
+00001750: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
+00001760: 6565 702f 6f70 656e 6170 692f 292e 0d0a  eep/openapi/)...
+00001770: 0d0a 2323 2053 7472 6174 6567 6965 7320  ..## Strategies 
+00001780: 746f 2068 616e 646c 6520 6175 7468 656e  to handle authen
+00001790: 7469 6361 7469 6f6e 2061 6e64 2061 7574  tication and aut
+000017a0: 686f 7269 7a61 7469 6f6e 0d0a 426c 6163  horization..Blac
+000017b0: 6b53 6865 6570 2069 6d70 6c65 6d65 6e74  kSheep implement
+000017c0: 7320 7374 7261 7465 6769 6573 2074 6f20  s strategies to 
+000017d0: 6861 6e64 6c65 2061 7574 6865 6e74 6963  handle authentic
+000017e0: 6174 696f 6e20 616e 6420 6175 7468 6f72  ation and author
+000017f0: 697a 6174 696f 6e2e 0d0a 5468 6573 6520  ization...These 
+00001800: 6665 6174 7572 6573 2061 7265 2064 6f63  features are doc
+00001810: 756d 656e 7465 6420 6865 7265 3a0d 0a0d  umented here:...
+00001820: 0a2a 205b 4175 7468 656e 7469 6361 7469  .* [Authenticati
+00001830: 6f6e 5d28 6874 7470 733a 2f2f 7777 772e  on](https://www.
+00001840: 6e65 6f74 6572 6f69 2e64 6576 2f62 6c61  neoteroi.dev/bla
+00001850: 636b 7368 6565 702f 6175 7468 656e 7469  cksheep/authenti
+00001860: 6361 7469 6f6e 2f29 0d0a 2a20 5b41 7574  cation/)..* [Aut
+00001870: 686f 7269 7a61 7469 6f6e 5d28 6874 7470  horization](http
+00001880: 733a 2f2f 7777 772e 6e65 6f74 6572 6f69  s://www.neoteroi
+00001890: 2e64 6576 2f62 6c61 636b 7368 6565 702f  .dev/blacksheep/
+000018a0: 6175 7468 6f72 697a 6174 696f 6e2f 290d  authorization/).
+000018b0: 0a0d 0a60 6060 7079 7468 6f6e 0d0a 6170  ...```python..ap
+000018c0: 702e 7573 655f 6175 7468 656e 7469 6361  p.use_authentica
+000018d0: 7469 6f6e 2829 5c0d 0a20 2020 202e 6164  tion()\..    .ad
+000018e0: 6428 4578 616d 706c 6541 7574 6865 6e74  d(ExampleAuthent
+000018f0: 6963 6174 696f 6e48 616e 646c 6572 2829  icationHandler()
+00001900: 290d 0a0d 0a0d 0a61 7070 2e75 7365 5f61  )......app.use_a
+00001910: 7574 686f 7269 7a61 7469 6f6e 2829 5c0d  uthorization()\.
+00001920: 0a20 2020 202e 6164 6428 4164 6d69 6e73  .    .add(Admins
+00001930: 506f 6c69 6379 2829 290d 0a0d 0a0d 0a40  Policy())......@
+00001940: 6175 7468 2822 6164 6d69 6e22 290d 0a40  auth("admin")..@
+00001950: 6170 702e 726f 7574 6572 2e67 6574 2822  app.router.get("
+00001960: 2f22 290d 0a61 7379 6e63 2064 6566 206f  /")..async def o
+00001970: 6e6c 795f 666f 725f 6164 6d69 6e73 2829  nly_for_admins()
+00001980: 3a0d 0a20 2020 202e 2e2e 0d0a 0d0a 0d0a  :..    .........
+00001990: 4061 7574 6828 290d 0a40 6170 702e 726f  @auth()..@app.ro
+000019a0: 7574 6572 2e67 6574 2822 2f22 290d 0a61  uter.get("/")..a
+000019b0: 7379 6e63 2064 6566 206f 6e6c 795f 666f  sync def only_fo
+000019c0: 725f 6175 7468 656e 7469 6361 7465 645f  r_authenticated_
+000019d0: 7573 6572 7328 293a 0d0a 2020 2020 2e2e  users():..    ..
+000019e0: 2e0d 0a60 6060 0d0a 0d0a 5369 6e63 6520  ...```....Since 
+000019f0: 7665 7273 696f 6e20 6031 2e32 2e31 602c  version `1.2.1`,
+00001a00: 2042 6c61 636b 5368 6565 7020 696d 706c   BlackSheep impl
+00001a10: 656d 656e 7473 3a0d 0a0d 0a2a 205b 4275  ements:....* [Bu
+00001a20: 696c 742d 696e 2073 7570 706f 7274 2066  ilt-in support f
+00001a30: 6f72 204f 7065 6e49 4420 436f 6e6e 6563  or OpenID Connec
+00001a40: 7420 6175 7468 656e 7469 6361 7469 6f6e  t authentication
+00001a50: 5d28 6874 7470 733a 2f2f 7777 772e 6e65  ](https://www.ne
+00001a60: 6f74 6572 6f69 2e64 6576 2f62 6c61 636b  oteroi.dev/black
+00001a70: 7368 6565 702f 6175 7468 656e 7469 6361  sheep/authentica
+00001a80: 7469 6f6e 2f23 6f69 6463 290d 0a2a 205b  tion/#oidc)..* [
+00001a90: 4275 696c 742d 696e 2073 7570 706f 7274  Built-in support
+00001aa0: 2066 6f72 204a 5754 2042 6561 7265 7220   for JWT Bearer 
+00001ab0: 6175 7468 656e 7469 6361 7469 6f6e 5d28  authentication](
+00001ac0: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
+00001ad0: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
+00001ae0: 6565 702f 6175 7468 656e 7469 6361 7469  eep/authenticati
+00001af0: 6f6e 2f23 6a77 742d 6265 6172 6572 290d  on/#jwt-bearer).
+00001b00: 0a0d 0a4d 6561 6e69 6e67 2074 6861 7420  ...Meaning that 
+00001b10: 6974 2069 7320 6561 7379 2074 6f20 696e  it is easy to in
+00001b20: 7465 6772 6174 6520 7769 7468 2073 6572  tegrate with ser
+00001b30: 7669 6365 7320 7375 6368 2061 733a 0d0a  vices such as:..
+00001b40: 2a20 5b41 7574 6830 5d28 6874 7470 733a  * [Auth0](https:
+00001b50: 2f2f 6175 7468 302e 636f 6d29 0d0a 2a20  //auth0.com)..* 
+00001b60: 5b41 7a75 7265 2041 6374 6976 6520 4469  [Azure Active Di
+00001b70: 7265 6374 6f72 795d 2868 7474 7073 3a2f  rectory](https:/
+00001b80: 2f61 7a75 7265 2e6d 6963 726f 736f 6674  /azure.microsoft
+00001b90: 2e63 6f6d 2f65 6e2d 7573 2f73 6572 7669  .com/en-us/servi
+00001ba0: 6365 732f 6163 7469 7665 2d64 6972 6563  ces/active-direc
+00001bb0: 746f 7279 2f29 0d0a 2a20 5b41 7a75 7265  tory/)..* [Azure
+00001bc0: 2041 6374 6976 6520 4469 7265 6374 6f72   Active Director
+00001bd0: 7920 4232 435d 2868 7474 7073 3a2f 2f64  y B2C](https://d
+00001be0: 6f63 732e 6d69 6372 6f73 6f66 742e 636f  ocs.microsoft.co
+00001bf0: 6d2f 656e 2d75 732f 617a 7572 652f 6163  m/en-us/azure/ac
+00001c00: 7469 7665 2d64 6972 6563 746f 7279 2d62  tive-directory-b
+00001c10: 3263 2f6f 7665 7276 6965 7729 0d0a 2a20  2c/overview)..* 
+00001c20: 5b4f 6b74 615d 2868 7474 7073 3a2f 2f77  [Okta](https://w
+00001c30: 7777 2e6f 6b74 612e 636f 6d29 0d0a 0d0a  ww.okta.com)....
+00001c40: 5265 6665 7220 746f 2074 6865 2064 6f63  Refer to the doc
+00001c50: 756d 656e 7461 7469 6f6e 2066 6f72 206d  umentation for m
+00001c60: 6f72 6520 6465 7461 696c 7320 616e 6420  ore details and 
+00001c70: 6578 616d 706c 6573 2e0d 0a0d 0a23 2320  examples.....## 
+00001c80: 5765 6220 6672 616d 6577 6f72 6b20 6665  Web framework fe
+00001c90: 6174 7572 6573 0d0a 0d0a 2a20 5b41 5347  atures....* [ASG
+00001ca0: 4920 636f 6d70 6174 6962 696c 6974 795d  I compatibility]
+00001cb0: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
+00001cc0: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
+00001cd0: 6865 6570 2f61 7367 692f 290d 0a2a 205b  heep/asgi/)..* [
+00001ce0: 526f 7574 696e 675d 2868 7474 7073 3a2f  Routing](https:/
+00001cf0: 2f77 7777 2e6e 656f 7465 726f 692e 6465  /www.neoteroi.de
+00001d00: 762f 626c 6163 6b73 6865 6570 2f72 6f75  v/blacksheep/rou
+00001d10: 7469 6e67 2f29 0d0a 2a20 5265 7175 6573  ting/)..* Reques
+00001d20: 7420 6861 6e64 6c65 7273 2063 616e 2062  t handlers can b
+00001d30: 6520 5b64 6566 696e 6564 2061 730d 0a20  e [defined as.. 
+00001d40: 2066 756e 6374 696f 6e73 5d28 6874 7470   functions](http
+00001d50: 733a 2f2f 7777 772e 6e65 6f74 6572 6f69  s://www.neoteroi
+00001d60: 2e64 6576 2f62 6c61 636b 7368 6565 702f  .dev/blacksheep/
+00001d70: 7265 7175 6573 742d 6861 6e64 6c65 7273  request-handlers
+00001d80: 2f29 2c20 6f72 205b 636c 6173 730d 0a20  /), or [class.. 
+00001d90: 206d 6574 686f 6473 5d28 6874 7470 733a   methods](https:
+00001da0: 2f2f 7777 772e 6e65 6f74 6572 6f69 2e64  //www.neoteroi.d
+00001db0: 6576 2f62 6c61 636b 7368 6565 702f 636f  ev/blacksheep/co
+00001dc0: 6e74 726f 6c6c 6572 732f 290d 0a2a 205b  ntrollers/)..* [
+00001dd0: 4d69 6464 6c65 7761 7265 735d 2868 7474  Middlewares](htt
+00001de0: 7073 3a2f 2f77 7777 2e6e 656f 7465 726f  ps://www.neotero
+00001df0: 692e 6465 762f 626c 6163 6b73 6865 6570  i.dev/blacksheep
+00001e00: 2f6d 6964 646c 6577 6172 6573 2f29 0d0a  /middlewares/)..
+00001e10: 2a20 5b57 6562 536f 636b 6574 5d28 6874  * [WebSocket](ht
+00001e20: 7470 733a 2f2f 7777 772e 6e65 6f74 6572  tps://www.neoter
+00001e30: 6f69 2e64 6576 2f62 6c61 636b 7368 6565  oi.dev/blackshee
+00001e40: 702f 7765 6273 6f63 6b65 742f 290d 0a2a  p/websocket/)..*
+00001e50: 205b 4275 696c 742d 696e 2073 7570 706f   [Built-in suppo
+00001e60: 7274 2066 6f72 2064 6570 656e 6465 6e63  rt for dependenc
+00001e70: 790d 0a20 2069 6e6a 6563 7469 6f6e 5d28  y..  injection](
+00001e80: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
+00001e90: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
+00001ea0: 6565 702f 6465 7065 6e64 656e 6379 2d69  eep/dependency-i
+00001eb0: 6e6a 6563 7469 6f6e 2f29 0d0a 2a20 5b53  njection/)..* [S
+00001ec0: 7570 706f 7274 2066 6f72 2061 7574 6f6d  upport for autom
+00001ed0: 6174 6963 2062 696e 6469 6e67 206f 6620  atic binding of 
+00001ee0: 726f 7574 6520 616e 6420 7175 6572 7920  route and query 
+00001ef0: 7061 7261 6d65 7465 7273 2074 6f20 7265  parameters to re
+00001f00: 7175 6573 740d 0a20 2068 616e 646c 6572  quest..  handler
+00001f10: 7320 6d65 7468 6f64 730d 0a20 2063 616c  s methods..  cal
+00001f20: 6c73 5d28 6874 7470 733a 2f2f 7777 772e  ls](https://www.
+00001f30: 6e65 6f74 6572 6f69 2e64 6576 2f62 6c61  neoteroi.dev/bla
+00001f40: 636b 7368 6565 702f 6765 7474 696e 672d  cksheep/getting-
+00001f50: 7374 6172 7465 642f 2368 616e 646c 696e  started/#handlin
+00001f60: 672d 726f 7574 652d 7061 7261 6d65 7465  g-route-paramete
+00001f70: 7273 290d 0a2a 205b 5374 7261 7465 6779  rs)..* [Strategy
+00001f80: 2074 6f20 6861 6e64 6c65 0d0a 2020 6578   to handle..  ex
+00001f90: 6365 7074 696f 6e73 5d28 6874 7470 733a  ceptions](https:
+00001fa0: 2f2f 7777 772e 6e65 6f74 6572 6f69 2e64  //www.neoteroi.d
+00001fb0: 6576 2f62 6c61 636b 7368 6565 702f 6170  ev/blacksheep/ap
+00001fc0: 706c 6963 6174 696f 6e2f 2363 6f6e 6669  plication/#confi
+00001fd0: 6775 7269 6e67 2d65 7863 6570 7469 6f6e  guring-exception
+00001fe0: 732d 6861 6e64 6c65 7273 290d 0a2a 205b  s-handlers)..* [
+00001ff0: 5374 7261 7465 6779 2074 6f20 6861 6e64  Strategy to hand
+00002000: 6c65 2061 7574 6865 6e74 6963 6174 696f  le authenticatio
+00002010: 6e20 616e 640d 0a20 2061 7574 686f 7269  n and..  authori
+00002020: 7a61 7469 6f6e 5d28 6874 7470 733a 2f2f  zation](https://
+00002030: 7777 772e 6e65 6f74 6572 6f69 2e64 6576  www.neoteroi.dev
+00002040: 2f62 6c61 636b 7368 6565 702f 6175 7468  /blacksheep/auth
+00002050: 656e 7469 6361 7469 6f6e 2f29 0d0a 2a20  entication/)..* 
+00002060: 5b42 7569 6c74 2d69 6e20 7375 7070 6f72  [Built-in suppor
+00002070: 7420 666f 7220 4f70 656e 4944 2043 6f6e  t for OpenID Con
+00002080: 6e65 6374 2061 7574 6865 6e74 6963 6174  nect authenticat
+00002090: 696f 6e20 7573 696e 6720 4f49 4443 0d0a  ion using OIDC..
+000020a0: 2020 6469 7363 6f76 6572 795d 2868 7474    discovery](htt
+000020b0: 7073 3a2f 2f77 7777 2e6e 656f 7465 726f  ps://www.neotero
+000020c0: 692e 6465 762f 626c 6163 6b73 6865 6570  i.dev/blacksheep
+000020d0: 2f61 7574 6865 6e74 6963 6174 696f 6e2f  /authentication/
+000020e0: 236f 6964 6329 0d0a 2a20 5b42 7569 6c74  #oidc)..* [Built
+000020f0: 2d69 6e20 7375 7070 6f72 7420 666f 7220  -in support for 
+00002100: 4a57 5420 4265 6172 6572 2061 7574 6865  JWT Bearer authe
+00002110: 6e74 6963 6174 696f 6e20 7573 696e 6720  ntication using 
+00002120: 4f49 4443 2064 6973 636f 7665 7279 2061  OIDC discovery a
+00002130: 6e64 0d0a 2020 6f74 6865 7220 736f 7572  nd..  other sour
+00002140: 6365 7320 6f66 0d0a 2020 4a57 4b53 5d28  ces of..  JWKS](
+00002150: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
+00002160: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
+00002170: 6565 702f 6175 7468 656e 7469 6361 7469  eep/authenticati
+00002180: 6f6e 2f23 6a77 742d 6265 6172 6572 290d  on/#jwt-bearer).
+00002190: 0a2a 205b 4861 6e64 6c65 7273 0d0a 2020  .* [Handlers..  
+000021a0: 6e6f 726d 616c 697a 6174 696f 6e5d 2868  normalization](h
+000021b0: 7474 7073 3a2f 2f77 7777 2e6e 656f 7465  ttps://www.neote
+000021c0: 726f 692e 6465 762f 626c 6163 6b73 6865  roi.dev/blackshe
+000021d0: 6570 2f72 6571 7565 7374 2d68 616e 646c  ep/request-handl
+000021e0: 6572 732f 290d 0a2a 205b 5365 7276 696e  ers/)..* [Servin
+000021f0: 6720 7374 6174 6963 0d0a 2020 6669 6c65  g static..  file
+00002200: 735d 2868 7474 7073 3a2f 2f77 7777 2e6e  s](https://www.n
+00002210: 656f 7465 726f 692e 6465 762f 626c 6163  eoteroi.dev/blac
+00002220: 6b73 6865 6570 2f73 7461 7469 632d 6669  ksheep/static-fi
+00002230: 6c65 732f 290d 0a2a 205b 496e 7465 6772  les/)..* [Integr
+00002240: 6174 696f 6e20 7769 7468 0d0a 2020 4a69  ation with..  Ji
+00002250: 6e6a 6132 5d28 6874 7470 733a 2f2f 7777  nja2](https://ww
+00002260: 772e 6e65 6f74 6572 6f69 2e64 6576 2f62  w.neoteroi.dev/b
+00002270: 6c61 636b 7368 6565 702f 7465 6d70 6c61  lacksheep/templa
+00002280: 7469 6e67 2f29 0d0a 2a20 5b53 7570 706f  ting/)..* [Suppo
+00002290: 7274 2066 6f72 2073 6572 7669 6e67 2053  rt for serving S
+000022a0: 5041 7320 7468 6174 2075 7365 2048 544d  PAs that use HTM
+000022b0: 4c35 2048 6973 746f 7279 2041 5049 2066  L5 History API f
+000022c0: 6f72 2063 6c69 656e 7420 7369 6465 0d0a  or client side..
+000022d0: 2020 726f 7574 696e 675d 2868 7474 7073    routing](https
+000022e0: 3a2f 2f77 7777 2e6e 656f 7465 726f 692e  ://www.neoteroi.
+000022f0: 6465 762f 626c 6163 6b73 6865 6570 2f73  dev/blacksheep/s
+00002300: 7461 7469 632d 6669 6c65 732f 2368 6f77  tatic-files/#how
+00002310: 2d74 6f2d 7365 7276 652d 7370 6173 2d74  -to-serve-spas-t
+00002320: 6861 742d 7573 652d 6874 6d6c 352d 6869  hat-use-html5-hi
+00002330: 7374 6f72 792d 6170 6929 0d0a 2a20 5b53  story-api)..* [S
+00002340: 7570 706f 7274 2066 6f72 2061 7574 6f6d  upport for autom
+00002350: 6174 6963 2067 656e 6572 6174 696f 6e20  atic generation 
+00002360: 6f66 204f 7065 6e41 5049 0d0a 2020 446f  of OpenAPI..  Do
+00002370: 6375 6d65 6e74 6174 696f 6e5d 2868 7474  cumentation](htt
+00002380: 7073 3a2f 2f77 7777 2e6e 656f 7465 726f  ps://www.neotero
+00002390: 692e 6465 762f 626c 6163 6b73 6865 6570  i.dev/blacksheep
+000023a0: 2f6f 7065 6e61 7069 2f29 0d0a 2a20 5b53  /openapi/)..* [S
+000023b0: 7472 6174 6567 7920 746f 2068 616e 646c  trategy to handl
+000023c0: 6520 434f 5253 2073 6574 7469 6e67 735d  e CORS settings]
+000023d0: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
+000023e0: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
+000023f0: 6865 6570 2f63 6f72 732f 290d 0a2a 205b  heep/cors/)..* [
+00002400: 5365 7373 696f 6e73 5d28 6874 7470 733a  Sessions](https:
+00002410: 2f2f 7777 772e 6e65 6f74 6572 6f69 2e64  //www.neoteroi.d
+00002420: 6576 2f62 6c61 636b 7368 6565 702f 7365  ev/blacksheep/se
+00002430: 7373 696f 6e73 2f29 0d0a 2a20 5375 7070  ssions/)..* Supp
+00002440: 6f72 7420 666f 7220 6175 746f 6d61 7469  ort for automati
+00002450: 6320 6269 6e64 696e 6720 6f66 2060 6461  c binding of `da
+00002460: 7461 636c 6173 7365 7360 2061 6e64 0d0a  taclasses` and..
+00002470: 2020 5b60 7079 6461 6e74 6963 605d 2868    [`pydantic`](h
+00002480: 7474 7073 3a2f 2f70 7964 616e 7469 632d  ttps://pydantic-
+00002490: 646f 6373 2e68 656c 706d 616e 7561 6c2e  docs.helpmanual.
+000024a0: 696f 2920 6d6f 6465 6c73 2074 6f20 6861  io) models to ha
+000024b0: 6e64 6c65 2074 6865 0d0a 2020 7265 7175  ndle the..  requ
+000024c0: 6573 7420 626f 6479 2070 6179 6c6f 6164  est body payload
+000024d0: 2065 7870 6563 7465 6420 6279 2072 6571   expected by req
+000024e0: 7565 7374 2068 616e 646c 6572 730d 0a2a  uest handlers..*
+000024f0: 205b 6054 6573 7443 6c69 656e 7460 2063   [`TestClient` c
+00002500: 6c61 7373 2074 6f20 7369 6d70 6c69 6679  lass to simplify
+00002510: 2074 6573 7469 6e67 206f 6620 6170 706c   testing of appl
+00002520: 6963 6174 696f 6e73 5d28 6874 7470 733a  ications](https:
+00002530: 2f2f 7777 772e 6e65 6f74 6572 6f69 2e64  //www.neoteroi.d
+00002540: 6576 2f62 6c61 636b 7368 6565 702f 7465  ev/blacksheep/te
+00002550: 7374 696e 672f 290d 0a2a 205b 416e 7469  sting/)..* [Anti
+00002560: 2046 6f72 6765 7279 2076 616c 6964 6174   Forgery validat
+00002570: 696f 6e5d 2868 7474 7073 3a2f 2f77 7777  ion](https://www
+00002580: 2e6e 656f 7465 726f 692e 6465 762f 626c  .neoteroi.dev/bl
+00002590: 6163 6b73 6865 6570 2f61 6e74 692d 7265  acksheep/anti-re
+000025a0: 7175 6573 742d 666f 7267 6572 7929 2074  quest-forgery) t
+000025b0: 6f20 7072 6f74 6563 7420 6167 6169 6e73  o protect agains
+000025c0: 7420 4372 6f73 732d 5369 7465 2052 6571  t Cross-Site Req
+000025d0: 7565 7374 2046 6f72 6765 7279 2028 5853  uest Forgery (XS
+000025e0: 5246 2f43 5352 4629 2061 7474 6163 6b73  RF/CSRF) attacks
+000025f0: 0d0a 0d0a 2323 2043 6c69 656e 7420 6665  ....## Client fe
+00002600: 6174 7572 6573 0d0a 0d0a 426c 6163 6b53  atures....BlackS
+00002610: 6865 6570 2069 6e63 6c75 6465 7320 616e  heep includes an
+00002620: 2048 5454 5020 436c 6965 6e74 2e0d 0a0d   HTTP Client....
+00002630: 0a2a 2a45 7861 6d70 6c65 3a2a 2a0d 0a60  .**Example:**..`
+00002640: 6060 7079 7468 6f6e 0d0a 696d 706f 7274  ``python..import
+00002650: 2061 7379 6e63 696f 0d0a 0d0a 6672 6f6d   asyncio....from
+00002660: 2062 6c61 636b 7368 6565 702e 636c 6965   blacksheep.clie
+00002670: 6e74 2069 6d70 6f72 7420 436c 6965 6e74  nt import Client
+00002680: 5365 7373 696f 6e0d 0a0d 0a0d 0a61 7379  Session......asy
+00002690: 6e63 2064 6566 2063 6c69 656e 745f 6578  nc def client_ex
+000026a0: 616d 706c 6528 293a 0d0a 2020 2020 6173  ample():..    as
+000026b0: 796e 6320 7769 7468 2043 6c69 656e 7453  ync with ClientS
+000026c0: 6573 7369 6f6e 2829 2061 7320 636c 6965  ession() as clie
+000026d0: 6e74 3a0d 0a20 2020 2020 2020 2072 6573  nt:..        res
+000026e0: 706f 6e73 6520 3d20 6177 6169 7420 636c  ponse = await cl
+000026f0: 6965 6e74 2e67 6574 2822 6874 7470 733a  ient.get("https:
+00002700: 2f2f 646f 6373 2e70 7974 686f 6e2e 6f72  //docs.python.or
+00002710: 672f 332f 2229 0d0a 0d0a 2020 2020 2020  g/3/")....      
+00002720: 2020 6173 7365 7274 2072 6573 706f 6e73    assert respons
+00002730: 6520 6973 206e 6f74 204e 6f6e 650d 0a20  e is not None.. 
+00002740: 2020 2020 2020 2074 6578 7420 3d20 6177         text = aw
+00002750: 6169 7420 7265 7370 6f6e 7365 2e74 6578  ait response.tex
+00002760: 7428 290d 0a20 2020 2020 2020 2070 7269  t()..        pri
+00002770: 6e74 2874 6578 7429 0d0a 0d0a 0d0a 6173  nt(text)......as
+00002780: 796e 6369 6f2e 7275 6e28 636c 6965 6e74  yncio.run(client
+00002790: 5f65 7861 6d70 6c65 2829 290d 0a60 6060  _example())..```
+000027a0: 0d0a 0d0a 2323 2053 7570 706f 7274 6564  ....## Supported
+000027b0: 2070 6c61 7466 6f72 6d73 2061 6e64 2072   platforms and r
+000027c0: 756e 7469 6d65 730d 0a2a 2050 7974 686f  untimes..* Pytho
+000027d0: 6e3a 2061 6c6c 2076 6572 7369 6f6e 7320  n: all versions 
+000027e0: 696e 636c 7564 6564 2069 6e20 7468 6520  included in the 
+000027f0: 6275 696c 6420 6d61 7472 6978 0d0a 2a20  build matrix..* 
+00002800: 5562 756e 7475 0d0a 2a20 5769 6e64 6f77  Ubuntu..* Window
+00002810: 7320 3130 0d0a 2a20 6d61 634f 530d 0a0d  s 10..* macOS...
+00002820: 0a23 2320 446f 6375 6d65 6e74 6174 696f  .## Documentatio
+00002830: 6e0d 0a50 6c65 6173 6520 7265 6665 7220  n..Please refer 
+00002840: 746f 2074 6865 205b 646f 6375 6d65 6e74  to the [document
+00002850: 6174 696f 6e20 7765 6273 6974 655d 2868  ation website](h
+00002860: 7474 7073 3a2f 2f77 7777 2e6e 656f 7465  ttps://www.neote
+00002870: 726f 692e 6465 762f 626c 6163 6b73 6865  roi.dev/blackshe
+00002880: 6570 2f29 2e0d 0a0d 0a23 2320 436f 6d6d  ep/).....## Comm
+00002890: 756e 6963 6174 696f 6e0d 0a5b 426c 6163  unication..[Blac
+000028a0: 6b53 6865 6570 2063 6f6d 6d75 6e69 7479  kSheep community
+000028b0: 2069 6e20 4769 7474 6572 5d28 6874 7470   in Gitter](http
+000028c0: 733a 2f2f 6769 7474 6572 2e69 6d2f 4e65  s://gitter.im/Ne
+000028d0: 6f74 6572 6f69 2f42 6c61 636b 5368 6565  oteroi/BlackShee
+000028e0: 7029 2e0d 0a0d 0a23 2320 4272 616e 6368  p).....## Branch
+000028f0: 6573 0d0a 5468 6520 5f6d 6169 6e5f 2062  es..The _main_ b
+00002900: 7261 6e63 6820 636f 6e74 6169 6e73 2074  ranch contains t
+00002910: 6865 2063 7572 7265 6e74 6c79 2064 6576  he currently dev
+00002920: 656c 6f70 6564 2076 6572 7369 6f6e 2c20  eloped version, 
+00002930: 7768 6963 6820 6973 2076 6572 7369 6f6e  which is version
+00002940: 2032 0d0a 616c 7068 612e 2054 6865 205f   2..alpha. The _
+00002950: 7631 5f20 6272 616e 6368 2063 6f6e 7461  v1_ branch conta
+00002960: 696e 7320 7665 7273 696f 6e20 3120 6f66  ins version 1 of
+00002970: 2074 6865 2077 6562 2066 7261 6d65 776f   the web framewo
+00002980: 726b 2c20 666f 7220 6275 6773 2066 6978  rk, for bugs fix
+00002990: 6573 0d0a 616e 6420 6d61 696e 7465 6e61  es..and maintena
+000029a0: 6e63 652e 0d0a                           nce...
```

### Comparing `blacksheep-2.0a5/blacksheep/__init__.py` & `blacksheep-2.0a6/blacksheep/__init__.py`

 * *Files 7% similar despite different names*

```diff
@@ -61,13 +61,23 @@
 from .server.responses import temporary_redirect as temporary_redirect
 from .server.responses import text as text
 from .server.responses import unauthorized as unauthorized
 from .server.routing import Route as Route
 from .server.routing import RouteException as RouteException
 from .server.routing import Router as Router
 from .server.routing import RoutesRegistry as RoutesRegistry
+from .server.routing import connect as connect
+from .server.routing import delete as delete
+from .server.routing import get as get
+from .server.routing import head as head
+from .server.routing import options as options
+from .server.routing import patch as patch
+from .server.routing import post as post
+from .server.routing import put as put
+from .server.routing import trace as trace
+from .server.routing import ws as ws
 from .server.websocket import WebSocket as WebSocket
 from .server.websocket import WebSocketDisconnectError as WebSocketDisconnectError
 from .server.websocket import WebSocketError as WebSocketError
 from .server.websocket import WebSocketState as WebSocketState
 from .url import URL as URL
 from .url import InvalidURL as InvalidURL
```

### Comparing `blacksheep-2.0a5/blacksheep/baseapp.c` & `blacksheep-2.0a6/blacksheep/baseapp.c`

 * *Files 1% similar despite different names*

```diff
@@ -1,20 +1,20 @@
-/* Generated by Cython 0.29.32 */
+/* Generated by Cython 0.29.34 */
 
 #ifndef PY_SSIZE_T_CLEAN
 #define PY_SSIZE_T_CLEAN
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_32"
-#define CYTHON_HEX_VERSION 0x001D20F0
+#define CYTHON_ABI "0_29_34"
+#define CYTHON_HEX_VERSION 0x001D22F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -83,15 +83,15 @@
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
-    #define CYTHON_UPDATE_DESCRIPTOR_DOC (PYPY_VERSION_HEX >= 0x07030900)
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
 #elif defined(PYSTON_VERSION)
   #define CYTHON_COMPILING_IN_PYPY 0
   #define CYTHON_COMPILING_IN_PYSTON 1
   #define CYTHON_COMPILING_IN_CPYTHON 0
   #define CYTHON_COMPILING_IN_NOGIL 0
   #ifndef CYTHON_USE_TYPE_SLOTS
@@ -199,15 +199,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -238,15 +238,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -548,35 +548,35 @@
 #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && CYTHON_USE_UNICODE_INTERNALS
 #define __Pyx_PyDict_GetItemStr(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
 #else
 #define __Pyx_PyDict_GetItemStr(dict, name)  PyDict_GetItem(dict, name)
 #endif
 #if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
   #define CYTHON_PEP393_ENABLED 1
-  #if defined(PyUnicode_IS_READY)
-  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
-                                              0 : _PyUnicode_Ready((PyObject *)(op)))
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_READY(op)       (0)
   #else
-  #define __Pyx_PyUnicode_READY(op)       (0)
+    #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
+                                                0 : _PyUnicode_Ready((PyObject *)(op)))
   #endif
   #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
   #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
   #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
   #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
   #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
   #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
   #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, ch)
-  #if defined(PyUnicode_IS_READY) && defined(PyUnicode_GET_SIZE)
-  #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
   #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
-  #endif
-  #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
+    #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
+    #else
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
+    #endif
   #endif
 #else
   #define CYTHON_PEP393_ENABLED 0
   #define PyUnicode_1BYTE_KIND  1
   #define PyUnicode_2BYTE_KIND  2
   #define PyUnicode_4BYTE_KIND  4
   #define __Pyx_PyUnicode_READY(op)       (0)
@@ -949,24 +949,24 @@
 static int __pyx_lineno;
 static int __pyx_clineno = 0;
 static const char * __pyx_cfilenm= __FILE__;
 static const char *__pyx_filename;
 
 
 static const char *__pyx_f[] = {
-  "blacksheep/baseapp.pyx",
-  "blacksheep/baseapp.pxd",
+  "blacksheep\\baseapp.pyx",
+  "blacksheep\\baseapp.pxd",
   "stringsource",
   "datetime.pxd",
-  "blacksheep/exceptions.pxd",
-  "blacksheep/contents.pxd",
+  "blacksheep\\exceptions.pxd",
+  "blacksheep\\contents.pxd",
   "type.pxd",
-  "blacksheep/cookies.pxd",
-  "blacksheep/url.pxd",
-  "blacksheep/messages.pxd",
+  "blacksheep\\cookies.pxd",
+  "blacksheep\\url.pxd",
+  "blacksheep\\messages.pxd",
 };
 
 /*--- Type declarations ---*/
 struct __pyx_obj_10blacksheep_10exceptions_MessageAborted;
 struct __pyx_obj_10blacksheep_10exceptions_HTTPException;
 struct __pyx_obj_10blacksheep_10exceptions_BadRequest;
 struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat;
@@ -1439,15 +1439,15 @@
   PyObject_HEAD
   PyObject *__pyx_v_exc;
   PyObject *__pyx_v_request;
   struct __pyx_obj_10blacksheep_7baseapp_BaseApplication *__pyx_v_self;
 };
 
 
-/* "blacksheep/baseapp.pyx":116
+/* "blacksheep/baseapp.pyx":119
  *         return None
  * 
  *     async def handle_internal_server_error(self, Request request, Exception exc):             # <<<<<<<<<<<<<<
  *         """
  *         Handles an unhandled exception.
  */
 struct __pyx_obj_10blacksheep_7baseapp___pyx_scope_struct_7_handle_internal_server_error {
@@ -1457,15 +1457,15 @@
   struct __pyx_obj_10blacksheep_7baseapp_BaseApplication *__pyx_v_self;
   PyObject *__pyx_t_0;
   PyObject *__pyx_t_1;
   PyObject *__pyx_t_2;
 };
 
 
-/* "blacksheep/baseapp.pyx":134
+/* "blacksheep/baseapp.pyx":137
  *         return Response(500, content=TextContent("Internal server error."))
  * 
  *     async def _apply_exception_handler(self, Request request, Exception exc, object exception_handler):             # <<<<<<<<<<<<<<
  *         try:
  *             return await exception_handler(self, request, exc)
  */
 struct __pyx_obj_10blacksheep_7baseapp___pyx_scope_struct_8__apply_exception_handler {
@@ -1480,15 +1480,15 @@
   PyObject *__pyx_t_2;
   PyObject *__pyx_t_3;
   PyObject *__pyx_t_4;
   PyObject *__pyx_t_5;
 };
 
 
-/* "blacksheep/baseapp.pyx":140
+/* "blacksheep/baseapp.pyx":143
  *             return await self.handle_exception(request, server_ex)
  * 
  *     async def handle_http_exception(self, Request request, HTTPException http_exception):             # <<<<<<<<<<<<<<
  *         exception_handler = self.get_http_exception_handler(http_exception)
  *         if exception_handler:
  */
 struct __pyx_obj_10blacksheep_7baseapp___pyx_scope_struct_9_handle_http_exception {
@@ -1496,15 +1496,15 @@
   PyObject *__pyx_v_exception_handler;
   struct __pyx_obj_10blacksheep_10exceptions_HTTPException *__pyx_v_http_exception;
   struct __pyx_obj_10blacksheep_8messages_Request *__pyx_v_request;
   struct __pyx_obj_10blacksheep_7baseapp_BaseApplication *__pyx_v_self;
 };
 
 
-/* "blacksheep/baseapp.pyx":147
+/* "blacksheep/baseapp.pyx":150
  *         return await self.handle_exception(request, http_exception)
  * 
  *     async def handle_exception(self, request, exc):             # <<<<<<<<<<<<<<
  *         exception_handler = self.get_exception_handler(exc)
  *         if exception_handler:
  */
 struct __pyx_obj_10blacksheep_7baseapp___pyx_scope_struct_10_handle_exception {
@@ -1698,14 +1698,24 @@
 #define __Pyx_DECREF_SET(r, v) do {\
         PyObject *tmp = (PyObject *) r;\
         r = v; __Pyx_DECREF(tmp);\
     } while (0)
 #define __Pyx_CLEAR(r)    do { PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);} while(0)
 #define __Pyx_XCLEAR(r)   do { if((r) != NULL) {PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);}} while(0)
 
+/* PyObjectGetAttrStr.proto */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
+#else
+#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
+#endif
+
+/* GetBuiltinName.proto */
+static PyObject *__Pyx_GetBuiltinName(PyObject *name);
+
 /* RaiseArgTupleInvalid.proto */
 static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
     Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);
 
 /* RaiseDoubleKeywords.proto */
 static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);
 
@@ -1764,21 +1774,14 @@
 #endif
 
 /* ReturnWithStopIteration.proto */
 #define __Pyx_ReturnWithStopIteration(value)\
     if (value == Py_None) PyErr_SetNone(PyExc_StopIteration); else __Pyx__ReturnWithStopIteration(value)
 static void __Pyx__ReturnWithStopIteration(PyObject* value);
 
-/* PyObjectGetAttrStr.proto */
-#if CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
-#else
-#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
-#endif
-
 /* CallableCheck.proto */
 #if CYTHON_USE_TYPE_SLOTS && PY_MAJOR_VERSION >= 3
 #define __Pyx_PyCallable_Check(obj)   (Py_TYPE(obj)->tp_call != NULL)
 #else
 #define __Pyx_PyCallable_Check(obj)   PyCallable_Check(obj)
 #endif
 
@@ -1845,17 +1848,14 @@
 #else
 #define __Pyx_PyCFunction_FastCall(func, args, nargs)  (assert(0), NULL)
 #endif
 
 /* PyObjectCallOneArg.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);
 
-/* GetBuiltinName.proto */
-static PyObject *__Pyx_GetBuiltinName(PyObject *name);
-
 /* PyDictVersioning.proto */
 #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
 #define __PYX_DICT_VERSION_INIT  ((PY_UINT64_T) -1)
 #define __PYX_GET_DICT_VERSION(dict)  (((PyDictObject*)(dict))->ma_version_tag)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)\
     (version_var) = __PYX_GET_DICT_VERSION(dict);\
     (cache_var) = (value);
@@ -1876,26 +1876,26 @@
 #define __PYX_GET_DICT_VERSION(dict)  (0)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
 #define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
 #endif
 
 /* GetModuleGlobalName.proto */
 #if CYTHON_USE_DICT_VERSIONS
-#define __Pyx_GetModuleGlobalName(var, name)  {\
+#define __Pyx_GetModuleGlobalName(var, name)  do {\
     static PY_UINT64_T __pyx_dict_version = 0;\
     static PyObject *__pyx_dict_cached_value = NULL;\
     (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
         (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
         __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  {\
+} while(0)
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  do {\
     PY_UINT64_T __pyx_dict_version;\
     PyObject *__pyx_dict_cached_value;\
     (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
+} while(0)
 static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
 #else
 #define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 #define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
 #endif
 
@@ -2148,20 +2148,28 @@
 
 /* SetupReduce.proto */
 static int __Pyx_setup_reduce(PyObject* type_obj);
 
 /* TypeImport.proto */
 #ifndef __PYX_HAVE_RT_ImportType_proto
 #define __PYX_HAVE_RT_ImportType_proto
+#if __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT(s) sizeof(void*)
+#endif
 enum __Pyx_ImportType_CheckSize {
    __Pyx_ImportType_CheckSize_Error = 0,
    __Pyx_ImportType_CheckSize_Warn = 1,
    __Pyx_ImportType_CheckSize_Ignore = 2
 };
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
+static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize check_size);
 #endif
 
 /* GetVTable.proto */
 static void* __Pyx_GetVtable(PyObject *dict);
 
 /* CLineInTraceback.proto */
 #ifdef CYTHON_CLINE_IN_TRACEBACK
@@ -2303,14 +2311,15 @@
 static PyTypeObject *__pyx_ptype_10blacksheep_7baseapp___pyx_scope_struct_10_handle_exception = 0;
 static PyObject *__pyx_f_10blacksheep_7baseapp___pyx_unpickle_BaseApplication__set_state(struct __pyx_obj_10blacksheep_7baseapp_BaseApplication *, PyObject *); /*proto*/
 #define __Pyx_MODULE_NAME "blacksheep.baseapp"
 extern int __pyx_module_is_main_blacksheep__baseapp;
 int __pyx_module_is_main_blacksheep__baseapp = 0;
 
 /* Implementation of 'blacksheep.baseapp' */
+static PyObject *__pyx_builtin_KeyError;
 static const char __pyx_k_app[] = "app";
 static const char __pyx_k_exc[] = "exc";
 static const char __pyx_k_get[] = "get";
 static const char __pyx_k_new[] = "__new__";
 static const char __pyx_k_url[] = "url";
 static const char __pyx_k_INFO[] = "INFO";
 static const char __pyx_k_args[] = "args";
@@ -2342,14 +2351,15 @@
 static const char __pyx_k_update[] = "update";
 static const char __pyx_k_values[] = "values";
 static const char __pyx_k_content[] = "content";
 static const char __pyx_k_context[] = "__context__";
 static const char __pyx_k_handler[] = "handler";
 static const char __pyx_k_logging[] = "logging";
 static const char __pyx_k_request[] = "request";
+static const char __pyx_k_KeyError[] = "KeyError";
 static const char __pyx_k_exc_info[] = "exc_info";
 static const char __pyx_k_getstate[] = "__getstate__";
 static const char __pyx_k_pyx_type[] = "__pyx_type";
 static const char __pyx_k_setLevel[] = "setLevel";
 static const char __pyx_k_setstate[] = "__setstate__";
 static const char __pyx_k_exception[] = "exception";
 static const char __pyx_k_getLogger[] = "getLogger";
@@ -2384,15 +2394,15 @@
 static const char __pyx_k_handle_bad_request[] = "handle_bad_request";
 static const char __pyx_k_show_error_details[] = "show_error_details";
 static const char __pyx_k_Handled_error_s_s_s[] = "Handled error: \"%s %s\". %s";
 static const char __pyx_k_Internal_Server_Error[] = "Internal Server Error";
 static const char __pyx_k_Internal_server_error[] = "Internal server error.";
 static const char __pyx_k_handle_http_exception[] = "handle_http_exception";
 static const char __pyx_k_BaseApplication_handle[] = "BaseApplication.handle";
-static const char __pyx_k_blacksheep_baseapp_pyx[] = "blacksheep/baseapp.pyx";
+static const char __pyx_k_blacksheep_baseapp_pyx[] = "blacksheep\\baseapp.pyx";
 static const char __pyx_k_Unhandled_exception_s_s[] = "Unhandled exception - \"%s %s\"";
 static const char __pyx_k_apply_exception_handler[] = "_apply_exception_handler";
 static const char __pyx_k_init_exceptions_handlers[] = "init_exceptions_handlers";
 static const char __pyx_k_get_class_instance_hierarchy[] = "get_class_instance_hierarchy";
 static const char __pyx_k_handle_internal_server_error[] = "handle_internal_server_error";
 static const char __pyx_k_pyx_unpickle_BaseApplication[] = "__pyx_unpickle_BaseApplication";
 static const char __pyx_k_server_error_details_handler[] = "server_error_details_handler";
@@ -2421,14 +2431,15 @@
 static PyObject *__pyx_n_s_HTTPStatus;
 static PyObject *__pyx_kp_u_HTTP_s_s_s_s;
 static PyObject *__pyx_kp_u_Handled_error_s_s_s;
 static PyObject *__pyx_n_s_INFO;
 static PyObject *__pyx_kp_s_Incompatible_checksums_0x_x_vs_0;
 static PyObject *__pyx_kp_u_Internal_Server_Error;
 static PyObject *__pyx_kp_u_Internal_server_error;
+static PyObject *__pyx_n_s_KeyError;
 static PyObject *__pyx_n_s_PickleError;
 static PyObject *__pyx_kp_u_Resource_not_found;
 static PyObject *__pyx_kp_u_Unhandled_exception_s_s;
 static PyObject *__pyx_n_s_app;
 static PyObject *__pyx_kp_b_application_json;
 static PyObject *__pyx_n_s_apply_exception_handler;
 static PyObject *__pyx_n_s_args;
@@ -3591,15 +3602,15 @@
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
   if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (!(likely(PyDict_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "dict", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 36, __pyx_L1_error)
+  if (!(likely(PyDict_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "dict", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v_self->exceptions_handlers);
   __Pyx_DECREF(__pyx_v_self->exceptions_handlers);
   __pyx_v_self->exceptions_handlers = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "blacksheep/baseapp.pyx":37
@@ -5716,76 +5727,178 @@
   return __pyx_r;
 }
 
 /* "blacksheep/baseapp.pyx":106
  *         return await self.handle_exception(request, exc)
  * 
  *     cdef object get_http_exception_handler(self, HTTPException http_exception):             # <<<<<<<<<<<<<<
- *         return self.exceptions_handlers.get(http_exception.status, common_http_exception_handler)
- * 
+ *         try:
+ *             return self.exceptions_handlers[type(http_exception)]
  */
 
 static PyObject *__pyx_f_10blacksheep_7baseapp_15BaseApplication_get_http_exception_handler(struct __pyx_obj_10blacksheep_7baseapp_BaseApplication *__pyx_v_self, struct __pyx_obj_10blacksheep_10exceptions_HTTPException *__pyx_v_http_exception) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  int __pyx_t_5;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  PyObject *__pyx_t_9 = NULL;
+  PyObject *__pyx_t_10 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_http_exception_handler", 0);
 
   /* "blacksheep/baseapp.pyx":107
  * 
  *     cdef object get_http_exception_handler(self, HTTPException http_exception):
- *         return self.exceptions_handlers.get(http_exception.status, common_http_exception_handler)             # <<<<<<<<<<<<<<
+ *         try:             # <<<<<<<<<<<<<<
+ *             return self.exceptions_handlers[type(http_exception)]
+ *         except KeyError:
+ */
+  {
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
+    __Pyx_XGOTREF(__pyx_t_1);
+    __Pyx_XGOTREF(__pyx_t_2);
+    __Pyx_XGOTREF(__pyx_t_3);
+    /*try:*/ {
+
+      /* "blacksheep/baseapp.pyx":108
+ *     cdef object get_http_exception_handler(self, HTTPException http_exception):
+ *         try:
+ *             return self.exceptions_handlers[type(http_exception)]             # <<<<<<<<<<<<<<
+ *         except KeyError:
+ *             return self.exceptions_handlers.get(http_exception.status, common_http_exception_handler)
+ */
+      __Pyx_XDECREF(__pyx_r);
+      if (unlikely(__pyx_v_self->exceptions_handlers == Py_None)) {
+        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+        __PYX_ERR(0, 108, __pyx_L3_error)
+      }
+      __pyx_t_4 = __Pyx_PyDict_GetItem(__pyx_v_self->exceptions_handlers, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_http_exception)))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 108, __pyx_L3_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __pyx_r = __pyx_t_4;
+      __pyx_t_4 = 0;
+      goto __pyx_L7_try_return;
+
+      /* "blacksheep/baseapp.pyx":107
+ * 
+ *     cdef object get_http_exception_handler(self, HTTPException http_exception):
+ *         try:             # <<<<<<<<<<<<<<
+ *             return self.exceptions_handlers[type(http_exception)]
+ *         except KeyError:
+ */
+    }
+    __pyx_L3_error:;
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+    /* "blacksheep/baseapp.pyx":109
+ *         try:
+ *             return self.exceptions_handlers[type(http_exception)]
+ *         except KeyError:             # <<<<<<<<<<<<<<
+ *             return self.exceptions_handlers.get(http_exception.status, common_http_exception_handler)
+ * 
+ */
+    __pyx_t_5 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_KeyError);
+    if (__pyx_t_5) {
+      __Pyx_AddTraceback("blacksheep.baseapp.BaseApplication.get_http_exception_handler", __pyx_clineno, __pyx_lineno, __pyx_filename);
+      if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(0, 109, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_GOTREF(__pyx_t_6);
+      __Pyx_GOTREF(__pyx_t_7);
+
+      /* "blacksheep/baseapp.pyx":110
+ *             return self.exceptions_handlers[type(http_exception)]
+ *         except KeyError:
+ *             return self.exceptions_handlers.get(http_exception.status, common_http_exception_handler)             # <<<<<<<<<<<<<<
  * 
  *     cdef object get_exception_handler(self, Exception exception):
  */
-  __Pyx_XDECREF(__pyx_r);
-  if (unlikely(__pyx_v_self->exceptions_handlers == Py_None)) {
-    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get");
-    __PYX_ERR(0, 107, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_r);
+      if (unlikely(__pyx_v_self->exceptions_handlers == Py_None)) {
+        PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get");
+        __PYX_ERR(0, 110, __pyx_L5_except_error)
+      }
+      __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_http_exception->status); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 110, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_8);
+      __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_common_http_exception_handler); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 110, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_9);
+      __pyx_t_10 = __Pyx_PyDict_GetItemDefault(__pyx_v_self->exceptions_handlers, __pyx_t_8, __pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 110, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_10);
+      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
+      __pyx_r = __pyx_t_10;
+      __pyx_t_10 = 0;
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+      goto __pyx_L6_except_return;
+    }
+    goto __pyx_L5_except_error;
+    __pyx_L5_except_error:;
+
+    /* "blacksheep/baseapp.pyx":107
+ * 
+ *     cdef object get_http_exception_handler(self, HTTPException http_exception):
+ *         try:             # <<<<<<<<<<<<<<
+ *             return self.exceptions_handlers[type(http_exception)]
+ *         except KeyError:
+ */
+    __Pyx_XGIVEREF(__pyx_t_1);
+    __Pyx_XGIVEREF(__pyx_t_2);
+    __Pyx_XGIVEREF(__pyx_t_3);
+    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
+    goto __pyx_L1_error;
+    __pyx_L7_try_return:;
+    __Pyx_XGIVEREF(__pyx_t_1);
+    __Pyx_XGIVEREF(__pyx_t_2);
+    __Pyx_XGIVEREF(__pyx_t_3);
+    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
+    goto __pyx_L0;
+    __pyx_L6_except_return:;
+    __Pyx_XGIVEREF(__pyx_t_1);
+    __Pyx_XGIVEREF(__pyx_t_2);
+    __Pyx_XGIVEREF(__pyx_t_3);
+    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
+    goto __pyx_L0;
   }
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_http_exception->status); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 107, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_common_http_exception_handler); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 107, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyDict_GetItemDefault(__pyx_v_self->exceptions_handlers, __pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 107, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_r = __pyx_t_3;
-  __pyx_t_3 = 0;
-  goto __pyx_L0;
 
   /* "blacksheep/baseapp.pyx":106
  *         return await self.handle_exception(request, exc)
  * 
  *     cdef object get_http_exception_handler(self, HTTPException http_exception):             # <<<<<<<<<<<<<<
- *         return self.exceptions_handlers.get(http_exception.status, common_http_exception_handler)
- * 
+ *         try:
+ *             return self.exceptions_handlers[type(http_exception)]
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_XDECREF(__pyx_t_9);
+  __Pyx_XDECREF(__pyx_t_10);
   __Pyx_AddTraceback("blacksheep.baseapp.BaseApplication.get_http_exception_handler", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/baseapp.pyx":109
- *         return self.exceptions_handlers.get(http_exception.status, common_http_exception_handler)
+/* "blacksheep/baseapp.pyx":112
+ *             return self.exceptions_handlers.get(http_exception.status, common_http_exception_handler)
  * 
  *     cdef object get_exception_handler(self, Exception exception):             # <<<<<<<<<<<<<<
  *         for current_class_in_hierarchy in get_class_instance_hierarchy(exception):
  *             if current_class_in_hierarchy in self.exceptions_handlers:
  */
 
 static PyObject *__pyx_f_10blacksheep_7baseapp_15BaseApplication_get_exception_handler(struct __pyx_obj_10blacksheep_7baseapp_BaseApplication *__pyx_v_self, PyObject *__pyx_v_exception) {
@@ -5800,147 +5913,147 @@
   int __pyx_t_6;
   int __pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_exception_handler", 0);
 
-  /* "blacksheep/baseapp.pyx":110
+  /* "blacksheep/baseapp.pyx":113
  * 
  *     cdef object get_exception_handler(self, Exception exception):
  *         for current_class_in_hierarchy in get_class_instance_hierarchy(exception):             # <<<<<<<<<<<<<<
  *             if current_class_in_hierarchy in self.exceptions_handlers:
  *                 return self.exceptions_handlers[current_class_in_hierarchy]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_get_class_instance_hierarchy); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_get_class_instance_hierarchy); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_exception) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_exception);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
     __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
     __pyx_t_5 = NULL;
   } else {
-    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 113, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 113, __pyx_L1_error)
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   for (;;) {
     if (likely(!__pyx_t_5)) {
       if (likely(PyList_CheckExact(__pyx_t_2))) {
         if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 113, __pyx_L1_error)
         #else
-        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
       } else {
         if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 113, __pyx_L1_error)
         #else
-        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
       }
     } else {
       __pyx_t_1 = __pyx_t_5(__pyx_t_2);
       if (unlikely(!__pyx_t_1)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 110, __pyx_L1_error)
+          else __PYX_ERR(0, 113, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_1);
     }
     __Pyx_XDECREF_SET(__pyx_v_current_class_in_hierarchy, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "blacksheep/baseapp.pyx":111
+    /* "blacksheep/baseapp.pyx":114
  *     cdef object get_exception_handler(self, Exception exception):
  *         for current_class_in_hierarchy in get_class_instance_hierarchy(exception):
  *             if current_class_in_hierarchy in self.exceptions_handlers:             # <<<<<<<<<<<<<<
  *                 return self.exceptions_handlers[current_class_in_hierarchy]
  * 
  */
     if (unlikely(__pyx_v_self->exceptions_handlers == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-      __PYX_ERR(0, 111, __pyx_L1_error)
+      __PYX_ERR(0, 114, __pyx_L1_error)
     }
-    __pyx_t_6 = (__Pyx_PyDict_ContainsTF(__pyx_v_current_class_in_hierarchy, __pyx_v_self->exceptions_handlers, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 111, __pyx_L1_error)
+    __pyx_t_6 = (__Pyx_PyDict_ContainsTF(__pyx_v_current_class_in_hierarchy, __pyx_v_self->exceptions_handlers, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 114, __pyx_L1_error)
     __pyx_t_7 = (__pyx_t_6 != 0);
     if (__pyx_t_7) {
 
-      /* "blacksheep/baseapp.pyx":112
+      /* "blacksheep/baseapp.pyx":115
  *         for current_class_in_hierarchy in get_class_instance_hierarchy(exception):
  *             if current_class_in_hierarchy in self.exceptions_handlers:
  *                 return self.exceptions_handlers[current_class_in_hierarchy]             # <<<<<<<<<<<<<<
  * 
  *         return None
  */
       __Pyx_XDECREF(__pyx_r);
       if (unlikely(__pyx_v_self->exceptions_handlers == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-        __PYX_ERR(0, 112, __pyx_L1_error)
+        __PYX_ERR(0, 115, __pyx_L1_error)
       }
-      __pyx_t_1 = __Pyx_PyDict_GetItem(__pyx_v_self->exceptions_handlers, __pyx_v_current_class_in_hierarchy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 112, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyDict_GetItem(__pyx_v_self->exceptions_handlers, __pyx_v_current_class_in_hierarchy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 115, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __pyx_r = __pyx_t_1;
       __pyx_t_1 = 0;
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       goto __pyx_L0;
 
-      /* "blacksheep/baseapp.pyx":111
+      /* "blacksheep/baseapp.pyx":114
  *     cdef object get_exception_handler(self, Exception exception):
  *         for current_class_in_hierarchy in get_class_instance_hierarchy(exception):
  *             if current_class_in_hierarchy in self.exceptions_handlers:             # <<<<<<<<<<<<<<
  *                 return self.exceptions_handlers[current_class_in_hierarchy]
  * 
  */
     }
 
-    /* "blacksheep/baseapp.pyx":110
+    /* "blacksheep/baseapp.pyx":113
  * 
  *     cdef object get_exception_handler(self, Exception exception):
  *         for current_class_in_hierarchy in get_class_instance_hierarchy(exception):             # <<<<<<<<<<<<<<
  *             if current_class_in_hierarchy in self.exceptions_handlers:
  *                 return self.exceptions_handlers[current_class_in_hierarchy]
  */
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "blacksheep/baseapp.pyx":114
+  /* "blacksheep/baseapp.pyx":117
  *                 return self.exceptions_handlers[current_class_in_hierarchy]
  * 
  *         return None             # <<<<<<<<<<<<<<
  * 
  *     async def handle_internal_server_error(self, Request request, Exception exc):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
 
-  /* "blacksheep/baseapp.pyx":109
- *         return self.exceptions_handlers.get(http_exception.status, common_http_exception_handler)
+  /* "blacksheep/baseapp.pyx":112
+ *             return self.exceptions_handlers.get(http_exception.status, common_http_exception_handler)
  * 
  *     cdef object get_exception_handler(self, Exception exception):             # <<<<<<<<<<<<<<
  *         for current_class_in_hierarchy in get_class_instance_hierarchy(exception):
  *             if current_class_in_hierarchy in self.exceptions_handlers:
  */
 
   /* function exit code */
@@ -5954,15 +6067,15 @@
   __Pyx_XDECREF(__pyx_v_current_class_in_hierarchy);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_10blacksheep_7baseapp_15BaseApplication_18generator7(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "blacksheep/baseapp.pyx":116
+/* "blacksheep/baseapp.pyx":119
  *         return None
  * 
  *     async def handle_internal_server_error(self, Request request, Exception exc):             # <<<<<<<<<<<<<<
  *         """
  *         Handles an unhandled exception.
  */
 
@@ -5997,39 +6110,39 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_request)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_exc)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("handle_internal_server_error", 1, 2, 2, 1); __PYX_ERR(0, 116, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("handle_internal_server_error", 1, 2, 2, 1); __PYX_ERR(0, 119, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "handle_internal_server_error") < 0)) __PYX_ERR(0, 116, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "handle_internal_server_error") < 0)) __PYX_ERR(0, 119, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_request = ((struct __pyx_obj_10blacksheep_8messages_Request *)values[0]);
     __pyx_v_exc = ((PyObject*)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("handle_internal_server_error", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 116, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("handle_internal_server_error", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 119, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("blacksheep.baseapp.BaseApplication.handle_internal_server_error", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_request), __pyx_ptype_10blacksheep_8messages_Request, 1, "request", 0))) __PYX_ERR(0, 116, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_exc), (&((PyTypeObject*)PyExc_Exception)[0]), 1, "exc", 0))) __PYX_ERR(0, 116, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_request), __pyx_ptype_10blacksheep_8messages_Request, 1, "request", 0))) __PYX_ERR(0, 119, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_exc), (&((PyTypeObject*)PyExc_Exception)[0]), 1, "exc", 0))) __PYX_ERR(0, 119, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_7baseapp_15BaseApplication_16handle_internal_server_error(((struct __pyx_obj_10blacksheep_7baseapp_BaseApplication *)__pyx_v_self), __pyx_v_request, __pyx_v_exc);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -6045,29 +6158,29 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("handle_internal_server_error", 0);
   __pyx_cur_scope = (struct __pyx_obj_10blacksheep_7baseapp___pyx_scope_struct_7_handle_internal_server_error *)__pyx_tp_new_10blacksheep_7baseapp___pyx_scope_struct_7_handle_internal_server_error(__pyx_ptype_10blacksheep_7baseapp___pyx_scope_struct_7_handle_internal_server_error, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10blacksheep_7baseapp___pyx_scope_struct_7_handle_internal_server_error *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 116, __pyx_L1_error)
+    __PYX_ERR(0, 119, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __pyx_cur_scope->__pyx_v_request = __pyx_v_request;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_request);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_request);
   __pyx_cur_scope->__pyx_v_exc = __pyx_v_exc;
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_exc);
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_exc);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_7baseapp_15BaseApplication_18generator7, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_handle_internal_server_error, __pyx_n_s_BaseApplication_handle_internal, __pyx_n_s_blacksheep_baseapp); if (unlikely(!gen)) __PYX_ERR(0, 116, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_7baseapp_15BaseApplication_18generator7, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_handle_internal_server_error, __pyx_n_s_BaseApplication_handle_internal, __pyx_n_s_blacksheep_baseapp); if (unlikely(!gen)) __PYX_ERR(0, 119, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -6104,58 +6217,58 @@
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L11_resume_from_await;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 116, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 119, __pyx_L1_error)
 
-  /* "blacksheep/baseapp.pyx":120
+  /* "blacksheep/baseapp.pyx":123
  *         Handles an unhandled exception.
  *         """
  *         if 500 in self.exceptions_handlers:             # <<<<<<<<<<<<<<
  *             # give a chance to run to the custom exception handler - but if it
  *             # fails, handle the failure (otherwise the
  */
   if (unlikely(__pyx_cur_scope->__pyx_v_self->exceptions_handlers == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 120, __pyx_L1_error)
+    __PYX_ERR(0, 123, __pyx_L1_error)
   }
-  __pyx_t_1 = (__Pyx_PyDict_ContainsTF(__pyx_int_500, __pyx_cur_scope->__pyx_v_self->exceptions_handlers, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 120, __pyx_L1_error)
+  __pyx_t_1 = (__Pyx_PyDict_ContainsTF(__pyx_int_500, __pyx_cur_scope->__pyx_v_self->exceptions_handlers, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 123, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "blacksheep/baseapp.pyx":123
+    /* "blacksheep/baseapp.pyx":126
  *             # give a chance to run to the custom exception handler - but if it
  *             # fails, handle the failure (otherwise the
  *             try:             # <<<<<<<<<<<<<<
  *                 return await self.exceptions_handlers[500](self, request, exc)
  *             except Exception:
  */
     {
       __Pyx_ExceptionSave(&__pyx_t_3, &__pyx_t_4, &__pyx_t_5);
       __Pyx_XGOTREF(__pyx_t_3);
       __Pyx_XGOTREF(__pyx_t_4);
       __Pyx_XGOTREF(__pyx_t_5);
       /*try:*/ {
 
-        /* "blacksheep/baseapp.pyx":124
+        /* "blacksheep/baseapp.pyx":127
  *             # fails, handle the failure (otherwise the
  *             try:
  *                 return await self.exceptions_handlers[500](self, request, exc)             # <<<<<<<<<<<<<<
  *             except Exception:
  *                 self.logger.exception(
  */
         __Pyx_XDECREF(__pyx_r);
         if (unlikely(__pyx_cur_scope->__pyx_v_self->exceptions_handlers == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-          __PYX_ERR(0, 124, __pyx_L5_error)
+          __PYX_ERR(0, 127, __pyx_L5_error)
         }
-        __pyx_t_7 = __Pyx_PyDict_GetItem(__pyx_cur_scope->__pyx_v_self->exceptions_handlers, __pyx_int_500); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 124, __pyx_L5_error)
+        __pyx_t_7 = __Pyx_PyDict_GetItem(__pyx_cur_scope->__pyx_v_self->exceptions_handlers, __pyx_int_500); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 127, __pyx_L5_error)
         __Pyx_GOTREF(__pyx_t_7);
         __pyx_t_8 = NULL;
         __pyx_t_9 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
           __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
           if (likely(__pyx_t_8)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
@@ -6164,43 +6277,43 @@
             __Pyx_DECREF_SET(__pyx_t_7, function);
             __pyx_t_9 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_7)) {
           PyObject *__pyx_temp[4] = {__pyx_t_8, ((PyObject *)__pyx_cur_scope->__pyx_v_self), ((PyObject *)__pyx_cur_scope->__pyx_v_request), __pyx_cur_scope->__pyx_v_exc};
-          __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L5_error)
+          __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 127, __pyx_L5_error)
           __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
           __Pyx_GOTREF(__pyx_t_6);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
           PyObject *__pyx_temp[4] = {__pyx_t_8, ((PyObject *)__pyx_cur_scope->__pyx_v_self), ((PyObject *)__pyx_cur_scope->__pyx_v_request), __pyx_cur_scope->__pyx_v_exc};
-          __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L5_error)
+          __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 127, __pyx_L5_error)
           __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
           __Pyx_GOTREF(__pyx_t_6);
         } else
         #endif
         {
-          __pyx_t_10 = PyTuple_New(3+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 124, __pyx_L5_error)
+          __pyx_t_10 = PyTuple_New(3+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 127, __pyx_L5_error)
           __Pyx_GOTREF(__pyx_t_10);
           if (__pyx_t_8) {
             __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_8); __pyx_t_8 = NULL;
           }
           __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_v_self));
           __Pyx_GIVEREF(((PyObject *)__pyx_cur_scope->__pyx_v_self));
           PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_9, ((PyObject *)__pyx_cur_scope->__pyx_v_self));
           __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_v_request));
           __Pyx_GIVEREF(((PyObject *)__pyx_cur_scope->__pyx_v_request));
           PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_9, ((PyObject *)__pyx_cur_scope->__pyx_v_request));
           __Pyx_INCREF(__pyx_cur_scope->__pyx_v_exc);
           __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_exc);
           PyTuple_SET_ITEM(__pyx_t_10, 2+__pyx_t_9, __pyx_cur_scope->__pyx_v_exc);
-          __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_10, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L5_error)
+          __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_10, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 127, __pyx_L5_error)
           __Pyx_GOTREF(__pyx_t_6);
           __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
         }
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_6);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_XGOTREF(__pyx_r);
@@ -6223,108 +6336,108 @@
           __Pyx_XGOTREF(__pyx_t_3);
           __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
           __pyx_cur_scope->__pyx_t_1 = 0;
           __Pyx_XGOTREF(__pyx_t_4);
           __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
           __pyx_cur_scope->__pyx_t_2 = 0;
           __Pyx_XGOTREF(__pyx_t_5);
-          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 124, __pyx_L5_error)
+          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 127, __pyx_L5_error)
           __pyx_t_6 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_6);
         } else {
           __pyx_t_6 = NULL;
-          if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_6) < 0) __PYX_ERR(0, 124, __pyx_L5_error)
+          if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_6) < 0) __PYX_ERR(0, 127, __pyx_L5_error)
           __Pyx_GOTREF(__pyx_t_6);
         }
         __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         goto __pyx_L9_try_return;
 
-        /* "blacksheep/baseapp.pyx":123
+        /* "blacksheep/baseapp.pyx":126
  *             # give a chance to run to the custom exception handler - but if it
  *             # fails, handle the failure (otherwise the
  *             try:             # <<<<<<<<<<<<<<
  *                 return await self.exceptions_handlers[500](self, request, exc)
  *             except Exception:
  */
       }
       __pyx_L5_error:;
       __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "blacksheep/baseapp.pyx":125
+      /* "blacksheep/baseapp.pyx":128
  *             try:
  *                 return await self.exceptions_handlers[500](self, request, exc)
  *             except Exception:             # <<<<<<<<<<<<<<
  *                 self.logger.exception(
  *                     "An exception occurred while trying to apply a custom 500 Internal Server Error handler!"
  */
       __pyx_t_9 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
       if (__pyx_t_9) {
         __Pyx_AddTraceback("blacksheep.baseapp.BaseApplication.handle_internal_server_error", __pyx_clineno, __pyx_lineno, __pyx_filename);
-        if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_7, &__pyx_t_10) < 0) __PYX_ERR(0, 125, __pyx_L7_except_error)
+        if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_7, &__pyx_t_10) < 0) __PYX_ERR(0, 128, __pyx_L7_except_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_GOTREF(__pyx_t_10);
 
-        /* "blacksheep/baseapp.pyx":126
+        /* "blacksheep/baseapp.pyx":129
  *                 return await self.exceptions_handlers[500](self, request, exc)
  *             except Exception:
  *                 self.logger.exception(             # <<<<<<<<<<<<<<
  *                     "An exception occurred while trying to apply a custom 500 Internal Server Error handler!"
  *                 )
  */
-        __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_self->logger, __pyx_n_s_exception); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 126, __pyx_L7_except_error)
+        __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_self->logger, __pyx_n_s_exception); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 129, __pyx_L7_except_error)
         __Pyx_GOTREF(__pyx_t_11);
         __pyx_t_12 = NULL;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_11))) {
           __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_11);
           if (likely(__pyx_t_12)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
             __Pyx_INCREF(__pyx_t_12);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_11, function);
           }
         }
         __pyx_t_8 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_12, __pyx_kp_u_An_exception_occurred_while_tryi) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_kp_u_An_exception_occurred_while_tryi);
         __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-        if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 126, __pyx_L7_except_error)
+        if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 129, __pyx_L7_except_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-        /* "blacksheep/baseapp.pyx":129
+        /* "blacksheep/baseapp.pyx":132
  *                     "An exception occurred while trying to apply a custom 500 Internal Server Error handler!"
  *                 )
  *                 return Response(500, content=TextContent('Internal Server Error'))             # <<<<<<<<<<<<<<
  *         if self.show_error_details:
  *             return self.server_error_details_handler.produce_response(request, exc)
  */
         __Pyx_XDECREF(__pyx_r);
-        __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 129, __pyx_L7_except_error)
+        __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L7_except_error)
         __Pyx_GOTREF(__pyx_t_8);
-        __pyx_t_11 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_8contents_TextContent), __pyx_tuple__9, NULL); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 129, __pyx_L7_except_error)
+        __pyx_t_11 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_8contents_TextContent), __pyx_tuple__9, NULL); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 132, __pyx_L7_except_error)
         __Pyx_GOTREF(__pyx_t_11);
-        if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_content, __pyx_t_11) < 0) __PYX_ERR(0, 129, __pyx_L7_except_error)
+        if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_content, __pyx_t_11) < 0) __PYX_ERR(0, 132, __pyx_L7_except_error)
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-        __pyx_t_11 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_8messages_Response), __pyx_tuple__8, __pyx_t_8); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 129, __pyx_L7_except_error)
+        __pyx_t_11 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_8messages_Response), __pyx_tuple__8, __pyx_t_8); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 132, __pyx_L7_except_error)
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
         goto __pyx_L8_except_return;
       }
       goto __pyx_L7_except_error;
       __pyx_L7_except_error:;
 
-      /* "blacksheep/baseapp.pyx":123
+      /* "blacksheep/baseapp.pyx":126
  *             # give a chance to run to the custom exception handler - but if it
  *             # fails, handle the failure (otherwise the
  *             try:             # <<<<<<<<<<<<<<
  *                 return await self.exceptions_handlers[500](self, request, exc)
  *             except Exception:
  */
       __Pyx_XGIVEREF(__pyx_t_3);
@@ -6342,44 +6455,44 @@
       __Pyx_XGIVEREF(__pyx_t_3);
       __Pyx_XGIVEREF(__pyx_t_4);
       __Pyx_XGIVEREF(__pyx_t_5);
       __Pyx_ExceptionReset(__pyx_t_3, __pyx_t_4, __pyx_t_5);
       goto __pyx_L0;
     }
 
-    /* "blacksheep/baseapp.pyx":120
+    /* "blacksheep/baseapp.pyx":123
  *         Handles an unhandled exception.
  *         """
  *         if 500 in self.exceptions_handlers:             # <<<<<<<<<<<<<<
  *             # give a chance to run to the custom exception handler - but if it
  *             # fails, handle the failure (otherwise the
  */
   }
 
-  /* "blacksheep/baseapp.pyx":130
+  /* "blacksheep/baseapp.pyx":133
  *                 )
  *                 return Response(500, content=TextContent('Internal Server Error'))
  *         if self.show_error_details:             # <<<<<<<<<<<<<<
  *             return self.server_error_details_handler.produce_response(request, exc)
  *         return Response(500, content=TextContent("Internal server error."))
  */
   __pyx_t_2 = (__pyx_cur_scope->__pyx_v_self->show_error_details != 0);
   if (__pyx_t_2) {
 
-    /* "blacksheep/baseapp.pyx":131
+    /* "blacksheep/baseapp.pyx":134
  *                 return Response(500, content=TextContent('Internal Server Error'))
  *         if self.show_error_details:
  *             return self.server_error_details_handler.produce_response(request, exc)             # <<<<<<<<<<<<<<
  *         return Response(500, content=TextContent("Internal server error."))
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_server_error_details_handler); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 131, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_server_error_details_handler); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 134, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_produce_response); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 131, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_produce_response); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 134, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_7 = NULL;
     __pyx_t_9 = 0;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
       __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
       if (likely(__pyx_t_7)) {
@@ -6389,80 +6502,80 @@
         __Pyx_DECREF_SET(__pyx_t_6, function);
         __pyx_t_9 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_6)) {
       PyObject *__pyx_temp[3] = {__pyx_t_7, ((PyObject *)__pyx_cur_scope->__pyx_v_request), __pyx_cur_scope->__pyx_v_exc};
-      __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 131, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 134, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_GOTREF(__pyx_t_10);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
       PyObject *__pyx_temp[3] = {__pyx_t_7, ((PyObject *)__pyx_cur_scope->__pyx_v_request), __pyx_cur_scope->__pyx_v_exc};
-      __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 131, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 134, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_GOTREF(__pyx_t_10);
     } else
     #endif
     {
-      __pyx_t_11 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 131, __pyx_L1_error)
+      __pyx_t_11 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 134, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
       if (__pyx_t_7) {
         __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_7); __pyx_t_7 = NULL;
       }
       __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_v_request));
       __Pyx_GIVEREF(((PyObject *)__pyx_cur_scope->__pyx_v_request));
       PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_9, ((PyObject *)__pyx_cur_scope->__pyx_v_request));
       __Pyx_INCREF(__pyx_cur_scope->__pyx_v_exc);
       __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_exc);
       PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_9, __pyx_cur_scope->__pyx_v_exc);
-      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_11, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 131, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_11, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 134, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     }
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/baseapp.pyx":130
+    /* "blacksheep/baseapp.pyx":133
  *                 )
  *                 return Response(500, content=TextContent('Internal Server Error'))
  *         if self.show_error_details:             # <<<<<<<<<<<<<<
  *             return self.server_error_details_handler.produce_response(request, exc)
  *         return Response(500, content=TextContent("Internal server error."))
  */
   }
 
-  /* "blacksheep/baseapp.pyx":132
+  /* "blacksheep/baseapp.pyx":135
  *         if self.show_error_details:
  *             return self.server_error_details_handler.produce_response(request, exc)
  *         return Response(500, content=TextContent("Internal server error."))             # <<<<<<<<<<<<<<
  * 
  *     async def _apply_exception_handler(self, Request request, Exception exc, object exception_handler):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_10 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 135, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_8contents_TextContent), __pyx_tuple__10, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_8contents_TextContent), __pyx_tuple__10, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 135, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_content, __pyx_t_6) < 0) __PYX_ERR(0, 132, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_content, __pyx_t_6) < 0) __PYX_ERR(0, 135, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_8messages_Response), __pyx_tuple__8, __pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_8messages_Response), __pyx_tuple__8, __pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 135, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   goto __pyx_L0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "blacksheep/baseapp.pyx":116
+  /* "blacksheep/baseapp.pyx":119
  *         return None
  * 
  *     async def handle_internal_server_error(self, Request request, Exception exc):             # <<<<<<<<<<<<<<
  *         """
  *         Handles an unhandled exception.
  */
 
@@ -6483,15 +6596,15 @@
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_10blacksheep_7baseapp_15BaseApplication_21generator8(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "blacksheep/baseapp.pyx":134
+/* "blacksheep/baseapp.pyx":137
  *         return Response(500, content=TextContent("Internal server error."))
  * 
  *     async def _apply_exception_handler(self, Request request, Exception exc, object exception_handler):             # <<<<<<<<<<<<<<
  *         try:
  *             return await exception_handler(self, request, exc)
  */
 
@@ -6528,47 +6641,47 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_request)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_exc)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_apply_exception_handler", 1, 3, 3, 1); __PYX_ERR(0, 134, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_apply_exception_handler", 1, 3, 3, 1); __PYX_ERR(0, 137, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_exception_handler)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_apply_exception_handler", 1, 3, 3, 2); __PYX_ERR(0, 134, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_apply_exception_handler", 1, 3, 3, 2); __PYX_ERR(0, 137, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_apply_exception_handler") < 0)) __PYX_ERR(0, 134, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_apply_exception_handler") < 0)) __PYX_ERR(0, 137, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_request = ((struct __pyx_obj_10blacksheep_8messages_Request *)values[0]);
     __pyx_v_exc = ((PyObject*)values[1]);
     __pyx_v_exception_handler = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_apply_exception_handler", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 134, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_apply_exception_handler", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 137, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("blacksheep.baseapp.BaseApplication._apply_exception_handler", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_request), __pyx_ptype_10blacksheep_8messages_Request, 1, "request", 0))) __PYX_ERR(0, 134, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_exc), (&((PyTypeObject*)PyExc_Exception)[0]), 1, "exc", 0))) __PYX_ERR(0, 134, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_request), __pyx_ptype_10blacksheep_8messages_Request, 1, "request", 0))) __PYX_ERR(0, 137, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_exc), (&((PyTypeObject*)PyExc_Exception)[0]), 1, "exc", 0))) __PYX_ERR(0, 137, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_7baseapp_15BaseApplication_19_apply_exception_handler(((struct __pyx_obj_10blacksheep_7baseapp_BaseApplication *)__pyx_v_self), __pyx_v_request, __pyx_v_exc, __pyx_v_exception_handler);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -6584,15 +6697,15 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_apply_exception_handler", 0);
   __pyx_cur_scope = (struct __pyx_obj_10blacksheep_7baseapp___pyx_scope_struct_8__apply_exception_handler *)__pyx_tp_new_10blacksheep_7baseapp___pyx_scope_struct_8__apply_exception_handler(__pyx_ptype_10blacksheep_7baseapp___pyx_scope_struct_8__apply_exception_handler, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10blacksheep_7baseapp___pyx_scope_struct_8__apply_exception_handler *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 134, __pyx_L1_error)
+    __PYX_ERR(0, 137, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __pyx_cur_scope->__pyx_v_request = __pyx_v_request;
@@ -6601,15 +6714,15 @@
   __pyx_cur_scope->__pyx_v_exc = __pyx_v_exc;
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_exc);
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_exc);
   __pyx_cur_scope->__pyx_v_exception_handler = __pyx_v_exception_handler;
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_exception_handler);
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_exception_handler);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_7baseapp_15BaseApplication_21generator8, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_apply_exception_handler, __pyx_n_s_BaseApplication__apply_exception, __pyx_n_s_blacksheep_baseapp); if (unlikely(!gen)) __PYX_ERR(0, 134, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_7baseapp_15BaseApplication_21generator8, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_apply_exception_handler, __pyx_n_s_BaseApplication__apply_exception, __pyx_n_s_blacksheep_baseapp); if (unlikely(!gen)) __PYX_ERR(0, 137, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -6655,31 +6768,31 @@
     case 1: goto __pyx_L10_resume_from_await;
     case 2: goto __pyx_L18_resume_from_await;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 134, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 137, __pyx_L1_error)
 
-  /* "blacksheep/baseapp.pyx":135
+  /* "blacksheep/baseapp.pyx":138
  * 
  *     async def _apply_exception_handler(self, Request request, Exception exc, object exception_handler):
  *         try:             # <<<<<<<<<<<<<<
  *             return await exception_handler(self, request, exc)
  *         except Exception as server_ex:
  */
   {
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "blacksheep/baseapp.pyx":136
+      /* "blacksheep/baseapp.pyx":139
  *     async def _apply_exception_handler(self, Request request, Exception exc, object exception_handler):
  *         try:
  *             return await exception_handler(self, request, exc)             # <<<<<<<<<<<<<<
  *         except Exception as server_ex:
  *             return await self.handle_exception(request, server_ex)
  */
       __Pyx_XDECREF(__pyx_r);
@@ -6695,43 +6808,43 @@
           __Pyx_DECREF_SET(__pyx_t_5, function);
           __pyx_t_7 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_5)) {
         PyObject *__pyx_temp[4] = {__pyx_t_6, ((PyObject *)__pyx_cur_scope->__pyx_v_self), ((PyObject *)__pyx_cur_scope->__pyx_v_request), __pyx_cur_scope->__pyx_v_exc};
-        __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 136, __pyx_L4_error)
+        __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 139, __pyx_L4_error)
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_GOTREF(__pyx_t_4);
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
         PyObject *__pyx_temp[4] = {__pyx_t_6, ((PyObject *)__pyx_cur_scope->__pyx_v_self), ((PyObject *)__pyx_cur_scope->__pyx_v_request), __pyx_cur_scope->__pyx_v_exc};
-        __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 136, __pyx_L4_error)
+        __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 139, __pyx_L4_error)
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_GOTREF(__pyx_t_4);
       } else
       #endif
       {
-        __pyx_t_8 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 136, __pyx_L4_error)
+        __pyx_t_8 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 139, __pyx_L4_error)
         __Pyx_GOTREF(__pyx_t_8);
         if (__pyx_t_6) {
           __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
         }
         __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_v_self));
         __Pyx_GIVEREF(((PyObject *)__pyx_cur_scope->__pyx_v_self));
         PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, ((PyObject *)__pyx_cur_scope->__pyx_v_self));
         __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_v_request));
         __Pyx_GIVEREF(((PyObject *)__pyx_cur_scope->__pyx_v_request));
         PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, ((PyObject *)__pyx_cur_scope->__pyx_v_request));
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_exc);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_exc);
         PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_7, __pyx_cur_scope->__pyx_v_exc);
-        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 136, __pyx_L4_error)
+        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 139, __pyx_L4_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       }
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_4);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_XGOTREF(__pyx_r);
@@ -6754,67 +6867,67 @@
         __Pyx_XGOTREF(__pyx_t_1);
         __pyx_t_2 = __pyx_cur_scope->__pyx_t_1;
         __pyx_cur_scope->__pyx_t_1 = 0;
         __Pyx_XGOTREF(__pyx_t_2);
         __pyx_t_3 = __pyx_cur_scope->__pyx_t_2;
         __pyx_cur_scope->__pyx_t_2 = 0;
         __Pyx_XGOTREF(__pyx_t_3);
-        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 136, __pyx_L4_error)
+        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 139, __pyx_L4_error)
         __pyx_t_4 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_4);
       } else {
         __pyx_t_4 = NULL;
-        if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_4) < 0) __PYX_ERR(0, 136, __pyx_L4_error)
+        if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_4) < 0) __PYX_ERR(0, 139, __pyx_L4_error)
         __Pyx_GOTREF(__pyx_t_4);
       }
       __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       goto __pyx_L8_try_return;
 
-      /* "blacksheep/baseapp.pyx":135
+      /* "blacksheep/baseapp.pyx":138
  * 
  *     async def _apply_exception_handler(self, Request request, Exception exc, object exception_handler):
  *         try:             # <<<<<<<<<<<<<<
  *             return await exception_handler(self, request, exc)
  *         except Exception as server_ex:
  */
     }
     __pyx_L4_error:;
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-    /* "blacksheep/baseapp.pyx":137
+    /* "blacksheep/baseapp.pyx":140
  *         try:
  *             return await exception_handler(self, request, exc)
  *         except Exception as server_ex:             # <<<<<<<<<<<<<<
  *             return await self.handle_exception(request, server_ex)
  * 
  */
     __pyx_t_7 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_7) {
       __Pyx_AddTraceback("blacksheep.baseapp.BaseApplication._apply_exception_handler", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_5, &__pyx_t_8) < 0) __PYX_ERR(0, 137, __pyx_L6_except_error)
+      if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_5, &__pyx_t_8) < 0) __PYX_ERR(0, 140, __pyx_L6_except_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_GIVEREF(__pyx_t_5);
       __pyx_cur_scope->__pyx_v_server_ex = __pyx_t_5;
       /*try:*/ {
 
-        /* "blacksheep/baseapp.pyx":138
+        /* "blacksheep/baseapp.pyx":141
  *             return await exception_handler(self, request, exc)
  *         except Exception as server_ex:
  *             return await self.handle_exception(request, server_ex)             # <<<<<<<<<<<<<<
  * 
  *     async def handle_http_exception(self, Request request, HTTPException http_exception):
  */
         __Pyx_XDECREF(__pyx_r);
-        __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_handle_exception); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 138, __pyx_L16_error)
+        __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_handle_exception); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 141, __pyx_L16_error)
         __Pyx_GOTREF(__pyx_t_9);
         __pyx_t_10 = NULL;
         __pyx_t_7 = 0;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_9))) {
           __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_9);
           if (likely(__pyx_t_10)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
@@ -6823,40 +6936,40 @@
             __Pyx_DECREF_SET(__pyx_t_9, function);
             __pyx_t_7 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_9)) {
           PyObject *__pyx_temp[3] = {__pyx_t_10, ((PyObject *)__pyx_cur_scope->__pyx_v_request), __pyx_cur_scope->__pyx_v_server_ex};
-          __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 138, __pyx_L16_error)
+          __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 141, __pyx_L16_error)
           __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
           __Pyx_GOTREF(__pyx_t_6);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
           PyObject *__pyx_temp[3] = {__pyx_t_10, ((PyObject *)__pyx_cur_scope->__pyx_v_request), __pyx_cur_scope->__pyx_v_server_ex};
-          __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 138, __pyx_L16_error)
+          __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 141, __pyx_L16_error)
           __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
           __Pyx_GOTREF(__pyx_t_6);
         } else
         #endif
         {
-          __pyx_t_11 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 138, __pyx_L16_error)
+          __pyx_t_11 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 141, __pyx_L16_error)
           __Pyx_GOTREF(__pyx_t_11);
           if (__pyx_t_10) {
             __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_10); __pyx_t_10 = NULL;
           }
           __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_v_request));
           __Pyx_GIVEREF(((PyObject *)__pyx_cur_scope->__pyx_v_request));
           PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_7, ((PyObject *)__pyx_cur_scope->__pyx_v_request));
           __Pyx_INCREF(__pyx_cur_scope->__pyx_v_server_ex);
           __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_server_ex);
           PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_7, __pyx_cur_scope->__pyx_v_server_ex);
-          __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_11, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 138, __pyx_L16_error)
+          __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_11, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 141, __pyx_L16_error)
           __Pyx_GOTREF(__pyx_t_6);
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
         }
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_6);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_XGOTREF(__pyx_r);
@@ -6894,30 +7007,30 @@
           __Pyx_XGOTREF(__pyx_t_4);
           __pyx_t_5 = __pyx_cur_scope->__pyx_t_4;
           __pyx_cur_scope->__pyx_t_4 = 0;
           __Pyx_XGOTREF(__pyx_t_5);
           __pyx_t_8 = __pyx_cur_scope->__pyx_t_5;
           __pyx_cur_scope->__pyx_t_5 = 0;
           __Pyx_XGOTREF(__pyx_t_8);
-          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 138, __pyx_L16_error)
+          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 141, __pyx_L16_error)
           __pyx_t_6 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_6);
         } else {
           __pyx_t_6 = NULL;
-          if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_6) < 0) __PYX_ERR(0, 138, __pyx_L16_error)
+          if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_6) < 0) __PYX_ERR(0, 141, __pyx_L16_error)
           __Pyx_GOTREF(__pyx_t_6);
         }
         __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         goto __pyx_L15_return;
       }
 
-      /* "blacksheep/baseapp.pyx":137
+      /* "blacksheep/baseapp.pyx":140
  *         try:
  *             return await exception_handler(self, request, exc)
  *         except Exception as server_ex:             # <<<<<<<<<<<<<<
  *             return await self.handle_exception(request, server_ex)
  * 
  */
       /*finally:*/ {
@@ -6989,15 +7102,15 @@
           goto __pyx_L7_except_return;
         }
       }
     }
     goto __pyx_L6_except_error;
     __pyx_L6_except_error:;
 
-    /* "blacksheep/baseapp.pyx":135
+    /* "blacksheep/baseapp.pyx":138
  * 
  *     async def _apply_exception_handler(self, Request request, Exception exc, object exception_handler):
  *         try:             # <<<<<<<<<<<<<<
  *             return await exception_handler(self, request, exc)
  *         except Exception as server_ex:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
@@ -7016,15 +7129,15 @@
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L0;
   }
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "blacksheep/baseapp.pyx":134
+  /* "blacksheep/baseapp.pyx":137
  *         return Response(500, content=TextContent("Internal server error."))
  * 
  *     async def _apply_exception_handler(self, Request request, Exception exc, object exception_handler):             # <<<<<<<<<<<<<<
  *         try:
  *             return await exception_handler(self, request, exc)
  */
 
@@ -7046,15 +7159,15 @@
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_10blacksheep_7baseapp_15BaseApplication_24generator9(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "blacksheep/baseapp.pyx":140
+/* "blacksheep/baseapp.pyx":143
  *             return await self.handle_exception(request, server_ex)
  * 
  *     async def handle_http_exception(self, Request request, HTTPException http_exception):             # <<<<<<<<<<<<<<
  *         exception_handler = self.get_http_exception_handler(http_exception)
  *         if exception_handler:
  */
 
@@ -7088,39 +7201,39 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_request)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_http_exception)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("handle_http_exception", 1, 2, 2, 1); __PYX_ERR(0, 140, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("handle_http_exception", 1, 2, 2, 1); __PYX_ERR(0, 143, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "handle_http_exception") < 0)) __PYX_ERR(0, 140, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "handle_http_exception") < 0)) __PYX_ERR(0, 143, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_request = ((struct __pyx_obj_10blacksheep_8messages_Request *)values[0]);
     __pyx_v_http_exception = ((struct __pyx_obj_10blacksheep_10exceptions_HTTPException *)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("handle_http_exception", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 140, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("handle_http_exception", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 143, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("blacksheep.baseapp.BaseApplication.handle_http_exception", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_request), __pyx_ptype_10blacksheep_8messages_Request, 1, "request", 0))) __PYX_ERR(0, 140, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_http_exception), __pyx_ptype_10blacksheep_10exceptions_HTTPException, 1, "http_exception", 0))) __PYX_ERR(0, 140, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_request), __pyx_ptype_10blacksheep_8messages_Request, 1, "request", 0))) __PYX_ERR(0, 143, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_http_exception), __pyx_ptype_10blacksheep_10exceptions_HTTPException, 1, "http_exception", 0))) __PYX_ERR(0, 143, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_7baseapp_15BaseApplication_22handle_http_exception(((struct __pyx_obj_10blacksheep_7baseapp_BaseApplication *)__pyx_v_self), __pyx_v_request, __pyx_v_http_exception);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -7136,29 +7249,29 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("handle_http_exception", 0);
   __pyx_cur_scope = (struct __pyx_obj_10blacksheep_7baseapp___pyx_scope_struct_9_handle_http_exception *)__pyx_tp_new_10blacksheep_7baseapp___pyx_scope_struct_9_handle_http_exception(__pyx_ptype_10blacksheep_7baseapp___pyx_scope_struct_9_handle_http_exception, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10blacksheep_7baseapp___pyx_scope_struct_9_handle_http_exception *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 140, __pyx_L1_error)
+    __PYX_ERR(0, 143, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __pyx_cur_scope->__pyx_v_request = __pyx_v_request;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_request);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_request);
   __pyx_cur_scope->__pyx_v_http_exception = __pyx_v_http_exception;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_http_exception);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_http_exception);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_7baseapp_15BaseApplication_24generator9, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_handle_http_exception, __pyx_n_s_BaseApplication_handle_http_exce, __pyx_n_s_blacksheep_baseapp); if (unlikely(!gen)) __PYX_ERR(0, 140, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_7baseapp_15BaseApplication_24generator9, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_handle_http_exception, __pyx_n_s_BaseApplication_handle_http_exce, __pyx_n_s_blacksheep_baseapp); if (unlikely(!gen)) __PYX_ERR(0, 143, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -7190,48 +7303,48 @@
     case 1: goto __pyx_L5_resume_from_await;
     case 2: goto __pyx_L6_resume_from_await;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 140, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 143, __pyx_L1_error)
 
-  /* "blacksheep/baseapp.pyx":141
+  /* "blacksheep/baseapp.pyx":144
  * 
  *     async def handle_http_exception(self, Request request, HTTPException http_exception):
  *         exception_handler = self.get_http_exception_handler(http_exception)             # <<<<<<<<<<<<<<
  *         if exception_handler:
  *             return await self._apply_exception_handler(request, http_exception, exception_handler)
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_7baseapp_BaseApplication *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->get_http_exception_handler(__pyx_cur_scope->__pyx_v_self, __pyx_cur_scope->__pyx_v_http_exception); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_7baseapp_BaseApplication *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->get_http_exception_handler(__pyx_cur_scope->__pyx_v_self, __pyx_cur_scope->__pyx_v_http_exception); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_cur_scope->__pyx_v_exception_handler = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "blacksheep/baseapp.pyx":142
+  /* "blacksheep/baseapp.pyx":145
  *     async def handle_http_exception(self, Request request, HTTPException http_exception):
  *         exception_handler = self.get_http_exception_handler(http_exception)
  *         if exception_handler:             # <<<<<<<<<<<<<<
  *             return await self._apply_exception_handler(request, http_exception, exception_handler)
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_exception_handler); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 142, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_exception_handler); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 145, __pyx_L1_error)
   if (__pyx_t_2) {
 
-    /* "blacksheep/baseapp.pyx":143
+    /* "blacksheep/baseapp.pyx":146
  *         exception_handler = self.get_http_exception_handler(http_exception)
  *         if exception_handler:
  *             return await self._apply_exception_handler(request, http_exception, exception_handler)             # <<<<<<<<<<<<<<
  * 
  *         return await self.handle_exception(request, http_exception)
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_apply_exception_handler); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 143, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_apply_exception_handler); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     __pyx_t_5 = 0;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -7240,43 +7353,43 @@
         __Pyx_DECREF_SET(__pyx_t_3, function);
         __pyx_t_5 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_3)) {
       PyObject *__pyx_temp[4] = {__pyx_t_4, ((PyObject *)__pyx_cur_scope->__pyx_v_request), ((PyObject *)__pyx_cur_scope->__pyx_v_http_exception), __pyx_cur_scope->__pyx_v_exception_handler};
-      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 143, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_GOTREF(__pyx_t_1);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
       PyObject *__pyx_temp[4] = {__pyx_t_4, ((PyObject *)__pyx_cur_scope->__pyx_v_request), ((PyObject *)__pyx_cur_scope->__pyx_v_http_exception), __pyx_cur_scope->__pyx_v_exception_handler};
-      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 143, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_GOTREF(__pyx_t_1);
     } else
     #endif
     {
-      __pyx_t_6 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 143, __pyx_L1_error)
+      __pyx_t_6 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 146, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       if (__pyx_t_4) {
         __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
       }
       __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_v_request));
       __Pyx_GIVEREF(((PyObject *)__pyx_cur_scope->__pyx_v_request));
       PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, ((PyObject *)__pyx_cur_scope->__pyx_v_request));
       __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_v_http_exception));
       __Pyx_GIVEREF(((PyObject *)__pyx_cur_scope->__pyx_v_http_exception));
       PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, ((PyObject *)__pyx_cur_scope->__pyx_v_http_exception));
       __Pyx_INCREF(__pyx_cur_scope->__pyx_v_exception_handler);
       __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_exception_handler);
       PyTuple_SET_ITEM(__pyx_t_6, 2+__pyx_t_5, __pyx_cur_scope->__pyx_v_exception_handler);
-      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 143, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_1);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XGOTREF(__pyx_r);
@@ -7284,43 +7397,43 @@
       __Pyx_XGIVEREF(__pyx_r);
       __Pyx_RefNannyFinishContext();
       __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
       /* return from generator, awaiting value */
       __pyx_generator->resume_label = 1;
       return __pyx_r;
       __pyx_L5_resume_from_await:;
-      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 143, __pyx_L1_error)
+      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 146, __pyx_L1_error)
       __pyx_t_1 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_1);
     } else {
       __pyx_t_1 = NULL;
-      if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 143, __pyx_L1_error)
+      if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 146, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
     }
     __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/baseapp.pyx":142
+    /* "blacksheep/baseapp.pyx":145
  *     async def handle_http_exception(self, Request request, HTTPException http_exception):
  *         exception_handler = self.get_http_exception_handler(http_exception)
  *         if exception_handler:             # <<<<<<<<<<<<<<
  *             return await self._apply_exception_handler(request, http_exception, exception_handler)
  * 
  */
   }
 
-  /* "blacksheep/baseapp.pyx":145
+  /* "blacksheep/baseapp.pyx":148
  *             return await self._apply_exception_handler(request, http_exception, exception_handler)
  * 
  *         return await self.handle_exception(request, http_exception)             # <<<<<<<<<<<<<<
  * 
  *     async def handle_exception(self, request, exc):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_handle_exception); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 145, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_handle_exception); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_6 = NULL;
   __pyx_t_5 = 0;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -7329,40 +7442,40 @@
       __Pyx_DECREF_SET(__pyx_t_3, function);
       __pyx_t_5 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_3)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, ((PyObject *)__pyx_cur_scope->__pyx_v_request), ((PyObject *)__pyx_cur_scope->__pyx_v_http_exception)};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 145, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, ((PyObject *)__pyx_cur_scope->__pyx_v_request), ((PyObject *)__pyx_cur_scope->__pyx_v_http_exception)};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 145, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_4 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 145, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 148, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
     __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_v_request));
     __Pyx_GIVEREF(((PyObject *)__pyx_cur_scope->__pyx_v_request));
     PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_5, ((PyObject *)__pyx_cur_scope->__pyx_v_request));
     __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_v_http_exception));
     __Pyx_GIVEREF(((PyObject *)__pyx_cur_scope->__pyx_v_http_exception));
     PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_5, ((PyObject *)__pyx_cur_scope->__pyx_v_http_exception));
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 145, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   }
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_XGOTREF(__pyx_r);
@@ -7370,27 +7483,27 @@
     __Pyx_XGIVEREF(__pyx_r);
     __Pyx_RefNannyFinishContext();
     __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
     /* return from generator, awaiting value */
     __pyx_generator->resume_label = 2;
     return __pyx_r;
     __pyx_L6_resume_from_await:;
-    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 145, __pyx_L1_error)
+    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 148, __pyx_L1_error)
     __pyx_t_1 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_1);
   } else {
     __pyx_t_1 = NULL;
-    if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 145, __pyx_L1_error)
+    if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 148, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
   }
   __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   goto __pyx_L0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "blacksheep/baseapp.pyx":140
+  /* "blacksheep/baseapp.pyx":143
  *             return await self.handle_exception(request, server_ex)
  * 
  *     async def handle_http_exception(self, Request request, HTTPException http_exception):             # <<<<<<<<<<<<<<
  *         exception_handler = self.get_http_exception_handler(http_exception)
  *         if exception_handler:
  */
 
@@ -7409,15 +7522,15 @@
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_10blacksheep_7baseapp_15BaseApplication_27generator10(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "blacksheep/baseapp.pyx":147
+/* "blacksheep/baseapp.pyx":150
  *         return await self.handle_exception(request, http_exception)
  * 
  *     async def handle_exception(self, request, exc):             # <<<<<<<<<<<<<<
  *         exception_handler = self.get_exception_handler(exc)
  *         if exception_handler:
  */
 
@@ -7451,32 +7564,32 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_request)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_exc)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("handle_exception", 1, 2, 2, 1); __PYX_ERR(0, 147, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("handle_exception", 1, 2, 2, 1); __PYX_ERR(0, 150, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "handle_exception") < 0)) __PYX_ERR(0, 147, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "handle_exception") < 0)) __PYX_ERR(0, 150, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_request = values[0];
     __pyx_v_exc = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("handle_exception", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 147, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("handle_exception", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 150, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("blacksheep.baseapp.BaseApplication.handle_exception", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_10blacksheep_7baseapp_15BaseApplication_25handle_exception(((struct __pyx_obj_10blacksheep_7baseapp_BaseApplication *)__pyx_v_self), __pyx_v_request, __pyx_v_exc);
 
@@ -7493,29 +7606,29 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("handle_exception", 0);
   __pyx_cur_scope = (struct __pyx_obj_10blacksheep_7baseapp___pyx_scope_struct_10_handle_exception *)__pyx_tp_new_10blacksheep_7baseapp___pyx_scope_struct_10_handle_exception(__pyx_ptype_10blacksheep_7baseapp___pyx_scope_struct_10_handle_exception, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10blacksheep_7baseapp___pyx_scope_struct_10_handle_exception *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 147, __pyx_L1_error)
+    __PYX_ERR(0, 150, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __pyx_cur_scope->__pyx_v_request = __pyx_v_request;
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_request);
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_request);
   __pyx_cur_scope->__pyx_v_exc = __pyx_v_exc;
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_exc);
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_exc);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_7baseapp_15BaseApplication_27generator10, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_handle_exception, __pyx_n_s_BaseApplication_handle_exception, __pyx_n_s_blacksheep_baseapp); if (unlikely(!gen)) __PYX_ERR(0, 147, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_7baseapp_15BaseApplication_27generator10, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_handle_exception, __pyx_n_s_BaseApplication_handle_exception, __pyx_n_s_blacksheep_baseapp); if (unlikely(!gen)) __PYX_ERR(0, 150, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -7547,49 +7660,49 @@
     case 1: goto __pyx_L5_resume_from_await;
     case 2: goto __pyx_L6_resume_from_await;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 147, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 150, __pyx_L1_error)
 
-  /* "blacksheep/baseapp.pyx":148
+  /* "blacksheep/baseapp.pyx":151
  * 
  *     async def handle_exception(self, request, exc):
  *         exception_handler = self.get_exception_handler(exc)             # <<<<<<<<<<<<<<
  *         if exception_handler:
  *             return await self._apply_exception_handler(request, exc, exception_handler)
  */
-  if (!(likely(__Pyx_PyException_Check(__pyx_cur_scope->__pyx_v_exc))||((__pyx_cur_scope->__pyx_v_exc) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "Exception", Py_TYPE(__pyx_cur_scope->__pyx_v_exc)->tp_name), 0))) __PYX_ERR(0, 148, __pyx_L1_error)
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_7baseapp_BaseApplication *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->get_exception_handler(__pyx_cur_scope->__pyx_v_self, ((PyObject*)__pyx_cur_scope->__pyx_v_exc)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)
+  if (!(likely(__Pyx_PyException_Check(__pyx_cur_scope->__pyx_v_exc))||((__pyx_cur_scope->__pyx_v_exc) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "Exception", Py_TYPE(__pyx_cur_scope->__pyx_v_exc)->tp_name), 0))) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_7baseapp_BaseApplication *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->get_exception_handler(__pyx_cur_scope->__pyx_v_self, ((PyObject*)__pyx_cur_scope->__pyx_v_exc)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_cur_scope->__pyx_v_exception_handler = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "blacksheep/baseapp.pyx":149
+  /* "blacksheep/baseapp.pyx":152
  *     async def handle_exception(self, request, exc):
  *         exception_handler = self.get_exception_handler(exc)
  *         if exception_handler:             # <<<<<<<<<<<<<<
  *             return await self._apply_exception_handler(request, exc, exception_handler)
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_exception_handler); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_exception_handler); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 152, __pyx_L1_error)
   if (__pyx_t_2) {
 
-    /* "blacksheep/baseapp.pyx":150
+    /* "blacksheep/baseapp.pyx":153
  *         exception_handler = self.get_exception_handler(exc)
  *         if exception_handler:
  *             return await self._apply_exception_handler(request, exc, exception_handler)             # <<<<<<<<<<<<<<
  * 
  *         return await self.handle_internal_server_error(request, exc)
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_apply_exception_handler); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 150, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_apply_exception_handler); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 153, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     __pyx_t_5 = 0;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -7598,43 +7711,43 @@
         __Pyx_DECREF_SET(__pyx_t_3, function);
         __pyx_t_5 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_3)) {
       PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_cur_scope->__pyx_v_request, __pyx_cur_scope->__pyx_v_exc, __pyx_cur_scope->__pyx_v_exception_handler};
-      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 153, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_GOTREF(__pyx_t_1);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
       PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_cur_scope->__pyx_v_request, __pyx_cur_scope->__pyx_v_exc, __pyx_cur_scope->__pyx_v_exception_handler};
-      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 153, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_GOTREF(__pyx_t_1);
     } else
     #endif
     {
-      __pyx_t_6 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 150, __pyx_L1_error)
+      __pyx_t_6 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 153, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       if (__pyx_t_4) {
         __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
       }
       __Pyx_INCREF(__pyx_cur_scope->__pyx_v_request);
       __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_request);
       PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_cur_scope->__pyx_v_request);
       __Pyx_INCREF(__pyx_cur_scope->__pyx_v_exc);
       __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_exc);
       PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_cur_scope->__pyx_v_exc);
       __Pyx_INCREF(__pyx_cur_scope->__pyx_v_exception_handler);
       __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_exception_handler);
       PyTuple_SET_ITEM(__pyx_t_6, 2+__pyx_t_5, __pyx_cur_scope->__pyx_v_exception_handler);
-      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 153, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_1);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XGOTREF(__pyx_r);
@@ -7642,41 +7755,41 @@
       __Pyx_XGIVEREF(__pyx_r);
       __Pyx_RefNannyFinishContext();
       __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
       /* return from generator, awaiting value */
       __pyx_generator->resume_label = 1;
       return __pyx_r;
       __pyx_L5_resume_from_await:;
-      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 150, __pyx_L1_error)
+      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 153, __pyx_L1_error)
       __pyx_t_1 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_1);
     } else {
       __pyx_t_1 = NULL;
-      if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 150, __pyx_L1_error)
+      if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 153, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
     }
     __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/baseapp.pyx":149
+    /* "blacksheep/baseapp.pyx":152
  *     async def handle_exception(self, request, exc):
  *         exception_handler = self.get_exception_handler(exc)
  *         if exception_handler:             # <<<<<<<<<<<<<<
  *             return await self._apply_exception_handler(request, exc, exception_handler)
  * 
  */
   }
 
-  /* "blacksheep/baseapp.pyx":152
+  /* "blacksheep/baseapp.pyx":155
  *             return await self._apply_exception_handler(request, exc, exception_handler)
  * 
  *         return await self.handle_internal_server_error(request, exc)             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_handle_internal_server_error); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_handle_internal_server_error); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 155, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_6 = NULL;
   __pyx_t_5 = 0;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -7685,40 +7798,40 @@
       __Pyx_DECREF_SET(__pyx_t_3, function);
       __pyx_t_5 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_3)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_cur_scope->__pyx_v_request, __pyx_cur_scope->__pyx_v_exc};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 155, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_cur_scope->__pyx_v_request, __pyx_cur_scope->__pyx_v_exc};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 155, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_4 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 152, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 155, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
     __Pyx_INCREF(__pyx_cur_scope->__pyx_v_request);
     __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_request);
     PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_5, __pyx_cur_scope->__pyx_v_request);
     __Pyx_INCREF(__pyx_cur_scope->__pyx_v_exc);
     __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_exc);
     PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_5, __pyx_cur_scope->__pyx_v_exc);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 155, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   }
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_XGOTREF(__pyx_r);
@@ -7726,27 +7839,27 @@
     __Pyx_XGIVEREF(__pyx_r);
     __Pyx_RefNannyFinishContext();
     __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
     /* return from generator, awaiting value */
     __pyx_generator->resume_label = 2;
     return __pyx_r;
     __pyx_L6_resume_from_await:;
-    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 152, __pyx_L1_error)
+    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 155, __pyx_L1_error)
     __pyx_t_1 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_1);
   } else {
     __pyx_t_1 = NULL;
-    if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 152, __pyx_L1_error)
+    if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 155, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
   }
   __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   goto __pyx_L0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "blacksheep/baseapp.pyx":147
+  /* "blacksheep/baseapp.pyx":150
  *         return await self.handle_exception(request, http_exception)
  * 
  *     async def handle_exception(self, request, exc):             # <<<<<<<<<<<<<<
  *         exception_handler = self.get_exception_handler(exc)
  *         if exception_handler:
  */
 
@@ -7978,15 +8091,15 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
-  if (!(likely(PyDict_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "dict", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(1, 15, __pyx_L1_error)
+  if (!(likely(PyDict_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "dict", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(1, 15, __pyx_L1_error)
   __pyx_t_1 = __pyx_v_value;
   __Pyx_INCREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v_self->exceptions_handlers);
   __Pyx_DECREF(__pyx_v_self->exceptions_handlers);
   __pyx_v_self->exceptions_handlers = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
@@ -8325,15 +8438,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_BaseApplication, (type(self), 0xe75049b, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_BaseApplication__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_7baseapp___pyx_unpickle_BaseApplication__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_BaseApplication, (type(self), 0xe75049b, state)
@@ -8571,15 +8684,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = BaseApplication.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_BaseApplication__set_state(<BaseApplication> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_BaseApplication__set_state(BaseApplication __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_7baseapp___pyx_unpickle_BaseApplication__set_state(((struct __pyx_obj_10blacksheep_7baseapp_BaseApplication *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xe75049b, 0xc7f976d, 0xa0c2b62) = (exceptions_handlers, logger, router, show_error_details))" % __pyx_checksum)
  *     __pyx_result = BaseApplication.__new__(__pyx_type)
@@ -8656,15 +8769,15 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyDict_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "dict", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyDict_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "dict", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->exceptions_handlers);
   __Pyx_DECREF(__pyx_v___pyx_result->exceptions_handlers);
   __pyx_v___pyx_result->exceptions_handlers = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -11414,14 +11527,15 @@
   {&__pyx_n_s_HTTPStatus, __pyx_k_HTTPStatus, sizeof(__pyx_k_HTTPStatus), 0, 0, 1, 1},
   {&__pyx_kp_u_HTTP_s_s_s_s, __pyx_k_HTTP_s_s_s_s, sizeof(__pyx_k_HTTP_s_s_s_s), 0, 1, 0, 0},
   {&__pyx_kp_u_Handled_error_s_s_s, __pyx_k_Handled_error_s_s_s, sizeof(__pyx_k_Handled_error_s_s_s), 0, 1, 0, 0},
   {&__pyx_n_s_INFO, __pyx_k_INFO, sizeof(__pyx_k_INFO), 0, 0, 1, 1},
   {&__pyx_kp_s_Incompatible_checksums_0x_x_vs_0, __pyx_k_Incompatible_checksums_0x_x_vs_0, sizeof(__pyx_k_Incompatible_checksums_0x_x_vs_0), 0, 0, 1, 0},
   {&__pyx_kp_u_Internal_Server_Error, __pyx_k_Internal_Server_Error, sizeof(__pyx_k_Internal_Server_Error), 0, 1, 0, 0},
   {&__pyx_kp_u_Internal_server_error, __pyx_k_Internal_server_error, sizeof(__pyx_k_Internal_server_error), 0, 1, 0, 0},
+  {&__pyx_n_s_KeyError, __pyx_k_KeyError, sizeof(__pyx_k_KeyError), 0, 0, 1, 1},
   {&__pyx_n_s_PickleError, __pyx_k_PickleError, sizeof(__pyx_k_PickleError), 0, 0, 1, 1},
   {&__pyx_kp_u_Resource_not_found, __pyx_k_Resource_not_found, sizeof(__pyx_k_Resource_not_found), 0, 1, 0, 0},
   {&__pyx_kp_u_Unhandled_exception_s_s, __pyx_k_Unhandled_exception_s_s, sizeof(__pyx_k_Unhandled_exception_s_s), 0, 1, 0, 0},
   {&__pyx_n_s_app, __pyx_k_app, sizeof(__pyx_k_app), 0, 0, 1, 1},
   {&__pyx_kp_b_application_json, __pyx_k_application_json, sizeof(__pyx_k_application_json), 0, 0, 0, 0},
   {&__pyx_n_s_apply_exception_handler, __pyx_k_apply_exception_handler, sizeof(__pyx_k_apply_exception_handler), 0, 0, 1, 1},
   {&__pyx_n_s_args, __pyx_k_args, sizeof(__pyx_k_args), 0, 0, 1, 1},
@@ -11500,15 +11614,18 @@
   {&__pyx_n_s_url, __pyx_k_url, sizeof(__pyx_k_url), 0, 0, 1, 1},
   {&__pyx_n_s_utils, __pyx_k_utils, sizeof(__pyx_k_utils), 0, 0, 1, 1},
   {&__pyx_n_s_value, __pyx_k_value, sizeof(__pyx_k_value), 0, 0, 1, 1},
   {&__pyx_n_s_values, __pyx_k_values, sizeof(__pyx_k_values), 0, 0, 1, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
+  __pyx_builtin_KeyError = __Pyx_GetBuiltinName(__pyx_n_s_KeyError); if (!__pyx_builtin_KeyError) __PYX_ERR(0, 109, __pyx_L1_error)
   return 0;
+  __pyx_L1_error:;
+  return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
   /* "blacksheep/baseapp.pyx":11
@@ -11543,36 +11660,36 @@
  * 
  *     async def handle_request_handler_exception(self, request, exc):
  */
   __pyx_tuple__7 = PyTuple_Pack(1, __pyx_int_204); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 92, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__7);
   __Pyx_GIVEREF(__pyx_tuple__7);
 
-  /* "blacksheep/baseapp.pyx":129
+  /* "blacksheep/baseapp.pyx":132
  *                     "An exception occurred while trying to apply a custom 500 Internal Server Error handler!"
  *                 )
  *                 return Response(500, content=TextContent('Internal Server Error'))             # <<<<<<<<<<<<<<
  *         if self.show_error_details:
  *             return self.server_error_details_handler.produce_response(request, exc)
  */
-  __pyx_tuple__8 = PyTuple_Pack(1, __pyx_int_500); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(0, 129, __pyx_L1_error)
+  __pyx_tuple__8 = PyTuple_Pack(1, __pyx_int_500); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(0, 132, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__8);
   __Pyx_GIVEREF(__pyx_tuple__8);
-  __pyx_tuple__9 = PyTuple_Pack(1, __pyx_kp_u_Internal_Server_Error); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 129, __pyx_L1_error)
+  __pyx_tuple__9 = PyTuple_Pack(1, __pyx_kp_u_Internal_Server_Error); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 132, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__9);
   __Pyx_GIVEREF(__pyx_tuple__9);
 
-  /* "blacksheep/baseapp.pyx":132
+  /* "blacksheep/baseapp.pyx":135
  *         if self.show_error_details:
  *             return self.server_error_details_handler.produce_response(request, exc)
  *         return Response(500, content=TextContent("Internal server error."))             # <<<<<<<<<<<<<<
  * 
  *     async def _apply_exception_handler(self, Request request, Exception exc, object exception_handler):
  */
-  __pyx_tuple__10 = PyTuple_Pack(1, __pyx_kp_u_Internal_server_error); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_tuple__10 = PyTuple_Pack(1, __pyx_kp_u_Internal_server_error); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 135, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__10);
   __Pyx_GIVEREF(__pyx_tuple__10);
 
   /* "(tree fragment)":4
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  *     if __pyx_checksum not in (0xe75049b, 0xc7f976d, 0xa0c2b62):             # <<<<<<<<<<<<<<
@@ -11645,15 +11762,15 @@
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
   __pyx_umethod_PyDict_Type_get.type = (PyObject*)&PyDict_Type;
-  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_204 = PyInt_FromLong(204); if (unlikely(!__pyx_int_204)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_400 = PyInt_FromLong(400); if (unlikely(!__pyx_int_400)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_404 = PyInt_FromLong(404); if (unlikely(!__pyx_int_404)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_500 = PyInt_FromLong(500); if (unlikely(!__pyx_int_500)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_168569698 = PyInt_FromLong(168569698L); if (unlikely(!__pyx_int_168569698)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_209688429 = PyInt_FromLong(209688429L); if (unlikely(!__pyx_int_209688429)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_242549915 = PyInt_FromLong(242549915L); if (unlikely(!__pyx_int_242549915)) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -11767,39 +11884,39 @@
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_6_handle_request_handler_exception.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_6_handle_request_handler_exception.tp_dictoffset && __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_6_handle_request_handler_exception.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_6_handle_request_handler_exception.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10blacksheep_7baseapp___pyx_scope_struct_6_handle_request_handler_exception = &__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_6_handle_request_handler_exception;
-  if (PyType_Ready(&__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_7_handle_internal_server_error) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_7_handle_internal_server_error) < 0) __PYX_ERR(0, 119, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_7_handle_internal_server_error.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_7_handle_internal_server_error.tp_dictoffset && __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_7_handle_internal_server_error.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_7_handle_internal_server_error.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10blacksheep_7baseapp___pyx_scope_struct_7_handle_internal_server_error = &__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_7_handle_internal_server_error;
-  if (PyType_Ready(&__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_8__apply_exception_handler) < 0) __PYX_ERR(0, 134, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_8__apply_exception_handler) < 0) __PYX_ERR(0, 137, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_8__apply_exception_handler.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_8__apply_exception_handler.tp_dictoffset && __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_8__apply_exception_handler.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_8__apply_exception_handler.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10blacksheep_7baseapp___pyx_scope_struct_8__apply_exception_handler = &__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_8__apply_exception_handler;
-  if (PyType_Ready(&__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_9_handle_http_exception) < 0) __PYX_ERR(0, 140, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_9_handle_http_exception) < 0) __PYX_ERR(0, 143, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_9_handle_http_exception.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_9_handle_http_exception.tp_dictoffset && __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_9_handle_http_exception.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_9_handle_http_exception.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10blacksheep_7baseapp___pyx_scope_struct_9_handle_http_exception = &__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_9_handle_http_exception;
-  if (PyType_Ready(&__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_10_handle_exception) < 0) __PYX_ERR(0, 147, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_10_handle_exception) < 0) __PYX_ERR(0, 150, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_10_handle_exception.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_10_handle_exception.tp_dictoffset && __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_10_handle_exception.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10blacksheep_7baseapp___pyx_scope_struct_10_handle_exception.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10blacksheep_7baseapp___pyx_scope_struct_10_handle_exception = &__pyx_type_10blacksheep_7baseapp___pyx_scope_struct_10_handle_exception;
@@ -11816,96 +11933,122 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule("blacksheep.exceptions"); if (unlikely(!__pyx_t_1)) __PYX_ERR(4, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_10exceptions_MessageAborted = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "MessageAborted", sizeof(struct __pyx_obj_10blacksheep_10exceptions_MessageAborted), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_MessageAborted = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "MessageAborted", sizeof(struct __pyx_obj_10blacksheep_10exceptions_MessageAborted), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_MessageAborted),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_MessageAborted) __PYX_ERR(4, 4, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_HTTPException = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "HTTPException", sizeof(struct __pyx_obj_10blacksheep_10exceptions_HTTPException), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_HTTPException = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "HTTPException", sizeof(struct __pyx_obj_10blacksheep_10exceptions_HTTPException), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_HTTPException),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_HTTPException) __PYX_ERR(4, 8, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_BadRequest = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequest", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequest), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_BadRequest = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequest", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequest), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_BadRequest),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_BadRequest) __PYX_ERR(4, 12, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_BadRequestFormat = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequestFormat", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_BadRequestFormat = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequestFormat", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_BadRequestFormat) __PYX_ERR(4, 16, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_NotFound = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "NotFound", sizeof(struct __pyx_obj_10blacksheep_10exceptions_NotFound), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_NotFound = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "NotFound", sizeof(struct __pyx_obj_10blacksheep_10exceptions_NotFound), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_NotFound),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_NotFound) __PYX_ERR(4, 20, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_InvalidArgument = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidArgument", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidArgument), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_InvalidArgument = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidArgument", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidArgument), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_InvalidArgument),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_InvalidArgument) __PYX_ERR(4, 24, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_InvalidOperation = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidOperation", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidOperation), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_InvalidOperation = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidOperation", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidOperation), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_InvalidOperation),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_InvalidOperation) __PYX_ERR(4, 28, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("blacksheep.contents"); if (unlikely(!__pyx_t_1)) __PYX_ERR(5, 8, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_8contents_Content = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "Content", sizeof(struct __pyx_obj_10blacksheep_8contents_Content), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_Content = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "Content", sizeof(struct __pyx_obj_10blacksheep_8contents_Content), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_Content),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_Content) __PYX_ERR(5, 8, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_StreamedContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "StreamedContent", sizeof(struct __pyx_obj_10blacksheep_8contents_StreamedContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_StreamedContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "StreamedContent", sizeof(struct __pyx_obj_10blacksheep_8contents_StreamedContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_StreamedContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_StreamedContent) __PYX_ERR(5, 14, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_ASGIContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "ASGIContent", sizeof(struct __pyx_obj_10blacksheep_8contents_ASGIContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_ASGIContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "ASGIContent", sizeof(struct __pyx_obj_10blacksheep_8contents_ASGIContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_ASGIContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_ASGIContent) __PYX_ERR(5, 18, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_8contents_ASGIContent = (struct __pyx_vtabstruct_10blacksheep_8contents_ASGIContent*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_8contents_ASGIContent->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_8contents_ASGIContent)) __PYX_ERR(5, 18, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_TextContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "TextContent", sizeof(struct __pyx_obj_10blacksheep_8contents_TextContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_TextContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "TextContent", sizeof(struct __pyx_obj_10blacksheep_8contents_TextContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_TextContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_TextContent) __PYX_ERR(5, 23, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_HTMLContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "HTMLContent", sizeof(struct __pyx_obj_10blacksheep_8contents_HTMLContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_HTMLContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "HTMLContent", sizeof(struct __pyx_obj_10blacksheep_8contents_HTMLContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_HTMLContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_HTMLContent) __PYX_ERR(5, 27, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_JSONContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "JSONContent", sizeof(struct __pyx_obj_10blacksheep_8contents_JSONContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_JSONContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "JSONContent", sizeof(struct __pyx_obj_10blacksheep_8contents_JSONContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_JSONContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_JSONContent) __PYX_ERR(5, 31, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_FormContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "FormContent", sizeof(struct __pyx_obj_10blacksheep_8contents_FormContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_FormContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "FormContent", sizeof(struct __pyx_obj_10blacksheep_8contents_FormContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_FormContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_FormContent) __PYX_ERR(5, 35, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_FormPart = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "FormPart", sizeof(struct __pyx_obj_10blacksheep_8contents_FormPart), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_FormPart = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "FormPart", sizeof(struct __pyx_obj_10blacksheep_8contents_FormPart), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_FormPart),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_FormPart) __PYX_ERR(5, 39, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_MultiPartFormData = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "MultiPartFormData", sizeof(struct __pyx_obj_10blacksheep_8contents_MultiPartFormData), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_MultiPartFormData = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "MultiPartFormData", sizeof(struct __pyx_obj_10blacksheep_8contents_MultiPartFormData), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_MultiPartFormData),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_MultiPartFormData) __PYX_ERR(5, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(6, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyHeapTypeObject),
   #endif
   __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(6, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("datetime"); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_8datetime_date = __Pyx_ImportType(__pyx_t_1, "datetime", "date", sizeof(PyDateTime_Date), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_date = __Pyx_ImportType(__pyx_t_1, "datetime", "date", sizeof(PyDateTime_Date), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_Date),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_date) __PYX_ERR(3, 9, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_time = __Pyx_ImportType(__pyx_t_1, "datetime", "time", sizeof(PyDateTime_Time), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_time = __Pyx_ImportType(__pyx_t_1, "datetime", "time", sizeof(PyDateTime_Time), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_Time),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_time) __PYX_ERR(3, 12, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_datetime = __Pyx_ImportType(__pyx_t_1, "datetime", "datetime", sizeof(PyDateTime_DateTime), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_datetime = __Pyx_ImportType(__pyx_t_1, "datetime", "datetime", sizeof(PyDateTime_DateTime), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_DateTime),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_datetime) __PYX_ERR(3, 15, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_timedelta = __Pyx_ImportType(__pyx_t_1, "datetime", "timedelta", sizeof(PyDateTime_Delta), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_timedelta = __Pyx_ImportType(__pyx_t_1, "datetime", "timedelta", sizeof(PyDateTime_Delta), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_Delta),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_timedelta) __PYX_ERR(3, 18, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_tzinfo = __Pyx_ImportType(__pyx_t_1, "datetime", "tzinfo", sizeof(PyDateTime_TZInfo), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_tzinfo = __Pyx_ImportType(__pyx_t_1, "datetime", "tzinfo", sizeof(PyDateTime_TZInfo), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_TZInfo),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_tzinfo) __PYX_ERR(3, 21, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("blacksheep.cookies"); if (unlikely(!__pyx_t_1)) __PYX_ERR(7, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_7cookies_Cookie = __Pyx_ImportType(__pyx_t_1, "blacksheep.cookies", "Cookie", sizeof(struct __pyx_obj_10blacksheep_7cookies_Cookie), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_7cookies_Cookie = __Pyx_ImportType(__pyx_t_1, "blacksheep.cookies", "Cookie", sizeof(struct __pyx_obj_10blacksheep_7cookies_Cookie), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_7cookies_Cookie),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_7cookies_Cookie) __PYX_ERR(7, 17, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_7cookies_Cookie = (struct __pyx_vtabstruct_10blacksheep_7cookies_Cookie*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_7cookies_Cookie->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_7cookies_Cookie)) __PYX_ERR(7, 17, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("blacksheep.url"); if (unlikely(!__pyx_t_1)) __PYX_ERR(8, 8, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_3url_URL = __Pyx_ImportType(__pyx_t_1, "blacksheep.url", "URL", sizeof(struct __pyx_obj_10blacksheep_3url_URL), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_3url_URL = __Pyx_ImportType(__pyx_t_1, "blacksheep.url", "URL", sizeof(struct __pyx_obj_10blacksheep_3url_URL), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_3url_URL),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_3url_URL) __PYX_ERR(8, 8, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_3url_URL = (struct __pyx_vtabstruct_10blacksheep_3url_URL*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_3url_URL->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_3url_URL)) __PYX_ERR(8, 8, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("blacksheep.messages"); if (unlikely(!__pyx_t_1)) __PYX_ERR(9, 18, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_8messages_Message = __Pyx_ImportType(__pyx_t_1, "blacksheep.messages", "Message", sizeof(struct __pyx_obj_10blacksheep_8messages_Message), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8messages_Message = __Pyx_ImportType(__pyx_t_1, "blacksheep.messages", "Message", sizeof(struct __pyx_obj_10blacksheep_8messages_Message), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8messages_Message),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8messages_Message) __PYX_ERR(9, 18, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_8messages_Message = (struct __pyx_vtabstruct_10blacksheep_8messages_Message*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_8messages_Message->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_8messages_Message)) __PYX_ERR(9, 18, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8messages_Request = __Pyx_ImportType(__pyx_t_1, "blacksheep.messages", "Request", sizeof(struct __pyx_obj_10blacksheep_8messages_Request), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8messages_Request = __Pyx_ImportType(__pyx_t_1, "blacksheep.messages", "Request", sizeof(struct __pyx_obj_10blacksheep_8messages_Request), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8messages_Request),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8messages_Request) __PYX_ERR(9, 45, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_8messages_Request = (struct __pyx_vtabstruct_10blacksheep_8messages_Request*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_8messages_Request->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_8messages_Request)) __PYX_ERR(9, 45, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8messages_Response = __Pyx_ImportType(__pyx_t_1, "blacksheep.messages", "Response", sizeof(struct __pyx_obj_10blacksheep_8messages_Response), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8messages_Response = __Pyx_ImportType(__pyx_t_1, "blacksheep.messages", "Response", sizeof(struct __pyx_obj_10blacksheep_8messages_Response), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8messages_Response),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8messages_Response) __PYX_ERR(9, 58, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_8messages_Response = (struct __pyx_vtabstruct_10blacksheep_8messages_Response*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_8messages_Response->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_8messages_Response)) __PYX_ERR(9, 58, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -12110,15 +12253,15 @@
   #endif
   __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_d);
   __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_b);
   __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_cython_runtime);
-  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Initialize various global constants etc. ---*/
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   if (__pyx_module_is_main_blacksheep__baseapp) {
     if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -12304,14 +12447,42 @@
 end:
     Py_XDECREF(p);
     Py_XDECREF(m);
     return (__Pyx_RefNannyAPIStruct *)r;
 }
 #endif
 
+/* PyObjectGetAttrStr */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
+    PyTypeObject* tp = Py_TYPE(obj);
+    if (likely(tp->tp_getattro))
+        return tp->tp_getattro(obj, attr_name);
+#if PY_MAJOR_VERSION < 3
+    if (likely(tp->tp_getattr))
+        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
+#endif
+    return PyObject_GetAttr(obj, attr_name);
+}
+#endif
+
+/* GetBuiltinName */
+static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
+    PyObject* result = __Pyx_PyObject_GetAttrStr(__pyx_b, name);
+    if (unlikely(!result)) {
+        PyErr_Format(PyExc_NameError,
+#if PY_MAJOR_VERSION >= 3
+            "name '%U' is not defined", name);
+#else
+            "name '%.200s' is not defined", PyString_AS_STRING(name));
+#endif
+    }
+    return result;
+}
+
 /* RaiseArgTupleInvalid */
 static void __Pyx_RaiseArgtupleInvalid(
     const char* func_name,
     int exact,
     Py_ssize_t num_min,
     Py_ssize_t num_max,
     Py_ssize_t num_found)
@@ -12553,28 +12724,14 @@
     Py_DECREF(args);
     if (unlikely(!exc)) return;
 #endif
     PyErr_SetObject(PyExc_StopIteration, exc);
     Py_DECREF(exc);
 }
 
-/* PyObjectGetAttrStr */
-#if CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
-    PyTypeObject* tp = Py_TYPE(obj);
-    if (likely(tp->tp_getattro))
-        return tp->tp_getattro(obj, attr_name);
-#if PY_MAJOR_VERSION < 3
-    if (likely(tp->tp_getattr))
-        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
-#endif
-    return PyObject_GetAttr(obj, attr_name);
-}
-#endif
-
 /* PyErrExceptionMatches */
 #if CYTHON_FAST_THREAD_STATE
 static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
     Py_ssize_t i, n;
     n = PyTuple_GET_SIZE(tuple);
 #if PY_MAJOR_VERSION >= 3
     for (i=0; i<n; i++) {
@@ -12767,15 +12924,15 @@
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
 #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(func)) {
         return __Pyx_PyFunction_FastCall(func, NULL, 0);
     }
 #endif
-#ifdef __Pyx_CyFunction_USED
+#if defined(__Pyx_CyFunction_USED) && defined(NDEBUG)
     if (likely(PyCFunction_Check(func) || __Pyx_CyFunction_Check(func)))
 #else
     if (likely(PyCFunction_Check(func)))
 #endif
     {
         if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
             return __Pyx_PyObject_CallMethO(func, NULL);
@@ -12844,28 +13001,14 @@
     if (unlikely(!args)) return NULL;
     result = __Pyx_PyObject_Call(func, args, NULL);
     Py_DECREF(args);
     return result;
 }
 #endif
 
-/* GetBuiltinName */
-static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
-    PyObject* result = __Pyx_PyObject_GetAttrStr(__pyx_b, name);
-    if (unlikely(!result)) {
-        PyErr_Format(PyExc_NameError,
-#if PY_MAJOR_VERSION >= 3
-            "name '%U' is not defined", name);
-#else
-            "name '%.200s' is not defined", PyString_AS_STRING(name));
-#endif
-    }
-    return result;
-}
-
 /* PyDictVersioning */
 #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
 static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
     PyObject *dict = Py_TYPE(obj)->tp_dict;
     return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
 }
 static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
@@ -13124,28 +13267,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -14615,15 +14758,19 @@
 #endif
 #if PY_VERSION_HEX >= 0x030500B2 || defined(PyCoro_CheckExact)
     if (PyCoro_CheckExact(obj)) {
         return __Pyx_NewRef(obj);
     } else
 #endif
 #if CYTHON_COMPILING_IN_CPYTHON && defined(CO_ITERABLE_COROUTINE)
+#if PY_VERSION_HEX >= 0x030C00A6
+    if (PyGen_CheckExact(obj) && (PyGen_GetCode(obj)->co_flags & CO_ITERABLE_COROUTINE)) {
+#else
     if (PyGen_CheckExact(obj) && ((PyGenObject*)obj)->gi_code && ((PyCodeObject *)((PyGenObject*)obj)->gi_code)->co_flags & CO_ITERABLE_COROUTINE) {
+#endif
         return __Pyx_NewRef(obj);
     } else
 #endif
     {
         PyObject *method = NULL;
         int is_method = __Pyx_PyObject_GetMethod(obj, __pyx_n_s_await, &method);
         if (likely(is_method)) {
@@ -14665,15 +14812,15 @@
                  "object %.100s can't be used in 'await' expression",
                  Py_TYPE(obj)->tp_name);
 bad:
     return NULL;
 }
 
 /* CoroutineYieldFrom */
-static PyObject* __Pyx__Coroutine_Yield_From_Generic(__pyx_CoroutineObject *gen, PyObject *source) {
+  static PyObject* __Pyx__Coroutine_Yield_From_Generic(__pyx_CoroutineObject *gen, PyObject *source) {
     PyObject *retval;
     PyObject *source_gen = __Pyx__Coroutine_GetAwaitableIter(source);
     if (unlikely(!source_gen)) {
         return NULL;
     }
     if (__Pyx_Coroutine_Check(source_gen)) {
         retval = __Pyx_Generator_Next(source_gen);
@@ -14712,28 +14859,28 @@
         Py_INCREF(source);
         gen->yieldfrom = source;
     }
     return retval;
 }
 
 /* ExtTypeTest */
-static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
+  static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
     if (unlikely(!type)) {
         PyErr_SetString(PyExc_SystemError, "Missing type object");
         return 0;
     }
     if (likely(__Pyx_TypeCheck(obj, type)))
         return 1;
     PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
                  Py_TYPE(obj)->tp_name, type->tp_name);
     return 0;
 }
 
 /* GetException */
-#if CYTHON_FAST_THREAD_STATE
+  #if CYTHON_FAST_THREAD_STATE
 static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
 #else
 static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
 #endif
 {
     PyObject *local_type, *local_value, *local_tb;
 #if CYTHON_FAST_THREAD_STATE
@@ -14799,15 +14946,15 @@
     Py_XDECREF(local_type);
     Py_XDECREF(local_value);
     Py_XDECREF(local_tb);
     return -1;
 }
 
 /* UnpackUnboundCMethod */
-static int __Pyx_TryUnpackUnboundCMethod(__Pyx_CachedCFunction* target) {
+  static int __Pyx_TryUnpackUnboundCMethod(__Pyx_CachedCFunction* target) {
     PyObject *method;
     method = __Pyx_PyObject_GetAttrStr(target->type, *target->method_name);
     if (unlikely(!method))
         return -1;
     target->method = method;
 #if CYTHON_COMPILING_IN_CPYTHON
     #if PY_MAJOR_VERSION >= 3
@@ -14819,26 +14966,26 @@
         target->flag = descr->d_method->ml_flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_STACKLESS);
     }
 #endif
     return 0;
 }
 
 /* CallUnboundCMethod1 */
-#if CYTHON_COMPILING_IN_CPYTHON
+  #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg) {
     if (likely(cfunc->func)) {
         int flag = cfunc->flag;
         if (flag == METH_O) {
             return (*(cfunc->func))(self, arg);
         } else if (PY_VERSION_HEX >= 0x030600B1 && flag == METH_FASTCALL) {
-            if (PY_VERSION_HEX >= 0x030700A0) {
+            #if PY_VERSION_HEX >= 0x030700A0
                 return (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)cfunc->func)(self, &arg, 1);
-            } else {
+            #else
                 return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
-            }
+            #endif
         } else if (PY_VERSION_HEX >= 0x030700A0 && flag == (METH_FASTCALL | METH_KEYWORDS)) {
             return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
         }
     }
     return __Pyx__CallUnboundCMethod1(cfunc, self, arg);
 }
 #endif
@@ -14871,15 +15018,15 @@
 #endif
 bad:
     Py_XDECREF(args);
     return result;
 }
 
 /* CallUnboundCMethod2 */
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030600B1
+  #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030600B1
 static CYTHON_INLINE PyObject *__Pyx_CallUnboundCMethod2(__Pyx_CachedCFunction *cfunc, PyObject *self, PyObject *arg1, PyObject *arg2) {
     if (likely(cfunc->func)) {
         PyObject *args[2] = {arg1, arg2};
         if (cfunc->flag == METH_FASTCALL) {
             #if PY_VERSION_HEX >= 0x030700A0
             return (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)cfunc->func)(self, args, 2);
             #else
@@ -14927,15 +15074,15 @@
 #endif
 bad:
     Py_XDECREF(args);
     return result;
 }
 
 /* dict_getitem_default */
-static PyObject* __Pyx_PyDict_GetItemDefault(PyObject* d, PyObject* key, PyObject* default_value) {
+  static PyObject* __Pyx_PyDict_GetItemDefault(PyObject* d, PyObject* key, PyObject* default_value) {
     PyObject* value;
 #if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY
     value = PyDict_GetItemWithError(d, key);
     if (unlikely(!value)) {
         if (unlikely(PyErr_Occurred()))
             return NULL;
         value = default_value;
@@ -14957,15 +15104,15 @@
         else
             value = __Pyx_CallUnboundCMethod2(&__pyx_umethod_PyDict_Type_get, d, key, default_value);
     }
     return value;
 }
 
 /* DictGetItem */
-#if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY
+  #if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY
 static PyObject *__Pyx_PyDict_GetItem(PyObject *d, PyObject* key) {
     PyObject *value;
     value = PyDict_GetItemWithError(d, key);
     if (unlikely(!value)) {
         if (!PyErr_Occurred()) {
             if (unlikely(PyTuple_Check(key))) {
                 PyObject* args = PyTuple_Pack(1, key);
@@ -14981,15 +15128,15 @@
     }
     Py_INCREF(value);
     return value;
 }
 #endif
 
 /* Import */
-static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
+  static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
     PyObject *empty_list = 0;
     PyObject *module = 0;
     PyObject *global_dict = 0;
     PyObject *empty_dict = 0;
     PyObject *list;
     #if PY_MAJOR_VERSION < 3
     PyObject *py_import;
@@ -15046,29 +15193,29 @@
     #endif
     Py_XDECREF(empty_list);
     Py_XDECREF(empty_dict);
     return module;
 }
 
 /* ImportFrom */
-static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name) {
+  static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name) {
     PyObject* value = __Pyx_PyObject_GetAttrStr(module, name);
     if (unlikely(!value) && PyErr_ExceptionMatches(PyExc_AttributeError)) {
         PyErr_Format(PyExc_ImportError,
         #if PY_MAJOR_VERSION < 3
             "cannot import name %.230s", PyString_AS_STRING(name));
         #else
             "cannot import name %S", name);
         #endif
     }
     return value;
 }
 
 /* GetItemInt */
-static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
+  static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
     PyObject *r;
     if (!j) return NULL;
     r = PyObject_GetItem(o, j);
     Py_DECREF(j);
     return r;
 }
 static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
@@ -15147,15 +15294,15 @@
         return PySequence_GetItem(o, i);
     }
 #endif
     return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
 }
 
 /* HasAttr */
-static CYTHON_INLINE int __Pyx_HasAttr(PyObject *o, PyObject *n) {
+  static CYTHON_INLINE int __Pyx_HasAttr(PyObject *o, PyObject *n) {
     PyObject *r;
     if (unlikely(!__Pyx_PyBaseString_Check(n))) {
         PyErr_SetString(PyExc_TypeError,
                         "hasattr(): attribute name must be string");
         return -1;
     }
     r = __Pyx_GetAttr(o, n);
@@ -15165,25 +15312,25 @@
     } else {
         Py_DECREF(r);
         return 1;
     }
 }
 
 /* PyObject_GenericGetAttr */
-#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
+  #if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
 static PyObject* __Pyx_PyObject_GenericGetAttr(PyObject* obj, PyObject* attr_name) {
     if (unlikely(Py_TYPE(obj)->tp_dictoffset)) {
         return PyObject_GenericGetAttr(obj, attr_name);
     }
     return __Pyx_PyObject_GenericGetAttrNoDict(obj, attr_name);
 }
 #endif
 
 /* SetVTable */
-static int __Pyx_SetVtable(PyObject *dict, void *vtable) {
+  static int __Pyx_SetVtable(PyObject *dict, void *vtable) {
 #if PY_VERSION_HEX >= 0x02070000
     PyObject *ob = PyCapsule_New(vtable, 0, 0);
 #else
     PyObject *ob = PyCObject_FromVoidPtr(vtable, 0);
 #endif
     if (!ob)
         goto bad;
@@ -15193,15 +15340,15 @@
     return 0;
 bad:
     Py_XDECREF(ob);
     return -1;
 }
 
 /* PyObjectGetAttrStrNoError */
-static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
+  static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     if (likely(__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
         __Pyx_PyErr_Clear();
 }
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name) {
     PyObject *result;
@@ -15215,15 +15362,15 @@
     if (unlikely(!result)) {
         __Pyx_PyObject_GetAttrStr_ClearAttributeError();
     }
     return result;
 }
 
 /* SetupReduce */
-static int __Pyx_setup_reduce_is_named(PyObject* meth, PyObject* name) {
+  static int __Pyx_setup_reduce_is_named(PyObject* meth, PyObject* name) {
   int ret;
   PyObject *name_attr;
   name_attr = __Pyx_PyObject_GetAttrStr(meth, __pyx_n_s_name);
   if (likely(name_attr)) {
       ret = PyObject_RichCompareBool(name_attr, name, Py_EQ);
   } else {
       ret = -1;
@@ -15319,47 +15466,65 @@
     Py_XDECREF(reduce_cython);
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 
 /* TypeImport */
-#ifndef __PYX_HAVE_RT_ImportType
+  #ifndef __PYX_HAVE_RT_ImportType
 #define __PYX_HAVE_RT_ImportType
 static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, enum __Pyx_ImportType_CheckSize check_size)
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
+    Py_ssize_t itemsize;
 #ifdef Py_LIMITED_API
     PyObject *py_basicsize;
+    PyObject *py_itemsize;
 #endif
     result = PyObject_GetAttrString(module, class_name);
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
         PyErr_Format(PyExc_TypeError,
             "%.200s.%.200s is not a type object",
             module_name, class_name);
         goto bad;
     }
 #ifndef Py_LIMITED_API
     basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
 #else
     py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
     if (!py_basicsize)
         goto bad;
     basicsize = PyLong_AsSsize_t(py_basicsize);
     Py_DECREF(py_basicsize);
     py_basicsize = 0;
     if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
         goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
 #endif
-    if ((size_t)basicsize < size) {
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
     if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
@@ -15380,15 +15545,15 @@
 bad:
     Py_XDECREF(result);
     return NULL;
 }
 #endif
 
 /* GetVTable */
-static void* __Pyx_GetVtable(PyObject *dict) {
+  static void* __Pyx_GetVtable(PyObject *dict) {
     void* ptr;
     PyObject *ob = PyObject_GetItem(dict, __pyx_n_s_pyx_vtable);
     if (!ob)
         goto bad;
 #if PY_VERSION_HEX >= 0x02070000
     ptr = PyCapsule_GetPointer(ob, 0);
 #else
@@ -15400,16 +15565,16 @@
     return ptr;
 bad:
     Py_XDECREF(ob);
     return NULL;
 }
 
 /* CLineInTraceback */
-#ifndef CYTHON_CLINE_IN_TRACEBACK
-static int __Pyx_CLineForTraceback(CYTHON_NCP_UNUSED PyThreadState *tstate, int c_line) {
+  #ifndef CYTHON_CLINE_IN_TRACEBACK
+static int __Pyx_CLineForTraceback(CYTHON_UNUSED PyThreadState *tstate, int c_line) {
     PyObject *use_cline;
     PyObject *ptype, *pvalue, *ptraceback;
 #if CYTHON_COMPILING_IN_CPYTHON
     PyObject **cython_runtime_dict;
 #endif
     if (unlikely(!__pyx_cython_runtime)) {
         return c_line;
@@ -15442,15 +15607,15 @@
     }
     __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
     return c_line;
 }
 #endif
 
 /* CodeObjectCache */
-static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
+  static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
     int start = 0, mid = 0, end = count - 1;
     if (end >= 0 && code_line > entries[end].code_line) {
         return count;
     }
     while (start < end) {
         mid = start + (end - start) / 2;
         if (code_line < entries[mid].code_line) {
@@ -15522,15 +15687,15 @@
     entries[pos].code_line = code_line;
     entries[pos].code_object = code_object;
     __pyx_code_cache.count++;
     Py_INCREF(code_object);
 }
 
 /* AddTraceback */
-#include "compile.h"
+  #include "compile.h"
 #include "frameobject.h"
 #include "traceback.h"
 #if PY_VERSION_HEX >= 0x030b00a6
   #ifndef Py_BUILD_CORE
     #define Py_BUILD_CORE 1
   #endif
   #include "internal/pycore_frame.h"
@@ -15629,15 +15794,15 @@
     PyTraceBack_Here(py_frame);
 bad:
     Py_XDECREF(py_code);
     Py_XDECREF(py_frame);
 }
 
 /* CIntFromPyVerify */
-#define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
+  #define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
     __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
 #define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
     __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
 #define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
     {\
         func_type value = func_value;\
         if (sizeof(target_type) < sizeof(func_type)) {\
@@ -15651,15 +15816,15 @@
                     goto raise_overflow;\
             }\
         }\
         return (target_type) value;\
     }
 
 /* CIntFromPy */
-static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
+  static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const long neg_one = (long) -1, const_zero = (long) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -15847,15 +16012,15 @@
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to long");
     return (long) -1;
 }
 
 /* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
+  static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const int neg_one = (int) -1, const_zero = (int) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -15885,15 +16050,15 @@
         unsigned char *bytes = (unsigned char *)&value;
         return _PyLong_FromByteArray(bytes, sizeof(int),
                                      little, !is_unsigned);
     }
 }
 
 /* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
+  static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const long neg_one = (long) -1, const_zero = (long) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -15923,15 +16088,15 @@
         unsigned char *bytes = (unsigned char *)&value;
         return _PyLong_FromByteArray(bytes, sizeof(long),
                                      little, !is_unsigned);
     }
 }
 
 /* CIntFromPy */
-static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
+  static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const int neg_one = (int) -1, const_zero = (int) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -16119,15 +16284,15 @@
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to int");
     return (int) -1;
 }
 
 /* FastTypeChecks */
-#if CYTHON_COMPILING_IN_CPYTHON
+  #if CYTHON_COMPILING_IN_CPYTHON
 static int __Pyx_InBases(PyTypeObject *a, PyTypeObject *b) {
     while (a) {
         a = a->tp_base;
         if (a == b)
             return 1;
     }
     return b == &PyBaseObject_Type;
@@ -16219,15 +16384,15 @@
         return __Pyx_inner_PyErr_GivenExceptionMatches2(err, exc_type1, exc_type2);
     }
     return (PyErr_GivenExceptionMatches(err, exc_type1) || PyErr_GivenExceptionMatches(err, exc_type2));
 }
 #endif
 
 /* CheckBinaryVersion */
-static int __Pyx_check_binary_version(void) {
+  static int __Pyx_check_binary_version(void) {
     char ctversion[5];
     int same=1, i, found_dot;
     const char* rt_from_call = Py_GetVersion();
     PyOS_snprintf(ctversion, 5, "%d.%d", PY_MAJOR_VERSION, PY_MINOR_VERSION);
     found_dot = 0;
     for (i = 0; i < 4; i++) {
         if (!ctversion[i]) {
@@ -16257,15 +16422,15 @@
                       ctversion, __Pyx_MODULE_NAME, rtversion);
         return PyErr_WarnEx(NULL, message, 1);
     }
     return 0;
 }
 
 /* FunctionImport */
-#ifndef __PYX_HAVE_RT_ImportFunction
+  #ifndef __PYX_HAVE_RT_ImportFunction
 #define __PYX_HAVE_RT_ImportFunction
 static int __Pyx_ImportFunction(PyObject *module, const char *funcname, void (**f)(void), const char *sig) {
     PyObject *d = 0;
     PyObject *cobj = 0;
     union {
         void (*fp)(void);
         void *p;
@@ -16311,15 +16476,15 @@
 bad:
     Py_XDECREF(d);
     return -1;
 }
 #endif
 
 /* InitStrings */
-static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
+  static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
     while (t->p) {
         #if PY_MAJOR_VERSION < 3
         if (t->is_unicode) {
             *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
         } else if (t->intern) {
             *t->p = PyString_InternFromString(t->s);
         } else {
```

### Comparing `blacksheep-2.0a5/blacksheep/baseapp.pxd` & `blacksheep-2.0a6/blacksheep/baseapp.pxd`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/baseapp.pyi` & `blacksheep-2.0a6/blacksheep/baseapp.pyi`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/baseapp.pyx` & `blacksheep-2.0a6/blacksheep/baseapp.pyx`

 * *Files 1% similar despite different names*

```diff
@@ -100,15 +100,18 @@
             await self.log_handled_exc(request, exc)
         else:
             await self.log_unhandled_exc(request, exc)
 
         return await self.handle_exception(request, exc)
 
     cdef object get_http_exception_handler(self, HTTPException http_exception):
-        return self.exceptions_handlers.get(http_exception.status, common_http_exception_handler)
+        try:
+            return self.exceptions_handlers[type(http_exception)]
+        except KeyError:
+            return self.exceptions_handlers.get(http_exception.status, common_http_exception_handler)
 
     cdef object get_exception_handler(self, Exception exception):
         for current_class_in_hierarchy in get_class_instance_hierarchy(exception):
             if current_class_in_hierarchy in self.exceptions_handlers:
                 return self.exceptions_handlers[current_class_in_hierarchy]
 
         return None
```

### Comparing `blacksheep-2.0a5/blacksheep/client/connection.py` & `blacksheep-2.0a6/blacksheep/client/connection.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/client/cookies.py` & `blacksheep-2.0a6/blacksheep/client/cookies.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/client/exceptions.py` & `blacksheep-2.0a6/blacksheep/client/exceptions.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/client/pool.py` & `blacksheep-2.0a6/blacksheep/client/pool.py`

 * *Files 2% similar despite different names*

```diff
@@ -126,14 +126,20 @@
         try:
             return self._pools[key]
         except KeyError:
             new_pool = ConnectionPool(self.loop, scheme, host, port, ssl)
             self._pools[key] = new_pool
             return new_pool
 
+    def __enter__(self):
+        return self
+
+    def __exit__(self, exc_type, exc_val, exc_tb):
+        self.dispose()
+
     def dispose(self):
         for pool in self._pools.values():
             pool.dispose()
         self._pools.clear()
 
 
 # For backward compatibility. Aliases will be removed in the future.
```

### Comparing `blacksheep-2.0a5/blacksheep/client/session.py` & `blacksheep-2.0a6/blacksheep/client/session.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/common/files/asyncfs.py` & `blacksheep-2.0a6/blacksheep/common/files/asyncfs.py`

 * *Files 0% similar despite different names*

```diff
@@ -24,15 +24,15 @@
 
 class FileContext(PoolClient):
     def __init__(
         self,
         file_path: str,
         *,
         loop: Optional[AbstractEventLoop] = None,
-        mode: str = "rb"
+        mode: str = "rb",
     ):
         super().__init__(loop)
         self._file_path = file_path
         self._file = None
         self._mode = mode
 
     @property
```

### Comparing `blacksheep-2.0a5/blacksheep/common/files/info.py` & `blacksheep-2.0a6/blacksheep/common/files/info.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/common/files/pathsutils.py` & `blacksheep-2.0a6/blacksheep/common/files/pathsutils.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/common/types.py` & `blacksheep-2.0a6/blacksheep/common/types.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/contents.c` & `blacksheep-2.0a6/blacksheep/contents.c`

 * *Files 1% similar despite different names*

```diff
@@ -1,20 +1,20 @@
-/* Generated by Cython 0.29.32 */
+/* Generated by Cython 0.29.34 */
 
 #ifndef PY_SSIZE_T_CLEAN
 #define PY_SSIZE_T_CLEAN
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_32"
-#define CYTHON_HEX_VERSION 0x001D20F0
+#define CYTHON_ABI "0_29_34"
+#define CYTHON_HEX_VERSION 0x001D22F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -83,15 +83,15 @@
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
-    #define CYTHON_UPDATE_DESCRIPTOR_DOC (PYPY_VERSION_HEX >= 0x07030900)
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
 #elif defined(PYSTON_VERSION)
   #define CYTHON_COMPILING_IN_PYPY 0
   #define CYTHON_COMPILING_IN_PYSTON 1
   #define CYTHON_COMPILING_IN_CPYTHON 0
   #define CYTHON_COMPILING_IN_NOGIL 0
   #ifndef CYTHON_USE_TYPE_SLOTS
@@ -199,15 +199,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -238,15 +238,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -548,35 +548,35 @@
 #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && CYTHON_USE_UNICODE_INTERNALS
 #define __Pyx_PyDict_GetItemStr(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
 #else
 #define __Pyx_PyDict_GetItemStr(dict, name)  PyDict_GetItem(dict, name)
 #endif
 #if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
   #define CYTHON_PEP393_ENABLED 1
-  #if defined(PyUnicode_IS_READY)
-  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
-                                              0 : _PyUnicode_Ready((PyObject *)(op)))
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_READY(op)       (0)
   #else
-  #define __Pyx_PyUnicode_READY(op)       (0)
+    #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
+                                                0 : _PyUnicode_Ready((PyObject *)(op)))
   #endif
   #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
   #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
   #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
   #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
   #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
   #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
   #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, ch)
-  #if defined(PyUnicode_IS_READY) && defined(PyUnicode_GET_SIZE)
-  #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
-  #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
-  #endif
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
   #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
+    #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
+    #else
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
+    #endif
   #endif
 #else
   #define CYTHON_PEP393_ENABLED 0
   #define PyUnicode_1BYTE_KIND  1
   #define PyUnicode_2BYTE_KIND  2
   #define PyUnicode_4BYTE_KIND  4
   #define __Pyx_PyUnicode_READY(op)       (0)
@@ -946,18 +946,18 @@
 static int __pyx_lineno;
 static int __pyx_clineno = 0;
 static const char * __pyx_cfilenm= __FILE__;
 static const char *__pyx_filename;
 
 
 static const char *__pyx_f[] = {
-  "blacksheep/contents.pyx",
-  "blacksheep/contents.pxd",
+  "blacksheep\\contents.pyx",
+  "blacksheep\\contents.pxd",
   "stringsource",
-  "blacksheep/exceptions.pxd",
+  "blacksheep\\exceptions.pxd",
 };
 
 /*--- Type declarations ---*/
 struct __pyx_obj_10blacksheep_10exceptions_MessageAborted;
 struct __pyx_obj_10blacksheep_10exceptions_HTTPException;
 struct __pyx_obj_10blacksheep_10exceptions_BadRequest;
 struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat;
@@ -1443,26 +1443,26 @@
 #define __PYX_GET_DICT_VERSION(dict)  (0)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
 #define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
 #endif
 
 /* GetModuleGlobalName.proto */
 #if CYTHON_USE_DICT_VERSIONS
-#define __Pyx_GetModuleGlobalName(var, name)  {\
+#define __Pyx_GetModuleGlobalName(var, name)  do {\
     static PY_UINT64_T __pyx_dict_version = 0;\
     static PyObject *__pyx_dict_cached_value = NULL;\
     (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
         (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
         __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  {\
+} while(0)
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  do {\
     PY_UINT64_T __pyx_dict_version;\
     PyObject *__pyx_dict_cached_value;\
     (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
+} while(0)
 static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
 #else
 #define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 #define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
 #endif
 
@@ -1881,20 +1881,28 @@
 
 /* SetVTable.proto */
 static int __Pyx_SetVtable(PyObject *dict, void *vtable);
 
 /* TypeImport.proto */
 #ifndef __PYX_HAVE_RT_ImportType_proto
 #define __PYX_HAVE_RT_ImportType_proto
+#if __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT(s) sizeof(void*)
+#endif
 enum __Pyx_ImportType_CheckSize {
    __Pyx_ImportType_CheckSize_Error = 0,
    __Pyx_ImportType_CheckSize_Warn = 1,
    __Pyx_ImportType_CheckSize_Ignore = 2
 };
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
+static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize check_size);
 #endif
 
 /* PatchInspect.proto */
 static PyObject* __Pyx_patch_inspect(PyObject* module);
 
 /* CLineInTraceback.proto */
 #ifdef CYTHON_CLINE_IN_TRACEBACK
@@ -3092,15 +3100,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_Content, (type(self), 0xac612b3, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_Content__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_8contents___pyx_unpickle_Content__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_Content, (type(self), 0xac612b3, state)
@@ -4126,15 +4134,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_StreamedContent, (type(self), 0x96e902e, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_StreamedContent__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_8contents___pyx_unpickle_StreamedContent__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_StreamedContent, (type(self), 0x96e902e, state)
@@ -5399,15 +5407,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_ASGIContent, (type(self), 0xc16b888, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_ASGIContent__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_8contents___pyx_unpickle_ASGIContent__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_ASGIContent, (type(self), 0xc16b888, state)
@@ -5891,15 +5899,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_TextContent, (type(self), 0xac612b3, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_TextContent__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_8contents___pyx_unpickle_TextContent__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_TextContent, (type(self), 0xac612b3, state)
@@ -6383,15 +6391,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_HTMLContent, (type(self), 0xac612b3, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_HTMLContent__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_8contents___pyx_unpickle_HTMLContent__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_HTMLContent, (type(self), 0xac612b3, state)
@@ -6915,15 +6923,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_JSONContent, (type(self), 0xac612b3, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_JSONContent__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_8contents___pyx_unpickle_JSONContent__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_JSONContent, (type(self), 0xac612b3, state)
@@ -7092,16 +7100,16 @@
       __pyx_L5_unpacking_failed:;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __pyx_t_8 = NULL;
       if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
       __PYX_ERR(0, 126, __pyx_L1_error)
       __pyx_L6_unpacking_done:;
     }
-    if (!(likely(PyUnicode_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 126, __pyx_L1_error)
-    if (!(likely(PyUnicode_CheckExact(__pyx_t_6))||((__pyx_t_6) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_6)->tp_name), 0))) __PYX_ERR(0, 126, __pyx_L1_error)
+    if (!(likely(PyUnicode_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 126, __pyx_L1_error)
+    if (!(likely(PyUnicode_CheckExact(__pyx_t_6))||((__pyx_t_6) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_6)->tp_name), 0))) __PYX_ERR(0, 126, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_key, ((PyObject*)__pyx_t_3));
     __pyx_t_3 = 0;
     __Pyx_XDECREF_SET(__pyx_v_value, ((PyObject*)__pyx_t_6));
     __pyx_t_6 = 0;
 
     /* "blacksheep/contents.pyx":127
  *     cdef dict data = {}
@@ -7624,15 +7632,15 @@
         }
       }
       __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 157, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      if (!(likely(PyUnicode_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 157, __pyx_L1_error)
+      if (!(likely(PyUnicode_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 157, __pyx_L1_error)
       __Pyx_XDECREF_SET(__pyx_v_charset, ((PyObject*)__pyx_t_3));
       __pyx_t_3 = 0;
 
       /* "blacksheep/contents.pyx":156
  *     for part in parts:
  *         key = part.name.decode('utf8')
  *         if part.charset:             # <<<<<<<<<<<<<<
@@ -7852,15 +7860,15 @@
  *                 data[key] = try_decode(part.data, charset)
  * 
  *     return data             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  if (!(likely(PyDict_CheckExact(__pyx_v_data))||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "dict", Py_TYPE(__pyx_v_data)->tp_name), 0))) __PYX_ERR(0, 178, __pyx_L1_error)
+  if (!(likely(PyDict_CheckExact(__pyx_v_data))||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "dict", Py_TYPE(__pyx_v_data)->tp_name), 0))) __PYX_ERR(0, 178, __pyx_L1_error)
   __Pyx_INCREF(__pyx_v_data);
   __pyx_r = ((PyObject*)__pyx_v_data);
   goto __pyx_L0;
 
   /* "blacksheep/contents.pyx":148
  * 
  * 
@@ -9128,15 +9136,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_FormContent, (type(self), 0xac612b3, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_FormContent__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_8contents___pyx_unpickle_FormContent__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_FormContent, (type(self), 0xac612b3, state)
@@ -10182,15 +10190,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_FormPart, (type(self), 0x708201b, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_FormPart__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_8contents___pyx_unpickle_FormPart__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_FormPart, (type(self), 0x708201b, state)
@@ -10340,15 +10348,15 @@
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = PyUnicode_AsEncodedString(((PyObject*)__pyx_t_1), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 251, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyNumber_Add(__pyx_kp_b__12, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 251, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 251, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 251, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v_self->boundary);
   __Pyx_DECREF(__pyx_v_self->boundary);
   __pyx_v_self->boundary = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "blacksheep/contents.pyx":252
@@ -10829,15 +10837,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_MultiPartFormData, (type(self), 0x59a2c94, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_MultiPartFormData__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_8contents___pyx_unpickle_MultiPartFormData__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_MultiPartFormData, (type(self), 0x59a2c94, state)
@@ -11298,15 +11306,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = Content.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Content__set_state(<Content> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_Content__set_state(Content __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_8contents___pyx_unpickle_Content__set_state(((struct __pyx_obj_10blacksheep_8contents_Content *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xac612b3, 0xa172827, 0xd8196b5) = (body, length, type))" % __pyx_checksum)
  *     __pyx_result = Content.__new__(__pyx_type)
@@ -11384,15 +11392,15 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->body);
   __Pyx_DECREF(__pyx_v___pyx_result->body);
   __pyx_v___pyx_result->body = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -11405,15 +11413,15 @@
   __pyx_v___pyx_result->length = __pyx_t_2;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->type);
   __Pyx_DECREF(__pyx_v___pyx_result->type);
   __pyx_v___pyx_result->type = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":13
@@ -11722,15 +11730,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = StreamedContent.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_StreamedContent__set_state(<StreamedContent> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_StreamedContent__set_state(StreamedContent __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_8contents___pyx_unpickle_StreamedContent__set_state(((struct __pyx_obj_10blacksheep_8contents_StreamedContent *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x96e902e, 0x7df2fc7, 0x1eed773) = (body, generator, length, type))" % __pyx_checksum)
  *     __pyx_result = StreamedContent.__new__(__pyx_type)
@@ -11808,15 +11816,15 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.body);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.body);
   __pyx_v___pyx_result->__pyx_base.body = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -11840,15 +11848,15 @@
   __pyx_v___pyx_result->__pyx_base.length = __pyx_t_2;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.type);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.type);
   __pyx_v___pyx_result->__pyx_base.type = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":13
@@ -12157,15 +12165,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = ASGIContent.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_ASGIContent__set_state(<ASGIContent> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_ASGIContent__set_state(ASGIContent __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_8contents___pyx_unpickle_ASGIContent__set_state(((struct __pyx_obj_10blacksheep_8contents_ASGIContent *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xc16b888, 0xebff2b2, 0xee27218) = (body, length, receive, type))" % __pyx_checksum)
  *     __pyx_result = ASGIContent.__new__(__pyx_type)
@@ -12243,15 +12251,15 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.body);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.body);
   __pyx_v___pyx_result->__pyx_base.body = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -12275,15 +12283,15 @@
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.type);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.type);
   __pyx_v___pyx_result->__pyx_base.type = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":13
@@ -12592,15 +12600,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = TextContent.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_TextContent__set_state(<TextContent> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_TextContent__set_state(TextContent __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_8contents___pyx_unpickle_TextContent__set_state(((struct __pyx_obj_10blacksheep_8contents_TextContent *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xac612b3, 0xa172827, 0xd8196b5) = (body, length, type))" % __pyx_checksum)
  *     __pyx_result = TextContent.__new__(__pyx_type)
@@ -12678,15 +12686,15 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.body);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.body);
   __pyx_v___pyx_result->__pyx_base.body = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -12699,15 +12707,15 @@
   __pyx_v___pyx_result->__pyx_base.length = __pyx_t_2;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.type);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.type);
   __pyx_v___pyx_result->__pyx_base.type = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":13
@@ -13016,15 +13024,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = HTMLContent.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_HTMLContent__set_state(<HTMLContent> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_HTMLContent__set_state(HTMLContent __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_8contents___pyx_unpickle_HTMLContent__set_state(((struct __pyx_obj_10blacksheep_8contents_HTMLContent *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xac612b3, 0xa172827, 0xd8196b5) = (body, length, type))" % __pyx_checksum)
  *     __pyx_result = HTMLContent.__new__(__pyx_type)
@@ -13102,15 +13110,15 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.body);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.body);
   __pyx_v___pyx_result->__pyx_base.body = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -13123,15 +13131,15 @@
   __pyx_v___pyx_result->__pyx_base.length = __pyx_t_2;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.type);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.type);
   __pyx_v___pyx_result->__pyx_base.type = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":13
@@ -13440,15 +13448,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = JSONContent.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_JSONContent__set_state(<JSONContent> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_JSONContent__set_state(JSONContent __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_8contents___pyx_unpickle_JSONContent__set_state(((struct __pyx_obj_10blacksheep_8contents_JSONContent *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xac612b3, 0xa172827, 0xd8196b5) = (body, length, type))" % __pyx_checksum)
  *     __pyx_result = JSONContent.__new__(__pyx_type)
@@ -13526,15 +13534,15 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.body);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.body);
   __pyx_v___pyx_result->__pyx_base.body = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -13547,15 +13555,15 @@
   __pyx_v___pyx_result->__pyx_base.length = __pyx_t_2;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.type);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.type);
   __pyx_v___pyx_result->__pyx_base.type = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":13
@@ -13864,15 +13872,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = FormContent.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_FormContent__set_state(<FormContent> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_FormContent__set_state(FormContent __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_8contents___pyx_unpickle_FormContent__set_state(((struct __pyx_obj_10blacksheep_8contents_FormContent *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xac612b3, 0xa172827, 0xd8196b5) = (body, length, type))" % __pyx_checksum)
  *     __pyx_result = FormContent.__new__(__pyx_type)
@@ -13950,15 +13958,15 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.body);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.body);
   __pyx_v___pyx_result->__pyx_base.body = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -13971,15 +13979,15 @@
   __pyx_v___pyx_result->__pyx_base.length = __pyx_t_2;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.type);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.type);
   __pyx_v___pyx_result->__pyx_base.type = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":13
@@ -14288,15 +14296,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = FormPart.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_FormPart__set_state(<FormPart> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_FormPart__set_state(FormPart __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_8contents___pyx_unpickle_FormPart__set_state(((struct __pyx_obj_10blacksheep_8contents_FormPart *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x708201b, 0xfbb0b7f, 0x54e8b6e) = (charset, content_type, data, file_name, name))" % __pyx_checksum)
  *     __pyx_result = FormPart.__new__(__pyx_type)
@@ -14373,63 +14381,63 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->charset);
   __Pyx_DECREF(__pyx_v___pyx_result->charset);
   __pyx_v___pyx_result->charset = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->content_type);
   __Pyx_DECREF(__pyx_v___pyx_result->content_type);
   __pyx_v___pyx_result->content_type = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->data);
   __Pyx_DECREF(__pyx_v___pyx_result->data);
   __pyx_v___pyx_result->data = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->file_name);
   __Pyx_DECREF(__pyx_v___pyx_result->file_name);
   __pyx_v___pyx_result->file_name = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->name);
   __Pyx_DECREF(__pyx_v___pyx_result->name);
   __pyx_v___pyx_result->name = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":13
@@ -14738,15 +14746,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = MultiPartFormData.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_MultiPartFormData__set_state(<MultiPartFormData> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_MultiPartFormData__set_state(MultiPartFormData __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_8contents___pyx_unpickle_MultiPartFormData__set_state(((struct __pyx_obj_10blacksheep_8contents_MultiPartFormData *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x59a2c94, 0x687dffc, 0x4dfb235) = (body, boundary, length, parts, type))" % __pyx_checksum)
  *     __pyx_result = MultiPartFormData.__new__(__pyx_type)
@@ -14824,27 +14832,27 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.body);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.body);
   __pyx_v___pyx_result->__pyx_base.body = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->boundary);
   __Pyx_DECREF(__pyx_v___pyx_result->boundary);
   __pyx_v___pyx_result->boundary = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -14857,27 +14865,27 @@
   __pyx_v___pyx_result->__pyx_base.length = __pyx_t_2;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->parts);
   __Pyx_DECREF(__pyx_v___pyx_result->parts);
   __pyx_v___pyx_result->parts = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.type);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.type);
   __pyx_v___pyx_result->__pyx_base.type = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":13
@@ -16855,15 +16863,15 @@
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
   __pyx_umethod_PyByteArray_Type_extend.type = (PyObject*)&PyByteArray_Type;
-  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_32429939 = PyInt_FromLong(32429939L); if (unlikely(!__pyx_int_32429939)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_81769013 = PyInt_FromLong(81769013L); if (unlikely(!__pyx_int_81769013)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_89033582 = PyInt_FromLong(89033582L); if (unlikely(!__pyx_int_89033582)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_93990036 = PyInt_FromLong(93990036L); if (unlikely(!__pyx_int_93990036)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_109567996 = PyInt_FromLong(109567996L); if (unlikely(!__pyx_int_109567996)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_117973019 = PyInt_FromLong(117973019L); if (unlikely(!__pyx_int_117973019)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_132067271 = PyInt_FromLong(132067271L); if (unlikely(!__pyx_int_132067271)) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -17080,27 +17088,34 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule("blacksheep.exceptions"); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_10exceptions_MessageAborted = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "MessageAborted", sizeof(struct __pyx_obj_10blacksheep_10exceptions_MessageAborted), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_MessageAborted = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "MessageAborted", sizeof(struct __pyx_obj_10blacksheep_10exceptions_MessageAborted), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_MessageAborted),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_MessageAborted) __PYX_ERR(3, 4, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_HTTPException = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "HTTPException", sizeof(struct __pyx_obj_10blacksheep_10exceptions_HTTPException), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_HTTPException = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "HTTPException", sizeof(struct __pyx_obj_10blacksheep_10exceptions_HTTPException), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_HTTPException),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_HTTPException) __PYX_ERR(3, 8, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_BadRequest = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequest", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequest), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_BadRequest = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequest", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequest), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_BadRequest),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_BadRequest) __PYX_ERR(3, 12, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_BadRequestFormat = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequestFormat", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_BadRequestFormat = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequestFormat", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_BadRequestFormat) __PYX_ERR(3, 16, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_NotFound = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "NotFound", sizeof(struct __pyx_obj_10blacksheep_10exceptions_NotFound), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_NotFound = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "NotFound", sizeof(struct __pyx_obj_10blacksheep_10exceptions_NotFound), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_NotFound),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_NotFound) __PYX_ERR(3, 20, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_InvalidArgument = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidArgument", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidArgument), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_InvalidArgument = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidArgument", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidArgument), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_InvalidArgument),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_InvalidArgument) __PYX_ERR(3, 24, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_InvalidOperation = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidOperation", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidOperation), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_InvalidOperation = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidOperation", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidOperation), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_InvalidOperation),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_InvalidOperation) __PYX_ERR(3, 28, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
@@ -17286,15 +17301,15 @@
   #endif
   __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_d);
   __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_b);
   __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_cython_runtime);
-  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Initialize various global constants etc. ---*/
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   if (__pyx_module_is_main_blacksheep__contents) {
     if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name_2, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -18407,28 +18422,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -18437,15 +18452,15 @@
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
 #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(func)) {
         return __Pyx_PyFunction_FastCall(func, NULL, 0);
     }
 #endif
-#ifdef __Pyx_CyFunction_USED
+#if defined(__Pyx_CyFunction_USED) && defined(NDEBUG)
     if (likely(PyCFunction_Check(func) || __Pyx_CyFunction_Check(func)))
 #else
     if (likely(PyCFunction_Check(func)))
 #endif
     {
         if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
             return __Pyx_PyObject_CallMethO(func, NULL);
@@ -18603,15 +18618,19 @@
 #endif
 #if PY_VERSION_HEX >= 0x030500B2 || defined(PyCoro_CheckExact)
     if (PyCoro_CheckExact(obj)) {
         return __Pyx_NewRef(obj);
     } else
 #endif
 #if CYTHON_COMPILING_IN_CPYTHON && defined(CO_ITERABLE_COROUTINE)
+#if PY_VERSION_HEX >= 0x030C00A6
+    if (PyGen_CheckExact(obj) && (PyGen_GetCode(obj)->co_flags & CO_ITERABLE_COROUTINE)) {
+#else
     if (PyGen_CheckExact(obj) && ((PyGenObject*)obj)->gi_code && ((PyCodeObject *)((PyGenObject*)obj)->gi_code)->co_flags & CO_ITERABLE_COROUTINE) {
+#endif
         return __Pyx_NewRef(obj);
     } else
 #endif
     {
         PyObject *method = NULL;
         int is_method = __Pyx_PyObject_GetMethod(obj, __pyx_n_s_await, &method);
         if (likely(is_method)) {
@@ -18653,15 +18672,15 @@
                  "object %.100s can't be used in 'await' expression",
                  Py_TYPE(obj)->tp_name);
 bad:
     return NULL;
 }
 
 /* PyObjectCallMethod0 */
-static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name) {
+  static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name) {
     PyObject *method = NULL, *result = NULL;
     int is_method = __Pyx_PyObject_GetMethod(obj, method_name, &method);
     if (likely(is_method)) {
         result = __Pyx_PyObject_CallOneArg(method, obj);
         Py_DECREF(method);
         return result;
     }
@@ -18669,15 +18688,15 @@
     result = __Pyx_PyObject_CallNoArg(method);
     Py_DECREF(method);
 bad:
     return result;
 }
 
 /* AsyncIter */
-static PyObject *__Pyx_Coroutine_GetAsyncIter_Generic(PyObject *obj) {
+  static PyObject *__Pyx_Coroutine_GetAsyncIter_Generic(PyObject *obj) {
 #if PY_VERSION_HEX < 0x030500B1
     {
         PyObject *iter = __Pyx_PyObject_CallMethod0(obj, __pyx_n_s_aiter);
         if (likely(iter))
             return iter;
         if (!PyErr_ExceptionMatches(PyExc_AttributeError))
             return NULL;
@@ -18732,15 +18751,15 @@
         }
     }
 #endif
     return __Pyx__Coroutine_AsyncIterNext(obj);
 }
 
 /* FetchCommonType */
-static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type) {
+  static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type) {
     PyObject* fake_module;
     PyTypeObject* cached_type = NULL;
     fake_module = PyImport_AddModule((char*) "_cython_" CYTHON_ABI);
     if (!fake_module) return NULL;
     Py_INCREF(fake_module);
     cached_type = (PyTypeObject*) PyObject_GetAttrString(fake_module, type->tp_name);
     if (cached_type) {
@@ -18771,30 +18790,30 @@
 bad:
     Py_XDECREF(cached_type);
     cached_type = NULL;
     goto done;
 }
 
 /* GetTopmostException */
-#if CYTHON_USE_EXC_INFO_STACK
+  #if CYTHON_USE_EXC_INFO_STACK
 static _PyErr_StackItem *
 __Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
 {
     _PyErr_StackItem *exc_info = tstate->exc_info;
     while ((exc_info->exc_type == NULL || exc_info->exc_type == Py_None) &&
            exc_info->previous_item != NULL)
     {
         exc_info = exc_info->previous_item;
     }
     return exc_info;
 }
 #endif
 
 /* SaveResetException */
-#if CYTHON_FAST_THREAD_STATE
+  #if CYTHON_FAST_THREAD_STATE
 static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
     #if CYTHON_USE_EXC_INFO_STACK
     _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
     *type = exc_info->exc_type;
     *value = exc_info->exc_value;
     *tb = exc_info->exc_traceback;
     #else
@@ -18827,15 +18846,15 @@
     Py_XDECREF(tmp_type);
     Py_XDECREF(tmp_value);
     Py_XDECREF(tmp_tb);
 }
 #endif
 
 /* SwapException */
-#if CYTHON_FAST_THREAD_STATE
+  #if CYTHON_FAST_THREAD_STATE
 static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
     PyObject *tmp_type, *tmp_value, *tmp_tb;
     #if CYTHON_USE_EXC_INFO_STACK
     _PyErr_StackItem *exc_info = tstate->exc_info;
     tmp_type = exc_info->exc_type;
     tmp_value = exc_info->exc_value;
     tmp_tb = exc_info->exc_traceback;
@@ -18862,15 +18881,15 @@
     *type = tmp_type;
     *value = tmp_value;
     *tb = tmp_tb;
 }
 #endif
 
 /* PyObjectCallMethod1 */
-static PyObject* __Pyx__PyObject_CallMethod1(PyObject* method, PyObject* arg) {
+  static PyObject* __Pyx__PyObject_CallMethod1(PyObject* method, PyObject* arg) {
     PyObject *result = __Pyx_PyObject_CallOneArg(method, arg);
     Py_DECREF(method);
     return result;
 }
 static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg) {
     PyObject *method = NULL, *result;
     int is_method = __Pyx_PyObject_GetMethod(obj, method_name, &method);
@@ -18880,15 +18899,15 @@
         return result;
     }
     if (unlikely(!method)) return NULL;
     return __Pyx__PyObject_CallMethod1(method, arg);
 }
 
 /* CoroutineBase */
-#include <structmember.h>
+  #include <structmember.h>
 #include <frameobject.h>
 #if PY_VERSION_HEX >= 0x030b00a6
   #ifndef Py_BUILD_CORE
     #define Py_BUILD_CORE 1
   #endif
   #include "internal/pycore_frame.h"
 #endif
@@ -19674,15 +19693,15 @@
     gen->gi_code = code;
     gen->gi_frame = NULL;
     PyObject_GC_Track(gen);
     return gen;
 }
 
 /* PyObject_GenericGetAttrNoDict */
-#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
+  #if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
 static PyObject *__Pyx_RaiseGenericGetAttributeError(PyTypeObject *tp, PyObject *attr_name) {
     PyErr_Format(PyExc_AttributeError,
 #if PY_MAJOR_VERSION >= 3
                  "'%.50s' object has no attribute '%U'",
                  tp->tp_name, attr_name);
 #else
                  "'%.50s' object has no attribute '%.400s'",
@@ -19714,15 +19733,15 @@
         }
     }
     return descr;
 }
 #endif
 
 /* PatchModuleWithCoroutine */
-static PyObject* __Pyx_Coroutine_patch_module(PyObject* module, const char* py_code) {
+  static PyObject* __Pyx_Coroutine_patch_module(PyObject* module, const char* py_code) {
 #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
     int result;
     PyObject *globals, *result_obj;
     globals = PyDict_New();  if (unlikely(!globals)) goto ignore;
     result = PyDict_SetItemString(globals, "_cython_coroutine_type",
     #ifdef __Pyx_Coroutine_USED
         (PyObject*)__pyx_CoroutineType);
@@ -19754,15 +19773,15 @@
 #else
     py_code++;
 #endif
     return module;
 }
 
 /* PatchGeneratorABC */
-#ifndef CYTHON_REGISTER_ABCS
+  #ifndef CYTHON_REGISTER_ABCS
 #define CYTHON_REGISTER_ABCS 1
 #endif
 #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
 static PyObject* __Pyx_patch_abc_module(PyObject *module);
 static PyObject* __Pyx_patch_abc_module(PyObject *module) {
     module = __Pyx_Coroutine_patch_module(
         module, ""
@@ -19811,15 +19830,15 @@
 #else
     if ((0)) __Pyx_Coroutine_patch_module(NULL, NULL);
 #endif
     return 0;
 }
 
 /* Coroutine */
-static void __Pyx_CoroutineAwait_dealloc(PyObject *self) {
+  static void __Pyx_CoroutineAwait_dealloc(PyObject *self) {
     PyObject_GC_UnTrack(self);
     Py_CLEAR(((__pyx_CoroutineAwaitObject*)self)->coroutine);
     PyObject_GC_Del(self);
 }
 static int __Pyx_CoroutineAwait_traverse(__pyx_CoroutineAwaitObject *self, visitproc visit, void *arg) {
     Py_VISIT(self->coroutine);
     return 0;
@@ -20088,15 +20107,15 @@
     __pyx_CoroutineAwaitType = __Pyx_FetchCommonType(&__pyx_CoroutineAwaitType_type);
     if (unlikely(!__pyx_CoroutineAwaitType))
         return -1;
     return 0;
 }
 
 /* CoroutineYieldFrom */
-static PyObject* __Pyx__Coroutine_Yield_From_Generic(__pyx_CoroutineObject *gen, PyObject *source) {
+  static PyObject* __Pyx__Coroutine_Yield_From_Generic(__pyx_CoroutineObject *gen, PyObject *source) {
     PyObject *retval;
     PyObject *source_gen = __Pyx__Coroutine_GetAwaitableIter(source);
     if (unlikely(!source_gen)) {
         return NULL;
     }
     if (__Pyx_Coroutine_Check(source_gen)) {
         retval = __Pyx_Generator_Next(source_gen);
@@ -20135,15 +20154,15 @@
         Py_INCREF(source);
         gen->yieldfrom = source;
     }
     return retval;
 }
 
 /* StopAsyncIteration */
-#if PY_VERSION_HEX < 0x030500B1
+  #if PY_VERSION_HEX < 0x030500B1
 static PyTypeObject __Pyx__PyExc_StopAsyncIteration_type = {
     PyVarObject_HEAD_INIT(0, 0)
     "StopAsyncIteration",
     sizeof(PyBaseExceptionObject),
     0,
     0,
     0,
@@ -20219,15 +20238,15 @@
     if (builtins && unlikely(PyMapping_SetItemString(builtins, (char*) "StopAsyncIteration", __Pyx_PyExc_StopAsyncIteration) < 0))
         return -1;
 #endif
     return 0;
 }
 
 /* UnpackUnboundCMethod */
-static int __Pyx_TryUnpackUnboundCMethod(__Pyx_CachedCFunction* target) {
+  static int __Pyx_TryUnpackUnboundCMethod(__Pyx_CachedCFunction* target) {
     PyObject *method;
     method = __Pyx_PyObject_GetAttrStr(target->type, *target->method_name);
     if (unlikely(!method))
         return -1;
     target->method = method;
 #if CYTHON_COMPILING_IN_CPYTHON
     #if PY_MAJOR_VERSION >= 3
@@ -20239,26 +20258,26 @@
         target->flag = descr->d_method->ml_flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_STACKLESS);
     }
 #endif
     return 0;
 }
 
 /* CallUnboundCMethod1 */
-#if CYTHON_COMPILING_IN_CPYTHON
+  #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg) {
     if (likely(cfunc->func)) {
         int flag = cfunc->flag;
         if (flag == METH_O) {
             return (*(cfunc->func))(self, arg);
         } else if (PY_VERSION_HEX >= 0x030600B1 && flag == METH_FASTCALL) {
-            if (PY_VERSION_HEX >= 0x030700A0) {
+            #if PY_VERSION_HEX >= 0x030700A0
                 return (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)cfunc->func)(self, &arg, 1);
-            } else {
+            #else
                 return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
-            }
+            #endif
         } else if (PY_VERSION_HEX >= 0x030700A0 && flag == (METH_FASTCALL | METH_KEYWORDS)) {
             return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
         }
     }
     return __Pyx__CallUnboundCMethod1(cfunc, self, arg);
 }
 #endif
@@ -20291,27 +20310,25 @@
 #endif
 bad:
     Py_XDECREF(args);
     return result;
 }
 
 /* WriteUnraisableException */
-static void __Pyx_WriteUnraisable(const char *name, CYTHON_UNUSED int clineno,
+  static void __Pyx_WriteUnraisable(const char *name, CYTHON_UNUSED int clineno,
                                   CYTHON_UNUSED int lineno, CYTHON_UNUSED const char *filename,
                                   int full_traceback, CYTHON_UNUSED int nogil) {
     PyObject *old_exc, *old_val, *old_tb;
     PyObject *ctx;
     __Pyx_PyThreadState_declare
 #ifdef WITH_THREAD
     PyGILState_STATE state;
     if (nogil)
         state = PyGILState_Ensure();
-#ifdef _MSC_VER
-    else state = (PyGILState_STATE)-1;
-#endif
+    else state = (PyGILState_STATE)0;
 #endif
     __Pyx_PyThreadState_assign
     __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
     if (full_traceback) {
         Py_XINCREF(old_exc);
         Py_XINCREF(old_val);
         Py_XINCREF(old_tb);
@@ -20333,15 +20350,15 @@
 #ifdef WITH_THREAD
     if (nogil)
         PyGILState_Release(state);
 #endif
 }
 
 /* BytesEquals */
-static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals) {
+  static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals) {
 #if CYTHON_COMPILING_IN_PYPY
     return PyObject_RichCompareBool(s1, s2, equals);
 #else
     if (s1 == s2) {
         return (equals == Py_EQ);
     } else if (PyBytes_CheckExact(s1) & PyBytes_CheckExact(s2)) {
         const char *ps1, *ps2;
@@ -20380,15 +20397,15 @@
         Py_DECREF(py_result);
         return result;
     }
 #endif
 }
 
 /* UnicodeEquals */
-static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals) {
+  static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals) {
 #if CYTHON_COMPILING_IN_PYPY
     return PyObject_RichCompareBool(s1, s2, equals);
 #else
 #if PY_MAJOR_VERSION < 3
     PyObject* owned_ref = NULL;
 #endif
     int s1_is_unicode, s2_is_unicode;
@@ -20482,28 +20499,28 @@
     Py_XDECREF(owned_ref);
     #endif
     return (equals == Py_NE);
 #endif
 }
 
 /* RaiseTooManyValuesToUnpack */
-static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected) {
+  static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected) {
     PyErr_Format(PyExc_ValueError,
                  "too many values to unpack (expected %" CYTHON_FORMAT_SSIZE_T "d)", expected);
 }
 
 /* RaiseNeedMoreValuesToUnpack */
-static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
+  static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
     PyErr_Format(PyExc_ValueError,
                  "need more than %" CYTHON_FORMAT_SSIZE_T "d value%.1s to unpack",
                  index, (index == 1) ? "" : "s");
 }
 
 /* IterFinish */
-static CYTHON_INLINE int __Pyx_IterFinish(void) {
+  static CYTHON_INLINE int __Pyx_IterFinish(void) {
 #if CYTHON_FAST_THREAD_STATE
     PyThreadState *tstate = __Pyx_PyThreadState_Current;
     PyObject* exc_type = tstate->curexc_type;
     if (unlikely(exc_type)) {
         if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) {
             PyObject *exc_value, *exc_tb;
             exc_value = tstate->curexc_value;
@@ -20530,27 +20547,25 @@
         }
     }
     return 0;
 #endif
 }
 
 /* UnpackItemEndCheck */
-static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected) {
+  static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected) {
     if (unlikely(retval)) {
         Py_DECREF(retval);
         __Pyx_RaiseTooManyValuesError(expected);
         return -1;
-    } else {
-        return __Pyx_IterFinish();
     }
-    return 0;
+    return __Pyx_IterFinish();
 }
 
 /* DictGetItem */
-#if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY
+  #if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY
 static PyObject *__Pyx_PyDict_GetItem(PyObject *d, PyObject* key) {
     PyObject *value;
     value = PyDict_GetItemWithError(d, key);
     if (unlikely(!value)) {
         if (!PyErr_Occurred()) {
             if (unlikely(PyTuple_Check(key))) {
                 PyObject* args = PyTuple_Pack(1, key);
@@ -20566,28 +20581,28 @@
     }
     Py_INCREF(value);
     return value;
 }
 #endif
 
 /* append */
-static CYTHON_INLINE int __Pyx_PyObject_Append(PyObject* L, PyObject* x) {
+  static CYTHON_INLINE int __Pyx_PyObject_Append(PyObject* L, PyObject* x) {
     if (likely(PyList_CheckExact(L))) {
         if (unlikely(__Pyx_PyList_Append(L, x) < 0)) return -1;
     } else {
         PyObject* retval = __Pyx_PyObject_CallMethod1(L, __pyx_n_s_append, x);
         if (unlikely(!retval))
             return -1;
         Py_DECREF(retval);
     }
     return 0;
 }
 
 /* GetException */
-#if CYTHON_FAST_THREAD_STATE
+  #if CYTHON_FAST_THREAD_STATE
 static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
 #else
 static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
 #endif
 {
     PyObject *local_type, *local_value, *local_tb;
 #if CYTHON_FAST_THREAD_STATE
@@ -20653,28 +20668,28 @@
     Py_XDECREF(local_type);
     Py_XDECREF(local_value);
     Py_XDECREF(local_tb);
     return -1;
 }
 
 /* ExtTypeTest */
-static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
+  static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
     if (unlikely(!type)) {
         PyErr_SetString(PyExc_SystemError, "Missing type object");
         return 0;
     }
     if (likely(__Pyx_TypeCheck(obj, type)))
         return 1;
     PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
                  Py_TYPE(obj)->tp_name, type->tp_name);
     return 0;
 }
 
 /* decode_c_bytes */
-static CYTHON_INLINE PyObject* __Pyx_decode_c_bytes(
+  static CYTHON_INLINE PyObject* __Pyx_decode_c_bytes(
          const char* cstring, Py_ssize_t length, Py_ssize_t start, Py_ssize_t stop,
          const char* encoding, const char* errors,
          PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors)) {
     if (unlikely((start < 0) | (stop < 0))) {
         if (start < 0) {
             start += length;
             if (start < 0)
@@ -20693,15 +20708,15 @@
         return decode_func(cstring, length, errors);
     } else {
         return PyUnicode_Decode(cstring, length, encoding, errors);
     }
 }
 
 /* JoinPyUnicode */
-static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
+  static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
                                       CYTHON_UNUSED Py_UCS4 max_char) {
 #if CYTHON_USE_UNICODE_INTERNALS && CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     PyObject *result_uval;
     int result_ukind;
     Py_ssize_t i, char_pos;
     void *result_udata;
 #if CYTHON_PEP393_ENABLED
@@ -20755,15 +20770,15 @@
     result_ulength++;
     value_count++;
     return PyUnicode_Join(__pyx_empty_unicode, value_tuple);
 #endif
 }
 
 /* Import */
-static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
+  static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
     PyObject *empty_list = 0;
     PyObject *module = 0;
     PyObject *global_dict = 0;
     PyObject *empty_dict = 0;
     PyObject *list;
     #if PY_MAJOR_VERSION < 3
     PyObject *py_import;
@@ -20820,29 +20835,29 @@
     #endif
     Py_XDECREF(empty_list);
     Py_XDECREF(empty_dict);
     return module;
 }
 
 /* ImportFrom */
-static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name) {
+  static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name) {
     PyObject* value = __Pyx_PyObject_GetAttrStr(module, name);
     if (unlikely(!value) && PyErr_ExceptionMatches(PyExc_AttributeError)) {
         PyErr_Format(PyExc_ImportError,
         #if PY_MAJOR_VERSION < 3
             "cannot import name %.230s", PyString_AS_STRING(name));
         #else
             "cannot import name %S", name);
         #endif
     }
     return value;
 }
 
 /* GetItemInt */
-static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
+  static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
     PyObject *r;
     if (!j) return NULL;
     r = PyObject_GetItem(o, j);
     Py_DECREF(j);
     return r;
 }
 static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
@@ -20921,15 +20936,15 @@
         return PySequence_GetItem(o, i);
     }
 #endif
     return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
 }
 
 /* HasAttr */
-static CYTHON_INLINE int __Pyx_HasAttr(PyObject *o, PyObject *n) {
+  static CYTHON_INLINE int __Pyx_HasAttr(PyObject *o, PyObject *n) {
     PyObject *r;
     if (unlikely(!__Pyx_PyBaseString_Check(n))) {
         PyErr_SetString(PyExc_TypeError,
                         "hasattr(): attribute name must be string");
         return -1;
     }
     r = __Pyx_GetAttr(o, n);
@@ -20939,48 +20954,48 @@
     } else {
         Py_DECREF(r);
         return 1;
     }
 }
 
 /* CallNextTpTraverse */
-static int __Pyx_call_next_tp_traverse(PyObject* obj, visitproc v, void *a, traverseproc current_tp_traverse) {
+  static int __Pyx_call_next_tp_traverse(PyObject* obj, visitproc v, void *a, traverseproc current_tp_traverse) {
     PyTypeObject* type = Py_TYPE(obj);
     while (type && type->tp_traverse != current_tp_traverse)
         type = type->tp_base;
     while (type && type->tp_traverse == current_tp_traverse)
         type = type->tp_base;
     if (type && type->tp_traverse)
         return type->tp_traverse(obj, v, a);
     return 0;
 }
 
 /* CallNextTpClear */
-static void __Pyx_call_next_tp_clear(PyObject* obj, inquiry current_tp_clear) {
+  static void __Pyx_call_next_tp_clear(PyObject* obj, inquiry current_tp_clear) {
     PyTypeObject* type = Py_TYPE(obj);
     while (type && type->tp_clear != current_tp_clear)
         type = type->tp_base;
     while (type && type->tp_clear == current_tp_clear)
         type = type->tp_base;
     if (type && type->tp_clear)
         type->tp_clear(obj);
 }
 
 /* PyObject_GenericGetAttr */
-#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
+  #if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
 static PyObject* __Pyx_PyObject_GenericGetAttr(PyObject* obj, PyObject* attr_name) {
     if (unlikely(Py_TYPE(obj)->tp_dictoffset)) {
         return PyObject_GenericGetAttr(obj, attr_name);
     }
     return __Pyx_PyObject_GenericGetAttrNoDict(obj, attr_name);
 }
 #endif
 
 /* PyObjectGetAttrStrNoError */
-static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
+  static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     if (likely(__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
         __Pyx_PyErr_Clear();
 }
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name) {
     PyObject *result;
@@ -20994,15 +21009,15 @@
     if (unlikely(!result)) {
         __Pyx_PyObject_GetAttrStr_ClearAttributeError();
     }
     return result;
 }
 
 /* SetupReduce */
-static int __Pyx_setup_reduce_is_named(PyObject* meth, PyObject* name) {
+  static int __Pyx_setup_reduce_is_named(PyObject* meth, PyObject* name) {
   int ret;
   PyObject *name_attr;
   name_attr = __Pyx_PyObject_GetAttrStr(meth, __pyx_n_s_name_2);
   if (likely(name_attr)) {
       ret = PyObject_RichCompareBool(name_attr, name, Py_EQ);
   } else {
       ret = -1;
@@ -21098,15 +21113,15 @@
     Py_XDECREF(reduce_cython);
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 
 /* SetVTable */
-static int __Pyx_SetVtable(PyObject *dict, void *vtable) {
+  static int __Pyx_SetVtable(PyObject *dict, void *vtable) {
 #if PY_VERSION_HEX >= 0x02070000
     PyObject *ob = PyCapsule_New(vtable, 0, 0);
 #else
     PyObject *ob = PyCObject_FromVoidPtr(vtable, 0);
 #endif
     if (!ob)
         goto bad;
@@ -21116,47 +21131,65 @@
     return 0;
 bad:
     Py_XDECREF(ob);
     return -1;
 }
 
 /* TypeImport */
-#ifndef __PYX_HAVE_RT_ImportType
+  #ifndef __PYX_HAVE_RT_ImportType
 #define __PYX_HAVE_RT_ImportType
 static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, enum __Pyx_ImportType_CheckSize check_size)
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
+    Py_ssize_t itemsize;
 #ifdef Py_LIMITED_API
     PyObject *py_basicsize;
+    PyObject *py_itemsize;
 #endif
     result = PyObject_GetAttrString(module, class_name);
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
         PyErr_Format(PyExc_TypeError,
             "%.200s.%.200s is not a type object",
             module_name, class_name);
         goto bad;
     }
 #ifndef Py_LIMITED_API
     basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
 #else
     py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
     if (!py_basicsize)
         goto bad;
     basicsize = PyLong_AsSsize_t(py_basicsize);
     Py_DECREF(py_basicsize);
     py_basicsize = 0;
     if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
         goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
 #endif
-    if ((size_t)basicsize < size) {
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
     if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
@@ -21177,15 +21210,15 @@
 bad:
     Py_XDECREF(result);
     return NULL;
 }
 #endif
 
 /* PatchInspect */
-static PyObject* __Pyx_patch_inspect(PyObject* module) {
+  static PyObject* __Pyx_patch_inspect(PyObject* module) {
 #if defined(__Pyx_Generator_USED) && (!defined(CYTHON_PATCH_INSPECT) || CYTHON_PATCH_INSPECT)
     static int inspect_patched = 0;
     if (unlikely((!inspect_patched) && module)) {
         module = __Pyx_Coroutine_patch_module(
             module, ""
 "old_types = getattr(_module.isgenerator, '_cython_generator_types', None)\n"
 "if old_types is None or not isinstance(old_types, set):\n"
@@ -21202,16 +21235,16 @@
 #else
     if ((0)) return __Pyx_Coroutine_patch_module(module, NULL);
 #endif
     return module;
 }
 
 /* CLineInTraceback */
-#ifndef CYTHON_CLINE_IN_TRACEBACK
-static int __Pyx_CLineForTraceback(CYTHON_NCP_UNUSED PyThreadState *tstate, int c_line) {
+  #ifndef CYTHON_CLINE_IN_TRACEBACK
+static int __Pyx_CLineForTraceback(CYTHON_UNUSED PyThreadState *tstate, int c_line) {
     PyObject *use_cline;
     PyObject *ptype, *pvalue, *ptraceback;
 #if CYTHON_COMPILING_IN_CPYTHON
     PyObject **cython_runtime_dict;
 #endif
     if (unlikely(!__pyx_cython_runtime)) {
         return c_line;
@@ -21244,15 +21277,15 @@
     }
     __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
     return c_line;
 }
 #endif
 
 /* CodeObjectCache */
-static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
+  static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
     int start = 0, mid = 0, end = count - 1;
     if (end >= 0 && code_line > entries[end].code_line) {
         return count;
     }
     while (start < end) {
         mid = start + (end - start) / 2;
         if (code_line < entries[mid].code_line) {
@@ -21324,15 +21357,15 @@
     entries[pos].code_line = code_line;
     entries[pos].code_object = code_object;
     __pyx_code_cache.count++;
     Py_INCREF(code_object);
 }
 
 /* AddTraceback */
-#include "compile.h"
+  #include "compile.h"
 #include "frameobject.h"
 #include "traceback.h"
 #if PY_VERSION_HEX >= 0x030b00a6
   #ifndef Py_BUILD_CORE
     #define Py_BUILD_CORE 1
   #endif
   #include "internal/pycore_frame.h"
@@ -21431,15 +21464,15 @@
     PyTraceBack_Here(py_frame);
 bad:
     Py_XDECREF(py_code);
     Py_XDECREF(py_frame);
 }
 
 /* CIntFromPyVerify */
-#define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
+  #define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
     __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
 #define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
     __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
 #define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
     {\
         func_type value = func_value;\
         if (sizeof(target_type) < sizeof(func_type)) {\
@@ -21453,15 +21486,15 @@
                     goto raise_overflow;\
             }\
         }\
         return (target_type) value;\
     }
 
 /* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
+  static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const int neg_one = (int) -1, const_zero = (int) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -21491,15 +21524,15 @@
         unsigned char *bytes = (unsigned char *)&value;
         return _PyLong_FromByteArray(bytes, sizeof(int),
                                      little, !is_unsigned);
     }
 }
 
 /* CIntFromPy */
-static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
+  static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const int neg_one = (int) -1, const_zero = (int) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -21687,15 +21720,15 @@
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to int");
     return (int) -1;
 }
 
 /* CIntFromPy */
-static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
+  static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const long neg_one = (long) -1, const_zero = (long) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -21883,15 +21916,15 @@
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to long");
     return (long) -1;
 }
 
 /* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
+  static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const long neg_one = (long) -1, const_zero = (long) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -21921,15 +21954,15 @@
         unsigned char *bytes = (unsigned char *)&value;
         return _PyLong_FromByteArray(bytes, sizeof(long),
                                      little, !is_unsigned);
     }
 }
 
 /* FastTypeChecks */
-#if CYTHON_COMPILING_IN_CPYTHON
+  #if CYTHON_COMPILING_IN_CPYTHON
 static int __Pyx_InBases(PyTypeObject *a, PyTypeObject *b) {
     while (a) {
         a = a->tp_base;
         if (a == b)
             return 1;
     }
     return b == &PyBaseObject_Type;
@@ -22021,15 +22054,15 @@
         return __Pyx_inner_PyErr_GivenExceptionMatches2(err, exc_type1, exc_type2);
     }
     return (PyErr_GivenExceptionMatches(err, exc_type1) || PyErr_GivenExceptionMatches(err, exc_type2));
 }
 #endif
 
 /* AsyncGeneratorInitFinalizer */
-#if PY_VERSION_HEX < 0x030600B0
+  #if PY_VERSION_HEX < 0x030600B0
 static int __Pyx_async_gen_init_hooks(__pyx_PyAsyncGenObject *o) {
 #if 0
     PyThreadState *tstate;
     PyObject *finalizer;
     PyObject *firstiter;
 #endif
     if (likely(o->ag_hooks_inited)) {
@@ -22056,15 +22089,15 @@
     }
 #endif
     return 0;
 }
 #endif
 
 /* AsyncGenerator */
-PyDoc_STRVAR(__Pyx_async_gen_send_doc,
+  PyDoc_STRVAR(__Pyx_async_gen_send_doc,
 "send(arg) -> send 'arg' into generator,\n\
 return next yielded value or raise StopIteration.");
 PyDoc_STRVAR(__Pyx_async_gen_close_doc,
 "close() -> raise GeneratorExit inside generator.");
 PyDoc_STRVAR(__Pyx_async_gen_throw_doc,
 "throw(typ[,val[,tb]]) -> raise exception in generator,\n\
 return next yielded value or raise StopIteration.");
@@ -22888,18 +22921,18 @@
     __pyx__PyAsyncGenASendType = __Pyx_FetchCommonType(&__pyx__PyAsyncGenASendType_type);
     if (unlikely(!__pyx__PyAsyncGenASendType))
         return -1;
     return 0;
 }
 
 /* AsyncGen */
-
+  
 
 /* CheckBinaryVersion */
-static int __Pyx_check_binary_version(void) {
+  static int __Pyx_check_binary_version(void) {
     char ctversion[5];
     int same=1, i, found_dot;
     const char* rt_from_call = Py_GetVersion();
     PyOS_snprintf(ctversion, 5, "%d.%d", PY_MAJOR_VERSION, PY_MINOR_VERSION);
     found_dot = 0;
     for (i = 0; i < 4; i++) {
         if (!ctversion[i]) {
@@ -22929,15 +22962,15 @@
                       ctversion, __Pyx_MODULE_NAME, rtversion);
         return PyErr_WarnEx(NULL, message, 1);
     }
     return 0;
 }
 
 /* FunctionExport */
-static int __Pyx_ExportFunction(const char *name, void (*f)(void), const char *sig) {
+  static int __Pyx_ExportFunction(const char *name, void (*f)(void), const char *sig) {
     PyObject *d = 0;
     PyObject *cobj = 0;
     union {
         void (*fp)(void);
         void *p;
     } tmp;
     d = PyObject_GetAttrString(__pyx_m, (char *)"__pyx_capi__");
@@ -22966,15 +22999,15 @@
 bad:
     Py_XDECREF(cobj);
     Py_XDECREF(d);
     return -1;
 }
 
 /* InitStrings */
-static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
+  static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
     while (t->p) {
         #if PY_MAJOR_VERSION < 3
         if (t->is_unicode) {
             *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
         } else if (t->intern) {
             *t->p = PyString_InternFromString(t->s);
         } else {
```

### Comparing `blacksheep-2.0a5/blacksheep/contents.pxd` & `blacksheep-2.0a6/blacksheep/contents.pxd`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/contents.pyi` & `blacksheep-2.0a6/blacksheep/contents.pyi`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/contents.pyx` & `blacksheep-2.0a6/blacksheep/contents.pyx`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/cookies.c` & `blacksheep-2.0a6/blacksheep/cookies.c`

 * *Files 0% similar despite different names*

```diff
@@ -1,20 +1,20 @@
-/* Generated by Cython 0.29.32 */
+/* Generated by Cython 0.29.34 */
 
 #ifndef PY_SSIZE_T_CLEAN
 #define PY_SSIZE_T_CLEAN
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_32"
-#define CYTHON_HEX_VERSION 0x001D20F0
+#define CYTHON_ABI "0_29_34"
+#define CYTHON_HEX_VERSION 0x001D22F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -83,15 +83,15 @@
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
-    #define CYTHON_UPDATE_DESCRIPTOR_DOC (PYPY_VERSION_HEX >= 0x07030900)
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
 #elif defined(PYSTON_VERSION)
   #define CYTHON_COMPILING_IN_PYPY 0
   #define CYTHON_COMPILING_IN_PYSTON 1
   #define CYTHON_COMPILING_IN_CPYTHON 0
   #define CYTHON_COMPILING_IN_NOGIL 0
   #ifndef CYTHON_USE_TYPE_SLOTS
@@ -199,15 +199,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -238,15 +238,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -548,35 +548,35 @@
 #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && CYTHON_USE_UNICODE_INTERNALS
 #define __Pyx_PyDict_GetItemStr(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
 #else
 #define __Pyx_PyDict_GetItemStr(dict, name)  PyDict_GetItem(dict, name)
 #endif
 #if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
   #define CYTHON_PEP393_ENABLED 1
-  #if defined(PyUnicode_IS_READY)
-  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
-                                              0 : _PyUnicode_Ready((PyObject *)(op)))
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_READY(op)       (0)
   #else
-  #define __Pyx_PyUnicode_READY(op)       (0)
+    #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
+                                                0 : _PyUnicode_Ready((PyObject *)(op)))
   #endif
   #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
   #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
   #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
   #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
   #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
   #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
   #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, ch)
-  #if defined(PyUnicode_IS_READY) && defined(PyUnicode_GET_SIZE)
-  #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
-  #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
-  #endif
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
   #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
+    #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
+    #else
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
+    #endif
   #endif
 #else
   #define CYTHON_PEP393_ENABLED 0
   #define PyUnicode_1BYTE_KIND  1
   #define PyUnicode_2BYTE_KIND  2
   #define PyUnicode_4BYTE_KIND  4
   #define __Pyx_PyUnicode_READY(op)       (0)
@@ -949,17 +949,17 @@
 static int __pyx_lineno;
 static int __pyx_clineno = 0;
 static const char * __pyx_cfilenm= __FILE__;
 static const char *__pyx_filename;
 
 
 static const char *__pyx_f[] = {
-  "blacksheep/cookies.pyx",
+  "blacksheep\\cookies.pyx",
   "stringsource",
-  "blacksheep/cookies.pxd",
+  "blacksheep\\cookies.pxd",
   "datetime.pxd",
   "type.pxd",
 };
 
 /*--- Type declarations ---*/
 struct __pyx_obj_10blacksheep_7cookies_Cookie;
 struct __pyx_obj_10blacksheep_7cookies_CookieError;
@@ -1219,26 +1219,26 @@
 #define __PYX_GET_DICT_VERSION(dict)  (0)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
 #define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
 #endif
 
 /* GetModuleGlobalName.proto */
 #if CYTHON_USE_DICT_VERSIONS
-#define __Pyx_GetModuleGlobalName(var, name)  {\
+#define __Pyx_GetModuleGlobalName(var, name)  do {\
     static PY_UINT64_T __pyx_dict_version = 0;\
     static PyObject *__pyx_dict_cached_value = NULL;\
     (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
         (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
         __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  {\
+} while(0)
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  do {\
     PY_UINT64_T __pyx_dict_version;\
     PyObject *__pyx_dict_cached_value;\
     (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
+} while(0)
 static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
 #else
 #define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 #define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
 #endif
 
@@ -1574,20 +1574,28 @@
 
 /* SetupReduce.proto */
 static int __Pyx_setup_reduce(PyObject* type_obj);
 
 /* TypeImport.proto */
 #ifndef __PYX_HAVE_RT_ImportType_proto
 #define __PYX_HAVE_RT_ImportType_proto
+#if __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT(s) sizeof(void*)
+#endif
 enum __Pyx_ImportType_CheckSize {
    __Pyx_ImportType_CheckSize_Error = 0,
    __Pyx_ImportType_CheckSize_Warn = 1,
    __Pyx_ImportType_CheckSize_Ignore = 2
 };
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
+static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize check_size);
 #endif
 
 /* CalculateMetaclass.proto */
 static PyObject *__Pyx_CalculateMetaclass(PyTypeObject *metaclass, PyObject *bases);
 
 /* SetNameInClass.proto */
 #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
@@ -2191,15 +2199,15 @@
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
   if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 9, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 9, __pyx_L1_error)
   __pyx_r = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* "blacksheep/cookies.pyx":8
  * 
  * 
@@ -2801,15 +2809,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_CookieError, (type(self), 0xd41d8cd, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_CookieError__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_7cookies___pyx_unpickle_CookieError__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_CookieError, (type(self), 0xd41d8cd, state)
@@ -3183,15 +3191,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_CookieValueExceedsMaximumLength, (type(self), 0xd41d8cd, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_CookieValueExceedsMaximumLength__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_7cookies___pyx_unpickle_CookieValueExceedsMaximumLength__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_CookieValueExceedsMaximumLength, (type(self), 0xd41d8cd, state)
@@ -3671,15 +3679,15 @@
   /* "blacksheep/cookies.pyx":64
  *         if not value:
  *             raise ValueError("A cookie name is required")
  *         self._name = value             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  if (!(likely(PyUnicode_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(0, 64, __pyx_L1_error)
+  if (!(likely(PyUnicode_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(0, 64, __pyx_L1_error)
   __pyx_t_3 = __pyx_v_value;
   __Pyx_INCREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_3);
   __Pyx_GOTREF(__pyx_v_self->_name);
   __Pyx_DECREF(__pyx_v_self->_name);
   __pyx_v_self->_name = ((PyObject*)__pyx_t_3);
   __pyx_t_3 = 0;
@@ -3854,15 +3862,15 @@
   /* "blacksheep/cookies.pyx":74
  *         if value and len(value.encode()) > 4096:
  *             raise CookieValueExceedsMaximumLength()
  *         self._value = value             # <<<<<<<<<<<<<<
  * 
  *     cpdef Cookie clone(self):
  */
-  if (!(likely(PyUnicode_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(0, 74, __pyx_L1_error)
+  if (!(likely(PyUnicode_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(0, 74, __pyx_L1_error)
   __pyx_t_3 = __pyx_v_value;
   __Pyx_INCREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_3);
   __Pyx_GOTREF(__pyx_v_self->_value);
   __Pyx_DECREF(__pyx_v_self->_value);
   __pyx_v_self->_value = ((PyObject*)__pyx_t_3);
   __pyx_t_3 = 0;
@@ -4622,15 +4630,15 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
-  if (!(likely(PyUnicode_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(2, 21, __pyx_L1_error)
+  if (!(likely(PyUnicode_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(2, 21, __pyx_L1_error)
   __pyx_t_1 = __pyx_v_value;
   __Pyx_INCREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v_self->domain);
   __Pyx_DECREF(__pyx_v_self->domain);
   __pyx_v_self->domain = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
@@ -4730,15 +4738,15 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
-  if (!(likely(PyUnicode_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(2, 22, __pyx_L1_error)
+  if (!(likely(PyUnicode_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(2, 22, __pyx_L1_error)
   __pyx_t_1 = __pyx_v_value;
   __Pyx_INCREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v_self->path);
   __Pyx_DECREF(__pyx_v_self->path);
   __pyx_v_self->path = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
@@ -5444,15 +5452,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_Cookie, (type(self), 0xe7407db, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_Cookie__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_7cookies___pyx_unpickle_Cookie__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_Cookie, (type(self), 0xe7407db, state)
@@ -5655,15 +5663,15 @@
  * 
  *     raw_value_lower = raw_value.lower()             # <<<<<<<<<<<<<<
  * 
  *     if raw_value_lower == b"strict":
  */
   __pyx_t_3 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_raw_value); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 115, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 115, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 115, __pyx_L1_error)
   __pyx_v_raw_value_lower = ((PyObject*)__pyx_t_3);
   __pyx_t_3 = 0;
 
   /* "blacksheep/cookies.pyx":117
  *     raw_value_lower = raw_value.lower()
  * 
  *     if raw_value_lower == b"strict":             # <<<<<<<<<<<<<<
@@ -5868,15 +5876,15 @@
  *     eq = b'='
  *     parts = raw_value.split(b'; ')             # <<<<<<<<<<<<<<
  *     if len(parts) == 0:
  *         # only name=value pair
  */
   __pyx_t_1 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PyBytes_Type_split, __pyx_v_raw_value, __pyx_kp_b__7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 136, __pyx_L1_error)
+  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 136, __pyx_L1_error)
   __pyx_v_parts = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "blacksheep/cookies.pyx":137
  *     eq = b'='
  *     parts = raw_value.split(b'; ')
  *     if len(parts) == 0:             # <<<<<<<<<<<<<<
@@ -5935,15 +5943,15 @@
           __pyx_t_8 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 140, __pyx_L4_error)
           __Pyx_GOTREF(__pyx_t_8);
           #endif
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         } else {
           __Pyx_RaiseNoneNotIterableError(); __PYX_ERR(0, 140, __pyx_L4_error)
         }
-        if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 140, __pyx_L4_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 140, __pyx_L4_error)
         __pyx_v_name = __pyx_t_7;
         __pyx_t_7 = 0;
         __Pyx_DECREF_SET(__pyx_v_value, ((PyObject*)__pyx_t_8));
         __pyx_t_8 = 0;
 
         /* "blacksheep/cookies.pyx":139
  *     if len(parts) == 0:
@@ -6124,15 +6132,15 @@
  *         # some set a cookie with a separator without space
  *         parts = raw_value.split(b';')             # <<<<<<<<<<<<<<
  *     try:
  *         name, value = split_value(parts[0], eq)
  */
     __pyx_t_7 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PyBytes_Type_split, __pyx_v_raw_value, __pyx_kp_b__8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 147, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    if (!(likely(PyList_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 147, __pyx_L1_error)
+    if (!(likely(PyList_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 147, __pyx_L1_error)
     __Pyx_DECREF_SET(__pyx_v_parts, ((PyObject*)__pyx_t_7));
     __pyx_t_7 = 0;
 
     /* "blacksheep/cookies.pyx":145
  *         else:
  *             return Cookie(name, value)
  *     if len(parts) == 1:             # <<<<<<<<<<<<<<
@@ -6166,15 +6174,15 @@
  */
       if (unlikely(__pyx_v_parts == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
         __PYX_ERR(0, 149, __pyx_L22_error)
       }
       __pyx_t_7 = __Pyx_GetItemInt_List(__pyx_v_parts, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 149, __pyx_L22_error)
       __Pyx_GOTREF(__pyx_t_7);
-      if (!(likely(PyBytes_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 149, __pyx_L22_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 149, __pyx_L22_error)
       __pyx_t_1 = __pyx_f_10blacksheep_7cookies_split_value(((PyObject*)__pyx_t_7), __pyx_v_eq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L22_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       if (likely(__pyx_t_1 != Py_None)) {
         PyObject* sequence = __pyx_t_1;
         Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
         if (unlikely(size != 2)) {
@@ -6193,15 +6201,15 @@
         __pyx_t_8 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 149, __pyx_L22_error)
         __Pyx_GOTREF(__pyx_t_8);
         #endif
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       } else {
         __Pyx_RaiseNoneNotIterableError(); __PYX_ERR(0, 149, __pyx_L22_error)
       }
-      if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 149, __pyx_L22_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 149, __pyx_L22_error)
       __pyx_v_name = __pyx_t_7;
       __pyx_t_7 = 0;
       __Pyx_DECREF_SET(__pyx_v_value, ((PyObject*)__pyx_t_8));
       __pyx_t_8 = 0;
 
       /* "blacksheep/cookies.pyx":148
  *         # some set a cookie with a separator without space
@@ -6357,15 +6365,15 @@
  *     if b' ' in value and value.startswith(b'"'):
  *         value = value.strip(b'"')             # <<<<<<<<<<<<<<
  * 
  *     expires = None
  */
     __pyx_t_7 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PyBytes_Type_strip, __pyx_v_value, __pyx_kp_b__10); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 154, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    if (!(likely(PyBytes_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 154, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 154, __pyx_L1_error)
     __Pyx_DECREF_SET(__pyx_v_value, ((PyObject*)__pyx_t_7));
     __pyx_t_7 = 0;
 
     /* "blacksheep/cookies.pyx":153
  *         raise ValueError(f'Invalid name=value fragment: {parts[0]}')
  * 
  *     if b' ' in value and value.startswith(b'"'):             # <<<<<<<<<<<<<<
@@ -6457,15 +6465,15 @@
     if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_7)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     __pyx_t_8 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_2); __Pyx_INCREF(__pyx_t_8); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 164, __pyx_L1_error)
     #else
     __pyx_t_8 = PySequence_ITEM(__pyx_t_7, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 164, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     #endif
-    if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 164, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 164, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_part, ((PyObject*)__pyx_t_8));
     __pyx_t_8 = 0;
 
     /* "blacksheep/cookies.pyx":165
  * 
  *     for part in parts:
  *         if eq in part:             # <<<<<<<<<<<<<<
@@ -6504,31 +6512,31 @@
         __pyx_t_10 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 166, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_10);
         #endif
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else {
         __Pyx_RaiseNoneNotIterableError(); __PYX_ERR(0, 166, __pyx_L1_error)
       }
-      if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 166, __pyx_L1_error)
-      if (!(likely(PyBytes_CheckExact(__pyx_t_10))||((__pyx_t_10) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_10)->tp_name), 0))) __PYX_ERR(0, 166, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 166, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_10))||((__pyx_t_10) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_10)->tp_name), 0))) __PYX_ERR(0, 166, __pyx_L1_error)
       __Pyx_XDECREF_SET(__pyx_v_k, ((PyObject*)__pyx_t_1));
       __pyx_t_1 = 0;
       __Pyx_XDECREF_SET(__pyx_v_v, ((PyObject*)__pyx_t_10));
       __pyx_t_10 = 0;
 
       /* "blacksheep/cookies.pyx":167
  *         if eq in part:
  *             k, v = split_value(part, eq)
  *             lower_k = k.lower()             # <<<<<<<<<<<<<<
  *             if lower_k == b'expires':
  *                 expires = v
  */
       __pyx_t_8 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_k); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 167, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 167, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 167, __pyx_L1_error)
       __Pyx_XDECREF_SET(__pyx_v_lower_k, ((PyObject*)__pyx_t_8));
       __pyx_t_8 = 0;
 
       /* "blacksheep/cookies.pyx":168
  *             k, v = split_value(part, eq)
  *             lower_k = k.lower()
  *             if lower_k == b'expires':             # <<<<<<<<<<<<<<
@@ -6702,15 +6710,15 @@
  *             lower_part = part.lower()             # <<<<<<<<<<<<<<
  *             if lower_part == b'httponly':
  *                 http_only = True
  */
     /*else*/ {
       __pyx_t_8 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_part); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 179, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 179, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 179, __pyx_L1_error)
       __Pyx_XDECREF_SET(__pyx_v_lower_part, ((PyObject*)__pyx_t_8));
       __pyx_t_8 = 0;
 
       /* "blacksheep/cookies.pyx":180
  *         else:
  *             lower_part = part.lower()
  *             if lower_part == b'httponly':             # <<<<<<<<<<<<<<
@@ -7542,15 +7550,15 @@
  *         parts.append(b'SameSite=None')
  * 
  *     return b'; '.join(parts)             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = __Pyx_PyBytes_Join(__pyx_kp_b__7, __pyx_v_parts); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 229, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 229, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 229, __pyx_L1_error)
   __pyx_r = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* "blacksheep/cookies.pyx":198
  * 
  * 
@@ -7793,15 +7801,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = CookieError.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_CookieError__set_state(<CookieError> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_CookieError__set_state(CookieError __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_7cookies___pyx_unpickle_CookieError__set_state(((struct __pyx_obj_10blacksheep_7cookies_CookieError *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xd41d8cd, 0xe3b0c44, 0xda39a3e) = ())" % __pyx_checksum)
  *     __pyx_result = CookieError.__new__(__pyx_type)
@@ -8175,15 +8183,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = CookieValueExceedsMaximumLength.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_CookieValueExceedsMaximumLength__set_state(<CookieValueExceedsMaximumLength> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_CookieValueExceedsMaximumLength__set_state(CookieValueExceedsMaximumLength __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_7cookies___pyx_unpickle_CookieValueExceedsMaximumLength__set_state(((struct __pyx_obj_10blacksheep_7cookies_CookieValueExceedsMaximumLength *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xd41d8cd, 0xe3b0c44, 0xda39a3e) = ())" % __pyx_checksum)
  *     __pyx_result = CookieValueExceedsMaximumLength.__new__(__pyx_type)
@@ -8557,15 +8565,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = Cookie.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Cookie__set_state(<Cookie> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_Cookie__set_state(Cookie __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_7cookies___pyx_unpickle_Cookie__set_state(((struct __pyx_obj_10blacksheep_7cookies_Cookie *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xe7407db, 0x2035a3d, 0xc44a7b0) = (_name, _value, domain, expires, http_only, max_age, path, same_site, secure))" % __pyx_checksum)
  *     __pyx_result = Cookie.__new__(__pyx_type)
@@ -8644,39 +8652,39 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(1, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
+  if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->_name);
   __Pyx_DECREF(__pyx_v___pyx_result->_name);
   __pyx_v___pyx_result->_name = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(1, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
+  if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->_value);
   __Pyx_DECREF(__pyx_v___pyx_result->_value);
   __pyx_v___pyx_result->_value = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(1, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
+  if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->domain);
   __Pyx_DECREF(__pyx_v___pyx_result->domain);
   __pyx_v___pyx_result->domain = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -8710,15 +8718,15 @@
   __pyx_v___pyx_result->max_age = __pyx_t_3;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(1, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 6, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
+  if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->path);
   __Pyx_DECREF(__pyx_v___pyx_result->path);
   __pyx_v___pyx_result->path = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -10453,15 +10461,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle___Pyx_EnumMeta, (type(self), 0xd41d8cd, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle___Pyx_EnumMeta__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_unpickle___Pyx_EnumMeta__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle___Pyx_EnumMeta, (type(self), 0xd41d8cd, state)
@@ -11230,15 +11238,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = __Pyx_EnumMeta.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle___Pyx_EnumMeta__set_state(<__Pyx_EnumMeta> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle___Pyx_EnumMeta__set_state(__Pyx_EnumMeta __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_unpickle___Pyx_EnumMeta__set_state(((struct __pyx_obj___Pyx_EnumMeta *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xd41d8cd, 0xe3b0c44, 0xda39a3e) = ())" % __pyx_checksum)
  *     __pyx_result = __Pyx_EnumMeta.__new__(__pyx_type)
@@ -12301,15 +12309,15 @@
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
   __pyx_umethod_PyBytes_Type_index.type = (PyObject*)&PyBytes_Type;
   __pyx_umethod_PyBytes_Type_lower.type = (PyObject*)&PyBytes_Type;
   __pyx_umethod_PyBytes_Type_split.type = (PyObject*)&PyBytes_Type;
   __pyx_umethod_PyBytes_Type_strip.type = (PyObject*)&PyBytes_Type;
-  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_33774141 = PyInt_FromLong(33774141L); if (unlikely(!__pyx_int_33774141)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_205825968 = PyInt_FromLong(205825968L); if (unlikely(!__pyx_int_205825968)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_222419149 = PyInt_FromLong(222419149L); if (unlikely(!__pyx_int_222419149)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_228825662 = PyInt_FromLong(228825662L); if (unlikely(!__pyx_int_228825662)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_238750788 = PyInt_FromLong(238750788L); if (unlikely(!__pyx_int_238750788)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_242485211 = PyInt_FromLong(242485211L); if (unlikely(!__pyx_int_242485211)) __PYX_ERR(0, 1, __pyx_L1_error)
   return 0;
@@ -12431,32 +12439,37 @@
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(4, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyHeapTypeObject),
   #endif
   __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(4, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("datetime"); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_8datetime_date = __Pyx_ImportType(__pyx_t_1, "datetime", "date", sizeof(PyDateTime_Date), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_date = __Pyx_ImportType(__pyx_t_1, "datetime", "date", sizeof(PyDateTime_Date), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_Date),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_date) __PYX_ERR(3, 9, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_time = __Pyx_ImportType(__pyx_t_1, "datetime", "time", sizeof(PyDateTime_Time), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_time = __Pyx_ImportType(__pyx_t_1, "datetime", "time", sizeof(PyDateTime_Time), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_Time),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_time) __PYX_ERR(3, 12, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_datetime = __Pyx_ImportType(__pyx_t_1, "datetime", "datetime", sizeof(PyDateTime_DateTime), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_datetime = __Pyx_ImportType(__pyx_t_1, "datetime", "datetime", sizeof(PyDateTime_DateTime), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_DateTime),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_datetime) __PYX_ERR(3, 15, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_timedelta = __Pyx_ImportType(__pyx_t_1, "datetime", "timedelta", sizeof(PyDateTime_Delta), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_timedelta = __Pyx_ImportType(__pyx_t_1, "datetime", "timedelta", sizeof(PyDateTime_Delta), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_Delta),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_timedelta) __PYX_ERR(3, 18, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_tzinfo = __Pyx_ImportType(__pyx_t_1, "datetime", "tzinfo", sizeof(PyDateTime_TZInfo), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_tzinfo = __Pyx_ImportType(__pyx_t_1, "datetime", "tzinfo", sizeof(PyDateTime_TZInfo), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_TZInfo),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_tzinfo) __PYX_ERR(3, 21, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
@@ -12646,15 +12659,15 @@
   #endif
   __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_d);
   __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_b);
   __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_cython_runtime);
-  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Initialize various global constants etc. ---*/
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   if (__pyx_module_is_main_blacksheep__cookies) {
     if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name_2, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -12994,15 +13007,15 @@
  * 
  * cdef dict __Pyx_globals = globals()             # <<<<<<<<<<<<<<
  * if PY_VERSION_HEX >= 0x03040000:
  * 
  */
   __pyx_t_2 = __Pyx_Globals(); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 50, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (!(likely(PyDict_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "dict", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(1, 50, __pyx_L1_error)
+  if (!(likely(PyDict_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "dict", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(1, 50, __pyx_L1_error)
   __Pyx_XGOTREF(__Pyx_globals);
   __Pyx_DECREF_SET(__Pyx_globals, ((PyObject*)__pyx_t_2));
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
 
   /* "EnumType":51
  * 
@@ -13685,15 +13698,15 @@
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
 #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(func)) {
         return __Pyx_PyFunction_FastCall(func, NULL, 0);
     }
 #endif
-#ifdef __Pyx_CyFunction_USED
+#if defined(__Pyx_CyFunction_USED) && defined(NDEBUG)
     if (likely(PyCFunction_Check(func) || __Pyx_CyFunction_Check(func)))
 #else
     if (likely(PyCFunction_Check(func)))
 #endif
     {
         if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
             return __Pyx_PyObject_CallMethO(func, NULL);
@@ -14231,28 +14244,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -14343,19 +14356,19 @@
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg) {
     if (likely(cfunc->func)) {
         int flag = cfunc->flag;
         if (flag == METH_O) {
             return (*(cfunc->func))(self, arg);
         } else if (PY_VERSION_HEX >= 0x030600B1 && flag == METH_FASTCALL) {
-            if (PY_VERSION_HEX >= 0x030700A0) {
+            #if PY_VERSION_HEX >= 0x030700A0
                 return (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)cfunc->func)(self, &arg, 1);
-            } else {
+            #else
                 return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
-            }
+            #endif
         } else if (PY_VERSION_HEX >= 0x030700A0 && flag == (METH_FASTCALL | METH_KEYWORDS)) {
             return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
         }
     }
     return __Pyx__CallUnboundCMethod1(cfunc, self, arg);
 }
 #endif
@@ -14464,17 +14477,15 @@
     PyObject *old_exc, *old_val, *old_tb;
     PyObject *ctx;
     __Pyx_PyThreadState_declare
 #ifdef WITH_THREAD
     PyGILState_STATE state;
     if (nogil)
         state = PyGILState_Ensure();
-#ifdef _MSC_VER
-    else state = (PyGILState_STATE)-1;
-#endif
+    else state = (PyGILState_STATE)0;
 #endif
     __Pyx_PyThreadState_assign
     __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
     if (full_traceback) {
         Py_XINCREF(old_exc);
         Py_XINCREF(old_val);
         Py_XINCREF(old_tb);
@@ -14947,15 +14958,15 @@
         return 1;
     }
 }
 
 /* ObjectGetItem */
 #if CYTHON_USE_TYPE_SLOTS
 static PyObject *__Pyx_PyObject_GetIndex(PyObject *obj, PyObject* index) {
-    PyObject *runerr;
+    PyObject *runerr = NULL;
     Py_ssize_t key_value;
     PySequenceMethods *m = Py_TYPE(obj)->tp_as_sequence;
     if (unlikely(!(m && m->sq_item))) {
         PyErr_Format(PyExc_TypeError, "'%.200s' object is not subscriptable", Py_TYPE(obj)->tp_name);
         return NULL;
     }
     key_value = __Pyx_PyIndex_AsSsize_t(index);
@@ -15171,44 +15182,62 @@
     return ret;
 }
 
 /* TypeImport */
 #ifndef __PYX_HAVE_RT_ImportType
 #define __PYX_HAVE_RT_ImportType
 static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, enum __Pyx_ImportType_CheckSize check_size)
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
+    Py_ssize_t itemsize;
 #ifdef Py_LIMITED_API
     PyObject *py_basicsize;
+    PyObject *py_itemsize;
 #endif
     result = PyObject_GetAttrString(module, class_name);
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
         PyErr_Format(PyExc_TypeError,
             "%.200s.%.200s is not a type object",
             module_name, class_name);
         goto bad;
     }
 #ifndef Py_LIMITED_API
     basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
 #else
     py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
     if (!py_basicsize)
         goto bad;
     basicsize = PyLong_AsSsize_t(py_basicsize);
     Py_DECREF(py_basicsize);
     py_basicsize = 0;
     if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
         goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
 #endif
-    if ((size_t)basicsize < size) {
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
     if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
@@ -15803,17 +15832,22 @@
         argc = PyTuple_GET_SIZE(args);
         new_args = PyTuple_GetSlice(args, 1, argc);
         if (unlikely(!new_args))
             return NULL;
         self = PyTuple_GetItem(args, 0);
         if (unlikely(!self)) {
             Py_DECREF(new_args);
+#if PY_MAJOR_VERSION > 2
             PyErr_Format(PyExc_TypeError,
                          "unbound method %.200S() needs an argument",
                          cyfunc->func_qualname);
+#else
+            PyErr_SetString(PyExc_TypeError,
+                            "unbound method needs an argument");
+#endif
             return NULL;
         }
         result = __Pyx_CyFunction_CallMethod(func, self, new_args, kw);
         Py_DECREF(new_args);
     } else {
         result = __Pyx_CyFunction_Call(func, args, kw);
     }
@@ -16044,15 +16078,15 @@
     Py_XDECREF(names);
     Py_XDECREF(globals);
     return NULL;
 }
 
 /* CLineInTraceback */
 #ifndef CYTHON_CLINE_IN_TRACEBACK
-static int __Pyx_CLineForTraceback(CYTHON_NCP_UNUSED PyThreadState *tstate, int c_line) {
+static int __Pyx_CLineForTraceback(CYTHON_UNUSED PyThreadState *tstate, int c_line) {
     PyObject *use_cline;
     PyObject *ptype, *pvalue, *ptraceback;
 #if CYTHON_COMPILING_IN_CPYTHON
     PyObject **cython_runtime_dict;
 #endif
     if (unlikely(!__pyx_cython_runtime)) {
         return c_line;
```

### Comparing `blacksheep-2.0a5/blacksheep/cookies.pxd` & `blacksheep-2.0a6/blacksheep/cookies.pxd`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/cookies.pyi` & `blacksheep-2.0a6/blacksheep/cookies.pyi`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/cookies.pyx` & `blacksheep-2.0a6/blacksheep/cookies.pyx`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/exceptions.c` & `blacksheep-2.0a6/blacksheep/exceptions.c`

 * *Files 0% similar despite different names*

```diff
@@ -1,20 +1,20 @@
-/* Generated by Cython 0.29.32 */
+/* Generated by Cython 0.29.34 */
 
 #ifndef PY_SSIZE_T_CLEAN
 #define PY_SSIZE_T_CLEAN
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_32"
-#define CYTHON_HEX_VERSION 0x001D20F0
+#define CYTHON_ABI "0_29_34"
+#define CYTHON_HEX_VERSION 0x001D22F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -83,15 +83,15 @@
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
-    #define CYTHON_UPDATE_DESCRIPTOR_DOC (PYPY_VERSION_HEX >= 0x07030900)
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
 #elif defined(PYSTON_VERSION)
   #define CYTHON_COMPILING_IN_PYPY 0
   #define CYTHON_COMPILING_IN_PYSTON 1
   #define CYTHON_COMPILING_IN_CPYTHON 0
   #define CYTHON_COMPILING_IN_NOGIL 0
   #ifndef CYTHON_USE_TYPE_SLOTS
@@ -199,15 +199,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -238,15 +238,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -548,35 +548,35 @@
 #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && CYTHON_USE_UNICODE_INTERNALS
 #define __Pyx_PyDict_GetItemStr(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
 #else
 #define __Pyx_PyDict_GetItemStr(dict, name)  PyDict_GetItem(dict, name)
 #endif
 #if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
   #define CYTHON_PEP393_ENABLED 1
-  #if defined(PyUnicode_IS_READY)
-  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
-                                              0 : _PyUnicode_Ready((PyObject *)(op)))
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_READY(op)       (0)
   #else
-  #define __Pyx_PyUnicode_READY(op)       (0)
+    #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
+                                                0 : _PyUnicode_Ready((PyObject *)(op)))
   #endif
   #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
   #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
   #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
   #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
   #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
   #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
   #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, ch)
-  #if defined(PyUnicode_IS_READY) && defined(PyUnicode_GET_SIZE)
-  #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
-  #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
-  #endif
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
   #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
+    #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
+    #else
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
+    #endif
   #endif
 #else
   #define CYTHON_PEP393_ENABLED 0
   #define PyUnicode_1BYTE_KIND  1
   #define PyUnicode_2BYTE_KIND  2
   #define PyUnicode_4BYTE_KIND  4
   #define __Pyx_PyUnicode_READY(op)       (0)
@@ -946,17 +946,17 @@
 static int __pyx_lineno;
 static int __pyx_clineno = 0;
 static const char * __pyx_cfilenm= __FILE__;
 static const char *__pyx_filename;
 
 
 static const char *__pyx_f[] = {
-  "blacksheep/exceptions.pyx",
+  "blacksheep\\exceptions.pyx",
   "stringsource",
-  "blacksheep/exceptions.pxd",
+  "blacksheep\\exceptions.pxd",
 };
 
 /*--- Type declarations ---*/
 struct __pyx_obj_10blacksheep_10exceptions_MessageAborted;
 struct __pyx_obj_10blacksheep_10exceptions_HTTPException;
 struct __pyx_obj_10blacksheep_10exceptions_BadRequest;
 struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat;
@@ -1345,26 +1345,26 @@
 #define __PYX_GET_DICT_VERSION(dict)  (0)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
 #define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
 #endif
 
 /* GetModuleGlobalName.proto */
 #if CYTHON_USE_DICT_VERSIONS
-#define __Pyx_GetModuleGlobalName(var, name)  {\
+#define __Pyx_GetModuleGlobalName(var, name)  do {\
     static PY_UINT64_T __pyx_dict_version = 0;\
     static PyObject *__pyx_dict_cached_value = NULL;\
     (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
         (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
         __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  {\
+} while(0)
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  do {\
     PY_UINT64_T __pyx_dict_version;\
     PyObject *__pyx_dict_cached_value;\
     (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
+} while(0)
 static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
 #else
 #define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 #define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
 #endif
 
@@ -2183,15 +2183,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_InvalidOperation, (type(self), 0xd41d8cd, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_InvalidOperation__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_InvalidOperation__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_InvalidOperation, (type(self), 0xd41d8cd, state)
@@ -2720,15 +2720,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_HTTPException, (type(self), 0x9acb445, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_HTTPException__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_HTTPException__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_HTTPException, (type(self), 0x9acb445, state)
@@ -3200,15 +3200,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_BadRequest, (type(self), 0x9acb445, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_BadRequest__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_BadRequest__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_BadRequest, (type(self), 0x9acb445, state)
@@ -3758,15 +3758,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_BadRequestFormat, (type(self), 0xe127518, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_BadRequestFormat__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_BadRequestFormat__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_BadRequestFormat, (type(self), 0xe127518, state)
@@ -4238,15 +4238,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_NotFound, (type(self), 0x9acb445, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_NotFound__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_NotFound__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_NotFound, (type(self), 0x9acb445, state)
@@ -4718,15 +4718,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_Unauthorized, (type(self), 0x9acb445, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_Unauthorized__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_Unauthorized__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_Unauthorized, (type(self), 0x9acb445, state)
@@ -5198,15 +5198,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_Forbidden, (type(self), 0x9acb445, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_Forbidden__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_Forbidden__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_Forbidden, (type(self), 0x9acb445, state)
@@ -5573,15 +5573,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_RangeNotSatisfiable, (type(self), 0x9acb445, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_RangeNotSatisfiable__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_RangeNotSatisfiable__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_RangeNotSatisfiable, (type(self), 0x9acb445, state)
@@ -5948,15 +5948,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_InternalServerError, (type(self), 0x9acb445, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_InternalServerError__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_InternalServerError__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_InternalServerError, (type(self), 0x9acb445, state)
@@ -6323,15 +6323,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_NotImplementedByServer, (type(self), 0x9acb445, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_NotImplementedByServer__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_NotImplementedByServer__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_NotImplementedByServer, (type(self), 0x9acb445, state)
@@ -6747,15 +6747,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_InvalidArgument, (type(self), 0xd41d8cd, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_InvalidArgument__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_InvalidArgument__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_InvalidArgument, (type(self), 0xd41d8cd, state)
@@ -7129,15 +7129,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_MessageAborted, (type(self), 0xd41d8cd, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_MessageAborted__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_MessageAborted__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_MessageAborted, (type(self), 0xd41d8cd, state)
@@ -7375,15 +7375,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = InvalidOperation.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_InvalidOperation__set_state(<InvalidOperation> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_InvalidOperation__set_state(InvalidOperation __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_InvalidOperation__set_state(((struct __pyx_obj_10blacksheep_10exceptions_InvalidOperation *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xd41d8cd, 0xe3b0c44, 0xda39a3e) = ())" % __pyx_checksum)
  *     __pyx_result = InvalidOperation.__new__(__pyx_type)
@@ -7757,15 +7757,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = HTTPException.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_HTTPException__set_state(<HTTPException> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_HTTPException__set_state(HTTPException __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_HTTPException__set_state(((struct __pyx_obj_10blacksheep_10exceptions_HTTPException *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x9acb445, 0x073c163, 0x48a3661) = (status))" % __pyx_checksum)
  *     __pyx_result = HTTPException.__new__(__pyx_type)
@@ -8157,15 +8157,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = BadRequest.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_BadRequest__set_state(<BadRequest> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_BadRequest__set_state(BadRequest __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_BadRequest__set_state(((struct __pyx_obj_10blacksheep_10exceptions_BadRequest *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x9acb445, 0x073c163, 0x48a3661) = (status))" % __pyx_checksum)
  *     __pyx_result = BadRequest.__new__(__pyx_type)
@@ -8557,15 +8557,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = BadRequestFormat.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_BadRequestFormat__set_state(<BadRequestFormat> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_BadRequestFormat__set_state(BadRequestFormat __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_BadRequestFormat__set_state(((struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xe127518, 0x819e913, 0x7ef201e) = (inner_exception, status))" % __pyx_checksum)
  *     __pyx_result = BadRequestFormat.__new__(__pyx_type)
@@ -8968,15 +8968,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = NotFound.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_NotFound__set_state(<NotFound> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_NotFound__set_state(NotFound __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_NotFound__set_state(((struct __pyx_obj_10blacksheep_10exceptions_NotFound *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x9acb445, 0x073c163, 0x48a3661) = (status))" % __pyx_checksum)
  *     __pyx_result = NotFound.__new__(__pyx_type)
@@ -9368,15 +9368,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = Unauthorized.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Unauthorized__set_state(<Unauthorized> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_Unauthorized__set_state(Unauthorized __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_Unauthorized__set_state(((struct __pyx_obj_10blacksheep_10exceptions_Unauthorized *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x9acb445, 0x073c163, 0x48a3661) = (status))" % __pyx_checksum)
  *     __pyx_result = Unauthorized.__new__(__pyx_type)
@@ -9768,15 +9768,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = Forbidden.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Forbidden__set_state(<Forbidden> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_Forbidden__set_state(Forbidden __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_Forbidden__set_state(((struct __pyx_obj_10blacksheep_10exceptions_Forbidden *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x9acb445, 0x073c163, 0x48a3661) = (status))" % __pyx_checksum)
  *     __pyx_result = Forbidden.__new__(__pyx_type)
@@ -10168,15 +10168,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = RangeNotSatisfiable.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_RangeNotSatisfiable__set_state(<RangeNotSatisfiable> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_RangeNotSatisfiable__set_state(RangeNotSatisfiable __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_RangeNotSatisfiable__set_state(((struct __pyx_obj_10blacksheep_10exceptions_RangeNotSatisfiable *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x9acb445, 0x073c163, 0x48a3661) = (status))" % __pyx_checksum)
  *     __pyx_result = RangeNotSatisfiable.__new__(__pyx_type)
@@ -10568,15 +10568,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = InternalServerError.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_InternalServerError__set_state(<InternalServerError> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_InternalServerError__set_state(InternalServerError __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_InternalServerError__set_state(((struct __pyx_obj_10blacksheep_10exceptions_InternalServerError *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x9acb445, 0x073c163, 0x48a3661) = (status))" % __pyx_checksum)
  *     __pyx_result = InternalServerError.__new__(__pyx_type)
@@ -10968,15 +10968,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = NotImplementedByServer.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_NotImplementedByServer__set_state(<NotImplementedByServer> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_NotImplementedByServer__set_state(NotImplementedByServer __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_NotImplementedByServer__set_state(((struct __pyx_obj_10blacksheep_10exceptions_NotImplementedByServer *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x9acb445, 0x073c163, 0x48a3661) = (status))" % __pyx_checksum)
  *     __pyx_result = NotImplementedByServer.__new__(__pyx_type)
@@ -11368,15 +11368,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = InvalidArgument.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_InvalidArgument__set_state(<InvalidArgument> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_InvalidArgument__set_state(InvalidArgument __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_InvalidArgument__set_state(((struct __pyx_obj_10blacksheep_10exceptions_InvalidArgument *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xd41d8cd, 0xe3b0c44, 0xda39a3e) = ())" % __pyx_checksum)
  *     __pyx_result = InvalidArgument.__new__(__pyx_type)
@@ -11750,15 +11750,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = MessageAborted.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_MessageAborted__set_state(<MessageAborted> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_MessageAborted__set_state(MessageAborted __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_10exceptions___pyx_unpickle_MessageAborted__set_state(((struct __pyx_obj_10blacksheep_10exceptions_MessageAborted *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xd41d8cd, 0xe3b0c44, 0xda39a3e) = ())" % __pyx_checksum)
  *     __pyx_result = MessageAborted.__new__(__pyx_type)
@@ -13314,15 +13314,15 @@
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
-  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 2, __pyx_L1_error);
+  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   __pyx_int_400 = PyInt_FromLong(400); if (unlikely(!__pyx_int_400)) __PYX_ERR(0, 2, __pyx_L1_error)
   __pyx_int_401 = PyInt_FromLong(401); if (unlikely(!__pyx_int_401)) __PYX_ERR(0, 2, __pyx_L1_error)
   __pyx_int_403 = PyInt_FromLong(403); if (unlikely(!__pyx_int_403)) __PYX_ERR(0, 2, __pyx_L1_error)
   __pyx_int_404 = PyInt_FromLong(404); if (unlikely(!__pyx_int_404)) __PYX_ERR(0, 2, __pyx_L1_error)
   __pyx_int_416 = PyInt_FromLong(416); if (unlikely(!__pyx_int_416)) __PYX_ERR(0, 2, __pyx_L1_error)
   __pyx_int_500 = PyInt_FromLong(500); if (unlikely(!__pyx_int_500)) __PYX_ERR(0, 2, __pyx_L1_error)
   __pyx_int_501 = PyInt_FromLong(501); if (unlikely(!__pyx_int_501)) __PYX_ERR(0, 2, __pyx_L1_error)
@@ -13704,15 +13704,15 @@
   #endif
   __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 2, __pyx_L1_error)
   Py_INCREF(__pyx_d);
   __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 2, __pyx_L1_error)
   Py_INCREF(__pyx_b);
   __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 2, __pyx_L1_error)
   Py_INCREF(__pyx_cython_runtime);
-  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 2, __pyx_L1_error);
+  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   /*--- Initialize various global constants etc. ---*/
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   #endif
   if (__pyx_module_is_main_blacksheep__exceptions) {
     if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name, __pyx_n_s_main) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
@@ -14773,28 +14773,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -15078,15 +15078,15 @@
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 
 /* CLineInTraceback */
 #ifndef CYTHON_CLINE_IN_TRACEBACK
-static int __Pyx_CLineForTraceback(CYTHON_NCP_UNUSED PyThreadState *tstate, int c_line) {
+static int __Pyx_CLineForTraceback(CYTHON_UNUSED PyThreadState *tstate, int c_line) {
     PyObject *use_cline;
     PyObject *ptype, *pvalue, *ptraceback;
 #if CYTHON_COMPILING_IN_CPYTHON
     PyObject **cython_runtime_dict;
 #endif
     if (unlikely(!__pyx_cython_runtime)) {
         return c_line;
```

### Comparing `blacksheep-2.0a5/blacksheep/exceptions.pyi` & `blacksheep-2.0a6/blacksheep/exceptions.pyi`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/exceptions.pyx` & `blacksheep-2.0a6/blacksheep/exceptions.pyx`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/headers.c` & `blacksheep-2.0a6/blacksheep/headers.c`

 * *Files 0% similar despite different names*

```diff
@@ -1,20 +1,20 @@
-/* Generated by Cython 0.29.32 */
+/* Generated by Cython 0.29.34 */
 
 #ifndef PY_SSIZE_T_CLEAN
 #define PY_SSIZE_T_CLEAN
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_32"
-#define CYTHON_HEX_VERSION 0x001D20F0
+#define CYTHON_ABI "0_29_34"
+#define CYTHON_HEX_VERSION 0x001D22F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -83,15 +83,15 @@
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
-    #define CYTHON_UPDATE_DESCRIPTOR_DOC (PYPY_VERSION_HEX >= 0x07030900)
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
 #elif defined(PYSTON_VERSION)
   #define CYTHON_COMPILING_IN_PYPY 0
   #define CYTHON_COMPILING_IN_PYSTON 1
   #define CYTHON_COMPILING_IN_CPYTHON 0
   #define CYTHON_COMPILING_IN_NOGIL 0
   #ifndef CYTHON_USE_TYPE_SLOTS
@@ -199,15 +199,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -238,15 +238,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -548,35 +548,35 @@
 #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && CYTHON_USE_UNICODE_INTERNALS
 #define __Pyx_PyDict_GetItemStr(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
 #else
 #define __Pyx_PyDict_GetItemStr(dict, name)  PyDict_GetItem(dict, name)
 #endif
 #if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
   #define CYTHON_PEP393_ENABLED 1
-  #if defined(PyUnicode_IS_READY)
-  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
-                                              0 : _PyUnicode_Ready((PyObject *)(op)))
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_READY(op)       (0)
   #else
-  #define __Pyx_PyUnicode_READY(op)       (0)
+    #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
+                                                0 : _PyUnicode_Ready((PyObject *)(op)))
   #endif
   #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
   #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
   #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
   #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
   #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
   #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
   #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, ch)
-  #if defined(PyUnicode_IS_READY) && defined(PyUnicode_GET_SIZE)
-  #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
-  #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
-  #endif
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
   #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
+    #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
+    #else
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
+    #endif
   #endif
 #else
   #define CYTHON_PEP393_ENABLED 0
   #define PyUnicode_1BYTE_KIND  1
   #define PyUnicode_2BYTE_KIND  2
   #define PyUnicode_4BYTE_KIND  4
   #define __Pyx_PyUnicode_READY(op)       (0)
@@ -946,15 +946,15 @@
 static int __pyx_lineno;
 static int __pyx_clineno = 0;
 static const char * __pyx_cfilenm= __FILE__;
 static const char *__pyx_filename;
 
 
 static const char *__pyx_f[] = {
-  "blacksheep/headers.pyx",
+  "blacksheep\\headers.pyx",
   "stringsource",
 };
 
 /*--- Type declarations ---*/
 struct __pyx_obj_10blacksheep_7headers_Header;
 struct __pyx_obj_10blacksheep_7headers_Headers;
 struct __pyx_obj_10blacksheep_7headers___pyx_scope_struct____iter__;
@@ -1307,26 +1307,26 @@
 #define __PYX_GET_DICT_VERSION(dict)  (0)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
 #define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
 #endif
 
 /* GetModuleGlobalName.proto */
 #if CYTHON_USE_DICT_VERSIONS
-#define __Pyx_GetModuleGlobalName(var, name)  {\
+#define __Pyx_GetModuleGlobalName(var, name)  do {\
     static PY_UINT64_T __pyx_dict_version = 0;\
     static PyObject *__pyx_dict_cached_value = NULL;\
     (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
         (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
         __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  {\
+} while(0)
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  do {\
     PY_UINT64_T __pyx_dict_version;\
     PyObject *__pyx_dict_cached_value;\
     (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
+} while(0)
 static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
 #else
 #define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 #define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
 #endif
 
@@ -1764,15 +1764,15 @@
 static const char __pyx_k_collections_abc[] = "collections.abc";
 static const char __pyx_k_pyx_PickleError[] = "__pyx_PickleError";
 static const char __pyx_k_setstate_cython[] = "__setstate_cython__";
 static const char __pyx_k_blacksheep_headers[] = "blacksheep.headers";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
 static const char __pyx_k_pyx_unpickle_Header[] = "__pyx_unpickle_Header";
 static const char __pyx_k_pyx_unpickle_Headers[] = "__pyx_unpickle_Headers";
-static const char __pyx_k_blacksheep_headers_pyx[] = "blacksheep/headers.pyx";
+static const char __pyx_k_blacksheep_headers_pyx[] = "blacksheep\\headers.pyx";
 static const char __pyx_k_Cannot_add_an_invalid_tuple[] = "Cannot add, an invalid tuple ";
 static const char __pyx_k_values_must_be_Dict_bytes_bytes[] = "values must be Dict[bytes, bytes] or List[Header]";
 static const char __pyx_k_Headers_contains_more_than_one_h[] = "Headers contains more than one header with the given key";
 static const char __pyx_k_Headers_does_not_contain_one_hea[] = "Headers does not contain one header with the given key";
 static const char __pyx_k_Incompatible_checksums_0x_x_vs_0[] = "Incompatible checksums (0x%x vs (0xfa7a105, 0xaaf55bf, 0xe891e3f) = (name, value))";
 static const char __pyx_k_The_sequence_contains_invalid_el[] = "The sequence contains invalid elements: cannot add ";
 static const char __pyx_k_Incompatible_checksums_0x_x_vs_0_2[] = "Incompatible checksums (0x%x vs (0xf09cc7e, 0x89445ea, 0x048b0cb) = (values))";
@@ -2792,15 +2792,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_Header, (type(self), 0xfa7a105, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_Header__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_7headers___pyx_unpickle_Header__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_Header, (type(self), 0xfa7a105, state)
@@ -3022,15 +3022,15 @@
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_name) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_name);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
         if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 31, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 31, __pyx_L1_error)
+        if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 31, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -3062,15 +3062,15 @@
  *         cdef tuple header
  *         name = name.lower()             # <<<<<<<<<<<<<<
  *         for header in self.values:
  *             if header[0].lower() == name:
  */
   __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 34, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 34, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 34, __pyx_L1_error)
   __Pyx_DECREF_SET(__pyx_v_name, ((PyObject*)__pyx_t_1));
   __pyx_t_1 = 0;
 
   /* "blacksheep/headers.pyx":35
  *         cdef tuple header
  *         name = name.lower()
  *         for header in self.values:             # <<<<<<<<<<<<<<
@@ -3086,15 +3086,15 @@
     if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 35, __pyx_L1_error)
     #else
     __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 35, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
-    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 35, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 35, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_header, ((PyObject*)__pyx_t_2));
     __pyx_t_2 = 0;
 
     /* "blacksheep/headers.pyx":36
  *         name = name.lower()
  *         for header in self.values:
  *             if header[0].lower() == name:             # <<<<<<<<<<<<<<
@@ -3301,15 +3301,15 @@
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_name) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_name);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
         if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 40, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyList_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 40, __pyx_L1_error)
+        if (!(likely(PyList_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 40, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -3341,15 +3341,15 @@
  *         cdef tuple header
  *         name = name.lower()             # <<<<<<<<<<<<<<
  *         for header in self.values:
  *             if header[0].lower() == name:
  */
   __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 43, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF_SET(__pyx_v_name, ((PyObject*)__pyx_t_1));
   __pyx_t_1 = 0;
 
   /* "blacksheep/headers.pyx":44
  *         cdef tuple header
  *         name = name.lower()
  *         for header in self.values:             # <<<<<<<<<<<<<<
@@ -3365,15 +3365,15 @@
     if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 44, __pyx_L1_error)
     #else
     __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 44, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
-    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 44, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 44, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_header, ((PyObject*)__pyx_t_2));
     __pyx_t_2 = 0;
 
     /* "blacksheep/headers.pyx":45
  *         name = name.lower()
  *         for header in self.values:
  *             if header[0].lower() == name:             # <<<<<<<<<<<<<<
@@ -3569,15 +3569,15 @@
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_key) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_key);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
         if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 49, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 49, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 49, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -3597,15 +3597,15 @@
  *         cdef tuple header
  *         key = key.lower()             # <<<<<<<<<<<<<<
  *         for header in self.values:
  *             if header[0].lower() == key:
  */
   __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 51, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_DECREF_SET(__pyx_v_key, ((PyObject*)__pyx_t_1));
   __pyx_t_1 = 0;
 
   /* "blacksheep/headers.pyx":52
  *         cdef tuple header
  *         key = key.lower()
  *         for header in self.values:             # <<<<<<<<<<<<<<
@@ -3621,15 +3621,15 @@
     if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 52, __pyx_L1_error)
     #else
     __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 52, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
-    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 52, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 52, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_header, ((PyObject*)__pyx_t_2));
     __pyx_t_2 = 0;
 
     /* "blacksheep/headers.pyx":53
  *         key = key.lower()
  *         for header in self.values:
  *             if header[0].lower() == key:             # <<<<<<<<<<<<<<
@@ -3674,15 +3674,15 @@
       __Pyx_XDECREF(__pyx_r);
       if (unlikely(__pyx_v_header == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
         __PYX_ERR(0, 54, __pyx_L1_error)
       }
       __pyx_t_2 = __Pyx_GetItemInt_Tuple(__pyx_v_header, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 54, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 54, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 54, __pyx_L1_error)
       __pyx_r = ((PyObject*)__pyx_t_2);
       __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       goto __pyx_L0;
 
       /* "blacksheep/headers.pyx":53
  *         key = key.lower()
@@ -3824,15 +3824,15 @@
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_key) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_key);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
         if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 56, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 56, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 56, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -3943,15 +3943,15 @@
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(__pyx_v_results == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(0, 62, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v_results, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 62, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 62, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 62, __pyx_L1_error)
   __pyx_r = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* "blacksheep/headers.pyx":56
  *                 return header[1]
  * 
@@ -4107,15 +4107,15 @@
     if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 66, __pyx_L1_error)
     #else
     __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 66, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
-    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 66, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 66, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_header, ((PyObject*)__pyx_t_2));
     __pyx_t_2 = 0;
 
     /* "blacksheep/headers.pyx":67
  *         cdef tuple header
  *         for header in values:
  *             if header is None:             # <<<<<<<<<<<<<<
@@ -4623,16 +4623,16 @@
       __pyx_L5_unpacking_failed:;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_7 = NULL;
       if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
       __PYX_ERR(0, 81, __pyx_L1_error)
       __pyx_L6_unpacking_done:;
     }
-    if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 81, __pyx_L1_error)
-    if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 81, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 81, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 81, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_name, ((PyObject*)__pyx_t_3));
     __pyx_t_3 = 0;
     __Pyx_XDECREF_SET(__pyx_v_value, ((PyObject*)__pyx_t_4));
     __pyx_t_4 = 0;
 
     /* "blacksheep/headers.pyx":82
  *         cdef bytes name, value
@@ -4939,16 +4939,16 @@
       /* "blacksheep/headers.pyx":93
  *         if isinstance(values, Mapping):
  *             for key, value in values.items():
  *                 self.add(key, value)             # <<<<<<<<<<<<<<
  *             return
  *         raise ValueError('values must be Dict[bytes, bytes] or List[Header]')
  */
-      if (!(likely(PyBytes_CheckExact(__pyx_v_key))||((__pyx_v_key) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_v_key)->tp_name), 0))) __PYX_ERR(0, 93, __pyx_L1_error)
-      if (!(likely(PyBytes_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(0, 93, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_v_key))||((__pyx_v_key) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_v_key)->tp_name), 0))) __PYX_ERR(0, 93, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(0, 93, __pyx_L1_error)
       ((struct __pyx_vtabstruct_10blacksheep_7headers_Headers *)__pyx_v_self->__pyx_vtab)->add(__pyx_v_self, ((PyObject*)__pyx_v_key), ((PyObject*)__pyx_v_value), 0);
     }
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
     /* "blacksheep/headers.pyx":94
  *             for key, value in values.items():
  *                 self.add(key, value)
@@ -6341,15 +6341,15 @@
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
         if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 145, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 145, __pyx_L1_error)
+        if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 145, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -6438,16 +6438,16 @@
       __pyx_L5_unpacking_failed:;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_7 = NULL;
       if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
       __PYX_ERR(0, 149, __pyx_L1_error)
       __pyx_L6_unpacking_done:;
     }
-    if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 149, __pyx_L1_error)
-    if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 149, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 149, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 149, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_name, ((PyObject*)__pyx_t_3));
     __pyx_t_3 = 0;
     __Pyx_XDECREF_SET(__pyx_v_value, ((PyObject*)__pyx_t_4));
     __pyx_t_4 = 0;
 
     /* "blacksheep/headers.pyx":150
  * 
@@ -7141,15 +7141,15 @@
  *         cdef list to_remove = []
  *         key = key.lower()             # <<<<<<<<<<<<<<
  * 
  *         for item in self.values:
  */
   __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 165, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_DECREF_SET(__pyx_v_key, ((PyObject*)__pyx_t_1));
   __pyx_t_1 = 0;
 
   /* "blacksheep/headers.pyx":167
  *         key = key.lower()
  * 
  *         for item in self.values:             # <<<<<<<<<<<<<<
@@ -7165,15 +7165,15 @@
     if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 167, __pyx_L1_error)
     #else
     __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 167, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
-    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 167, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 167, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_item, ((PyObject*)__pyx_t_2));
     __pyx_t_2 = 0;
 
     /* "blacksheep/headers.pyx":168
  * 
  *         for item in self.values:
  *             if item[0].lower() == key:             # <<<<<<<<<<<<<<
@@ -7248,15 +7248,15 @@
     if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 171, __pyx_L1_error)
     #else
     __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 171, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
-    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 171, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 171, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_item, ((PyObject*)__pyx_t_2));
     __pyx_t_2 = 0;
 
     /* "blacksheep/headers.pyx":172
  * 
  *         for item in to_remove:
  *             self.values.remove(item)             # <<<<<<<<<<<<<<
@@ -7441,15 +7441,15 @@
  *         cdef bytes name, value
  *         key = key.lower()             # <<<<<<<<<<<<<<
  * 
  *         for name, value in self.values:
  */
   __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 176, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 176, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 176, __pyx_L1_error)
   __Pyx_DECREF_SET(__pyx_v_key, ((PyObject*)__pyx_t_1));
   __pyx_t_1 = 0;
 
   /* "blacksheep/headers.pyx":178
  *         key = key.lower()
  * 
  *         for name, value in self.values:             # <<<<<<<<<<<<<<
@@ -7511,16 +7511,16 @@
       __pyx_L5_unpacking_failed:;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __pyx_t_8 = NULL;
       if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
       __PYX_ERR(0, 178, __pyx_L1_error)
       __pyx_L6_unpacking_done:;
     }
-    if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 178, __pyx_L1_error)
-    if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 178, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 178, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 178, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_name, ((PyObject*)__pyx_t_3));
     __pyx_t_3 = 0;
     __Pyx_XDECREF_SET(__pyx_v_value, ((PyObject*)__pyx_t_4));
     __pyx_t_4 = 0;
 
     /* "blacksheep/headers.pyx":179
  * 
@@ -8146,15 +8146,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_Headers, (type(self), 0xf09cc7e, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_Headers__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_7headers___pyx_unpickle_Headers__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_Headers, (type(self), 0xf09cc7e, state)
@@ -8392,15 +8392,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = Header.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Header__set_state(<Header> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_Header__set_state(Header __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_7headers___pyx_unpickle_Header__set_state(((struct __pyx_obj_10blacksheep_7headers_Header *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xfa7a105, 0xaaf55bf, 0xe891e3f) = (name, value))" % __pyx_checksum)
  *     __pyx_result = Header.__new__(__pyx_type)
@@ -8477,27 +8477,27 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(1, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->name);
   __Pyx_DECREF(__pyx_v___pyx_result->name);
   __pyx_v___pyx_result->name = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(1, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->value);
   __Pyx_DECREF(__pyx_v___pyx_result->value);
   __pyx_v___pyx_result->value = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":13
@@ -8806,15 +8806,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = Headers.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Headers__set_state(<Headers> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_Headers__set_state(Headers __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_7headers___pyx_unpickle_Headers__set_state(((struct __pyx_obj_10blacksheep_7headers_Headers *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xf09cc7e, 0x89445ea, 0x048b0cb) = (values))" % __pyx_checksum)
  *     __pyx_result = Headers.__new__(__pyx_type)
@@ -8891,15 +8891,15 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(1, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
+  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->values);
   __Pyx_DECREF(__pyx_v___pyx_result->values);
   __pyx_v___pyx_result->values = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":13
@@ -9924,15 +9924,15 @@
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
   __pyx_umethod_PyBytes_Type_lower.type = (PyObject*)&PyBytes_Type;
-  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_4763851 = PyInt_FromLong(4763851L); if (unlikely(!__pyx_int_4763851)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_143934954 = PyInt_FromLong(143934954L); if (unlikely(!__pyx_int_143934954)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_179262911 = PyInt_FromLong(179262911L); if (unlikely(!__pyx_int_179262911)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_243867199 = PyInt_FromLong(243867199L); if (unlikely(!__pyx_int_243867199)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_252300414 = PyInt_FromLong(252300414L); if (unlikely(!__pyx_int_252300414)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_262643973 = PyInt_FromLong(262643973L); if (unlikely(!__pyx_int_262643973)) __PYX_ERR(0, 1, __pyx_L1_error)
   return 0;
@@ -10230,15 +10230,15 @@
   #endif
   __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_d);
   __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_b);
   __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_cython_runtime);
-  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Initialize various global constants etc. ---*/
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   if (__pyx_module_is_main_blacksheep__headers) {
     if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name_2, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -10855,15 +10855,15 @@
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
 #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(func)) {
         return __Pyx_PyFunction_FastCall(func, NULL, 0);
     }
 #endif
-#ifdef __Pyx_CyFunction_USED
+#if defined(__Pyx_CyFunction_USED) && defined(NDEBUG)
     if (likely(PyCFunction_Check(func) || __Pyx_CyFunction_Check(func)))
 #else
     if (likely(PyCFunction_Check(func)))
 #endif
     {
         if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
             return __Pyx_PyObject_CallMethO(func, NULL);
@@ -11409,28 +11409,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -11442,17 +11442,15 @@
     PyObject *old_exc, *old_val, *old_tb;
     PyObject *ctx;
     __Pyx_PyThreadState_declare
 #ifdef WITH_THREAD
     PyGILState_STATE state;
     if (nogil)
         state = PyGILState_Ensure();
-#ifdef _MSC_VER
-    else state = (PyGILState_STATE)-1;
-#endif
+    else state = (PyGILState_STATE)0;
 #endif
     __Pyx_PyThreadState_assign
     __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
     if (full_traceback) {
         Py_XINCREF(old_exc);
         Py_XINCREF(old_val);
         Py_XINCREF(old_tb);
@@ -11639,18 +11637,16 @@
 
 /* UnpackItemEndCheck */
 static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected) {
     if (unlikely(retval)) {
         Py_DECREF(retval);
         __Pyx_RaiseTooManyValuesError(expected);
         return -1;
-    } else {
-        return __Pyx_IterFinish();
     }
-    return 0;
+    return __Pyx_IterFinish();
 }
 
 /* RaiseNoneIterError */
 static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
 }
 
@@ -13341,15 +13337,15 @@
         result = __Pyx_GetGlobalNameAfterAttributeLookup(name);
     }
     return result;
 }
 
 /* CLineInTraceback */
 #ifndef CYTHON_CLINE_IN_TRACEBACK
-static int __Pyx_CLineForTraceback(CYTHON_NCP_UNUSED PyThreadState *tstate, int c_line) {
+static int __Pyx_CLineForTraceback(CYTHON_UNUSED PyThreadState *tstate, int c_line) {
     PyObject *use_cline;
     PyObject *ptype, *pvalue, *ptraceback;
 #if CYTHON_COMPILING_IN_CPYTHON
     PyObject **cython_runtime_dict;
 #endif
     if (unlikely(!__pyx_cython_runtime)) {
         return c_line;
```

### Comparing `blacksheep-2.0a5/blacksheep/headers.pxd` & `blacksheep-2.0a6/blacksheep/headers.pxd`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/headers.pyi` & `blacksheep-2.0a6/blacksheep/headers.pyi`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/headers.pyx` & `blacksheep-2.0a6/blacksheep/headers.pyx`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/messages.c` & `blacksheep-2.0a6/blacksheep/messages.c`

 * *Files 0% similar despite different names*

```diff
@@ -1,20 +1,20 @@
-/* Generated by Cython 0.29.32 */
+/* Generated by Cython 0.29.34 */
 
 #ifndef PY_SSIZE_T_CLEAN
 #define PY_SSIZE_T_CLEAN
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_32"
-#define CYTHON_HEX_VERSION 0x001D20F0
+#define CYTHON_ABI "0_29_34"
+#define CYTHON_HEX_VERSION 0x001D22F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -83,15 +83,15 @@
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
-    #define CYTHON_UPDATE_DESCRIPTOR_DOC (PYPY_VERSION_HEX >= 0x07030900)
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
 #elif defined(PYSTON_VERSION)
   #define CYTHON_COMPILING_IN_PYPY 0
   #define CYTHON_COMPILING_IN_PYSTON 1
   #define CYTHON_COMPILING_IN_CPYTHON 0
   #define CYTHON_COMPILING_IN_NOGIL 0
   #ifndef CYTHON_USE_TYPE_SLOTS
@@ -199,15 +199,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -238,15 +238,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -548,35 +548,35 @@
 #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && CYTHON_USE_UNICODE_INTERNALS
 #define __Pyx_PyDict_GetItemStr(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
 #else
 #define __Pyx_PyDict_GetItemStr(dict, name)  PyDict_GetItem(dict, name)
 #endif
 #if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
   #define CYTHON_PEP393_ENABLED 1
-  #if defined(PyUnicode_IS_READY)
-  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
-                                              0 : _PyUnicode_Ready((PyObject *)(op)))
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_READY(op)       (0)
   #else
-  #define __Pyx_PyUnicode_READY(op)       (0)
+    #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
+                                                0 : _PyUnicode_Ready((PyObject *)(op)))
   #endif
   #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
   #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
   #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
   #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
   #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
   #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
   #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, ch)
-  #if defined(PyUnicode_IS_READY) && defined(PyUnicode_GET_SIZE)
-  #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
   #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
-  #endif
-  #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
+    #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
+    #else
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
+    #endif
   #endif
 #else
   #define CYTHON_PEP393_ENABLED 0
   #define PyUnicode_1BYTE_KIND  1
   #define PyUnicode_2BYTE_KIND  2
   #define PyUnicode_4BYTE_KIND  4
   #define __Pyx_PyUnicode_READY(op)       (0)
@@ -949,24 +949,24 @@
 static int __pyx_lineno;
 static int __pyx_clineno = 0;
 static const char * __pyx_cfilenm= __FILE__;
 static const char *__pyx_filename;
 
 
 static const char *__pyx_f[] = {
-  "blacksheep/messages.pyx",
-  "blacksheep/messages.pxd",
+  "blacksheep\\messages.pyx",
+  "blacksheep\\messages.pxd",
   "stringsource",
   "datetime.pxd",
-  "blacksheep/contents.pxd",
+  "blacksheep\\contents.pxd",
   "type.pxd",
-  "blacksheep/cookies.pxd",
-  "blacksheep/exceptions.pxd",
-  "blacksheep/url.pxd",
-  "blacksheep/headers.pxd",
+  "blacksheep\\cookies.pxd",
+  "blacksheep\\exceptions.pxd",
+  "blacksheep\\url.pxd",
+  "blacksheep\\headers.pxd",
 };
 
 /*--- Type declarations ---*/
 struct __pyx_obj_10blacksheep_8contents_Content;
 struct __pyx_obj_10blacksheep_8contents_StreamedContent;
 struct __pyx_obj_10blacksheep_8contents_ASGIContent;
 struct __pyx_obj_10blacksheep_8contents_TextContent;
@@ -1334,73 +1334,73 @@
   struct __pyx_obj_10blacksheep_8messages_Message __pyx_base;
   int status;
   int active;
   PyObject *__dict__;
 };
 
 
-/* "blacksheep/messages.pyx":128
+/* "blacksheep/messages.pyx":125
  *         return self.get_first_header(b'content-type')
  * 
  *     async def read(self):             # <<<<<<<<<<<<<<
  *         if self.content:
  *             # TODO: return content.body if not an instance of StreamedContent?
  */
 struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct__read {
   PyObject_HEAD
   struct __pyx_obj_10blacksheep_8messages_Message *__pyx_v_self;
 };
 
 
-/* "blacksheep/messages.pyx":134
+/* "blacksheep/messages.pyx":131
  *         return None
  * 
  *     async def stream(self):             # <<<<<<<<<<<<<<
  *         if self.content:
  *             async for chunk in self.content.stream():
  */
 struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_1_stream {
   PyObject_HEAD
   PyObject *__pyx_v_chunk;
   struct __pyx_obj_10blacksheep_8messages_Message *__pyx_v_self;
   PyObject *__pyx_t_0;
 };
 
 
-/* "blacksheep/messages.pyx":141
+/* "blacksheep/messages.pyx":138
  *             yield None
  * 
  *     async def text(self):             # <<<<<<<<<<<<<<
  *         body = await self.read()
  * 
  */
 struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_2_text {
   PyObject_HEAD
   PyObject *__pyx_v_body;
   struct __pyx_obj_10blacksheep_8messages_Message *__pyx_v_self;
 };
 
 
-/* "blacksheep/messages.pyx":159
- *                     return body.decode(chardet.detect(body)['encoding'])
+/* "blacksheep/messages.pyx":156
+ *                     return body.decode(charset_normalizer.detect(body)['encoding'])
  * 
  *     async def form(self):             # <<<<<<<<<<<<<<
  *         cdef str text
  *         cdef bytes body
  */
 struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_3_form {
   PyObject_HEAD
   PyObject *__pyx_v_body;
   PyObject *__pyx_v_content_type_value;
   struct __pyx_obj_10blacksheep_8messages_Message *__pyx_v_self;
   PyObject *__pyx_v_text;
 };
 
 
-/* "blacksheep/messages.pyx":176
+/* "blacksheep/messages.pyx":173
  *         return None
  * 
  *     async def multipart(self):             # <<<<<<<<<<<<<<
  *         cdef str text
  *         cdef bytes body
  */
 struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_4_multipart {
@@ -1408,15 +1408,15 @@
   PyObject *__pyx_v_body;
   PyObject *__pyx_v_content_type_value;
   struct __pyx_obj_10blacksheep_8messages_Message *__pyx_v_self;
   PyObject *__pyx_v_text;
 };
 
 
-/* "blacksheep/messages.pyx":205
+/* "blacksheep/messages.pyx":202
  *         return self.declares_content_type(b'xml')
  * 
  *     async def files(self, name=None):             # <<<<<<<<<<<<<<
  *         if isinstance(name, str):
  *             name = name.encode('ascii')
  */
 struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_5_files {
@@ -1426,15 +1426,15 @@
   PyObject *__pyx_v_name;
   PyObject *__pyx_7genexpr__pyx_v_part;
   PyObject *__pyx_8genexpr1__pyx_v_part;
   struct __pyx_obj_10blacksheep_8messages_Message *__pyx_v_self;
 };
 
 
-/* "blacksheep/messages.pyx":218
+/* "blacksheep/messages.pyx":215
  *         return [part for part in data if part.file_name]
  * 
  *     async def json(self, loads=json_settings.loads):             # <<<<<<<<<<<<<<
  *         if not self.declares_json():
  *             return None
  */
 struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_6_json {
@@ -1514,15 +1514,15 @@
   void (*remove)(struct __pyx_obj_10blacksheep_7headers_Headers *, PyObject *, int __pyx_skip_dispatch);
   void (*merge)(struct __pyx_obj_10blacksheep_7headers_Headers *, PyObject *, int __pyx_skip_dispatch);
   int (*contains)(struct __pyx_obj_10blacksheep_7headers_Headers *, PyObject *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_10blacksheep_7headers_Headers *__pyx_vtabptr_10blacksheep_7headers_Headers;
 
 
-/* "blacksheep/messages.pyx":32
+/* "blacksheep/messages.pyx":29
  * 
  * 
  * cdef class Message:             # <<<<<<<<<<<<<<
  * 
  *     def __init__(self, list headers):
  */
 
@@ -1545,30 +1545,30 @@
   int (*declares_content_type)(struct __pyx_obj_10blacksheep_8messages_Message *, PyObject *, int __pyx_skip_dispatch);
   int (*declares_json)(struct __pyx_obj_10blacksheep_8messages_Message *, int __pyx_skip_dispatch);
   int (*declares_xml)(struct __pyx_obj_10blacksheep_8messages_Message *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_10blacksheep_8messages_Message *__pyx_vtabptr_10blacksheep_8messages_Message;
 
 
-/* "blacksheep/messages.pyx":264
+/* "blacksheep/messages.pyx":261
  * 
  * 
  * cdef class Request(Message):             # <<<<<<<<<<<<<<
  * 
  *     def __init__(
  */
 
 struct __pyx_vtabstruct_10blacksheep_8messages_Request {
   struct __pyx_vtabstruct_10blacksheep_8messages_Message __pyx_base;
   int (*expect_100_continue)(struct __pyx_obj_10blacksheep_8messages_Request *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_10blacksheep_8messages_Request *__pyx_vtabptr_10blacksheep_8messages_Request;
 
 
-/* "blacksheep/messages.pyx":488
+/* "blacksheep/messages.pyx":485
  * 
  * 
  * cdef class Response(Message):             # <<<<<<<<<<<<<<
  * 
  *     def __init__(
  */
 
@@ -1676,26 +1676,26 @@
 #define __PYX_GET_DICT_VERSION(dict)  (0)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
 #define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
 #endif
 
 /* GetModuleGlobalName.proto */
 #if CYTHON_USE_DICT_VERSIONS
-#define __Pyx_GetModuleGlobalName(var, name)  {\
+#define __Pyx_GetModuleGlobalName(var, name)  do {\
     static PY_UINT64_T __pyx_dict_version = 0;\
     static PyObject *__pyx_dict_cached_value = NULL;\
     (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
         (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
         __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  {\
+} while(0)
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  do {\
     PY_UINT64_T __pyx_dict_version;\
     PyObject *__pyx_dict_cached_value;\
     (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
+} while(0)
 static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
 #else
 #define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 #define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
 #endif
 
@@ -2266,20 +2266,28 @@
 
 /* SetupReduce.proto */
 static int __Pyx_setup_reduce(PyObject* type_obj);
 
 /* TypeImport.proto */
 #ifndef __PYX_HAVE_RT_ImportType_proto
 #define __PYX_HAVE_RT_ImportType_proto
+#if __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT(s) sizeof(void*)
+#endif
 enum __Pyx_ImportType_CheckSize {
    __Pyx_ImportType_CheckSize_Error = 0,
    __Pyx_ImportType_CheckSize_Warn = 1,
    __Pyx_ImportType_CheckSize_Ignore = 2
 };
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
+static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize check_size);
 #endif
 
 /* GetVTable.proto */
 static void* __Pyx_GetVtable(PyObject *dict);
 
 /* ClassMethod.proto */
 #include "descrobject.h"
@@ -2478,15 +2486,14 @@
 static PyObject *__pyx_f_10blacksheep_8messages___pyx_unpickle_Request__set_state(struct __pyx_obj_10blacksheep_8messages_Request *, PyObject *); /*proto*/
 static PyObject *__pyx_f_10blacksheep_8messages___pyx_unpickle_Response__set_state(struct __pyx_obj_10blacksheep_8messages_Response *, PyObject *); /*proto*/
 #define __Pyx_MODULE_NAME "blacksheep.messages"
 extern int __pyx_module_is_main_blacksheep__messages;
 int __pyx_module_is_main_blacksheep__messages = 0;
 
 /* Implementation of 'blacksheep.messages' */
-static PyObject *__pyx_builtin_ImportError;
 static PyObject *__pyx_builtin_ValueError;
 static PyObject *__pyx_builtin_UnicodeDecodeError;
 static PyObject *__pyx_builtin_TypeError;
 static const char __pyx_k_I[] = "I";
 static const char __pyx_k__3[] = "";
 static const char __pyx_k_re[] = "re";
 static const char __pyx_k_GET[] = "GET";
@@ -2557,25 +2564,23 @@
 static const char __pyx_k_stream[] = "stream";
 static const char __pyx_k_update[] = "update";
 static const char __pyx_k_utcnow[] = "utcnow";
 static const char __pyx_k_Message[] = "Message";
 static const char __pyx_k_OPTIONS[] = "OPTIONS";
 static const char __pyx_k_Request[] = "<Request ";
 static const char __pyx_k_Session[] = "Session";
-static const char __pyx_k_chardet[] = "chardet";
 static const char __pyx_k_charset[] = "charset";
 static const char __pyx_k_compile[] = "compile";
 static const char __pyx_k_content[] = "content";
 static const char __pyx_k_cookies[] = "cookies";
 static const char __pyx_k_headers[] = "headers";
 static const char __pyx_k_request[] = "request";
 static const char __pyx_k_session[] = "_session";
 static const char __pyx_k_unquote[] = "unquote";
 static const char __pyx_k_Response[] = "<Response ";
-static const char __pyx_k_cchardet[] = "cchardet";
 static const char __pyx_k_datetime[] = "datetime";
 static const char __pyx_k_encoding[] = "encoding";
 static const char __pyx_k_getstate[] = "__getstate__";
 static const char __pyx_k_has_body[] = "has_body";
 static const char __pyx_k_incoming[] = "incoming";
 static const char __pyx_k_parse_qs[] = "parse_qs";
 static const char __pyx_k_pyx_type[] = "__pyx_type";
@@ -2601,15 +2606,14 @@
 static const char __pyx_k_charset_rx[] = "_charset_rx";
 static const char __pyx_k_has_header[] = "has_header";
 static const char __pyx_k_pyx_result[] = "__pyx_result";
 static const char __pyx_k_pyx_vtable[] = "__pyx_vtable__";
 static const char __pyx_k_set_cookie[] = "set-cookie";
 static const char __pyx_k_set_header[] = "set_header";
 static const char __pyx_k_with_query[] = "with_query";
-static const char __pyx_k_ImportError[] = "ImportError";
 static const char __pyx_k_PickleError[] = "PickleError";
 static const char __pyx_k_get_cookies[] = "get_cookies";
 static const char __pyx_k_get_headers[] = "get_headers";
 static const char __pyx_k_is_absolute[] = "is_absolute";
 static const char __pyx_k_is_redirect[] = "is_redirect";
 static const char __pyx_k_100_continue[] = "100-continue";
 static const char __pyx_k_Message_form[] = "Message.form";
@@ -2636,14 +2640,15 @@
 static const char __pyx_k_parse_multipart[] = "parse_multipart";
 static const char __pyx_k_pyx_PickleError[] = "__pyx_PickleError";
 static const char __pyx_k_setstate_cython[] = "__setstate_cython__";
 static const char __pyx_k_get_first_header[] = "get_first_header";
 static const char __pyx_k_Message_multipart[] = "Message.multipart";
 static const char __pyx_k_get_single_header[] = "get_single_header";
 static const char __pyx_k_UnicodeDecodeError[] = "UnicodeDecodeError";
+static const char __pyx_k_charset_normalizer[] = "charset_normalizer";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
 static const char __pyx_k_original_client_ip[] = "original_client_ip";
 static const char __pyx_k_Missing_Host_header[] = "Missing Host header";
 static const char __pyx_k_blacksheep_messages[] = "blacksheep.messages";
 static const char __pyx_k_blacksheep_sessions[] = "blacksheep.sessions";
 static const char __pyx_k_expect_100_continue[] = "expect_100_continue";
 static const char __pyx_k_multipart_form_data[] = "multipart/form-data;";
@@ -2674,15 +2679,14 @@
 static PyObject *__pyx_n_u_GET;
 static PyObject *__pyx_n_u_HEAD;
 static PyObject *__pyx_n_s_HTTPStatus;
 static PyObject *__pyx_kp_u_Headers_contains_more_than_one_h;
 static PyObject *__pyx_kp_u_Headers_does_not_contain_one_hea;
 static PyObject *__pyx_n_s_I;
 static PyObject *__pyx_kp_u_ISO_8859_1;
-static PyObject *__pyx_n_s_ImportError;
 static PyObject *__pyx_kp_s_Incompatible_checksums_0x_x_vs_0;
 static PyObject *__pyx_kp_s_Incompatible_checksums_0x_x_vs_0_2;
 static PyObject *__pyx_kp_s_Incompatible_checksums_0x_x_vs_0_3;
 static PyObject *__pyx_kp_u_Input_value_must_be_bytes_or_str;
 static PyObject *__pyx_kp_u_Invalid_value_type_expected_byte;
 static PyObject *__pyx_n_s_JSONDecodeError;
 static PyObject *__pyx_n_s_Message;
@@ -2725,17 +2729,16 @@
 static PyObject *__pyx_n_s_base_path;
 static PyObject *__pyx_n_u_base_path;
 static PyObject *__pyx_n_s_blacksheep_messages;
 static PyObject *__pyx_n_s_blacksheep_multipart;
 static PyObject *__pyx_n_s_blacksheep_sessions;
 static PyObject *__pyx_n_s_blacksheep_settings_json;
 static PyObject *__pyx_kp_u_but_the_content_cannot_be_parse;
-static PyObject *__pyx_n_s_cchardet;
-static PyObject *__pyx_n_s_chardet;
 static PyObject *__pyx_n_s_charset;
+static PyObject *__pyx_n_s_charset_normalizer;
 static PyObject *__pyx_n_s_charset_rx;
 static PyObject *__pyx_kp_b_charset_s;
 static PyObject *__pyx_n_u_client;
 static PyObject *__pyx_n_s_client_ip;
 static PyObject *__pyx_n_s_cline_in_traceback;
 static PyObject *__pyx_n_s_close;
 static PyObject *__pyx_n_s_compile;
@@ -2997,15 +3000,15 @@
 static PyObject *__pyx_tuple__23;
 static PyObject *__pyx_tuple__25;
 static PyObject *__pyx_codeobj__22;
 static PyObject *__pyx_codeobj__24;
 static PyObject *__pyx_codeobj__26;
 /* Late includes */
 
-/* "blacksheep/messages.pyx":25
+/* "blacksheep/messages.pyx":22
  * 
  * 
  * cpdef str parse_charset(bytes value):             # <<<<<<<<<<<<<<
  *     m = _charset_rx.match(value)
  *     if m:
  */
 
@@ -3020,123 +3023,123 @@
   int __pyx_t_4;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("parse_charset", 0);
 
-  /* "blacksheep/messages.pyx":26
+  /* "blacksheep/messages.pyx":23
  * 
  * cpdef str parse_charset(bytes value):
  *     m = _charset_rx.match(value)             # <<<<<<<<<<<<<<
  *     if m:
  *         return m.group(1).decode('utf8')
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_charset_rx); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 26, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_charset_rx); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_match); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 26, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_match); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_value) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_value);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 26, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_m = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":27
+  /* "blacksheep/messages.pyx":24
  * cpdef str parse_charset(bytes value):
  *     m = _charset_rx.match(value)
  *     if m:             # <<<<<<<<<<<<<<
  *         return m.group(1).decode('utf8')
  *     return None
  */
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_m); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_m); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 24, __pyx_L1_error)
   if (__pyx_t_4) {
 
-    /* "blacksheep/messages.pyx":28
+    /* "blacksheep/messages.pyx":25
  *     m = _charset_rx.match(value)
  *     if m:
  *         return m.group(1).decode('utf8')             # <<<<<<<<<<<<<<
  *     return None
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_m, __pyx_n_s_group); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 28, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_m, __pyx_n_s_group); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 25, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_int_1) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_int_1);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 28, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 25, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_decode); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 28, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_decode); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 25, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_n_u_utf8) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_n_u_utf8);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 28, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 28, __pyx_L1_error)
+    if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 25, __pyx_L1_error)
     __pyx_r = ((PyObject*)__pyx_t_1);
     __pyx_t_1 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":27
+    /* "blacksheep/messages.pyx":24
  * cpdef str parse_charset(bytes value):
  *     m = _charset_rx.match(value)
  *     if m:             # <<<<<<<<<<<<<<
  *         return m.group(1).decode('utf8')
  *     return None
  */
   }
 
-  /* "blacksheep/messages.pyx":29
+  /* "blacksheep/messages.pyx":26
  *     if m:
  *         return m.group(1).decode('utf8')
  *     return None             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_r = ((PyObject*)Py_None); __Pyx_INCREF(Py_None);
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":25
+  /* "blacksheep/messages.pyx":22
  * 
  * 
  * cpdef str parse_charset(bytes value):             # <<<<<<<<<<<<<<
  *     m = _charset_rx.match(value)
  *     if m:
  */
 
@@ -3160,15 +3163,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_1parse_charset(PyObject *__pyx_self, PyObject *__pyx_v_value) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("parse_charset (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyBytes_Type), 1, "value", 1))) __PYX_ERR(0, 25, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyBytes_Type), 1, "value", 1))) __PYX_ERR(0, 22, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_parse_charset(__pyx_self, ((PyObject*)__pyx_v_value));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -3181,15 +3184,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("parse_charset", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_10blacksheep_8messages_parse_charset(__pyx_v_value, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_10blacksheep_8messages_parse_charset(__pyx_v_value, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -3198,15 +3201,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":34
+/* "blacksheep/messages.pyx":31
  * cdef class Message:
  * 
  *     def __init__(self, list headers):             # <<<<<<<<<<<<<<
  *         self.__headers = headers or []
  * 
  */
 
@@ -3235,32 +3238,32 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_headers)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 34, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 31, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_headers = ((PyObject*)values[0]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 34, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 31, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("blacksheep.messages.Message.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_headers), (&PyList_Type), 1, "headers", 1))) __PYX_ERR(0, 34, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_headers), (&PyList_Type), 1, "headers", 1))) __PYX_ERR(0, 31, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Message___init__(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_v_headers);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -3275,41 +3278,41 @@
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "blacksheep/messages.pyx":35
+  /* "blacksheep/messages.pyx":32
  * 
  *     def __init__(self, list headers):
  *         self.__headers = headers or []             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_headers); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 35, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_headers); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 32, __pyx_L1_error)
   if (!__pyx_t_2) {
   } else {
     __Pyx_INCREF(__pyx_v_headers);
     __pyx_t_1 = __pyx_v_headers;
     goto __pyx_L3_bool_binop_done;
   }
-  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 35, __pyx_L1_error)
+  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 32, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(__pyx_t_3);
   __pyx_t_1 = __pyx_t_3;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_L3_bool_binop_done:;
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v_self->__pyx___headers);
   __Pyx_DECREF(__pyx_v_self->__pyx___headers);
   __pyx_v_self->__pyx___headers = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":34
+  /* "blacksheep/messages.pyx":31
  * cdef class Message:
  * 
  *     def __init__(self, list headers):             # <<<<<<<<<<<<<<
  *         self.__headers = headers or []
  * 
  */
 
@@ -3322,15 +3325,15 @@
   __Pyx_AddTraceback("blacksheep.messages.Message.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":38
+/* "blacksheep/messages.pyx":35
  * 
  *     @property
  *     def headers(self):             # <<<<<<<<<<<<<<
  *         cdef str key = '_headers'
  *         if key in self.__dict__:
  */
 
@@ -3356,97 +3359,97 @@
   int __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":39
+  /* "blacksheep/messages.pyx":36
  *     @property
  *     def headers(self):
  *         cdef str key = '_headers'             # <<<<<<<<<<<<<<
  *         if key in self.__dict__:
  *             return self.__dict__[key]
  */
   __Pyx_INCREF(__pyx_n_u_headers_2);
   __pyx_v_key = __pyx_n_u_headers_2;
 
-  /* "blacksheep/messages.pyx":40
+  /* "blacksheep/messages.pyx":37
  *     def headers(self):
  *         cdef str key = '_headers'
  *         if key in self.__dict__:             # <<<<<<<<<<<<<<
  *             return self.__dict__[key]
  *         self.__dict__[key] = Headers(self.__headers)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dict); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dict); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 37, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_v_key, __pyx_t_1, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_v_key, __pyx_t_1, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 37, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
-    /* "blacksheep/messages.pyx":41
+    /* "blacksheep/messages.pyx":38
  *         cdef str key = '_headers'
  *         if key in self.__dict__:
  *             return self.__dict__[key]             # <<<<<<<<<<<<<<
  *         self.__dict__[key] = Headers(self.__headers)
  *         return self.__dict__[key]
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dict); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dict); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 38, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_v_key); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 41, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_v_key); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 38, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_r = __pyx_t_4;
     __pyx_t_4 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":40
+    /* "blacksheep/messages.pyx":37
  *     def headers(self):
  *         cdef str key = '_headers'
  *         if key in self.__dict__:             # <<<<<<<<<<<<<<
  *             return self.__dict__[key]
  *         self.__dict__[key] = Headers(self.__headers)
  */
   }
 
-  /* "blacksheep/messages.pyx":42
+  /* "blacksheep/messages.pyx":39
  *         if key in self.__dict__:
  *             return self.__dict__[key]
  *         self.__dict__[key] = Headers(self.__headers)             # <<<<<<<<<<<<<<
  *         return self.__dict__[key]
  * 
  */
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_10blacksheep_7headers_Headers), __pyx_v_self->__pyx___headers); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 42, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_10blacksheep_7headers_Headers), __pyx_v_self->__pyx___headers); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 39, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dict); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 42, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dict); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 39, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (unlikely(PyObject_SetItem(__pyx_t_1, __pyx_v_key, __pyx_t_4) < 0)) __PYX_ERR(0, 42, __pyx_L1_error)
+  if (unlikely(PyObject_SetItem(__pyx_t_1, __pyx_v_key, __pyx_t_4) < 0)) __PYX_ERR(0, 39, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "blacksheep/messages.pyx":43
+  /* "blacksheep/messages.pyx":40
  *             return self.__dict__[key]
  *         self.__dict__[key] = Headers(self.__headers)
  *         return self.__dict__[key]             # <<<<<<<<<<<<<<
  * 
  *     cpdef Message with_content(self, Content content):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dict); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dict); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 40, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":38
+  /* "blacksheep/messages.pyx":35
  * 
  *     @property
  *     def headers(self):             # <<<<<<<<<<<<<<
  *         cdef str key = '_headers'
  *         if key in self.__dict__:
  */
 
@@ -3459,15 +3462,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_key);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":45
+/* "blacksheep/messages.pyx":42
  *         return self.__dict__[key]
  * 
  *     cpdef Message with_content(self, Content content):             # <<<<<<<<<<<<<<
  *         self.content = content
  *         return self
  */
 
@@ -3488,15 +3491,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_with_content); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 45, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_with_content); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 42, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_7Message_3with_content)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -3505,18 +3508,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_v_content)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_content));
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 45, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 42, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_10blacksheep_8messages_Message))))) __PYX_ERR(0, 45, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_10blacksheep_8messages_Message))))) __PYX_ERR(0, 42, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -3527,40 +3530,40 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":46
+  /* "blacksheep/messages.pyx":43
  * 
  *     cpdef Message with_content(self, Content content):
  *         self.content = content             # <<<<<<<<<<<<<<
  *         return self
  * 
  */
   __Pyx_INCREF(((PyObject *)__pyx_v_content));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_content));
   __Pyx_GOTREF(__pyx_v_self->content);
   __Pyx_DECREF(((PyObject *)__pyx_v_self->content));
   __pyx_v_self->content = __pyx_v_content;
 
-  /* "blacksheep/messages.pyx":47
+  /* "blacksheep/messages.pyx":44
  *     cpdef Message with_content(self, Content content):
  *         self.content = content
  *         return self             # <<<<<<<<<<<<<<
  * 
  *     cpdef bytes get_first_header(self, bytes key):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = __pyx_v_self;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":45
+  /* "blacksheep/messages.pyx":42
  *         return self.__dict__[key]
  * 
  *     cpdef Message with_content(self, Content content):             # <<<<<<<<<<<<<<
  *         self.content = content
  *         return self
  */
 
@@ -3583,15 +3586,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_7Message_3with_content(PyObject *__pyx_v_self, PyObject *__pyx_v_content) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("with_content (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_content), __pyx_ptype_10blacksheep_8contents_Content, 1, "content", 0))) __PYX_ERR(0, 45, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_content), __pyx_ptype_10blacksheep_8contents_Content, 1, "content", 0))) __PYX_ERR(0, 42, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Message_2with_content(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), ((struct __pyx_obj_10blacksheep_8contents_Content *)__pyx_v_content));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -3604,15 +3607,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("with_content", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_10blacksheep_8messages_7Message_with_content(__pyx_v_self, __pyx_v_content, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 45, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_10blacksheep_8messages_7Message_with_content(__pyx_v_self, __pyx_v_content, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 42, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -3621,15 +3624,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":49
+/* "blacksheep/messages.pyx":46
  *         return self
  * 
  *     cpdef bytes get_first_header(self, bytes key):             # <<<<<<<<<<<<<<
  *         cdef tuple header
  *         key = key.lower()
  */
 
@@ -3654,15 +3657,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_first_header); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 49, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_first_header); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 46, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_7Message_5get_first_header)) {
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -3671,18 +3674,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_key) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_key);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 49, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 46, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 49, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 46, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -3693,126 +3696,126 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":51
+  /* "blacksheep/messages.pyx":48
  *     cpdef bytes get_first_header(self, bytes key):
  *         cdef tuple header
  *         key = key.lower()             # <<<<<<<<<<<<<<
  *         for header in self.__headers:
  *             if header[0].lower() == key:
  */
-  __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 48, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 51, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 48, __pyx_L1_error)
   __Pyx_DECREF_SET(__pyx_v_key, ((PyObject*)__pyx_t_1));
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":52
+  /* "blacksheep/messages.pyx":49
  *         cdef tuple header
  *         key = key.lower()
  *         for header in self.__headers:             # <<<<<<<<<<<<<<
  *             if header[0].lower() == key:
  *                 return header[1]
  */
   if (unlikely(__pyx_v_self->__pyx___headers == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 52, __pyx_L1_error)
+    __PYX_ERR(0, 49, __pyx_L1_error)
   }
   __pyx_t_1 = __pyx_v_self->__pyx___headers; __Pyx_INCREF(__pyx_t_1); __pyx_t_5 = 0;
   for (;;) {
     if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 52, __pyx_L1_error)
+    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 49, __pyx_L1_error)
     #else
-    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 52, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 49, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
-    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 52, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 49, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_header, ((PyObject*)__pyx_t_2));
     __pyx_t_2 = 0;
 
-    /* "blacksheep/messages.pyx":53
+    /* "blacksheep/messages.pyx":50
  *         key = key.lower()
  *         for header in self.__headers:
  *             if header[0].lower() == key:             # <<<<<<<<<<<<<<
  *                 return header[1]
  * 
  */
     if (unlikely(__pyx_v_header == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 53, __pyx_L1_error)
+      __PYX_ERR(0, 50, __pyx_L1_error)
     }
-    __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_header, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 53, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_header, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 50, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_lower); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 53, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_lower); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 50, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 53, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 50, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_6 = (__Pyx_PyBytes_Equals(__pyx_t_2, __pyx_v_key, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 53, __pyx_L1_error)
+    __pyx_t_6 = (__Pyx_PyBytes_Equals(__pyx_t_2, __pyx_v_key, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 50, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     if (__pyx_t_6) {
 
-      /* "blacksheep/messages.pyx":54
+      /* "blacksheep/messages.pyx":51
  *         for header in self.__headers:
  *             if header[0].lower() == key:
  *                 return header[1]             # <<<<<<<<<<<<<<
  * 
  *     cpdef list get_headers(self, bytes key):
  */
       __Pyx_XDECREF(__pyx_r);
       if (unlikely(__pyx_v_header == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-        __PYX_ERR(0, 54, __pyx_L1_error)
+        __PYX_ERR(0, 51, __pyx_L1_error)
       }
-      __pyx_t_2 = __Pyx_GetItemInt_Tuple(__pyx_v_header, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 54, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_GetItemInt_Tuple(__pyx_v_header, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 51, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 54, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 51, __pyx_L1_error)
       __pyx_r = ((PyObject*)__pyx_t_2);
       __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       goto __pyx_L0;
 
-      /* "blacksheep/messages.pyx":53
+      /* "blacksheep/messages.pyx":50
  *         key = key.lower()
  *         for header in self.__headers:
  *             if header[0].lower() == key:             # <<<<<<<<<<<<<<
  *                 return header[1]
  * 
  */
     }
 
-    /* "blacksheep/messages.pyx":52
+    /* "blacksheep/messages.pyx":49
  *         cdef tuple header
  *         key = key.lower()
  *         for header in self.__headers:             # <<<<<<<<<<<<<<
  *             if header[0].lower() == key:
  *                 return header[1]
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":49
+  /* "blacksheep/messages.pyx":46
  *         return self
  * 
  *     cpdef bytes get_first_header(self, bytes key):             # <<<<<<<<<<<<<<
  *         cdef tuple header
  *         key = key.lower()
  */
 
@@ -3839,15 +3842,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_7Message_5get_first_header(PyObject *__pyx_v_self, PyObject *__pyx_v_key) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("get_first_header (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_key), (&PyBytes_Type), 1, "key", 1))) __PYX_ERR(0, 49, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_key), (&PyBytes_Type), 1, "key", 1))) __PYX_ERR(0, 46, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Message_4get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), ((PyObject*)__pyx_v_key));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -3860,15 +3863,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_first_header", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_10blacksheep_8messages_7Message_get_first_header(__pyx_v_self, __pyx_v_key, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 49, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_10blacksheep_8messages_7Message_get_first_header(__pyx_v_self, __pyx_v_key, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 46, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -3877,15 +3880,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":56
+/* "blacksheep/messages.pyx":53
  *                 return header[1]
  * 
  *     cpdef list get_headers(self, bytes key):             # <<<<<<<<<<<<<<
  *         cdef list results = []
  *         cdef tuple header
  */
 
@@ -3912,15 +3915,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_headers); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 56, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_headers); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 53, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_7Message_7get_headers)) {
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -3929,18 +3932,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_key) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_key);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 56, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 53, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyList_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 56, __pyx_L1_error)
+        if (!(likely(PyList_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 53, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -3951,146 +3954,146 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":57
+  /* "blacksheep/messages.pyx":54
  * 
  *     cpdef list get_headers(self, bytes key):
  *         cdef list results = []             # <<<<<<<<<<<<<<
  *         cdef tuple header
  *         key = key.lower()
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 57, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 54, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_results = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":59
+  /* "blacksheep/messages.pyx":56
  *         cdef list results = []
  *         cdef tuple header
  *         key = key.lower()             # <<<<<<<<<<<<<<
  *         for header in self.__headers:
  *             if header[0].lower() == key:
  */
-  __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 59, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 56, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 59, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 56, __pyx_L1_error)
   __Pyx_DECREF_SET(__pyx_v_key, ((PyObject*)__pyx_t_1));
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":60
+  /* "blacksheep/messages.pyx":57
  *         cdef tuple header
  *         key = key.lower()
  *         for header in self.__headers:             # <<<<<<<<<<<<<<
  *             if header[0].lower() == key:
  *                 results.append(header[1])
  */
   if (unlikely(__pyx_v_self->__pyx___headers == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 60, __pyx_L1_error)
+    __PYX_ERR(0, 57, __pyx_L1_error)
   }
   __pyx_t_1 = __pyx_v_self->__pyx___headers; __Pyx_INCREF(__pyx_t_1); __pyx_t_5 = 0;
   for (;;) {
     if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 60, __pyx_L1_error)
+    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 57, __pyx_L1_error)
     #else
-    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 60, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 57, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
-    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 60, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 57, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_header, ((PyObject*)__pyx_t_2));
     __pyx_t_2 = 0;
 
-    /* "blacksheep/messages.pyx":61
+    /* "blacksheep/messages.pyx":58
  *         key = key.lower()
  *         for header in self.__headers:
  *             if header[0].lower() == key:             # <<<<<<<<<<<<<<
  *                 results.append(header[1])
  *         return results
  */
     if (unlikely(__pyx_v_header == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 61, __pyx_L1_error)
+      __PYX_ERR(0, 58, __pyx_L1_error)
     }
-    __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_header, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 61, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_header, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 58, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_lower); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 61, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_lower); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 58, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 61, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 58, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_6 = (__Pyx_PyBytes_Equals(__pyx_t_2, __pyx_v_key, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 61, __pyx_L1_error)
+    __pyx_t_6 = (__Pyx_PyBytes_Equals(__pyx_t_2, __pyx_v_key, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 58, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     if (__pyx_t_6) {
 
-      /* "blacksheep/messages.pyx":62
+      /* "blacksheep/messages.pyx":59
  *         for header in self.__headers:
  *             if header[0].lower() == key:
  *                 results.append(header[1])             # <<<<<<<<<<<<<<
  *         return results
  * 
  */
       if (unlikely(__pyx_v_header == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-        __PYX_ERR(0, 62, __pyx_L1_error)
+        __PYX_ERR(0, 59, __pyx_L1_error)
       }
-      __pyx_t_2 = __Pyx_GetItemInt_Tuple(__pyx_v_header, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 62, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_GetItemInt_Tuple(__pyx_v_header, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 59, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_results, __pyx_t_2); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 62, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_results, __pyx_t_2); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 59, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-      /* "blacksheep/messages.pyx":61
+      /* "blacksheep/messages.pyx":58
  *         key = key.lower()
  *         for header in self.__headers:
  *             if header[0].lower() == key:             # <<<<<<<<<<<<<<
  *                 results.append(header[1])
  *         return results
  */
     }
 
-    /* "blacksheep/messages.pyx":60
+    /* "blacksheep/messages.pyx":57
  *         cdef tuple header
  *         key = key.lower()
  *         for header in self.__headers:             # <<<<<<<<<<<<<<
  *             if header[0].lower() == key:
  *                 results.append(header[1])
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":63
+  /* "blacksheep/messages.pyx":60
  *             if header[0].lower() == key:
  *                 results.append(header[1])
  *         return results             # <<<<<<<<<<<<<<
  * 
  *     cdef list get_headers_tuples(self, bytes key):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_results);
   __pyx_r = __pyx_v_results;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":56
+  /* "blacksheep/messages.pyx":53
  *                 return header[1]
  * 
  *     cpdef list get_headers(self, bytes key):             # <<<<<<<<<<<<<<
  *         cdef list results = []
  *         cdef tuple header
  */
 
@@ -4116,15 +4119,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_7Message_7get_headers(PyObject *__pyx_v_self, PyObject *__pyx_v_key) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("get_headers (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_key), (&PyBytes_Type), 1, "key", 1))) __PYX_ERR(0, 56, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_key), (&PyBytes_Type), 1, "key", 1))) __PYX_ERR(0, 53, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Message_6get_headers(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), ((PyObject*)__pyx_v_key));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -4137,15 +4140,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_headers", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_10blacksheep_8messages_7Message_get_headers(__pyx_v_self, __pyx_v_key, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 56, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_10blacksheep_8messages_7Message_get_headers(__pyx_v_self, __pyx_v_key, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 53, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -4154,15 +4157,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":65
+/* "blacksheep/messages.pyx":62
  *         return results
  * 
  *     cdef list get_headers_tuples(self, bytes key):             # <<<<<<<<<<<<<<
  *         cdef list results = []
  *         cdef tuple header
  */
 
@@ -4180,139 +4183,139 @@
   int __pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_headers_tuples", 0);
   __Pyx_INCREF(__pyx_v_key);
 
-  /* "blacksheep/messages.pyx":66
+  /* "blacksheep/messages.pyx":63
  * 
  *     cdef list get_headers_tuples(self, bytes key):
  *         cdef list results = []             # <<<<<<<<<<<<<<
  *         cdef tuple header
  *         key = key.lower()
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 63, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_results = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":68
+  /* "blacksheep/messages.pyx":65
  *         cdef list results = []
  *         cdef tuple header
  *         key = key.lower()             # <<<<<<<<<<<<<<
  *         for header in self.__headers:
  *             if header[0].lower() == key:
  */
-  __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 68, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_DECREF_SET(__pyx_v_key, ((PyObject*)__pyx_t_1));
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":69
+  /* "blacksheep/messages.pyx":66
  *         cdef tuple header
  *         key = key.lower()
  *         for header in self.__headers:             # <<<<<<<<<<<<<<
  *             if header[0].lower() == key:
  *                 results.append(header)
  */
   if (unlikely(__pyx_v_self->__pyx___headers == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 69, __pyx_L1_error)
+    __PYX_ERR(0, 66, __pyx_L1_error)
   }
   __pyx_t_1 = __pyx_v_self->__pyx___headers; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
   for (;;) {
     if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 69, __pyx_L1_error)
+    __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 66, __pyx_L1_error)
     #else
-    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 69, __pyx_L1_error)
+    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 66, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     #endif
-    if (!(likely(PyTuple_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 69, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 66, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_header, ((PyObject*)__pyx_t_3));
     __pyx_t_3 = 0;
 
-    /* "blacksheep/messages.pyx":70
+    /* "blacksheep/messages.pyx":67
  *         key = key.lower()
  *         for header in self.__headers:
  *             if header[0].lower() == key:             # <<<<<<<<<<<<<<
  *                 results.append(header)
  *         return results
  */
     if (unlikely(__pyx_v_header == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 70, __pyx_L1_error)
+      __PYX_ERR(0, 67, __pyx_L1_error)
     }
-    __pyx_t_4 = __Pyx_GetItemInt_Tuple(__pyx_v_header, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 70, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_GetItemInt_Tuple(__pyx_v_header, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 67, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_lower); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 70, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_lower); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 67, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_5, function);
       }
     }
     __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 70, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 67, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_6 = (__Pyx_PyBytes_Equals(__pyx_t_3, __pyx_v_key, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 70, __pyx_L1_error)
+    __pyx_t_6 = (__Pyx_PyBytes_Equals(__pyx_t_3, __pyx_v_key, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 67, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     if (__pyx_t_6) {
 
-      /* "blacksheep/messages.pyx":71
+      /* "blacksheep/messages.pyx":68
  *         for header in self.__headers:
  *             if header[0].lower() == key:
  *                 results.append(header)             # <<<<<<<<<<<<<<
  *         return results
  * 
  */
-      __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_results, __pyx_v_header); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 71, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_results, __pyx_v_header); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 68, __pyx_L1_error)
 
-      /* "blacksheep/messages.pyx":70
+      /* "blacksheep/messages.pyx":67
  *         key = key.lower()
  *         for header in self.__headers:
  *             if header[0].lower() == key:             # <<<<<<<<<<<<<<
  *                 results.append(header)
  *         return results
  */
     }
 
-    /* "blacksheep/messages.pyx":69
+    /* "blacksheep/messages.pyx":66
  *         cdef tuple header
  *         key = key.lower()
  *         for header in self.__headers:             # <<<<<<<<<<<<<<
  *             if header[0].lower() == key:
  *                 results.append(header)
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":72
+  /* "blacksheep/messages.pyx":69
  *             if header[0].lower() == key:
  *                 results.append(header)
  *         return results             # <<<<<<<<<<<<<<
  * 
  *     cpdef bytes get_single_header(self, bytes key):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_results);
   __pyx_r = __pyx_v_results;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":65
+  /* "blacksheep/messages.pyx":62
  *         return results
  * 
  *     cdef list get_headers_tuples(self, bytes key):             # <<<<<<<<<<<<<<
  *         cdef list results = []
  *         cdef tuple header
  */
 
@@ -4329,15 +4332,15 @@
   __Pyx_XDECREF(__pyx_v_header);
   __Pyx_XDECREF(__pyx_v_key);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":74
+/* "blacksheep/messages.pyx":71
  *         return results
  * 
  *     cpdef bytes get_single_header(self, bytes key):             # <<<<<<<<<<<<<<
  *         cdef list results = self.get_headers(key)
  *         if len(results) > 1:
  */
 
@@ -4361,15 +4364,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_single_header); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 74, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_single_header); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 71, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_7Message_9get_single_header)) {
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -4378,18 +4381,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_key) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_key);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 74, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 71, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 74, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 71, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -4400,120 +4403,120 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":75
+  /* "blacksheep/messages.pyx":72
  * 
  *     cpdef bytes get_single_header(self, bytes key):
  *         cdef list results = self.get_headers(key)             # <<<<<<<<<<<<<<
  *         if len(results) > 1:
  *             raise ValueError('Headers contains more than one header with the given key')
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_v_self->__pyx_vtab)->get_headers(__pyx_v_self, __pyx_v_key, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 75, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_v_self->__pyx_vtab)->get_headers(__pyx_v_self, __pyx_v_key, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 72, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_results = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":76
+  /* "blacksheep/messages.pyx":73
  *     cpdef bytes get_single_header(self, bytes key):
  *         cdef list results = self.get_headers(key)
  *         if len(results) > 1:             # <<<<<<<<<<<<<<
  *             raise ValueError('Headers contains more than one header with the given key')
  *         if len(results) < 1:
  */
   if (unlikely(__pyx_v_results == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 76, __pyx_L1_error)
+    __PYX_ERR(0, 73, __pyx_L1_error)
   }
-  __pyx_t_5 = PyList_GET_SIZE(__pyx_v_results); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 76, __pyx_L1_error)
+  __pyx_t_5 = PyList_GET_SIZE(__pyx_v_results); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 73, __pyx_L1_error)
   __pyx_t_6 = ((__pyx_t_5 > 1) != 0);
   if (unlikely(__pyx_t_6)) {
 
-    /* "blacksheep/messages.pyx":77
+    /* "blacksheep/messages.pyx":74
  *         cdef list results = self.get_headers(key)
  *         if len(results) > 1:
  *             raise ValueError('Headers contains more than one header with the given key')             # <<<<<<<<<<<<<<
  *         if len(results) < 1:
  *             raise ValueError('Headers does not contain one header with the given key')
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 74, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 77, __pyx_L1_error)
+    __PYX_ERR(0, 74, __pyx_L1_error)
 
-    /* "blacksheep/messages.pyx":76
+    /* "blacksheep/messages.pyx":73
  *     cpdef bytes get_single_header(self, bytes key):
  *         cdef list results = self.get_headers(key)
  *         if len(results) > 1:             # <<<<<<<<<<<<<<
  *             raise ValueError('Headers contains more than one header with the given key')
  *         if len(results) < 1:
  */
   }
 
-  /* "blacksheep/messages.pyx":78
+  /* "blacksheep/messages.pyx":75
  *         if len(results) > 1:
  *             raise ValueError('Headers contains more than one header with the given key')
  *         if len(results) < 1:             # <<<<<<<<<<<<<<
  *             raise ValueError('Headers does not contain one header with the given key')
  *         return results[0]
  */
   if (unlikely(__pyx_v_results == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 78, __pyx_L1_error)
+    __PYX_ERR(0, 75, __pyx_L1_error)
   }
-  __pyx_t_5 = PyList_GET_SIZE(__pyx_v_results); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 78, __pyx_L1_error)
+  __pyx_t_5 = PyList_GET_SIZE(__pyx_v_results); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 75, __pyx_L1_error)
   __pyx_t_6 = ((__pyx_t_5 < 1) != 0);
   if (unlikely(__pyx_t_6)) {
 
-    /* "blacksheep/messages.pyx":79
+    /* "blacksheep/messages.pyx":76
  *             raise ValueError('Headers contains more than one header with the given key')
  *         if len(results) < 1:
  *             raise ValueError('Headers does not contain one header with the given key')             # <<<<<<<<<<<<<<
  *         return results[0]
  * 
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 79, __pyx_L1_error)
+    __PYX_ERR(0, 76, __pyx_L1_error)
 
-    /* "blacksheep/messages.pyx":78
+    /* "blacksheep/messages.pyx":75
  *         if len(results) > 1:
  *             raise ValueError('Headers contains more than one header with the given key')
  *         if len(results) < 1:             # <<<<<<<<<<<<<<
  *             raise ValueError('Headers does not contain one header with the given key')
  *         return results[0]
  */
   }
 
-  /* "blacksheep/messages.pyx":80
+  /* "blacksheep/messages.pyx":77
  *         if len(results) < 1:
  *             raise ValueError('Headers does not contain one header with the given key')
  *         return results[0]             # <<<<<<<<<<<<<<
  * 
  *     cpdef void remove_header(self, bytes key):
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(__pyx_v_results == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-    __PYX_ERR(0, 80, __pyx_L1_error)
+    __PYX_ERR(0, 77, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_results, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_results, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 80, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 77, __pyx_L1_error)
   __pyx_r = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":74
+  /* "blacksheep/messages.pyx":71
  *         return results
  * 
  *     cpdef bytes get_single_header(self, bytes key):             # <<<<<<<<<<<<<<
  *         cdef list results = self.get_headers(key)
  *         if len(results) > 1:
  */
 
@@ -4537,15 +4540,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_7Message_9get_single_header(PyObject *__pyx_v_self, PyObject *__pyx_v_key) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("get_single_header (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_key), (&PyBytes_Type), 1, "key", 1))) __PYX_ERR(0, 74, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_key), (&PyBytes_Type), 1, "key", 1))) __PYX_ERR(0, 71, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Message_8get_single_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), ((PyObject*)__pyx_v_key));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -4558,15 +4561,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_single_header", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_10blacksheep_8messages_7Message_get_single_header(__pyx_v_self, __pyx_v_key, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_10blacksheep_8messages_7Message_get_single_header(__pyx_v_self, __pyx_v_key, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 71, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -4575,15 +4578,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":82
+/* "blacksheep/messages.pyx":79
  *         return results[0]
  * 
  *     cpdef void remove_header(self, bytes key):             # <<<<<<<<<<<<<<
  *         cdef tuple header
  *         cdef list to_remove = []
  */
 
@@ -4609,15 +4612,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_remove_header); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_remove_header); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_7Message_11remove_header)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -4625,15 +4628,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_key) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_key);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 82, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 79, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -4645,183 +4648,183 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":84
+  /* "blacksheep/messages.pyx":81
  *     cpdef void remove_header(self, bytes key):
  *         cdef tuple header
  *         cdef list to_remove = []             # <<<<<<<<<<<<<<
  *         key = key.lower()
  *         for header in self.__headers:
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 81, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_to_remove = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":85
+  /* "blacksheep/messages.pyx":82
  *         cdef tuple header
  *         cdef list to_remove = []
  *         key = key.lower()             # <<<<<<<<<<<<<<
  *         for header in self.__headers:
  *             if header[0].lower() == key:
  */
-  __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 85, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_DECREF_SET(__pyx_v_key, ((PyObject*)__pyx_t_1));
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":86
+  /* "blacksheep/messages.pyx":83
  *         cdef list to_remove = []
  *         key = key.lower()
  *         for header in self.__headers:             # <<<<<<<<<<<<<<
  *             if header[0].lower() == key:
  *                 to_remove.append(header)
  */
   if (unlikely(__pyx_v_self->__pyx___headers == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 86, __pyx_L1_error)
+    __PYX_ERR(0, 83, __pyx_L1_error)
   }
   __pyx_t_1 = __pyx_v_self->__pyx___headers; __Pyx_INCREF(__pyx_t_1); __pyx_t_5 = 0;
   for (;;) {
     if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 86, __pyx_L1_error)
+    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 83, __pyx_L1_error)
     #else
-    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 86, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 83, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
-    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 86, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 83, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_header, ((PyObject*)__pyx_t_2));
     __pyx_t_2 = 0;
 
-    /* "blacksheep/messages.pyx":87
+    /* "blacksheep/messages.pyx":84
  *         key = key.lower()
  *         for header in self.__headers:
  *             if header[0].lower() == key:             # <<<<<<<<<<<<<<
  *                 to_remove.append(header)
  * 
  */
     if (unlikely(__pyx_v_header == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 87, __pyx_L1_error)
+      __PYX_ERR(0, 84, __pyx_L1_error)
     }
-    __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_header, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 87, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_header, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 84, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_lower); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 87, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_lower); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 84, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 87, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 84, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_6 = (__Pyx_PyBytes_Equals(__pyx_t_2, __pyx_v_key, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 87, __pyx_L1_error)
+    __pyx_t_6 = (__Pyx_PyBytes_Equals(__pyx_t_2, __pyx_v_key, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 84, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     if (__pyx_t_6) {
 
-      /* "blacksheep/messages.pyx":88
+      /* "blacksheep/messages.pyx":85
  *         for header in self.__headers:
  *             if header[0].lower() == key:
  *                 to_remove.append(header)             # <<<<<<<<<<<<<<
  * 
  *         for header in to_remove:
  */
-      __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_to_remove, __pyx_v_header); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 88, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_to_remove, __pyx_v_header); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 85, __pyx_L1_error)
 
-      /* "blacksheep/messages.pyx":87
+      /* "blacksheep/messages.pyx":84
  *         key = key.lower()
  *         for header in self.__headers:
  *             if header[0].lower() == key:             # <<<<<<<<<<<<<<
  *                 to_remove.append(header)
  * 
  */
     }
 
-    /* "blacksheep/messages.pyx":86
+    /* "blacksheep/messages.pyx":83
  *         cdef list to_remove = []
  *         key = key.lower()
  *         for header in self.__headers:             # <<<<<<<<<<<<<<
  *             if header[0].lower() == key:
  *                 to_remove.append(header)
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":90
+  /* "blacksheep/messages.pyx":87
  *                 to_remove.append(header)
  * 
  *         for header in to_remove:             # <<<<<<<<<<<<<<
  *             self.__headers.remove(header)
  * 
  */
   __pyx_t_1 = __pyx_v_to_remove; __Pyx_INCREF(__pyx_t_1); __pyx_t_5 = 0;
   for (;;) {
     if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 90, __pyx_L1_error)
+    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 87, __pyx_L1_error)
     #else
-    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 90, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 87, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
-    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 90, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 87, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_header, ((PyObject*)__pyx_t_2));
     __pyx_t_2 = 0;
 
-    /* "blacksheep/messages.pyx":91
+    /* "blacksheep/messages.pyx":88
  * 
  *         for header in to_remove:
  *             self.__headers.remove(header)             # <<<<<<<<<<<<<<
  * 
  *     cdef void remove_headers(self, list headers):
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->__pyx___headers, __pyx_n_s_remove); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 91, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->__pyx___headers, __pyx_n_s_remove); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 88, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_v_header) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_header);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 91, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 88, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "blacksheep/messages.pyx":90
+    /* "blacksheep/messages.pyx":87
  *                 to_remove.append(header)
  * 
  *         for header in to_remove:             # <<<<<<<<<<<<<<
  *             self.__headers.remove(header)
  * 
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":82
+  /* "blacksheep/messages.pyx":79
  *         return results[0]
  * 
  *     cpdef void remove_header(self, bytes key):             # <<<<<<<<<<<<<<
  *         cdef tuple header
  *         cdef list to_remove = []
  */
 
@@ -4845,15 +4848,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_7Message_11remove_header(PyObject *__pyx_v_self, PyObject *__pyx_v_key) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("remove_header (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_key), (&PyBytes_Type), 1, "key", 1))) __PYX_ERR(0, 82, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_key), (&PyBytes_Type), 1, "key", 1))) __PYX_ERR(0, 79, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Message_10remove_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), ((PyObject*)__pyx_v_key));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -4866,15 +4869,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("remove_header", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_10blacksheep_8messages_7Message_remove_header(__pyx_v_self, __pyx_v_key, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_10blacksheep_8messages_7Message_remove_header(__pyx_v_self, __pyx_v_key, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -4883,15 +4886,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":93
+/* "blacksheep/messages.pyx":90
  *             self.__headers.remove(header)
  * 
  *     cdef void remove_headers(self, list headers):             # <<<<<<<<<<<<<<
  *         cdef tuple header
  *         for header in headers:
  */
 
@@ -4904,75 +4907,75 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("remove_headers", 0);
 
-  /* "blacksheep/messages.pyx":95
+  /* "blacksheep/messages.pyx":92
  *     cdef void remove_headers(self, list headers):
  *         cdef tuple header
  *         for header in headers:             # <<<<<<<<<<<<<<
  *             self.__headers.remove(header)
  * 
  */
   if (unlikely(__pyx_v_headers == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 95, __pyx_L1_error)
+    __PYX_ERR(0, 92, __pyx_L1_error)
   }
   __pyx_t_1 = __pyx_v_headers; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
   for (;;) {
     if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 95, __pyx_L1_error)
+    __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 92, __pyx_L1_error)
     #else
-    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 95, __pyx_L1_error)
+    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 92, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     #endif
-    if (!(likely(PyTuple_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 95, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 92, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_header, ((PyObject*)__pyx_t_3));
     __pyx_t_3 = 0;
 
-    /* "blacksheep/messages.pyx":96
+    /* "blacksheep/messages.pyx":93
  *         cdef tuple header
  *         for header in headers:
  *             self.__headers.remove(header)             # <<<<<<<<<<<<<<
  * 
  *     cdef bint _has_header(self, bytes key):
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->__pyx___headers, __pyx_n_s_remove); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 96, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->__pyx___headers, __pyx_n_s_remove); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_header) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_header);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 96, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "blacksheep/messages.pyx":95
+    /* "blacksheep/messages.pyx":92
  *     cdef void remove_headers(self, list headers):
  *         cdef tuple header
  *         for header in headers:             # <<<<<<<<<<<<<<
  *             self.__headers.remove(header)
  * 
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":93
+  /* "blacksheep/messages.pyx":90
  *             self.__headers.remove(header)
  * 
  *     cdef void remove_headers(self, list headers):             # <<<<<<<<<<<<<<
  *         cdef tuple header
  *         for header in headers:
  */
 
@@ -4985,15 +4988,15 @@
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_WriteUnraisable("blacksheep.messages.Message.remove_headers", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_header);
   __Pyx_RefNannyFinishContext();
 }
 
-/* "blacksheep/messages.pyx":98
+/* "blacksheep/messages.pyx":95
  *             self.__headers.remove(header)
  * 
  *     cdef bint _has_header(self, bytes key):             # <<<<<<<<<<<<<<
  *         cdef bytes existing_key, existing_value
  *         key = key.lower()
  */
 
@@ -5012,154 +5015,154 @@
   int __pyx_t_8;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_has_header", 0);
   __Pyx_INCREF(__pyx_v_key);
 
-  /* "blacksheep/messages.pyx":100
+  /* "blacksheep/messages.pyx":97
  *     cdef bint _has_header(self, bytes key):
  *         cdef bytes existing_key, existing_value
  *         key = key.lower()             # <<<<<<<<<<<<<<
  *         for existing_key, existing_value in self.__headers:
  *             if existing_key.lower() == key:
  */
-  __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 97, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 100, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 97, __pyx_L1_error)
   __Pyx_DECREF_SET(__pyx_v_key, ((PyObject*)__pyx_t_1));
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":101
+  /* "blacksheep/messages.pyx":98
  *         cdef bytes existing_key, existing_value
  *         key = key.lower()
  *         for existing_key, existing_value in self.__headers:             # <<<<<<<<<<<<<<
  *             if existing_key.lower() == key:
  *                 return True
  */
   if (unlikely(__pyx_v_self->__pyx___headers == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 101, __pyx_L1_error)
+    __PYX_ERR(0, 98, __pyx_L1_error)
   }
   __pyx_t_1 = __pyx_v_self->__pyx___headers; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
   for (;;) {
     if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 101, __pyx_L1_error)
+    __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 98, __pyx_L1_error)
     #else
-    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 101, __pyx_L1_error)
+    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 98, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     #endif
     if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
       PyObject* sequence = __pyx_t_3;
       Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
       if (unlikely(size != 2)) {
         if (size > 2) __Pyx_RaiseTooManyValuesError(2);
         else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-        __PYX_ERR(0, 101, __pyx_L1_error)
+        __PYX_ERR(0, 98, __pyx_L1_error)
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
       if (likely(PyTuple_CheckExact(sequence))) {
         __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
         __pyx_t_5 = PyTuple_GET_ITEM(sequence, 1); 
       } else {
         __pyx_t_4 = PyList_GET_ITEM(sequence, 0); 
         __pyx_t_5 = PyList_GET_ITEM(sequence, 1); 
       }
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_5);
       #else
-      __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 101, __pyx_L1_error)
+      __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 98, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 101, __pyx_L1_error)
+      __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 98, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       #endif
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     } else {
       Py_ssize_t index = -1;
-      __pyx_t_6 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 101, __pyx_L1_error)
+      __pyx_t_6 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 98, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __pyx_t_7 = Py_TYPE(__pyx_t_6)->tp_iternext;
       index = 0; __pyx_t_4 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_4)) goto __pyx_L5_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_4);
       index = 1; __pyx_t_5 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_5)) goto __pyx_L5_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_5);
-      if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 2) < 0) __PYX_ERR(0, 101, __pyx_L1_error)
+      if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 2) < 0) __PYX_ERR(0, 98, __pyx_L1_error)
       __pyx_t_7 = NULL;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       goto __pyx_L6_unpacking_done;
       __pyx_L5_unpacking_failed:;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_7 = NULL;
       if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-      __PYX_ERR(0, 101, __pyx_L1_error)
+      __PYX_ERR(0, 98, __pyx_L1_error)
       __pyx_L6_unpacking_done:;
     }
-    if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 101, __pyx_L1_error)
-    if (!(likely(PyBytes_CheckExact(__pyx_t_5))||((__pyx_t_5) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_5)->tp_name), 0))) __PYX_ERR(0, 101, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 98, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_5))||((__pyx_t_5) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_5)->tp_name), 0))) __PYX_ERR(0, 98, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_existing_key, ((PyObject*)__pyx_t_4));
     __pyx_t_4 = 0;
     __Pyx_XDECREF_SET(__pyx_v_existing_value, ((PyObject*)__pyx_t_5));
     __pyx_t_5 = 0;
 
-    /* "blacksheep/messages.pyx":102
+    /* "blacksheep/messages.pyx":99
  *         key = key.lower()
  *         for existing_key, existing_value in self.__headers:
  *             if existing_key.lower() == key:             # <<<<<<<<<<<<<<
  *                 return True
  *         return False
  */
-    __pyx_t_3 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_existing_key); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 102, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_existing_key); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 99, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_8 = (__Pyx_PyBytes_Equals(__pyx_t_3, __pyx_v_key, Py_EQ)); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
+    __pyx_t_8 = (__Pyx_PyBytes_Equals(__pyx_t_3, __pyx_v_key, Py_EQ)); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 99, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     if (__pyx_t_8) {
 
-      /* "blacksheep/messages.pyx":103
+      /* "blacksheep/messages.pyx":100
  *         for existing_key, existing_value in self.__headers:
  *             if existing_key.lower() == key:
  *                 return True             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
       __pyx_r = 1;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       goto __pyx_L0;
 
-      /* "blacksheep/messages.pyx":102
+      /* "blacksheep/messages.pyx":99
  *         key = key.lower()
  *         for existing_key, existing_value in self.__headers:
  *             if existing_key.lower() == key:             # <<<<<<<<<<<<<<
  *                 return True
  *         return False
  */
     }
 
-    /* "blacksheep/messages.pyx":101
+    /* "blacksheep/messages.pyx":98
  *         cdef bytes existing_key, existing_value
  *         key = key.lower()
  *         for existing_key, existing_value in self.__headers:             # <<<<<<<<<<<<<<
  *             if existing_key.lower() == key:
  *                 return True
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":104
+  /* "blacksheep/messages.pyx":101
  *             if existing_key.lower() == key:
  *                 return True
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     cpdef bint has_header(self, bytes key):
  */
   __pyx_r = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":98
+  /* "blacksheep/messages.pyx":95
  *             self.__headers.remove(header)
  * 
  *     cdef bint _has_header(self, bytes key):             # <<<<<<<<<<<<<<
  *         cdef bytes existing_key, existing_value
  *         key = key.lower()
  */
 
@@ -5176,15 +5179,15 @@
   __Pyx_XDECREF(__pyx_v_existing_key);
   __Pyx_XDECREF(__pyx_v_existing_value);
   __Pyx_XDECREF(__pyx_v_key);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":106
+/* "blacksheep/messages.pyx":103
  *         return False
  * 
  *     cpdef bint has_header(self, bytes key):             # <<<<<<<<<<<<<<
  *         return self._has_header(key)
  * 
  */
 
@@ -5206,15 +5209,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_has_header); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 106, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_has_header); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 103, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_7Message_13has_header)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -5222,18 +5225,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_key) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_key);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 106, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 103, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 106, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 103, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -5244,25 +5247,25 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":107
+  /* "blacksheep/messages.pyx":104
  * 
  *     cpdef bint has_header(self, bytes key):
  *         return self._has_header(key)             # <<<<<<<<<<<<<<
  * 
  *     cdef void _add_header(self, bytes key, bytes value):
  */
   __pyx_r = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_v_self->__pyx_vtab)->_has_header(__pyx_v_self, __pyx_v_key);
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":106
+  /* "blacksheep/messages.pyx":103
  *         return False
  * 
  *     cpdef bint has_header(self, bytes key):             # <<<<<<<<<<<<<<
  *         return self._has_header(key)
  * 
  */
 
@@ -5284,15 +5287,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_7Message_13has_header(PyObject *__pyx_v_self, PyObject *__pyx_v_key) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("has_header (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_key), (&PyBytes_Type), 1, "key", 1))) __PYX_ERR(0, 106, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_key), (&PyBytes_Type), 1, "key", 1))) __PYX_ERR(0, 103, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Message_12has_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), ((PyObject*)__pyx_v_key));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -5305,15 +5308,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("has_header", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_7Message_has_header(__pyx_v_self, __pyx_v_key, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 106, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_7Message_has_header(__pyx_v_self, __pyx_v_key, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 103, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -5322,15 +5325,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":109
+/* "blacksheep/messages.pyx":106
  *         return self._has_header(key)
  * 
  *     cdef void _add_header(self, bytes key, bytes value):             # <<<<<<<<<<<<<<
  *         self.__headers.append((key, value))
  * 
  */
 
@@ -5339,37 +5342,37 @@
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_add_header", 0);
 
-  /* "blacksheep/messages.pyx":110
+  /* "blacksheep/messages.pyx":107
  * 
  *     cdef void _add_header(self, bytes key, bytes value):
  *         self.__headers.append((key, value))             # <<<<<<<<<<<<<<
  * 
  *     cdef void _add_header_if_missing(self, bytes key, bytes value):
  */
   if (unlikely(__pyx_v_self->__pyx___headers == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "append");
-    __PYX_ERR(0, 110, __pyx_L1_error)
+    __PYX_ERR(0, 107, __pyx_L1_error)
   }
-  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 107, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_v_key);
   __Pyx_GIVEREF(__pyx_v_key);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_key);
   __Pyx_INCREF(__pyx_v_value);
   __Pyx_GIVEREF(__pyx_v_value);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_value);
-  __pyx_t_2 = __Pyx_PyList_Append(__pyx_v_self->__pyx___headers, __pyx_t_1); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyList_Append(__pyx_v_self->__pyx___headers, __pyx_t_1); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 107, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":109
+  /* "blacksheep/messages.pyx":106
  *         return self._has_header(key)
  * 
  *     cdef void _add_header(self, bytes key, bytes value):             # <<<<<<<<<<<<<<
  *         self.__headers.append((key, value))
  * 
  */
 
@@ -5378,15 +5381,15 @@
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_WriteUnraisable("blacksheep.messages.Message._add_header", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "blacksheep/messages.pyx":112
+/* "blacksheep/messages.pyx":109
  *         self.__headers.append((key, value))
  * 
  *     cdef void _add_header_if_missing(self, bytes key, bytes value):             # <<<<<<<<<<<<<<
  *         if not self._has_header(key):
  *             self.__headers.append((key, value))
  */
 
@@ -5396,56 +5399,56 @@
   PyObject *__pyx_t_2 = NULL;
   int __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_add_header_if_missing", 0);
 
-  /* "blacksheep/messages.pyx":113
+  /* "blacksheep/messages.pyx":110
  * 
  *     cdef void _add_header_if_missing(self, bytes key, bytes value):
  *         if not self._has_header(key):             # <<<<<<<<<<<<<<
  *             self.__headers.append((key, value))
  * 
  */
   __pyx_t_1 = ((!(((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_v_self->__pyx_vtab)->_has_header(__pyx_v_self, __pyx_v_key) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "blacksheep/messages.pyx":114
+    /* "blacksheep/messages.pyx":111
  *     cdef void _add_header_if_missing(self, bytes key, bytes value):
  *         if not self._has_header(key):
  *             self.__headers.append((key, value))             # <<<<<<<<<<<<<<
  * 
  *     cpdef void add_header(self, bytes key, bytes value):
  */
     if (unlikely(__pyx_v_self->__pyx___headers == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "append");
-      __PYX_ERR(0, 114, __pyx_L1_error)
+      __PYX_ERR(0, 111, __pyx_L1_error)
     }
-    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 114, __pyx_L1_error)
+    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 111, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_INCREF(__pyx_v_key);
     __Pyx_GIVEREF(__pyx_v_key);
     PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_key);
     __Pyx_INCREF(__pyx_v_value);
     __Pyx_GIVEREF(__pyx_v_value);
     PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_value);
-    __pyx_t_3 = __Pyx_PyList_Append(__pyx_v_self->__pyx___headers, __pyx_t_2); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 114, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyList_Append(__pyx_v_self->__pyx___headers, __pyx_t_2); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 111, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "blacksheep/messages.pyx":113
+    /* "blacksheep/messages.pyx":110
  * 
  *     cdef void _add_header_if_missing(self, bytes key, bytes value):
  *         if not self._has_header(key):             # <<<<<<<<<<<<<<
  *             self.__headers.append((key, value))
  * 
  */
   }
 
-  /* "blacksheep/messages.pyx":112
+  /* "blacksheep/messages.pyx":109
  *         self.__headers.append((key, value))
  * 
  *     cdef void _add_header_if_missing(self, bytes key, bytes value):             # <<<<<<<<<<<<<<
  *         if not self._has_header(key):
  *             self.__headers.append((key, value))
  */
 
@@ -5454,15 +5457,15 @@
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_WriteUnraisable("blacksheep.messages.Message._add_header_if_missing", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "blacksheep/messages.pyx":116
+/* "blacksheep/messages.pyx":113
  *             self.__headers.append((key, value))
  * 
  *     cpdef void add_header(self, bytes key, bytes value):             # <<<<<<<<<<<<<<
  *         self.__headers.append((key, value))
  * 
  */
 
@@ -5485,15 +5488,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add_header); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add_header); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_7Message_15add_header)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         __pyx_t_5 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -5504,40 +5507,40 @@
             __Pyx_DECREF_SET(__pyx_t_3, function);
             __pyx_t_5 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_3)) {
           PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_key, __pyx_v_value};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 116, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 113, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_GOTREF(__pyx_t_2);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
           PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_key, __pyx_v_value};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 116, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 113, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_GOTREF(__pyx_t_2);
         } else
         #endif
         {
-          __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 116, __pyx_L1_error)
+          __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           if (__pyx_t_4) {
             __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
           }
           __Pyx_INCREF(__pyx_v_key);
           __Pyx_GIVEREF(__pyx_v_key);
           PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_key);
           __Pyx_INCREF(__pyx_v_value);
           __Pyx_GIVEREF(__pyx_v_value);
           PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_v_value);
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 116, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 113, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         }
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
@@ -5551,37 +5554,37 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":117
+  /* "blacksheep/messages.pyx":114
  * 
  *     cpdef void add_header(self, bytes key, bytes value):
  *         self.__headers.append((key, value))             # <<<<<<<<<<<<<<
  * 
  *     cpdef void set_header(self, bytes key, bytes value):
  */
   if (unlikely(__pyx_v_self->__pyx___headers == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "append");
-    __PYX_ERR(0, 117, __pyx_L1_error)
+    __PYX_ERR(0, 114, __pyx_L1_error)
   }
-  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 114, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_v_key);
   __Pyx_GIVEREF(__pyx_v_key);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_key);
   __Pyx_INCREF(__pyx_v_value);
   __Pyx_GIVEREF(__pyx_v_value);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_value);
-  __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_self->__pyx___headers, __pyx_t_1); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_self->__pyx___headers, __pyx_t_1); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 114, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":116
+  /* "blacksheep/messages.pyx":113
  *             self.__headers.append((key, value))
  * 
  *     cpdef void add_header(self, bytes key, bytes value):             # <<<<<<<<<<<<<<
  *         self.__headers.append((key, value))
  * 
  */
 
@@ -5628,39 +5631,39 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_key)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_value)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("add_header", 1, 2, 2, 1); __PYX_ERR(0, 116, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("add_header", 1, 2, 2, 1); __PYX_ERR(0, 113, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add_header") < 0)) __PYX_ERR(0, 116, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add_header") < 0)) __PYX_ERR(0, 113, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_key = ((PyObject*)values[0]);
     __pyx_v_value = ((PyObject*)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("add_header", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 116, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("add_header", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 113, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("blacksheep.messages.Message.add_header", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_key), (&PyBytes_Type), 1, "key", 1))) __PYX_ERR(0, 116, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyBytes_Type), 1, "value", 1))) __PYX_ERR(0, 116, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_key), (&PyBytes_Type), 1, "key", 1))) __PYX_ERR(0, 113, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyBytes_Type), 1, "value", 1))) __PYX_ERR(0, 113, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Message_14add_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_v_key, __pyx_v_value);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -5673,15 +5676,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("add_header", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_10blacksheep_8messages_7Message_add_header(__pyx_v_self, __pyx_v_key, __pyx_v_value, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_10blacksheep_8messages_7Message_add_header(__pyx_v_self, __pyx_v_key, __pyx_v_value, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -5690,15 +5693,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":119
+/* "blacksheep/messages.pyx":116
  *         self.__headers.append((key, value))
  * 
  *     cpdef void set_header(self, bytes key, bytes value):             # <<<<<<<<<<<<<<
  *         self.remove_header(key)
  *         self.__headers.append((key, value))
  */
 
@@ -5721,15 +5724,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_header); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 119, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_header); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_7Message_17set_header)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         __pyx_t_5 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -5740,40 +5743,40 @@
             __Pyx_DECREF_SET(__pyx_t_3, function);
             __pyx_t_5 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_3)) {
           PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_key, __pyx_v_value};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 119, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 116, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_GOTREF(__pyx_t_2);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
           PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_key, __pyx_v_value};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 119, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 116, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_GOTREF(__pyx_t_2);
         } else
         #endif
         {
-          __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 119, __pyx_L1_error)
+          __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 116, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           if (__pyx_t_4) {
             __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
           }
           __Pyx_INCREF(__pyx_v_key);
           __Pyx_GIVEREF(__pyx_v_key);
           PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_key);
           __Pyx_INCREF(__pyx_v_value);
           __Pyx_GIVEREF(__pyx_v_value);
           PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_v_value);
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 119, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 116, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         }
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
@@ -5787,46 +5790,46 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":120
+  /* "blacksheep/messages.pyx":117
  * 
  *     cpdef void set_header(self, bytes key, bytes value):
  *         self.remove_header(key)             # <<<<<<<<<<<<<<
  *         self.__headers.append((key, value))
  * 
  */
   ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_v_self->__pyx_vtab)->remove_header(__pyx_v_self, __pyx_v_key, 0);
 
-  /* "blacksheep/messages.pyx":121
+  /* "blacksheep/messages.pyx":118
  *     cpdef void set_header(self, bytes key, bytes value):
  *         self.remove_header(key)
  *         self.__headers.append((key, value))             # <<<<<<<<<<<<<<
  * 
  *     cpdef bytes content_type(self):
  */
   if (unlikely(__pyx_v_self->__pyx___headers == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "append");
-    __PYX_ERR(0, 121, __pyx_L1_error)
+    __PYX_ERR(0, 118, __pyx_L1_error)
   }
-  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 118, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_v_key);
   __Pyx_GIVEREF(__pyx_v_key);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_key);
   __Pyx_INCREF(__pyx_v_value);
   __Pyx_GIVEREF(__pyx_v_value);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_value);
-  __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_self->__pyx___headers, __pyx_t_1); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_self->__pyx___headers, __pyx_t_1); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 118, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":119
+  /* "blacksheep/messages.pyx":116
  *         self.__headers.append((key, value))
  * 
  *     cpdef void set_header(self, bytes key, bytes value):             # <<<<<<<<<<<<<<
  *         self.remove_header(key)
  *         self.__headers.append((key, value))
  */
 
@@ -5873,39 +5876,39 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_key)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_value)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("set_header", 1, 2, 2, 1); __PYX_ERR(0, 119, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("set_header", 1, 2, 2, 1); __PYX_ERR(0, 116, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_header") < 0)) __PYX_ERR(0, 119, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_header") < 0)) __PYX_ERR(0, 116, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_key = ((PyObject*)values[0]);
     __pyx_v_value = ((PyObject*)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("set_header", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 119, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("set_header", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 116, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("blacksheep.messages.Message.set_header", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_key), (&PyBytes_Type), 1, "key", 1))) __PYX_ERR(0, 119, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyBytes_Type), 1, "value", 1))) __PYX_ERR(0, 119, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_key), (&PyBytes_Type), 1, "key", 1))) __PYX_ERR(0, 116, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyBytes_Type), 1, "value", 1))) __PYX_ERR(0, 116, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Message_16set_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_v_key, __pyx_v_value);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -5918,15 +5921,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_header", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_10blacksheep_8messages_7Message_set_header(__pyx_v_self, __pyx_v_key, __pyx_v_value, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 119, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_10blacksheep_8messages_7Message_set_header(__pyx_v_self, __pyx_v_key, __pyx_v_value, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -5935,15 +5938,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":123
+/* "blacksheep/messages.pyx":120
  *         self.__headers.append((key, value))
  * 
  *     cpdef bytes content_type(self):             # <<<<<<<<<<<<<<
  *         if self.content and self.content.type:
  *             return self.content.type
  */
 
@@ -5966,15 +5969,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_content_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 123, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_content_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 120, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_7Message_19content_type)) {
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -5983,18 +5986,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 123, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 120, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 123, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 120, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -6005,68 +6008,68 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":124
+  /* "blacksheep/messages.pyx":121
  * 
  *     cpdef bytes content_type(self):
  *         if self.content and self.content.type:             # <<<<<<<<<<<<<<
  *             return self.content.type
  *         return self.get_first_header(b'content-type')
  */
-  __pyx_t_6 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_self->content)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 124, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_self->content)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 121, __pyx_L1_error)
   if (__pyx_t_6) {
   } else {
     __pyx_t_5 = __pyx_t_6;
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = (__pyx_v_self->content->type != Py_None)&&(PyBytes_GET_SIZE(__pyx_v_self->content->type) != 0);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_5) {
 
-    /* "blacksheep/messages.pyx":125
+    /* "blacksheep/messages.pyx":122
  *     cpdef bytes content_type(self):
  *         if self.content and self.content.type:
  *             return self.content.type             # <<<<<<<<<<<<<<
  *         return self.get_first_header(b'content-type')
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->content->type);
     __pyx_r = __pyx_v_self->content->type;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":124
+    /* "blacksheep/messages.pyx":121
  * 
  *     cpdef bytes content_type(self):
  *         if self.content and self.content.type:             # <<<<<<<<<<<<<<
  *             return self.content.type
  *         return self.get_first_header(b'content-type')
  */
   }
 
-  /* "blacksheep/messages.pyx":126
+  /* "blacksheep/messages.pyx":123
  *         if self.content and self.content.type:
  *             return self.content.type
  *         return self.get_first_header(b'content-type')             # <<<<<<<<<<<<<<
  * 
  *     async def read(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_v_self->__pyx_vtab)->get_first_header(__pyx_v_self, __pyx_kp_b_content_type_2, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 126, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_v_self->__pyx_vtab)->get_first_header(__pyx_v_self, __pyx_kp_b_content_type_2, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 123, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":123
+  /* "blacksheep/messages.pyx":120
  *         self.__headers.append((key, value))
  * 
  *     cpdef bytes content_type(self):             # <<<<<<<<<<<<<<
  *         if self.content and self.content.type:
  *             return self.content.type
  */
 
@@ -6102,15 +6105,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("content_type", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_10blacksheep_8messages_7Message_content_type(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 123, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_10blacksheep_8messages_7Message_content_type(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -6120,15 +6123,15 @@
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_10blacksheep_8messages_7Message_22generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "blacksheep/messages.pyx":128
+/* "blacksheep/messages.pyx":125
  *         return self.get_first_header(b'content-type')
  * 
  *     async def read(self):             # <<<<<<<<<<<<<<
  *         if self.content:
  *             # TODO: return content.body if not an instance of StreamedContent?
  */
 
@@ -6153,23 +6156,23 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("read", 0);
   __pyx_cur_scope = (struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct__read *)__pyx_tp_new_10blacksheep_8messages___pyx_scope_struct__read(__pyx_ptype_10blacksheep_8messages___pyx_scope_struct__read, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct__read *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 128, __pyx_L1_error)
+    __PYX_ERR(0, 125, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_8messages_7Message_22generator, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_read, __pyx_n_s_Message_read, __pyx_n_s_blacksheep_messages); if (unlikely(!gen)) __PYX_ERR(0, 128, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_8messages_7Message_22generator, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_read, __pyx_n_s_Message_read, __pyx_n_s_blacksheep_messages); if (unlikely(!gen)) __PYX_ERR(0, 125, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -6198,95 +6201,95 @@
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L5_resume_from_await;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 128, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 125, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":129
+  /* "blacksheep/messages.pyx":126
  * 
  *     async def read(self):
  *         if self.content:             # <<<<<<<<<<<<<<
  *             # TODO: return content.body if not an instance of StreamedContent?
  *             return await self.content.read()
  */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_cur_scope->__pyx_v_self->content)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 129, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_cur_scope->__pyx_v_self->content)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 126, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "blacksheep/messages.pyx":131
+    /* "blacksheep/messages.pyx":128
  *         if self.content:
  *             # TODO: return content.body if not an instance of StreamedContent?
  *             return await self.content.read()             # <<<<<<<<<<<<<<
  *         return None
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self->content), __pyx_n_s_read); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 131, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self->content), __pyx_n_s_read); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 128, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 131, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 128, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_2);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XGOTREF(__pyx_r);
     if (likely(__pyx_r)) {
       __Pyx_XGIVEREF(__pyx_r);
       __Pyx_RefNannyFinishContext();
       __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
       /* return from generator, awaiting value */
       __pyx_generator->resume_label = 1;
       return __pyx_r;
       __pyx_L5_resume_from_await:;
-      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 131, __pyx_L1_error)
+      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 128, __pyx_L1_error)
       __pyx_t_2 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_2);
     } else {
       __pyx_t_2 = NULL;
-      if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_2) < 0) __PYX_ERR(0, 131, __pyx_L1_error)
+      if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_2) < 0) __PYX_ERR(0, 128, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
     }
     __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":129
+    /* "blacksheep/messages.pyx":126
  * 
  *     async def read(self):
  *         if self.content:             # <<<<<<<<<<<<<<
  *             # TODO: return content.body if not an instance of StreamedContent?
  *             return await self.content.read()
  */
   }
 
-  /* "blacksheep/messages.pyx":132
+  /* "blacksheep/messages.pyx":129
  *             # TODO: return content.body if not an instance of StreamedContent?
  *             return await self.content.read()
  *         return None             # <<<<<<<<<<<<<<
  * 
  *     async def stream(self):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_r = NULL;
   goto __pyx_L0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "blacksheep/messages.pyx":128
+  /* "blacksheep/messages.pyx":125
  *         return self.get_first_header(b'content-type')
  * 
  *     async def read(self):             # <<<<<<<<<<<<<<
  *         if self.content:
  *             # TODO: return content.body if not an instance of StreamedContent?
  */
 
@@ -6304,15 +6307,15 @@
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_10blacksheep_8messages_7Message_25generator1(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "blacksheep/messages.pyx":134
+/* "blacksheep/messages.pyx":131
  *         return None
  * 
  *     async def stream(self):             # <<<<<<<<<<<<<<
  *         if self.content:
  *             async for chunk in self.content.stream():
  */
 
@@ -6337,23 +6340,23 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("stream", 0);
   __pyx_cur_scope = (struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_1_stream *)__pyx_tp_new_10blacksheep_8messages___pyx_scope_struct_1_stream(__pyx_ptype_10blacksheep_8messages___pyx_scope_struct_1_stream, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_1_stream *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 134, __pyx_L1_error)
+    __PYX_ERR(0, 131, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   {
-    __pyx_CoroutineObject *gen = __Pyx_AsyncGen_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_8messages_7Message_25generator1, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_stream, __pyx_n_s_Message_stream, __pyx_n_s_blacksheep_messages); if (unlikely(!gen)) __PYX_ERR(0, 134, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_AsyncGen_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_8messages_7Message_25generator1, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_stream, __pyx_n_s_Message_stream, __pyx_n_s_blacksheep_messages); if (unlikely(!gen)) __PYX_ERR(0, 131, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -6384,55 +6387,55 @@
     case 2: goto __pyx_L8_resume_from_yield;
     case 3: goto __pyx_L9_resume_from_yield;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 134, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 131, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":135
+  /* "blacksheep/messages.pyx":132
  * 
  *     async def stream(self):
  *         if self.content:             # <<<<<<<<<<<<<<
  *             async for chunk in self.content.stream():
  *                 yield chunk
  */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_cur_scope->__pyx_v_self->content)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 135, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_cur_scope->__pyx_v_self->content)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 132, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "blacksheep/messages.pyx":136
+    /* "blacksheep/messages.pyx":133
  *     async def stream(self):
  *         if self.content:
  *             async for chunk in self.content.stream():             # <<<<<<<<<<<<<<
  *                 yield chunk
  *         else:
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self->content), __pyx_n_s_stream); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 136, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self->content), __pyx_n_s_stream); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 133, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 136, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 133, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_Coroutine_GetAsyncIter(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 136, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_Coroutine_GetAsyncIter(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 133, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     for (;;) {
-      __pyx_t_2 = __Pyx_Coroutine_AsyncIterNext(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 136, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_Coroutine_AsyncIterNext(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 133, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_2);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_XGOTREF(__pyx_r);
       if (likely(__pyx_r)) {
         __Pyx_XGIVEREF(__pyx_t_3);
         __pyx_cur_scope->__pyx_t_0 = __pyx_t_3;
@@ -6448,33 +6451,33 @@
         __Pyx_XGOTREF(__pyx_t_3);
         if (unlikely(!__pyx_sent_value)) {
           PyObject* exc_type = __Pyx_PyErr_Occurred();
           if (unlikely(exc_type && (exc_type == __Pyx_PyExc_StopAsyncIteration || ( exc_type != PyExc_StopIteration && exc_type != PyExc_GeneratorExit && __Pyx_PyErr_GivenExceptionMatches(exc_type, __Pyx_PyExc_StopAsyncIteration))))) {
             PyErr_Clear();
             break;
           }
-          __PYX_ERR(0, 136, __pyx_L1_error)
+          __PYX_ERR(0, 133, __pyx_L1_error)
         }
         __pyx_t_2 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_2);
       } else {
         PyObject* exc_type = __Pyx_PyErr_Occurred();
         if (unlikely(exc_type && (exc_type == __Pyx_PyExc_StopAsyncIteration || ( exc_type != PyExc_StopIteration && exc_type != PyExc_GeneratorExit && __Pyx_PyErr_GivenExceptionMatches(exc_type, __Pyx_PyExc_StopAsyncIteration))))) {
           PyErr_Clear();
           break;
         }
         __pyx_t_2 = NULL;
-        if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_2) < 0) __PYX_ERR(0, 136, __pyx_L1_error)
+        if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_2) < 0) __PYX_ERR(0, 133, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
       }
       __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_chunk);
       __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_chunk, __pyx_t_2);
       __Pyx_GIVEREF(__pyx_t_2);
       __pyx_t_2 = 0;
 
-      /* "blacksheep/messages.pyx":137
+      /* "blacksheep/messages.pyx":134
  *         if self.content:
  *             async for chunk in self.content.stream():
  *                 yield chunk             # <<<<<<<<<<<<<<
  *         else:
  *             yield None
  */
       __Pyx_INCREF(__pyx_cur_scope->__pyx_v_chunk);
@@ -6487,37 +6490,37 @@
       /* return from async generator, yielding value */
       __pyx_generator->resume_label = 2;
       return __Pyx__PyAsyncGenValueWrapperNew(__pyx_r);
       __pyx_L8_resume_from_yield:;
       __pyx_t_3 = __pyx_cur_scope->__pyx_t_0;
       __pyx_cur_scope->__pyx_t_0 = 0;
       __Pyx_XGOTREF(__pyx_t_3);
-      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 137, __pyx_L1_error)
+      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 134, __pyx_L1_error)
 
-      /* "blacksheep/messages.pyx":136
+      /* "blacksheep/messages.pyx":133
  *     async def stream(self):
  *         if self.content:
  *             async for chunk in self.content.stream():             # <<<<<<<<<<<<<<
  *                 yield chunk
  *         else:
  */
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "blacksheep/messages.pyx":135
+    /* "blacksheep/messages.pyx":132
  * 
  *     async def stream(self):
  *         if self.content:             # <<<<<<<<<<<<<<
  *             async for chunk in self.content.stream():
  *                 yield chunk
  */
     goto __pyx_L4;
   }
 
-  /* "blacksheep/messages.pyx":139
+  /* "blacksheep/messages.pyx":136
  *                 yield chunk
  *         else:
  *             yield None             # <<<<<<<<<<<<<<
  * 
  *     async def text(self):
  */
   /*else*/ {
@@ -6526,20 +6529,20 @@
     __Pyx_XGIVEREF(__pyx_r);
     __Pyx_RefNannyFinishContext();
     __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
     /* return from async generator, yielding value */
     __pyx_generator->resume_label = 3;
     return __Pyx__PyAsyncGenValueWrapperNew(__pyx_r);
     __pyx_L9_resume_from_yield:;
-    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 139, __pyx_L1_error)
+    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 136, __pyx_L1_error)
   }
   __pyx_L4:;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "blacksheep/messages.pyx":134
+  /* "blacksheep/messages.pyx":131
  *         return None
  * 
  *     async def stream(self):             # <<<<<<<<<<<<<<
  *         if self.content:
  *             async for chunk in self.content.stream():
  */
 
@@ -6559,15 +6562,15 @@
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_10blacksheep_8messages_7Message_28generator2(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "blacksheep/messages.pyx":141
+/* "blacksheep/messages.pyx":138
  *             yield None
  * 
  *     async def text(self):             # <<<<<<<<<<<<<<
  *         body = await self.read()
  * 
  */
 
@@ -6592,23 +6595,23 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("text", 0);
   __pyx_cur_scope = (struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_2_text *)__pyx_tp_new_10blacksheep_8messages___pyx_scope_struct_2_text(__pyx_ptype_10blacksheep_8messages___pyx_scope_struct_2_text, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_2_text *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 141, __pyx_L1_error)
+    __PYX_ERR(0, 138, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_8messages_7Message_28generator2, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_text, __pyx_n_s_Message_text, __pyx_n_s_blacksheep_messages); if (unlikely(!gen)) __PYX_ERR(0, 141, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_8messages_7Message_28generator2, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_text, __pyx_n_s_Message_text, __pyx_n_s_blacksheep_messages); if (unlikely(!gen)) __PYX_ERR(0, 138, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -6653,286 +6656,286 @@
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L4_resume_from_await;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 141, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 138, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":142
+  /* "blacksheep/messages.pyx":139
  * 
  *     async def text(self):
  *         body = await self.read()             # <<<<<<<<<<<<<<
  * 
  *         if body is None:
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_read); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 142, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_read); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_XGOTREF(__pyx_r);
   if (likely(__pyx_r)) {
     __Pyx_XGIVEREF(__pyx_r);
     __Pyx_RefNannyFinishContext();
     __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
     /* return from generator, awaiting value */
     __pyx_generator->resume_label = 1;
     return __pyx_r;
     __pyx_L4_resume_from_await:;
-    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 142, __pyx_L1_error)
+    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 139, __pyx_L1_error)
     __pyx_t_1 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_1);
   } else {
     __pyx_t_1 = NULL;
-    if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 142, __pyx_L1_error)
+    if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
   }
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_cur_scope->__pyx_v_body = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":144
+  /* "blacksheep/messages.pyx":141
  *         body = await self.read()
  * 
  *         if body is None:             # <<<<<<<<<<<<<<
  *             return ""
  *         try:
  */
   __pyx_t_4 = (__pyx_cur_scope->__pyx_v_body == Py_None);
   __pyx_t_5 = (__pyx_t_4 != 0);
   if (__pyx_t_5) {
 
-    /* "blacksheep/messages.pyx":145
+    /* "blacksheep/messages.pyx":142
  * 
  *         if body is None:
  *             return ""             # <<<<<<<<<<<<<<
  *         try:
  *             return body.decode(self.charset)
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_kp_u__3);
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":144
+    /* "blacksheep/messages.pyx":141
  *         body = await self.read()
  * 
  *         if body is None:             # <<<<<<<<<<<<<<
  *             return ""
  *         try:
  */
   }
 
-  /* "blacksheep/messages.pyx":146
+  /* "blacksheep/messages.pyx":143
  *         if body is None:
  *             return ""
  *         try:             # <<<<<<<<<<<<<<
  *             return body.decode(self.charset)
  *         except UnicodeDecodeError:
  */
   {
     __Pyx_ExceptionSave(&__pyx_t_6, &__pyx_t_7, &__pyx_t_8);
     __Pyx_XGOTREF(__pyx_t_6);
     __Pyx_XGOTREF(__pyx_t_7);
     __Pyx_XGOTREF(__pyx_t_8);
     /*try:*/ {
 
-      /* "blacksheep/messages.pyx":147
+      /* "blacksheep/messages.pyx":144
  *             return ""
  *         try:
  *             return body.decode(self.charset)             # <<<<<<<<<<<<<<
  *         except UnicodeDecodeError:
  *             # this can happen when the server returned a declared charset,
  */
       __Pyx_XDECREF(__pyx_r);
-      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_body, __pyx_n_s_decode); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 147, __pyx_L6_error)
+      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_body, __pyx_n_s_decode); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 144, __pyx_L6_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_charset); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 147, __pyx_L6_error)
+      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_charset); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 144, __pyx_L6_error)
       __Pyx_GOTREF(__pyx_t_3);
       __pyx_t_9 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
         __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_2);
         if (likely(__pyx_t_9)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
           __Pyx_INCREF(__pyx_t_9);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_2, function);
         }
       }
       __pyx_t_1 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_9, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
       __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 147, __pyx_L6_error)
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 144, __pyx_L6_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       goto __pyx_L10_try_return;
 
-      /* "blacksheep/messages.pyx":146
+      /* "blacksheep/messages.pyx":143
  *         if body is None:
  *             return ""
  *         try:             # <<<<<<<<<<<<<<
  *             return body.decode(self.charset)
  *         except UnicodeDecodeError:
  */
     }
     __pyx_L6_error:;
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-    /* "blacksheep/messages.pyx":148
+    /* "blacksheep/messages.pyx":145
  *         try:
  *             return body.decode(self.charset)
  *         except UnicodeDecodeError:             # <<<<<<<<<<<<<<
  *             # this can happen when the server returned a declared charset,
  *             # but its content is not actually using the declared encoding
  */
     __pyx_t_10 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_UnicodeDecodeError);
     if (__pyx_t_10) {
       __Pyx_AddTraceback("blacksheep.messages.Message.text", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3) < 0) __PYX_ERR(0, 148, __pyx_L8_except_error)
+      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3) < 0) __PYX_ERR(0, 145, __pyx_L8_except_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_GOTREF(__pyx_t_3);
 
-      /* "blacksheep/messages.pyx":152
+      /* "blacksheep/messages.pyx":149
  *             # but its content is not actually using the declared encoding
  *             # a common encoding is 'ISO-8859-1', so before using chardet, we try with this
  *             if self.charset != 'ISO-8859-1':             # <<<<<<<<<<<<<<
  *                 try:
  *                     return body.decode('ISO-8859-1')
  */
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_charset); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 152, __pyx_L8_except_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_charset); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 149, __pyx_L8_except_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_9, __pyx_kp_u_ISO_8859_1, Py_NE)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 152, __pyx_L8_except_error)
+      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_9, __pyx_kp_u_ISO_8859_1, Py_NE)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 149, __pyx_L8_except_error)
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       if (__pyx_t_5) {
 
-        /* "blacksheep/messages.pyx":153
+        /* "blacksheep/messages.pyx":150
  *             # a common encoding is 'ISO-8859-1', so before using chardet, we try with this
  *             if self.charset != 'ISO-8859-1':
  *                 try:             # <<<<<<<<<<<<<<
  *                     return body.decode('ISO-8859-1')
  *                 except UnicodeDecodeError:
  */
         {
           __Pyx_ExceptionSave(&__pyx_t_11, &__pyx_t_12, &__pyx_t_13);
           __Pyx_XGOTREF(__pyx_t_11);
           __Pyx_XGOTREF(__pyx_t_12);
           __Pyx_XGOTREF(__pyx_t_13);
           /*try:*/ {
 
-            /* "blacksheep/messages.pyx":154
+            /* "blacksheep/messages.pyx":151
  *             if self.charset != 'ISO-8859-1':
  *                 try:
  *                     return body.decode('ISO-8859-1')             # <<<<<<<<<<<<<<
  *                 except UnicodeDecodeError:
- *                     # fallback to chardet;
+ *                     # fallback to trying to detect the encoding;
  */
             __Pyx_XDECREF(__pyx_r);
-            __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_body, __pyx_n_s_decode); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 154, __pyx_L15_error)
+            __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_body, __pyx_n_s_decode); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 151, __pyx_L15_error)
             __Pyx_GOTREF(__pyx_t_14);
             __pyx_t_15 = NULL;
             if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_14))) {
               __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_14);
               if (likely(__pyx_t_15)) {
                 PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
                 __Pyx_INCREF(__pyx_t_15);
                 __Pyx_INCREF(function);
                 __Pyx_DECREF_SET(__pyx_t_14, function);
               }
             }
             __pyx_t_9 = (__pyx_t_15) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_15, __pyx_kp_u_ISO_8859_1) : __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_kp_u_ISO_8859_1);
             __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
-            if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 154, __pyx_L15_error)
+            if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 151, __pyx_L15_error)
             __Pyx_GOTREF(__pyx_t_9);
             __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
             __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_9);
             __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
             __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
             __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
             goto __pyx_L19_try_return;
 
-            /* "blacksheep/messages.pyx":153
+            /* "blacksheep/messages.pyx":150
  *             # a common encoding is 'ISO-8859-1', so before using chardet, we try with this
  *             if self.charset != 'ISO-8859-1':
  *                 try:             # <<<<<<<<<<<<<<
  *                     return body.decode('ISO-8859-1')
  *                 except UnicodeDecodeError:
  */
           }
           __pyx_L15_error:;
           __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
           __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
           __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-          /* "blacksheep/messages.pyx":155
+          /* "blacksheep/messages.pyx":152
  *                 try:
  *                     return body.decode('ISO-8859-1')
  *                 except UnicodeDecodeError:             # <<<<<<<<<<<<<<
- *                     # fallback to chardet;
- *                     return body.decode(chardet.detect(body)['encoding'])
+ *                     # fallback to trying to detect the encoding;
+ *                     return body.decode(charset_normalizer.detect(body)['encoding'])
  */
           __pyx_t_10 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_UnicodeDecodeError);
           if (__pyx_t_10) {
             __Pyx_AddTraceback("blacksheep.messages.Message.text", __pyx_clineno, __pyx_lineno, __pyx_filename);
-            if (__Pyx_GetException(&__pyx_t_9, &__pyx_t_14, &__pyx_t_15) < 0) __PYX_ERR(0, 155, __pyx_L17_except_error)
+            if (__Pyx_GetException(&__pyx_t_9, &__pyx_t_14, &__pyx_t_15) < 0) __PYX_ERR(0, 152, __pyx_L17_except_error)
             __Pyx_GOTREF(__pyx_t_9);
             __Pyx_GOTREF(__pyx_t_14);
             __Pyx_GOTREF(__pyx_t_15);
 
-            /* "blacksheep/messages.pyx":157
+            /* "blacksheep/messages.pyx":154
  *                 except UnicodeDecodeError:
- *                     # fallback to chardet;
- *                     return body.decode(chardet.detect(body)['encoding'])             # <<<<<<<<<<<<<<
+ *                     # fallback to trying to detect the encoding;
+ *                     return body.decode(charset_normalizer.detect(body)['encoding'])             # <<<<<<<<<<<<<<
  * 
  *     async def form(self):
  */
             __Pyx_XDECREF(__pyx_r);
-            __pyx_t_17 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_body, __pyx_n_s_decode); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 157, __pyx_L17_except_error)
+            __pyx_t_17 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_body, __pyx_n_s_decode); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 154, __pyx_L17_except_error)
             __Pyx_GOTREF(__pyx_t_17);
-            __Pyx_GetModuleGlobalName(__pyx_t_19, __pyx_n_s_chardet); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 157, __pyx_L17_except_error)
+            __Pyx_GetModuleGlobalName(__pyx_t_19, __pyx_n_s_charset_normalizer); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 154, __pyx_L17_except_error)
             __Pyx_GOTREF(__pyx_t_19);
-            __pyx_t_20 = __Pyx_PyObject_GetAttrStr(__pyx_t_19, __pyx_n_s_detect); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 157, __pyx_L17_except_error)
+            __pyx_t_20 = __Pyx_PyObject_GetAttrStr(__pyx_t_19, __pyx_n_s_detect); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 154, __pyx_L17_except_error)
             __Pyx_GOTREF(__pyx_t_20);
             __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
             __pyx_t_19 = NULL;
             if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_20))) {
               __pyx_t_19 = PyMethod_GET_SELF(__pyx_t_20);
               if (likely(__pyx_t_19)) {
                 PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_20);
                 __Pyx_INCREF(__pyx_t_19);
                 __Pyx_INCREF(function);
                 __Pyx_DECREF_SET(__pyx_t_20, function);
               }
             }
             __pyx_t_18 = (__pyx_t_19) ? __Pyx_PyObject_Call2Args(__pyx_t_20, __pyx_t_19, __pyx_cur_scope->__pyx_v_body) : __Pyx_PyObject_CallOneArg(__pyx_t_20, __pyx_cur_scope->__pyx_v_body);
             __Pyx_XDECREF(__pyx_t_19); __pyx_t_19 = 0;
-            if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 157, __pyx_L17_except_error)
+            if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 154, __pyx_L17_except_error)
             __Pyx_GOTREF(__pyx_t_18);
             __Pyx_DECREF(__pyx_t_20); __pyx_t_20 = 0;
-            __pyx_t_20 = __Pyx_PyObject_Dict_GetItem(__pyx_t_18, __pyx_n_u_encoding); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 157, __pyx_L17_except_error)
+            __pyx_t_20 = __Pyx_PyObject_Dict_GetItem(__pyx_t_18, __pyx_n_u_encoding); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 154, __pyx_L17_except_error)
             __Pyx_GOTREF(__pyx_t_20);
             __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
             __pyx_t_18 = NULL;
             if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_17))) {
               __pyx_t_18 = PyMethod_GET_SELF(__pyx_t_17);
               if (likely(__pyx_t_18)) {
                 PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_17);
@@ -6940,15 +6943,15 @@
                 __Pyx_INCREF(function);
                 __Pyx_DECREF_SET(__pyx_t_17, function);
               }
             }
             __pyx_t_16 = (__pyx_t_18) ? __Pyx_PyObject_Call2Args(__pyx_t_17, __pyx_t_18, __pyx_t_20) : __Pyx_PyObject_CallOneArg(__pyx_t_17, __pyx_t_20);
             __Pyx_XDECREF(__pyx_t_18); __pyx_t_18 = 0;
             __Pyx_DECREF(__pyx_t_20); __pyx_t_20 = 0;
-            if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 157, __pyx_L17_except_error)
+            if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 154, __pyx_L17_except_error)
             __Pyx_GOTREF(__pyx_t_16);
             __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
             __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_16);
             __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
             __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
             __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
@@ -6956,15 +6959,15 @@
             __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
             __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
             goto __pyx_L18_except_return;
           }
           goto __pyx_L17_except_error;
           __pyx_L17_except_error:;
 
-          /* "blacksheep/messages.pyx":153
+          /* "blacksheep/messages.pyx":150
  *             # a common encoding is 'ISO-8859-1', so before using chardet, we try with this
  *             if self.charset != 'ISO-8859-1':
  *                 try:             # <<<<<<<<<<<<<<
  *                     return body.decode('ISO-8859-1')
  *                 except UnicodeDecodeError:
  */
           __Pyx_XGIVEREF(__pyx_t_11);
@@ -6982,15 +6985,15 @@
           __Pyx_XGIVEREF(__pyx_t_11);
           __Pyx_XGIVEREF(__pyx_t_12);
           __Pyx_XGIVEREF(__pyx_t_13);
           __Pyx_ExceptionReset(__pyx_t_11, __pyx_t_12, __pyx_t_13);
           goto __pyx_L9_except_return;
         }
 
-        /* "blacksheep/messages.pyx":152
+        /* "blacksheep/messages.pyx":149
  *             # but its content is not actually using the declared encoding
  *             # a common encoding is 'ISO-8859-1', so before using chardet, we try with this
  *             if self.charset != 'ISO-8859-1':             # <<<<<<<<<<<<<<
  *                 try:
  *                     return body.decode('ISO-8859-1')
  */
       }
@@ -6998,15 +7001,15 @@
       __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
       goto __pyx_L7_exception_handled;
     }
     goto __pyx_L8_except_error;
     __pyx_L8_except_error:;
 
-    /* "blacksheep/messages.pyx":146
+    /* "blacksheep/messages.pyx":143
  *         if body is None:
  *             return ""
  *         try:             # <<<<<<<<<<<<<<
  *             return body.decode(self.charset)
  *         except UnicodeDecodeError:
  */
     __Pyx_XGIVEREF(__pyx_t_6);
@@ -7030,15 +7033,15 @@
     __Pyx_XGIVEREF(__pyx_t_6);
     __Pyx_XGIVEREF(__pyx_t_7);
     __Pyx_XGIVEREF(__pyx_t_8);
     __Pyx_ExceptionReset(__pyx_t_6, __pyx_t_7, __pyx_t_8);
   }
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "blacksheep/messages.pyx":141
+  /* "blacksheep/messages.pyx":138
  *             yield None
  * 
  *     async def text(self):             # <<<<<<<<<<<<<<
  *         body = await self.read()
  * 
  */
 
@@ -7066,16 +7069,16 @@
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_10blacksheep_8messages_7Message_31generator3(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "blacksheep/messages.pyx":159
- *                     return body.decode(chardet.detect(body)['encoding'])
+/* "blacksheep/messages.pyx":156
+ *                     return body.decode(charset_normalizer.detect(body)['encoding'])
  * 
  *     async def form(self):             # <<<<<<<<<<<<<<
  *         cdef str text
  *         cdef bytes body
  */
 
 /* Python wrapper */
@@ -7099,23 +7102,23 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("form", 0);
   __pyx_cur_scope = (struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_3_form *)__pyx_tp_new_10blacksheep_8messages___pyx_scope_struct_3_form(__pyx_ptype_10blacksheep_8messages___pyx_scope_struct_3_form, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_3_form *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 159, __pyx_L1_error)
+    __PYX_ERR(0, 156, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_8messages_7Message_31generator3, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_form, __pyx_n_s_Message_form, __pyx_n_s_blacksheep_messages); if (unlikely(!gen)) __PYX_ERR(0, 159, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_8messages_7Message_31generator3, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_form, __pyx_n_s_Message_form, __pyx_n_s_blacksheep_messages); if (unlikely(!gen)) __PYX_ERR(0, 156, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -7146,257 +7149,257 @@
     case 1: goto __pyx_L6_resume_from_await;
     case 2: goto __pyx_L8_resume_from_await;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 159, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 156, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":162
+  /* "blacksheep/messages.pyx":159
  *         cdef str text
  *         cdef bytes body
  *         cdef bytes content_type_value = self.content_type()             # <<<<<<<<<<<<<<
  * 
  *         if not content_type_value:
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->content_type(__pyx_cur_scope->__pyx_v_self, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 162, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->content_type(__pyx_cur_scope->__pyx_v_self, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 159, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_cur_scope->__pyx_v_content_type_value = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":164
+  /* "blacksheep/messages.pyx":161
  *         cdef bytes content_type_value = self.content_type()
  * 
  *         if not content_type_value:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_2 = (__pyx_cur_scope->__pyx_v_content_type_value != Py_None)&&(PyBytes_GET_SIZE(__pyx_cur_scope->__pyx_v_content_type_value) != 0);
   __pyx_t_3 = ((!__pyx_t_2) != 0);
   if (__pyx_t_3) {
 
-    /* "blacksheep/messages.pyx":165
+    /* "blacksheep/messages.pyx":162
  * 
  *         if not content_type_value:
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         if b'application/x-www-form-urlencoded' in content_type_value:
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = NULL;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":164
+    /* "blacksheep/messages.pyx":161
  *         cdef bytes content_type_value = self.content_type()
  * 
  *         if not content_type_value:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "blacksheep/messages.pyx":167
+  /* "blacksheep/messages.pyx":164
  *             return None
  * 
  *         if b'application/x-www-form-urlencoded' in content_type_value:             # <<<<<<<<<<<<<<
  *             text = await self.text()
  *             return parse_www_form_urlencoded(text)
  */
-  __pyx_t_3 = (__Pyx_PySequence_ContainsTF(__pyx_kp_b_application_x_www_form_urlencode, __pyx_cur_scope->__pyx_v_content_type_value, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 167, __pyx_L1_error)
+  __pyx_t_3 = (__Pyx_PySequence_ContainsTF(__pyx_kp_b_application_x_www_form_urlencode, __pyx_cur_scope->__pyx_v_content_type_value, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 164, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_3 != 0);
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":168
+    /* "blacksheep/messages.pyx":165
  * 
  *         if b'application/x-www-form-urlencoded' in content_type_value:
  *             text = await self.text()             # <<<<<<<<<<<<<<
  *             return parse_www_form_urlencoded(text)
  * 
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_text); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 168, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_text); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_1);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XGOTREF(__pyx_r);
     if (likely(__pyx_r)) {
       __Pyx_XGIVEREF(__pyx_r);
       __Pyx_RefNannyFinishContext();
       __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
       /* return from generator, awaiting value */
       __pyx_generator->resume_label = 1;
       return __pyx_r;
       __pyx_L6_resume_from_await:;
-      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 168, __pyx_L1_error)
+      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 165, __pyx_L1_error)
       __pyx_t_1 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_1);
     } else {
       __pyx_t_1 = NULL;
-      if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 168, __pyx_L1_error)
+      if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
     }
-    if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 168, __pyx_L1_error)
+    if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GIVEREF(__pyx_t_1);
     __pyx_cur_scope->__pyx_v_text = ((PyObject*)__pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "blacksheep/messages.pyx":169
+    /* "blacksheep/messages.pyx":166
  *         if b'application/x-www-form-urlencoded' in content_type_value:
  *             text = await self.text()
  *             return parse_www_form_urlencoded(text)             # <<<<<<<<<<<<<<
  * 
  *         if b'multipart/form-data;' in content_type_value:
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = __pyx_f_10blacksheep_8contents_parse_www_form_urlencoded(__pyx_cur_scope->__pyx_v_text); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 169, __pyx_L1_error)
+    __pyx_t_1 = __pyx_f_10blacksheep_8contents_parse_www_form_urlencoded(__pyx_cur_scope->__pyx_v_text); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 166, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":167
+    /* "blacksheep/messages.pyx":164
  *             return None
  * 
  *         if b'application/x-www-form-urlencoded' in content_type_value:             # <<<<<<<<<<<<<<
  *             text = await self.text()
  *             return parse_www_form_urlencoded(text)
  */
   }
 
-  /* "blacksheep/messages.pyx":171
+  /* "blacksheep/messages.pyx":168
  *             return parse_www_form_urlencoded(text)
  * 
  *         if b'multipart/form-data;' in content_type_value:             # <<<<<<<<<<<<<<
  *             body = await self.read()
  *             return multiparts_to_dictionary(list(parse_multipart(body)))
  */
-  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_kp_b_multipart_form_data, __pyx_cur_scope->__pyx_v_content_type_value, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 171, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_kp_b_multipart_form_data, __pyx_cur_scope->__pyx_v_content_type_value, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 168, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
-    /* "blacksheep/messages.pyx":172
+    /* "blacksheep/messages.pyx":169
  * 
  *         if b'multipart/form-data;' in content_type_value:
  *             body = await self.read()             # <<<<<<<<<<<<<<
  *             return multiparts_to_dictionary(list(parse_multipart(body)))
  *         return None
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_read); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 172, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_read); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 169, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 169, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_1);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XGOTREF(__pyx_r);
     if (likely(__pyx_r)) {
       __Pyx_XGIVEREF(__pyx_r);
       __Pyx_RefNannyFinishContext();
       __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
       /* return from generator, awaiting value */
       __pyx_generator->resume_label = 2;
       return __pyx_r;
       __pyx_L8_resume_from_await:;
-      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 172, __pyx_L1_error)
+      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 169, __pyx_L1_error)
       __pyx_t_1 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_1);
     } else {
       __pyx_t_1 = NULL;
-      if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 172, __pyx_L1_error)
+      if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 169, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
     }
-    if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 172, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 169, __pyx_L1_error)
     __Pyx_GIVEREF(__pyx_t_1);
     __pyx_cur_scope->__pyx_v_body = ((PyObject*)__pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "blacksheep/messages.pyx":173
+    /* "blacksheep/messages.pyx":170
  *         if b'multipart/form-data;' in content_type_value:
  *             body = await self.read()
  *             return multiparts_to_dictionary(list(parse_multipart(body)))             # <<<<<<<<<<<<<<
  *         return None
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_parse_multipart); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 173, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_parse_multipart); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 170, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_cur_scope->__pyx_v_body) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_cur_scope->__pyx_v_body);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 173, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 170, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PySequence_List(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 173, __pyx_L1_error)
+    __pyx_t_4 = PySequence_List(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 170, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __pyx_f_10blacksheep_8contents_multiparts_to_dictionary(((PyObject*)__pyx_t_4)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 173, __pyx_L1_error)
+    __pyx_t_1 = __pyx_f_10blacksheep_8contents_multiparts_to_dictionary(((PyObject*)__pyx_t_4)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 170, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":171
+    /* "blacksheep/messages.pyx":168
  *             return parse_www_form_urlencoded(text)
  * 
  *         if b'multipart/form-data;' in content_type_value:             # <<<<<<<<<<<<<<
  *             body = await self.read()
  *             return multiparts_to_dictionary(list(parse_multipart(body)))
  */
   }
 
-  /* "blacksheep/messages.pyx":174
+  /* "blacksheep/messages.pyx":171
  *             body = await self.read()
  *             return multiparts_to_dictionary(list(parse_multipart(body)))
  *         return None             # <<<<<<<<<<<<<<
  * 
  *     async def multipart(self):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_r = NULL;
   goto __pyx_L0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "blacksheep/messages.pyx":159
- *                     return body.decode(chardet.detect(body)['encoding'])
+  /* "blacksheep/messages.pyx":156
+ *                     return body.decode(charset_normalizer.detect(body)['encoding'])
  * 
  *     async def form(self):             # <<<<<<<<<<<<<<
  *         cdef str text
  *         cdef bytes body
  */
 
   /* function exit code */
@@ -7413,15 +7416,15 @@
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_10blacksheep_8messages_7Message_34generator4(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "blacksheep/messages.pyx":176
+/* "blacksheep/messages.pyx":173
  *         return None
  * 
  *     async def multipart(self):             # <<<<<<<<<<<<<<
  *         cdef str text
  *         cdef bytes body
  */
 
@@ -7446,23 +7449,23 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("multipart", 0);
   __pyx_cur_scope = (struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_4_multipart *)__pyx_tp_new_10blacksheep_8messages___pyx_scope_struct_4_multipart(__pyx_ptype_10blacksheep_8messages___pyx_scope_struct_4_multipart, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_4_multipart *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 176, __pyx_L1_error)
+    __PYX_ERR(0, 173, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_8messages_7Message_34generator4, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_multipart, __pyx_n_s_Message_multipart, __pyx_n_s_blacksheep_messages); if (unlikely(!gen)) __PYX_ERR(0, 176, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_8messages_7Message_34generator4, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_multipart, __pyx_n_s_Message_multipart, __pyx_n_s_blacksheep_messages); if (unlikely(!gen)) __PYX_ERR(0, 173, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -7492,172 +7495,172 @@
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L6_resume_from_await;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 176, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 173, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":179
+  /* "blacksheep/messages.pyx":176
  *         cdef str text
  *         cdef bytes body
  *         cdef bytes content_type_value = self.content_type()             # <<<<<<<<<<<<<<
  * 
  *         if not content_type_value:
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->content_type(__pyx_cur_scope->__pyx_v_self, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->content_type(__pyx_cur_scope->__pyx_v_self, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 176, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_cur_scope->__pyx_v_content_type_value = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":181
+  /* "blacksheep/messages.pyx":178
  *         cdef bytes content_type_value = self.content_type()
  * 
  *         if not content_type_value:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_2 = (__pyx_cur_scope->__pyx_v_content_type_value != Py_None)&&(PyBytes_GET_SIZE(__pyx_cur_scope->__pyx_v_content_type_value) != 0);
   __pyx_t_3 = ((!__pyx_t_2) != 0);
   if (__pyx_t_3) {
 
-    /* "blacksheep/messages.pyx":182
+    /* "blacksheep/messages.pyx":179
  * 
  *         if not content_type_value:
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         if b'multipart/form-data;' in content_type_value:
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = NULL;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":181
+    /* "blacksheep/messages.pyx":178
  *         cdef bytes content_type_value = self.content_type()
  * 
  *         if not content_type_value:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "blacksheep/messages.pyx":184
+  /* "blacksheep/messages.pyx":181
  *             return None
  * 
  *         if b'multipart/form-data;' in content_type_value:             # <<<<<<<<<<<<<<
  *             body = await self.read()
  *             return list(parse_multipart(body))
  */
-  __pyx_t_3 = (__Pyx_PySequence_ContainsTF(__pyx_kp_b_multipart_form_data, __pyx_cur_scope->__pyx_v_content_type_value, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_3 = (__Pyx_PySequence_ContainsTF(__pyx_kp_b_multipart_form_data, __pyx_cur_scope->__pyx_v_content_type_value, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 181, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_3 != 0);
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":185
+    /* "blacksheep/messages.pyx":182
  * 
  *         if b'multipart/form-data;' in content_type_value:
  *             body = await self.read()             # <<<<<<<<<<<<<<
  *             return list(parse_multipart(body))
  *         return None
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_read); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 185, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_read); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 182, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 185, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 182, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_1);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XGOTREF(__pyx_r);
     if (likely(__pyx_r)) {
       __Pyx_XGIVEREF(__pyx_r);
       __Pyx_RefNannyFinishContext();
       __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
       /* return from generator, awaiting value */
       __pyx_generator->resume_label = 1;
       return __pyx_r;
       __pyx_L6_resume_from_await:;
-      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 185, __pyx_L1_error)
+      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 182, __pyx_L1_error)
       __pyx_t_1 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_1);
     } else {
       __pyx_t_1 = NULL;
-      if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 185, __pyx_L1_error)
+      if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 182, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
     }
-    if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 185, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 182, __pyx_L1_error)
     __Pyx_GIVEREF(__pyx_t_1);
     __pyx_cur_scope->__pyx_v_body = ((PyObject*)__pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "blacksheep/messages.pyx":186
+    /* "blacksheep/messages.pyx":183
  *         if b'multipart/form-data;' in content_type_value:
  *             body = await self.read()
  *             return list(parse_multipart(body))             # <<<<<<<<<<<<<<
  *         return None
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_parse_multipart); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 186, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_parse_multipart); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 183, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_cur_scope->__pyx_v_body) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_cur_scope->__pyx_v_body);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 186, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 183, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PySequence_List(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 186, __pyx_L1_error)
+    __pyx_t_4 = PySequence_List(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 183, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":184
+    /* "blacksheep/messages.pyx":181
  *             return None
  * 
  *         if b'multipart/form-data;' in content_type_value:             # <<<<<<<<<<<<<<
  *             body = await self.read()
  *             return list(parse_multipart(body))
  */
   }
 
-  /* "blacksheep/messages.pyx":187
+  /* "blacksheep/messages.pyx":184
  *             body = await self.read()
  *             return list(parse_multipart(body))
  *         return None             # <<<<<<<<<<<<<<
  * 
  *     cpdef bint declares_content_type(self, bytes type):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_r = NULL;
   goto __pyx_L0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "blacksheep/messages.pyx":176
+  /* "blacksheep/messages.pyx":173
  *         return None
  * 
  *     async def multipart(self):             # <<<<<<<<<<<<<<
  *         cdef str text
  *         cdef bytes body
  */
 
@@ -7674,15 +7677,15 @@
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":189
+/* "blacksheep/messages.pyx":186
  *         return None
  * 
  *     cpdef bint declares_content_type(self, bytes type):             # <<<<<<<<<<<<<<
  *         cdef bytes content_type = self.content_type()
  *         if not content_type:
  */
 
@@ -7706,15 +7709,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_declares_content_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_declares_content_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 186, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_7Message_36declares_content_type)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -7722,18 +7725,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_type) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_type);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 189, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 186, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 189, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 186, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -7744,103 +7747,103 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":190
+  /* "blacksheep/messages.pyx":187
  * 
  *     cpdef bint declares_content_type(self, bytes type):
  *         cdef bytes content_type = self.content_type()             # <<<<<<<<<<<<<<
  *         if not content_type:
  *             return False
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_v_self->__pyx_vtab)->content_type(__pyx_v_self, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 190, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_v_self->__pyx_vtab)->content_type(__pyx_v_self, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 187, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_content_type = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":191
+  /* "blacksheep/messages.pyx":188
  *     cpdef bint declares_content_type(self, bytes type):
  *         cdef bytes content_type = self.content_type()
  *         if not content_type:             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
   __pyx_t_5 = (__pyx_v_content_type != Py_None)&&(PyBytes_GET_SIZE(__pyx_v_content_type) != 0);
   __pyx_t_6 = ((!__pyx_t_5) != 0);
   if (__pyx_t_6) {
 
-    /* "blacksheep/messages.pyx":192
+    /* "blacksheep/messages.pyx":189
  *         cdef bytes content_type = self.content_type()
  *         if not content_type:
  *             return False             # <<<<<<<<<<<<<<
  * 
  *         # NB: we look for substring intentionally here
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":191
+    /* "blacksheep/messages.pyx":188
  *     cpdef bint declares_content_type(self, bytes type):
  *         cdef bytes content_type = self.content_type()
  *         if not content_type:             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
   }
 
-  /* "blacksheep/messages.pyx":195
+  /* "blacksheep/messages.pyx":192
  * 
  *         # NB: we look for substring intentionally here
  *         if type.lower() in content_type.lower():             # <<<<<<<<<<<<<<
  *             return True
  *         return False
  */
-  __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_content_type); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_content_type); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_6 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_t_2, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_t_2, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_5 = (__pyx_t_6 != 0);
   if (__pyx_t_5) {
 
-    /* "blacksheep/messages.pyx":196
+    /* "blacksheep/messages.pyx":193
  *         # NB: we look for substring intentionally here
  *         if type.lower() in content_type.lower():
  *             return True             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
     __pyx_r = 1;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":195
+    /* "blacksheep/messages.pyx":192
  * 
  *         # NB: we look for substring intentionally here
  *         if type.lower() in content_type.lower():             # <<<<<<<<<<<<<<
  *             return True
  *         return False
  */
   }
 
-  /* "blacksheep/messages.pyx":197
+  /* "blacksheep/messages.pyx":194
  *         if type.lower() in content_type.lower():
  *             return True
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     cpdef bint declares_json(self):
  */
   __pyx_r = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":189
+  /* "blacksheep/messages.pyx":186
  *         return None
  * 
  *     cpdef bint declares_content_type(self, bytes type):             # <<<<<<<<<<<<<<
  *         cdef bytes content_type = self.content_type()
  *         if not content_type:
  */
 
@@ -7863,15 +7866,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_7Message_36declares_content_type(PyObject *__pyx_v_self, PyObject *__pyx_v_type) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("declares_content_type (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_type), (&PyBytes_Type), 1, "type", 1))) __PYX_ERR(0, 189, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_type), (&PyBytes_Type), 1, "type", 1))) __PYX_ERR(0, 186, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Message_35declares_content_type(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), ((PyObject*)__pyx_v_type));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -7884,15 +7887,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("declares_content_type", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_7Message_declares_content_type(__pyx_v_self, __pyx_v_type, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_7Message_declares_content_type(__pyx_v_self, __pyx_v_type, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 186, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -7901,15 +7904,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":199
+/* "blacksheep/messages.pyx":196
  *         return False
  * 
  *     cpdef bint declares_json(self):             # <<<<<<<<<<<<<<
  *         return self.declares_content_type(b'json')
  * 
  */
 
@@ -7931,15 +7934,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_declares_json); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 199, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_declares_json); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 196, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_7Message_38declares_json)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -7947,18 +7950,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 199, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 196, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 199, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 196, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -7969,25 +7972,25 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":200
+  /* "blacksheep/messages.pyx":197
  * 
  *     cpdef bint declares_json(self):
  *         return self.declares_content_type(b'json')             # <<<<<<<<<<<<<<
  * 
  *     cpdef bint declares_xml(self):
  */
   __pyx_r = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_v_self->__pyx_vtab)->declares_content_type(__pyx_v_self, __pyx_n_b_json, 0);
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":199
+  /* "blacksheep/messages.pyx":196
  *         return False
  * 
  *     cpdef bint declares_json(self):             # <<<<<<<<<<<<<<
  *         return self.declares_content_type(b'json')
  * 
  */
 
@@ -8022,15 +8025,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("declares_json", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_7Message_declares_json(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 199, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_7Message_declares_json(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 196, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -8039,15 +8042,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":202
+/* "blacksheep/messages.pyx":199
  *         return self.declares_content_type(b'json')
  * 
  *     cpdef bint declares_xml(self):             # <<<<<<<<<<<<<<
  *         return self.declares_content_type(b'xml')
  * 
  */
 
@@ -8069,15 +8072,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_declares_xml); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 202, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_declares_xml); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 199, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_7Message_40declares_xml)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -8085,18 +8088,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 202, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 199, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 202, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 199, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -8107,25 +8110,25 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":203
+  /* "blacksheep/messages.pyx":200
  * 
  *     cpdef bint declares_xml(self):
  *         return self.declares_content_type(b'xml')             # <<<<<<<<<<<<<<
  * 
  *     async def files(self, name=None):
  */
   __pyx_r = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_v_self->__pyx_vtab)->declares_content_type(__pyx_v_self, __pyx_n_b_xml, 0);
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":202
+  /* "blacksheep/messages.pyx":199
  *         return self.declares_content_type(b'json')
  * 
  *     cpdef bint declares_xml(self):             # <<<<<<<<<<<<<<
  *         return self.declares_content_type(b'xml')
  * 
  */
 
@@ -8160,15 +8163,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("declares_xml", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_7Message_declares_xml(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 202, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_7Message_declares_xml(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -8178,15 +8181,15 @@
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_10blacksheep_8messages_7Message_43generator5(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "blacksheep/messages.pyx":205
+/* "blacksheep/messages.pyx":202
  *         return self.declares_content_type(b'xml')
  * 
  *     async def files(self, name=None):             # <<<<<<<<<<<<<<
  *         if isinstance(name, str):
  *             name = name.encode('ascii')
  */
 
@@ -8218,29 +8221,29 @@
         case  0:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name);
           if (value) { values[0] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "files") < 0)) __PYX_ERR(0, 205, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "files") < 0)) __PYX_ERR(0, 202, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_name = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("files", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 205, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("files", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 202, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("blacksheep.messages.Message.files", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Message_41files(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_v_name);
 
@@ -8257,26 +8260,26 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("files", 0);
   __pyx_cur_scope = (struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_5_files *)__pyx_tp_new_10blacksheep_8messages___pyx_scope_struct_5_files(__pyx_ptype_10blacksheep_8messages___pyx_scope_struct_5_files, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_5_files *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 205, __pyx_L1_error)
+    __PYX_ERR(0, 202, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __pyx_cur_scope->__pyx_v_name = __pyx_v_name;
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_name);
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_name);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_8messages_7Message_43generator5, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_files, __pyx_n_s_Message_files, __pyx_n_s_blacksheep_messages); if (unlikely(!gen)) __PYX_ERR(0, 205, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_8messages_7Message_43generator5, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_files, __pyx_n_s_Message_files, __pyx_n_s_blacksheep_messages); if (unlikely(!gen)) __PYX_ERR(0, 202, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -8310,337 +8313,337 @@
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L8_resume_from_await;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 205, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 202, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":206
+  /* "blacksheep/messages.pyx":203
  * 
  *     async def files(self, name=None):
  *         if isinstance(name, str):             # <<<<<<<<<<<<<<
  *             name = name.encode('ascii')
  * 
  */
   __pyx_t_1 = PyUnicode_Check(__pyx_cur_scope->__pyx_v_name); 
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":207
+    /* "blacksheep/messages.pyx":204
  *     async def files(self, name=None):
  *         if isinstance(name, str):
  *             name = name.encode('ascii')             # <<<<<<<<<<<<<<
  * 
  *         content_type = self.content_type()
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_name, __pyx_n_s_encode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 207, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_name, __pyx_n_s_encode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 204, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_n_u_ascii) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_n_u_ascii);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 207, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 204, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_name);
     __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_name, __pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_3);
     __pyx_t_3 = 0;
 
-    /* "blacksheep/messages.pyx":206
+    /* "blacksheep/messages.pyx":203
  * 
  *     async def files(self, name=None):
  *         if isinstance(name, str):             # <<<<<<<<<<<<<<
  *             name = name.encode('ascii')
  * 
  */
   }
 
-  /* "blacksheep/messages.pyx":209
+  /* "blacksheep/messages.pyx":206
  *             name = name.encode('ascii')
  * 
  *         content_type = self.content_type()             # <<<<<<<<<<<<<<
  * 
  *         if not content_type or b'multipart/form-data;' not in content_type:
  */
-  __pyx_t_3 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->content_type(__pyx_cur_scope->__pyx_v_self, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 209, __pyx_L1_error)
+  __pyx_t_3 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->content_type(__pyx_cur_scope->__pyx_v_self, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 206, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_3);
   __pyx_cur_scope->__pyx_v_content_type = ((PyObject*)__pyx_t_3);
   __pyx_t_3 = 0;
 
-  /* "blacksheep/messages.pyx":211
+  /* "blacksheep/messages.pyx":208
  *         content_type = self.content_type()
  * 
  *         if not content_type or b'multipart/form-data;' not in content_type:             # <<<<<<<<<<<<<<
  *             return []
  *         data = await self.multipart()
  */
   __pyx_t_1 = (__pyx_cur_scope->__pyx_v_content_type != Py_None)&&(PyBytes_GET_SIZE(__pyx_cur_scope->__pyx_v_content_type) != 0);
   __pyx_t_6 = ((!__pyx_t_1) != 0);
   if (!__pyx_t_6) {
   } else {
     __pyx_t_2 = __pyx_t_6;
     goto __pyx_L6_bool_binop_done;
   }
-  __pyx_t_6 = (__Pyx_PySequence_ContainsTF(__pyx_kp_b_multipart_form_data, __pyx_cur_scope->__pyx_v_content_type, Py_NE)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 211, __pyx_L1_error)
+  __pyx_t_6 = (__Pyx_PySequence_ContainsTF(__pyx_kp_b_multipart_form_data, __pyx_cur_scope->__pyx_v_content_type, Py_NE)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
   __pyx_t_1 = (__pyx_t_6 != 0);
   __pyx_t_2 = __pyx_t_1;
   __pyx_L6_bool_binop_done:;
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":212
+    /* "blacksheep/messages.pyx":209
  * 
  *         if not content_type or b'multipart/form-data;' not in content_type:
  *             return []             # <<<<<<<<<<<<<<
  *         data = await self.multipart()
  *         if name:
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 212, __pyx_L1_error)
+    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 209, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":211
+    /* "blacksheep/messages.pyx":208
  *         content_type = self.content_type()
  * 
  *         if not content_type or b'multipart/form-data;' not in content_type:             # <<<<<<<<<<<<<<
  *             return []
  *         data = await self.multipart()
  */
   }
 
-  /* "blacksheep/messages.pyx":213
+  /* "blacksheep/messages.pyx":210
  *         if not content_type or b'multipart/form-data;' not in content_type:
  *             return []
  *         data = await self.multipart()             # <<<<<<<<<<<<<<
  *         if name:
  *             return [part for part in data if part.file_name and part.name == name]
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_multipart); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 213, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_multipart); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 210, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 213, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 210, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_3);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_XGOTREF(__pyx_r);
   if (likely(__pyx_r)) {
     __Pyx_XGIVEREF(__pyx_r);
     __Pyx_RefNannyFinishContext();
     __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
     /* return from generator, awaiting value */
     __pyx_generator->resume_label = 1;
     return __pyx_r;
     __pyx_L8_resume_from_await:;
-    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 213, __pyx_L1_error)
+    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 210, __pyx_L1_error)
     __pyx_t_3 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_3);
   } else {
     __pyx_t_3 = NULL;
-    if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_3) < 0) __PYX_ERR(0, 213, __pyx_L1_error)
+    if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_3) < 0) __PYX_ERR(0, 210, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
   }
   __Pyx_GIVEREF(__pyx_t_3);
   __pyx_cur_scope->__pyx_v_data = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "blacksheep/messages.pyx":214
+  /* "blacksheep/messages.pyx":211
  *             return []
  *         data = await self.multipart()
  *         if name:             # <<<<<<<<<<<<<<
  *             return [part for part in data if part.file_name and part.name == name]
  *         return [part for part in data if part.file_name]
  */
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_name); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_name); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 211, __pyx_L1_error)
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":215
+    /* "blacksheep/messages.pyx":212
  *         data = await self.multipart()
  *         if name:
  *             return [part for part in data if part.file_name and part.name == name]             # <<<<<<<<<<<<<<
  *         return [part for part in data if part.file_name]
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     { /* enter inner scope */
-      __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 215, __pyx_L1_error)
+      __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 212, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       if (likely(PyList_CheckExact(__pyx_cur_scope->__pyx_v_data)) || PyTuple_CheckExact(__pyx_cur_scope->__pyx_v_data)) {
         __pyx_t_4 = __pyx_cur_scope->__pyx_v_data; __Pyx_INCREF(__pyx_t_4); __pyx_t_7 = 0;
         __pyx_t_8 = NULL;
       } else {
-        __pyx_t_7 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_cur_scope->__pyx_v_data); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 215, __pyx_L1_error)
+        __pyx_t_7 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_cur_scope->__pyx_v_data); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 212, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_8 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 215, __pyx_L1_error)
+        __pyx_t_8 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 212, __pyx_L1_error)
       }
       for (;;) {
         if (likely(!__pyx_t_8)) {
           if (likely(PyList_CheckExact(__pyx_t_4))) {
             if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_4)) break;
             #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            __pyx_t_5 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_7); __Pyx_INCREF(__pyx_t_5); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 215, __pyx_L1_error)
+            __pyx_t_5 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_7); __Pyx_INCREF(__pyx_t_5); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 212, __pyx_L1_error)
             #else
-            __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 215, __pyx_L1_error)
+            __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 212, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_5);
             #endif
           } else {
             if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
             #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_7); __Pyx_INCREF(__pyx_t_5); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 215, __pyx_L1_error)
+            __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_7); __Pyx_INCREF(__pyx_t_5); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 212, __pyx_L1_error)
             #else
-            __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 215, __pyx_L1_error)
+            __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 212, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_5);
             #endif
           }
         } else {
           __pyx_t_5 = __pyx_t_8(__pyx_t_4);
           if (unlikely(!__pyx_t_5)) {
             PyObject* exc_type = PyErr_Occurred();
             if (exc_type) {
               if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-              else __PYX_ERR(0, 215, __pyx_L1_error)
+              else __PYX_ERR(0, 212, __pyx_L1_error)
             }
             break;
           }
           __Pyx_GOTREF(__pyx_t_5);
         }
         __Pyx_XGOTREF(__pyx_cur_scope->__pyx_7genexpr__pyx_v_part);
         __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_7genexpr__pyx_v_part, __pyx_t_5);
         __Pyx_GIVEREF(__pyx_t_5);
         __pyx_t_5 = 0;
-        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_7genexpr__pyx_v_part, __pyx_n_s_file_name); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 215, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_7genexpr__pyx_v_part, __pyx_n_s_file_name); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 212, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 215, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 212, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         if (__pyx_t_1) {
         } else {
           __pyx_t_2 = __pyx_t_1;
           goto __pyx_L13_bool_binop_done;
         }
-        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_7genexpr__pyx_v_part, __pyx_n_s_name); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 215, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_7genexpr__pyx_v_part, __pyx_n_s_name); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 212, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_9 = PyObject_RichCompare(__pyx_t_5, __pyx_cur_scope->__pyx_v_name, Py_EQ); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 215, __pyx_L1_error)
+        __pyx_t_9 = PyObject_RichCompare(__pyx_t_5, __pyx_cur_scope->__pyx_v_name, Py_EQ); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 212, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 215, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 212, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         __pyx_t_2 = __pyx_t_1;
         __pyx_L13_bool_binop_done:;
         if (__pyx_t_2) {
-          if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_cur_scope->__pyx_7genexpr__pyx_v_part))) __PYX_ERR(0, 215, __pyx_L1_error)
+          if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_cur_scope->__pyx_7genexpr__pyx_v_part))) __PYX_ERR(0, 212, __pyx_L1_error)
         }
       }
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     } /* exit inner scope */
     __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":214
+    /* "blacksheep/messages.pyx":211
  *             return []
  *         data = await self.multipart()
  *         if name:             # <<<<<<<<<<<<<<
  *             return [part for part in data if part.file_name and part.name == name]
  *         return [part for part in data if part.file_name]
  */
   }
 
-  /* "blacksheep/messages.pyx":216
+  /* "blacksheep/messages.pyx":213
  *         if name:
  *             return [part for part in data if part.file_name and part.name == name]
  *         return [part for part in data if part.file_name]             # <<<<<<<<<<<<<<
  * 
  *     async def json(self, loads=json_settings.loads):
  */
   __Pyx_XDECREF(__pyx_r);
   { /* enter inner scope */
-    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 216, __pyx_L1_error)
+    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 213, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     if (likely(PyList_CheckExact(__pyx_cur_scope->__pyx_v_data)) || PyTuple_CheckExact(__pyx_cur_scope->__pyx_v_data)) {
       __pyx_t_4 = __pyx_cur_scope->__pyx_v_data; __Pyx_INCREF(__pyx_t_4); __pyx_t_7 = 0;
       __pyx_t_8 = NULL;
     } else {
-      __pyx_t_7 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_cur_scope->__pyx_v_data); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 216, __pyx_L1_error)
+      __pyx_t_7 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_cur_scope->__pyx_v_data); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 213, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_8 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 216, __pyx_L1_error)
+      __pyx_t_8 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 213, __pyx_L1_error)
     }
     for (;;) {
       if (likely(!__pyx_t_8)) {
         if (likely(PyList_CheckExact(__pyx_t_4))) {
           if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_9 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_7); __Pyx_INCREF(__pyx_t_9); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 216, __pyx_L1_error)
+          __pyx_t_9 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_7); __Pyx_INCREF(__pyx_t_9); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 213, __pyx_L1_error)
           #else
-          __pyx_t_9 = PySequence_ITEM(__pyx_t_4, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 216, __pyx_L1_error)
+          __pyx_t_9 = PySequence_ITEM(__pyx_t_4, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 213, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           #endif
         } else {
           if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_9 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_7); __Pyx_INCREF(__pyx_t_9); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 216, __pyx_L1_error)
+          __pyx_t_9 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_7); __Pyx_INCREF(__pyx_t_9); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 213, __pyx_L1_error)
           #else
-          __pyx_t_9 = PySequence_ITEM(__pyx_t_4, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 216, __pyx_L1_error)
+          __pyx_t_9 = PySequence_ITEM(__pyx_t_4, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 213, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           #endif
         }
       } else {
         __pyx_t_9 = __pyx_t_8(__pyx_t_4);
         if (unlikely(!__pyx_t_9)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 216, __pyx_L1_error)
+            else __PYX_ERR(0, 213, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_9);
       }
       __Pyx_XGOTREF(__pyx_cur_scope->__pyx_8genexpr1__pyx_v_part);
       __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_8genexpr1__pyx_v_part, __pyx_t_9);
       __Pyx_GIVEREF(__pyx_t_9);
       __pyx_t_9 = 0;
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_8genexpr1__pyx_v_part, __pyx_n_s_file_name); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 216, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_8genexpr1__pyx_v_part, __pyx_n_s_file_name); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 213, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 216, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 213, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       if (__pyx_t_2) {
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_cur_scope->__pyx_8genexpr1__pyx_v_part))) __PYX_ERR(0, 216, __pyx_L1_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_cur_scope->__pyx_8genexpr1__pyx_v_part))) __PYX_ERR(0, 213, __pyx_L1_error)
       }
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   } /* exit inner scope */
   __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   goto __pyx_L0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "blacksheep/messages.pyx":205
+  /* "blacksheep/messages.pyx":202
  *         return self.declares_content_type(b'xml')
  * 
  *     async def files(self, name=None):             # <<<<<<<<<<<<<<
  *         if isinstance(name, str):
  *             name = name.encode('ascii')
  */
 
@@ -8659,15 +8662,15 @@
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_10blacksheep_8messages_7Message_46generator6(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "blacksheep/messages.pyx":218
+/* "blacksheep/messages.pyx":215
  *         return [part for part in data if part.file_name]
  * 
  *     async def json(self, loads=json_settings.loads):             # <<<<<<<<<<<<<<
  *         if not self.declares_json():
  *             return None
  */
 
@@ -8699,29 +8702,29 @@
         case  0:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_loads);
           if (value) { values[0] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "json") < 0)) __PYX_ERR(0, 218, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "json") < 0)) __PYX_ERR(0, 215, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_loads = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("json", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 218, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("json", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 215, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("blacksheep.messages.Message.json", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Message_44json(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_v_loads);
 
@@ -8738,26 +8741,26 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("json", 0);
   __pyx_cur_scope = (struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_6_json *)__pyx_tp_new_10blacksheep_8messages___pyx_scope_struct_6_json(__pyx_ptype_10blacksheep_8messages___pyx_scope_struct_6_json, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10blacksheep_8messages___pyx_scope_struct_6_json *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 218, __pyx_L1_error)
+    __PYX_ERR(0, 215, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __pyx_cur_scope->__pyx_v_loads = __pyx_v_loads;
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_loads);
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_loads);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_8messages_7Message_46generator6, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_json, __pyx_n_s_Message_json, __pyx_n_s_blacksheep_messages); if (unlikely(!gen)) __PYX_ERR(0, 218, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Coroutine_New((__pyx_coroutine_body_t) __pyx_gb_10blacksheep_8messages_7Message_46generator6, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_json, __pyx_n_s_Message_json, __pyx_n_s_blacksheep_messages); if (unlikely(!gen)) __PYX_ERR(0, 215, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -8804,146 +8807,146 @@
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L5_resume_from_await;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 218, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 215, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":219
+  /* "blacksheep/messages.pyx":216
  * 
  *     async def json(self, loads=json_settings.loads):
  *         if not self.declares_json():             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_1 = ((!(((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->declares_json(__pyx_cur_scope->__pyx_v_self, 0) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "blacksheep/messages.pyx":220
+    /* "blacksheep/messages.pyx":217
  *     async def json(self, loads=json_settings.loads):
  *         if not self.declares_json():
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         text = await self.text()
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = NULL;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":219
+    /* "blacksheep/messages.pyx":216
  * 
  *     async def json(self, loads=json_settings.loads):
  *         if not self.declares_json():             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "blacksheep/messages.pyx":222
+  /* "blacksheep/messages.pyx":219
  *             return None
  * 
  *         text = await self.text()             # <<<<<<<<<<<<<<
  * 
  *         if text is None or text == "":
  */
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_text); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 222, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_text); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 222, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_r = __Pyx_Coroutine_Yield_From(__pyx_generator, __pyx_t_2);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_XGOTREF(__pyx_r);
   if (likely(__pyx_r)) {
     __Pyx_XGIVEREF(__pyx_r);
     __Pyx_RefNannyFinishContext();
     __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
     /* return from generator, awaiting value */
     __pyx_generator->resume_label = 1;
     return __pyx_r;
     __pyx_L5_resume_from_await:;
-    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 222, __pyx_L1_error)
+    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 219, __pyx_L1_error)
     __pyx_t_2 = __pyx_sent_value; __Pyx_INCREF(__pyx_t_2);
   } else {
     __pyx_t_2 = NULL;
-    if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_2) < 0) __PYX_ERR(0, 222, __pyx_L1_error)
+    if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_2) < 0) __PYX_ERR(0, 219, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
   }
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_cur_scope->__pyx_v_text = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "blacksheep/messages.pyx":224
+  /* "blacksheep/messages.pyx":221
  *         text = await self.text()
  * 
  *         if text is None or text == "":             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_5 = (__pyx_cur_scope->__pyx_v_text == Py_None);
   __pyx_t_6 = (__pyx_t_5 != 0);
   if (!__pyx_t_6) {
   } else {
     __pyx_t_1 = __pyx_t_6;
     goto __pyx_L7_bool_binop_done;
   }
-  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_cur_scope->__pyx_v_text, __pyx_kp_u__3, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 224, __pyx_L1_error)
+  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_cur_scope->__pyx_v_text, __pyx_kp_u__3, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 221, __pyx_L1_error)
   __pyx_t_1 = __pyx_t_6;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "blacksheep/messages.pyx":225
+    /* "blacksheep/messages.pyx":222
  * 
  *         if text is None or text == "":
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         try:
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = NULL;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":224
+    /* "blacksheep/messages.pyx":221
  *         text = await self.text()
  * 
  *         if text is None or text == "":             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "blacksheep/messages.pyx":227
+  /* "blacksheep/messages.pyx":224
  *             return None
  * 
  *         try:             # <<<<<<<<<<<<<<
  *             return loads(text)
  *         except JSONDecodeError as decode_error:
  */
   {
     __Pyx_ExceptionSave(&__pyx_t_7, &__pyx_t_8, &__pyx_t_9);
     __Pyx_XGOTREF(__pyx_t_7);
     __Pyx_XGOTREF(__pyx_t_8);
     __Pyx_XGOTREF(__pyx_t_9);
     /*try:*/ {
 
-      /* "blacksheep/messages.pyx":228
+      /* "blacksheep/messages.pyx":225
  * 
  *         try:
  *             return loads(text)             # <<<<<<<<<<<<<<
  *         except JSONDecodeError as decode_error:
  *             content_type = self.content_type()
  */
       __Pyx_XDECREF(__pyx_r);
@@ -8956,180 +8959,180 @@
           __Pyx_INCREF(__pyx_t_4);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_3, function);
         }
       }
       __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_cur_scope->__pyx_v_text) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_cur_scope->__pyx_v_text);
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 228, __pyx_L9_error)
+      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 225, __pyx_L9_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __pyx_r = NULL; __Pyx_ReturnWithStopIteration(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       goto __pyx_L13_try_return;
 
-      /* "blacksheep/messages.pyx":227
+      /* "blacksheep/messages.pyx":224
  *             return None
  * 
  *         try:             # <<<<<<<<<<<<<<
  *             return loads(text)
  *         except JSONDecodeError as decode_error:
  */
     }
     __pyx_L9_error:;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "blacksheep/messages.pyx":229
+    /* "blacksheep/messages.pyx":226
  *         try:
  *             return loads(text)
  *         except JSONDecodeError as decode_error:             # <<<<<<<<<<<<<<
  *             content_type = self.content_type()
  *             if content_type and b'json' in content_type:
  */
     __Pyx_ErrFetch(&__pyx_t_2, &__pyx_t_3, &__pyx_t_4);
-    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_JSONDecodeError); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 229, __pyx_L11_except_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_JSONDecodeError); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 226, __pyx_L11_except_error)
     __Pyx_GOTREF(__pyx_t_10);
     __pyx_t_11 = __Pyx_PyErr_GivenExceptionMatches(__pyx_t_2, __pyx_t_10);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __Pyx_ErrRestore(__pyx_t_2, __pyx_t_3, __pyx_t_4);
     __pyx_t_2 = 0; __pyx_t_3 = 0; __pyx_t_4 = 0;
     if (__pyx_t_11) {
       __Pyx_AddTraceback("blacksheep.messages.Message.json", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_3, &__pyx_t_2) < 0) __PYX_ERR(0, 229, __pyx_L11_except_error)
+      if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_3, &__pyx_t_2) < 0) __PYX_ERR(0, 226, __pyx_L11_except_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_GIVEREF(__pyx_t_3);
       __pyx_cur_scope->__pyx_v_decode_error = __pyx_t_3;
       /*try:*/ {
 
-        /* "blacksheep/messages.pyx":230
+        /* "blacksheep/messages.pyx":227
  *             return loads(text)
  *         except JSONDecodeError as decode_error:
  *             content_type = self.content_type()             # <<<<<<<<<<<<<<
  *             if content_type and b'json' in content_type:
  *                 # NB: content type could also be "application/problem+json";
  */
-        __pyx_t_10 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->content_type(__pyx_cur_scope->__pyx_v_self, 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 230, __pyx_L20_error)
+        __pyx_t_10 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->content_type(__pyx_cur_scope->__pyx_v_self, 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 227, __pyx_L20_error)
         __Pyx_GOTREF(__pyx_t_10);
         __Pyx_GIVEREF(__pyx_t_10);
         __pyx_cur_scope->__pyx_v_content_type = ((PyObject*)__pyx_t_10);
         __pyx_t_10 = 0;
 
-        /* "blacksheep/messages.pyx":231
+        /* "blacksheep/messages.pyx":228
  *         except JSONDecodeError as decode_error:
  *             content_type = self.content_type()
  *             if content_type and b'json' in content_type:             # <<<<<<<<<<<<<<
  *                 # NB: content type could also be "application/problem+json";
  *                 # so we don't check for application/json in this case
  */
         __pyx_t_6 = (__pyx_cur_scope->__pyx_v_content_type != Py_None)&&(PyBytes_GET_SIZE(__pyx_cur_scope->__pyx_v_content_type) != 0);
         if (__pyx_t_6) {
         } else {
           __pyx_t_1 = __pyx_t_6;
           goto __pyx_L23_bool_binop_done;
         }
-        __pyx_t_6 = (__Pyx_PySequence_ContainsTF(__pyx_n_b_json, __pyx_cur_scope->__pyx_v_content_type, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 231, __pyx_L20_error)
+        __pyx_t_6 = (__Pyx_PySequence_ContainsTF(__pyx_n_b_json, __pyx_cur_scope->__pyx_v_content_type, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 228, __pyx_L20_error)
         __pyx_t_5 = (__pyx_t_6 != 0);
         __pyx_t_1 = __pyx_t_5;
         __pyx_L23_bool_binop_done:;
         if (unlikely(__pyx_t_1)) {
 
-          /* "blacksheep/messages.pyx":235
+          /* "blacksheep/messages.pyx":232
  *                 # so we don't check for application/json in this case
  *                 raise BadRequestFormat(
  *                     f'Declared Content-Type is {content_type.decode()} but '             # <<<<<<<<<<<<<<
  *                     f'the content cannot be parsed as JSON.', decode_error
  *                 )
  */
-          __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 235, __pyx_L20_error)
+          __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 232, __pyx_L20_error)
           __Pyx_GOTREF(__pyx_t_10);
           __pyx_t_12 = 0;
           __pyx_t_13 = 127;
           __Pyx_INCREF(__pyx_kp_u_Declared_Content_Type_is);
           __pyx_t_12 += 25;
           __Pyx_GIVEREF(__pyx_kp_u_Declared_Content_Type_is);
           PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_kp_u_Declared_Content_Type_is);
           if (unlikely(__pyx_cur_scope->__pyx_v_content_type == Py_None)) {
             PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "decode");
-            __PYX_ERR(0, 235, __pyx_L20_error)
+            __PYX_ERR(0, 232, __pyx_L20_error)
           }
-          __pyx_t_14 = __Pyx_decode_bytes(__pyx_cur_scope->__pyx_v_content_type, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 235, __pyx_L20_error)
+          __pyx_t_14 = __Pyx_decode_bytes(__pyx_cur_scope->__pyx_v_content_type, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 232, __pyx_L20_error)
           __Pyx_GOTREF(__pyx_t_14);
           __pyx_t_13 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_14) > __pyx_t_13) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_14) : __pyx_t_13;
           __pyx_t_12 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_14);
           __Pyx_GIVEREF(__pyx_t_14);
           PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_14);
           __pyx_t_14 = 0;
           __Pyx_INCREF(__pyx_kp_u_but_the_content_cannot_be_parse);
           __pyx_t_12 += 42;
           __Pyx_GIVEREF(__pyx_kp_u_but_the_content_cannot_be_parse);
           PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_kp_u_but_the_content_cannot_be_parse);
-          __pyx_t_14 = __Pyx_PyUnicode_Join(__pyx_t_10, 3, __pyx_t_12, __pyx_t_13); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 235, __pyx_L20_error)
+          __pyx_t_14 = __Pyx_PyUnicode_Join(__pyx_t_10, 3, __pyx_t_12, __pyx_t_13); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 232, __pyx_L20_error)
           __Pyx_GOTREF(__pyx_t_14);
           __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
 
-          /* "blacksheep/messages.pyx":234
+          /* "blacksheep/messages.pyx":231
  *                 # NB: content type could also be "application/problem+json";
  *                 # so we don't check for application/json in this case
  *                 raise BadRequestFormat(             # <<<<<<<<<<<<<<
  *                     f'Declared Content-Type is {content_type.decode()} but '
  *                     f'the content cannot be parsed as JSON.', decode_error
  */
-          __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 234, __pyx_L20_error)
+          __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 231, __pyx_L20_error)
           __Pyx_GOTREF(__pyx_t_10);
           __Pyx_GIVEREF(__pyx_t_14);
           PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_14);
           __Pyx_INCREF(__pyx_cur_scope->__pyx_v_decode_error);
           __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_decode_error);
           PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_cur_scope->__pyx_v_decode_error);
           __pyx_t_14 = 0;
-          __pyx_t_14 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_10exceptions_BadRequestFormat), __pyx_t_10, NULL); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 234, __pyx_L20_error)
+          __pyx_t_14 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_10exceptions_BadRequestFormat), __pyx_t_10, NULL); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 231, __pyx_L20_error)
           __Pyx_GOTREF(__pyx_t_14);
           __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
           __Pyx_Raise(__pyx_t_14, 0, 0, 0);
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-          __PYX_ERR(0, 234, __pyx_L20_error)
+          __PYX_ERR(0, 231, __pyx_L20_error)
 
-          /* "blacksheep/messages.pyx":231
+          /* "blacksheep/messages.pyx":228
  *         except JSONDecodeError as decode_error:
  *             content_type = self.content_type()
  *             if content_type and b'json' in content_type:             # <<<<<<<<<<<<<<
  *                 # NB: content type could also be "application/problem+json";
  *                 # so we don't check for application/json in this case
  */
         }
 
-        /* "blacksheep/messages.pyx":238
+        /* "blacksheep/messages.pyx":235
  *                     f'the content cannot be parsed as JSON.', decode_error
  *                 )
  *             raise BadRequestFormat(             # <<<<<<<<<<<<<<
  *                 f'Cannot parse content as JSON',
  *                 decode_error
  */
-        __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 238, __pyx_L20_error)
+        __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 235, __pyx_L20_error)
         __Pyx_GOTREF(__pyx_t_14);
         __Pyx_INCREF(__pyx_kp_u_Cannot_parse_content_as_JSON);
         __Pyx_GIVEREF(__pyx_kp_u_Cannot_parse_content_as_JSON);
         PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_kp_u_Cannot_parse_content_as_JSON);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_decode_error);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_decode_error);
         PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_cur_scope->__pyx_v_decode_error);
-        __pyx_t_10 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_10exceptions_BadRequestFormat), __pyx_t_14, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 238, __pyx_L20_error)
+        __pyx_t_10 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_10exceptions_BadRequestFormat), __pyx_t_14, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 235, __pyx_L20_error)
         __Pyx_GOTREF(__pyx_t_10);
         __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
         __Pyx_Raise(__pyx_t_10, 0, 0, 0);
         __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-        __PYX_ERR(0, 238, __pyx_L20_error)
+        __PYX_ERR(0, 235, __pyx_L20_error)
       }
 
-      /* "blacksheep/messages.pyx":229
+      /* "blacksheep/messages.pyx":226
  *         try:
  *             return loads(text)
  *         except JSONDecodeError as decode_error:             # <<<<<<<<<<<<<<
  *             content_type = self.content_type()
  *             if content_type and b'json' in content_type:
  */
       /*finally:*/ {
@@ -9168,15 +9171,15 @@
           goto __pyx_L11_except_error;
         }
       }
     }
     goto __pyx_L11_except_error;
     __pyx_L11_except_error:;
 
-    /* "blacksheep/messages.pyx":227
+    /* "blacksheep/messages.pyx":224
  *             return None
  * 
  *         try:             # <<<<<<<<<<<<<<
  *             return loads(text)
  *         except JSONDecodeError as decode_error:
  */
     __Pyx_XGIVEREF(__pyx_t_7);
@@ -9189,15 +9192,15 @@
     __Pyx_XGIVEREF(__pyx_t_8);
     __Pyx_XGIVEREF(__pyx_t_9);
     __Pyx_ExceptionReset(__pyx_t_7, __pyx_t_8, __pyx_t_9);
     goto __pyx_L0;
   }
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "blacksheep/messages.pyx":218
+  /* "blacksheep/messages.pyx":215
  *         return [part for part in data if part.file_name]
  * 
  *     async def json(self, loads=json_settings.loads):             # <<<<<<<<<<<<<<
  *         if not self.declares_json():
  *             return None
  */
 
@@ -9216,15 +9219,15 @@
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":243
+/* "blacksheep/messages.pyx":240
  *             )
  * 
  *     cpdef bint has_body(self):             # <<<<<<<<<<<<<<
  *         cdef Content content = self.content
  *         if not content or content.length == 0:
  */
 
@@ -9249,15 +9252,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_has_body); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 243, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_has_body); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 240, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_7Message_48has_body)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -9265,18 +9268,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 243, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 240, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 243, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 240, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -9287,75 +9290,75 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":244
+  /* "blacksheep/messages.pyx":241
  * 
  *     cpdef bint has_body(self):
  *         cdef Content content = self.content             # <<<<<<<<<<<<<<
  *         if not content or content.length == 0:
  *             return False
  */
   __pyx_t_1 = ((PyObject *)__pyx_v_self->content);
   __Pyx_INCREF(__pyx_t_1);
   __pyx_v_content = ((struct __pyx_obj_10blacksheep_8contents_Content *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":245
+  /* "blacksheep/messages.pyx":242
  *     cpdef bint has_body(self):
  *         cdef Content content = self.content
  *         if not content or content.length == 0:             # <<<<<<<<<<<<<<
  *             return False
  *         # NB: if we use chunked encoding, we don't know the content.length;
  */
-  __pyx_t_6 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_content)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_content)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 242, __pyx_L1_error)
   __pyx_t_7 = ((!__pyx_t_6) != 0);
   if (!__pyx_t_7) {
   } else {
     __pyx_t_5 = __pyx_t_7;
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_7 = ((__pyx_v_content->length == 0) != 0);
   __pyx_t_5 = __pyx_t_7;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_5) {
 
-    /* "blacksheep/messages.pyx":246
+    /* "blacksheep/messages.pyx":243
  *         cdef Content content = self.content
  *         if not content or content.length == 0:
  *             return False             # <<<<<<<<<<<<<<
  *         # NB: if we use chunked encoding, we don't know the content.length;
  *         # and it is set to -1 (in contents.pyx), therefore it is handled
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":245
+    /* "blacksheep/messages.pyx":242
  *     cpdef bint has_body(self):
  *         cdef Content content = self.content
  *         if not content or content.length == 0:             # <<<<<<<<<<<<<<
  *             return False
  *         # NB: if we use chunked encoding, we don't know the content.length;
  */
   }
 
-  /* "blacksheep/messages.pyx":250
+  /* "blacksheep/messages.pyx":247
  *         # and it is set to -1 (in contents.pyx), therefore it is handled
  *         # properly
  *         return True             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __pyx_r = 1;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":243
+  /* "blacksheep/messages.pyx":240
  *             )
  * 
  *     cpdef bint has_body(self):             # <<<<<<<<<<<<<<
  *         cdef Content content = self.content
  *         if not content or content.length == 0:
  */
 
@@ -9391,15 +9394,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("has_body", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_7Message_has_body(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 243, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_7Message_has_body(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 240, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -9408,15 +9411,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":253
+/* "blacksheep/messages.pyx":250
  * 
  *     @property
  *     def charset(self):             # <<<<<<<<<<<<<<
  *         content_type = self.content_type()
  *         if content_type:
  */
 
@@ -9441,47 +9444,47 @@
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":254
+  /* "blacksheep/messages.pyx":251
  *     @property
  *     def charset(self):
  *         content_type = self.content_type()             # <<<<<<<<<<<<<<
  *         if content_type:
  *             return parse_charset(content_type) or 'utf8'
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_v_self->__pyx_vtab)->content_type(__pyx_v_self, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 254, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Message *)__pyx_v_self->__pyx_vtab)->content_type(__pyx_v_self, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 251, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_content_type = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":255
+  /* "blacksheep/messages.pyx":252
  *     def charset(self):
  *         content_type = self.content_type()
  *         if content_type:             # <<<<<<<<<<<<<<
  *             return parse_charset(content_type) or 'utf8'
  *         return 'utf8'
  */
   __pyx_t_2 = (__pyx_v_content_type != Py_None)&&(PyBytes_GET_SIZE(__pyx_v_content_type) != 0);
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":256
+    /* "blacksheep/messages.pyx":253
  *         content_type = self.content_type()
  *         if content_type:
  *             return parse_charset(content_type) or 'utf8'             # <<<<<<<<<<<<<<
  *         return 'utf8'
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = __pyx_f_10blacksheep_8messages_parse_charset(__pyx_v_content_type, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 256, __pyx_L1_error)
+    __pyx_t_3 = __pyx_f_10blacksheep_8messages_parse_charset(__pyx_v_content_type, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 253, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 256, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 253, __pyx_L1_error)
     if (!__pyx_t_2) {
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     } else {
       __Pyx_INCREF(__pyx_t_3);
       __pyx_t_1 = __pyx_t_3;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       goto __pyx_L4_bool_binop_done;
@@ -9489,36 +9492,36 @@
     __Pyx_INCREF(__pyx_n_u_utf8);
     __pyx_t_1 = __pyx_n_u_utf8;
     __pyx_L4_bool_binop_done:;
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":255
+    /* "blacksheep/messages.pyx":252
  *     def charset(self):
  *         content_type = self.content_type()
  *         if content_type:             # <<<<<<<<<<<<<<
  *             return parse_charset(content_type) or 'utf8'
  *         return 'utf8'
  */
   }
 
-  /* "blacksheep/messages.pyx":257
+  /* "blacksheep/messages.pyx":254
  *         if content_type:
  *             return parse_charset(content_type) or 'utf8'
  *         return 'utf8'             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_n_u_utf8);
   __pyx_r = __pyx_n_u_utf8;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":253
+  /* "blacksheep/messages.pyx":250
  * 
  *     @property
  *     def charset(self):             # <<<<<<<<<<<<<<
  *         content_type = self.content_type()
  *         if content_type:
  */
 
@@ -9921,15 +9924,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_Message, (type(self), 0x976f334, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_Message__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_8messages___pyx_unpickle_Message__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_Message, (type(self), 0x976f334, state)
@@ -9946,15 +9949,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":260
+/* "blacksheep/messages.pyx":257
  * 
  * 
  * cpdef bint method_without_body(str method):             # <<<<<<<<<<<<<<
  *     return method == 'GET' or method == 'HEAD' or method == 'TRACE'
  * 
  */
 
@@ -9966,43 +9969,43 @@
   int __pyx_t_2;
   int __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("method_without_body", 0);
 
-  /* "blacksheep/messages.pyx":261
+  /* "blacksheep/messages.pyx":258
  * 
  * cpdef bint method_without_body(str method):
  *     return method == 'GET' or method == 'HEAD' or method == 'TRACE'             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_GET, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 261, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_GET, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 258, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (!__pyx_t_3) {
   } else {
     __pyx_t_1 = __pyx_t_3;
     goto __pyx_L3_bool_binop_done;
   }
-  __pyx_t_3 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_HEAD, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 261, __pyx_L1_error)
+  __pyx_t_3 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_HEAD, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 258, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_3 != 0);
   if (!__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L3_bool_binop_done;
   }
-  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_TRACE, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 261, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_TRACE, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 258, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_2 != 0);
   __pyx_t_1 = __pyx_t_3;
   __pyx_L3_bool_binop_done:;
   __pyx_r = __pyx_t_1;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":260
+  /* "blacksheep/messages.pyx":257
  * 
  * 
  * cpdef bint method_without_body(str method):             # <<<<<<<<<<<<<<
  *     return method == 'GET' or method == 'HEAD' or method == 'TRACE'
  * 
  */
 
@@ -10020,15 +10023,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_3method_without_body(PyObject *__pyx_self, PyObject *__pyx_v_method) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("method_without_body (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_method), (&PyUnicode_Type), 1, "method", 1))) __PYX_ERR(0, 260, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_method), (&PyUnicode_Type), 1, "method", 1))) __PYX_ERR(0, 257, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_2method_without_body(__pyx_self, ((PyObject*)__pyx_v_method));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -10041,15 +10044,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("method_without_body", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_method_without_body(__pyx_v_method, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 260, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_method_without_body(__pyx_v_method, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 257, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -10058,15 +10061,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":266
+/* "blacksheep/messages.pyx":263
  * cdef class Request(Message):
  * 
  *     def __init__(             # <<<<<<<<<<<<<<
  *         self,
  *         str method,
  */
 
@@ -10103,48 +10106,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_method)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_url)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); __PYX_ERR(0, 266, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); __PYX_ERR(0, 263, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_headers)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); __PYX_ERR(0, 266, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); __PYX_ERR(0, 263, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 266, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 263, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_method = ((PyObject*)values[0]);
     __pyx_v_url = ((PyObject*)values[1]);
     __pyx_v_headers = ((PyObject*)values[2]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 266, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 263, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("blacksheep.messages.Request.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_method), (&PyUnicode_Type), 1, "method", 1))) __PYX_ERR(0, 268, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_url), (&PyBytes_Type), 1, "url", 1))) __PYX_ERR(0, 269, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_headers), (&PyList_Type), 1, "headers", 1))) __PYX_ERR(0, 270, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_method), (&PyUnicode_Type), 1, "method", 1))) __PYX_ERR(0, 265, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_url), (&PyBytes_Type), 1, "url", 1))) __PYX_ERR(0, 266, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_headers), (&PyList_Type), 1, "headers", 1))) __PYX_ERR(0, 267, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Request___init__(((struct __pyx_obj_10blacksheep_8messages_Request *)__pyx_v_self), __pyx_v_method, __pyx_v_url, __pyx_v_headers);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -10160,145 +10163,145 @@
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "blacksheep/messages.pyx":272
+  /* "blacksheep/messages.pyx":269
  *         list headers
  *     ):
  *         cdef URL _url = URL(url) if url else None             # <<<<<<<<<<<<<<
  *         self.__headers = headers or []
  *         self.method = method
  */
   __pyx_t_2 = (__pyx_v_url != Py_None)&&(PyBytes_GET_SIZE(__pyx_v_url) != 0);
   if (__pyx_t_2) {
-    __pyx_t_3 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_10blacksheep_3url_URL), __pyx_v_url); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 272, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_10blacksheep_3url_URL), __pyx_v_url); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 269, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_1 = __pyx_t_3;
     __pyx_t_3 = 0;
   } else {
     __Pyx_INCREF(Py_None);
     __pyx_t_1 = Py_None;
   }
   __pyx_v__url = ((struct __pyx_obj_10blacksheep_3url_URL *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":273
+  /* "blacksheep/messages.pyx":270
  *     ):
  *         cdef URL _url = URL(url) if url else None
  *         self.__headers = headers or []             # <<<<<<<<<<<<<<
  *         self.method = method
  *         self._url = _url
  */
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_headers); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 273, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_headers); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 270, __pyx_L1_error)
   if (!__pyx_t_2) {
   } else {
     __Pyx_INCREF(__pyx_v_headers);
     __pyx_t_1 = __pyx_v_headers;
     goto __pyx_L3_bool_binop_done;
   }
-  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 273, __pyx_L1_error)
+  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(__pyx_t_3);
   __pyx_t_1 = __pyx_t_3;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_L3_bool_binop_done:;
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v_self->__pyx_base.__pyx___headers);
   __Pyx_DECREF(__pyx_v_self->__pyx_base.__pyx___headers);
   __pyx_v_self->__pyx_base.__pyx___headers = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":274
+  /* "blacksheep/messages.pyx":271
  *         cdef URL _url = URL(url) if url else None
  *         self.__headers = headers or []
  *         self.method = method             # <<<<<<<<<<<<<<
  *         self._url = _url
  *         self._session = None
  */
   __Pyx_INCREF(__pyx_v_method);
   __Pyx_GIVEREF(__pyx_v_method);
   __Pyx_GOTREF(__pyx_v_self->method);
   __Pyx_DECREF(__pyx_v_self->method);
   __pyx_v_self->method = __pyx_v_method;
 
-  /* "blacksheep/messages.pyx":275
+  /* "blacksheep/messages.pyx":272
  *         self.__headers = headers or []
  *         self.method = method
  *         self._url = _url             # <<<<<<<<<<<<<<
  *         self._session = None
  *         if _url:
  */
   __Pyx_INCREF(((PyObject *)__pyx_v__url));
   __Pyx_GIVEREF(((PyObject *)__pyx_v__url));
   __Pyx_GOTREF(__pyx_v_self->_url);
   __Pyx_DECREF(((PyObject *)__pyx_v_self->_url));
   __pyx_v_self->_url = __pyx_v__url;
 
-  /* "blacksheep/messages.pyx":276
+  /* "blacksheep/messages.pyx":273
  *         self.method = method
  *         self._url = _url
  *         self._session = None             # <<<<<<<<<<<<<<
  *         if _url:
  *             self._path = _url.path
  */
-  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_session, Py_None) < 0) __PYX_ERR(0, 276, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_session, Py_None) < 0) __PYX_ERR(0, 273, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":277
+  /* "blacksheep/messages.pyx":274
  *         self._url = _url
  *         self._session = None
  *         if _url:             # <<<<<<<<<<<<<<
  *             self._path = _url.path
  *             self._raw_query = _url.query
  */
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v__url)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 277, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v__url)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 274, __pyx_L1_error)
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":278
+    /* "blacksheep/messages.pyx":275
  *         self._session = None
  *         if _url:
  *             self._path = _url.path             # <<<<<<<<<<<<<<
  *             self._raw_query = _url.query
  * 
  */
     __pyx_t_1 = __pyx_v__url->path;
     __Pyx_INCREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_1);
     __Pyx_GOTREF(__pyx_v_self->_path);
     __Pyx_DECREF(__pyx_v_self->_path);
     __pyx_v_self->_path = ((PyObject*)__pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "blacksheep/messages.pyx":279
+    /* "blacksheep/messages.pyx":276
  *         if _url:
  *             self._path = _url.path
  *             self._raw_query = _url.query             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
     __pyx_t_1 = __pyx_v__url->query;
     __Pyx_INCREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_1);
     __Pyx_GOTREF(__pyx_v_self->_raw_query);
     __Pyx_DECREF(__pyx_v_self->_raw_query);
     __pyx_v_self->_raw_query = ((PyObject*)__pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "blacksheep/messages.pyx":277
+    /* "blacksheep/messages.pyx":274
  *         self._url = _url
  *         self._session = None
  *         if _url:             # <<<<<<<<<<<<<<
  *             self._path = _url.path
  *             self._raw_query = _url.query
  */
   }
 
-  /* "blacksheep/messages.pyx":266
+  /* "blacksheep/messages.pyx":263
  * cdef class Request(Message):
  * 
  *     def __init__(             # <<<<<<<<<<<<<<
  *         self,
  *         str method,
  */
 
@@ -10312,15 +10315,15 @@
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__url);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":282
+/* "blacksheep/messages.pyx":279
  * 
  *     @property
  *     def identity(self):             # <<<<<<<<<<<<<<
  *         return self.__dict__.get("_user")
  * 
  */
 
@@ -10342,33 +10345,33 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":283
+  /* "blacksheep/messages.pyx":280
  *     @property
  *     def identity(self):
  *         return self.__dict__.get("_user")             # <<<<<<<<<<<<<<
  * 
  *     @identity.setter
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get");
-    __PYX_ERR(0, 283, __pyx_L1_error)
+    __PYX_ERR(0, 280, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_PyDict_GetItemDefault(__pyx_v_self->__dict__, __pyx_n_u_user, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 283, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_GetItemDefault(__pyx_v_self->__dict__, __pyx_n_u_user, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 280, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":282
+  /* "blacksheep/messages.pyx":279
  * 
  *     @property
  *     def identity(self):             # <<<<<<<<<<<<<<
  *         return self.__dict__.get("_user")
  * 
  */
 
@@ -10379,15 +10382,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":286
+/* "blacksheep/messages.pyx":283
  * 
  *     @identity.setter
  *     def identity(self, value):             # <<<<<<<<<<<<<<
  *         self.__dict__["_user"] = value
  * 
  */
 
@@ -10408,28 +10411,28 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "blacksheep/messages.pyx":287
+  /* "blacksheep/messages.pyx":284
  *     @identity.setter
  *     def identity(self, value):
  *         self.__dict__["_user"] = value             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-    __PYX_ERR(0, 287, __pyx_L1_error)
+    __PYX_ERR(0, 284, __pyx_L1_error)
   }
-  if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_user, __pyx_v_value) < 0)) __PYX_ERR(0, 287, __pyx_L1_error)
+  if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_user, __pyx_v_value) < 0)) __PYX_ERR(0, 284, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":286
+  /* "blacksheep/messages.pyx":283
  * 
  *     @identity.setter
  *     def identity(self, value):             # <<<<<<<<<<<<<<
  *         self.__dict__["_user"] = value
  * 
  */
 
@@ -10440,15 +10443,15 @@
   __Pyx_AddTraceback("blacksheep.messages.Request.identity.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":290
+/* "blacksheep/messages.pyx":287
  * 
  *     @property
  *     def user(self):             # <<<<<<<<<<<<<<
  *         return self.__dict__.get("_user")
  * 
  */
 
@@ -10470,33 +10473,33 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":291
+  /* "blacksheep/messages.pyx":288
  *     @property
  *     def user(self):
  *         return self.__dict__.get("_user")             # <<<<<<<<<<<<<<
  * 
  *     @user.setter
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get");
-    __PYX_ERR(0, 291, __pyx_L1_error)
+    __PYX_ERR(0, 288, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_PyDict_GetItemDefault(__pyx_v_self->__dict__, __pyx_n_u_user, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 291, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_GetItemDefault(__pyx_v_self->__dict__, __pyx_n_u_user, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 288, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":290
+  /* "blacksheep/messages.pyx":287
  * 
  *     @property
  *     def user(self):             # <<<<<<<<<<<<<<
  *         return self.__dict__.get("_user")
  * 
  */
 
@@ -10507,15 +10510,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":294
+/* "blacksheep/messages.pyx":291
  * 
  *     @user.setter
  *     def user(self, value):             # <<<<<<<<<<<<<<
  *         self.__dict__["_user"] = value
  * 
  */
 
@@ -10536,28 +10539,28 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "blacksheep/messages.pyx":295
+  /* "blacksheep/messages.pyx":292
  *     @user.setter
  *     def user(self, value):
  *         self.__dict__["_user"] = value             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-    __PYX_ERR(0, 295, __pyx_L1_error)
+    __PYX_ERR(0, 292, __pyx_L1_error)
   }
-  if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_user, __pyx_v_value) < 0)) __PYX_ERR(0, 295, __pyx_L1_error)
+  if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_user, __pyx_v_value) < 0)) __PYX_ERR(0, 292, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":294
+  /* "blacksheep/messages.pyx":291
  * 
  *     @user.setter
  *     def user(self, value):             # <<<<<<<<<<<<<<
  *         self.__dict__["_user"] = value
  * 
  */
 
@@ -10568,15 +10571,15 @@
   __Pyx_AddTraceback("blacksheep.messages.Request.user.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":298
+/* "blacksheep/messages.pyx":295
  * 
  *     @property
  *     def scheme(self) -> str:             # <<<<<<<<<<<<<<
  *         return self.__dict__.get("scheme") or (self.scope.get("scheme", "") if self.scope else "")
  * 
  */
 
@@ -10602,42 +10605,42 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":299
+  /* "blacksheep/messages.pyx":296
  *     @property
  *     def scheme(self) -> str:
  *         return self.__dict__.get("scheme") or (self.scope.get("scheme", "") if self.scope else "")             # <<<<<<<<<<<<<<
  * 
  *     @scheme.setter
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get");
-    __PYX_ERR(0, 299, __pyx_L1_error)
+    __PYX_ERR(0, 296, __pyx_L1_error)
   }
-  __pyx_t_2 = __Pyx_PyDict_GetItemDefault(__pyx_v_self->__dict__, __pyx_n_u_scheme, Py_None); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 299, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_GetItemDefault(__pyx_v_self->__dict__, __pyx_n_u_scheme, Py_None); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 296, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 299, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 296, __pyx_L1_error)
   if (!__pyx_t_3) {
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   } else {
     __Pyx_INCREF(__pyx_t_2);
     __pyx_t_1 = __pyx_t_2;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     goto __pyx_L3_bool_binop_done;
   }
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_self->scope); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 299, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_self->scope); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 296, __pyx_L1_error)
   if (__pyx_t_3) {
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->scope, __pyx_n_s_get); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 299, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->scope, __pyx_n_s_get); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 299, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_2 = __pyx_t_5;
     __pyx_t_5 = 0;
   } else {
     __Pyx_INCREF(__pyx_kp_u__3);
     __pyx_t_2 = __pyx_kp_u__3;
@@ -10646,15 +10649,15 @@
   __pyx_t_1 = __pyx_t_2;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_L3_bool_binop_done:;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":298
+  /* "blacksheep/messages.pyx":295
  * 
  *     @property
  *     def scheme(self) -> str:             # <<<<<<<<<<<<<<
  *         return self.__dict__.get("scheme") or (self.scope.get("scheme", "") if self.scope else "")
  * 
  */
 
@@ -10668,15 +10671,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":302
+/* "blacksheep/messages.pyx":299
  * 
  *     @scheme.setter
  *     def scheme(self, value: str):             # <<<<<<<<<<<<<<
  *         # this can be set, for example when handling forward headers
  *         self.__dict__["scheme"] = value
  */
 
@@ -10685,15 +10688,15 @@
 static int __pyx_pw_10blacksheep_8messages_7Request_6scheme_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyUnicode_Type), 1, "value", 1))) __PYX_ERR(0, 302, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyUnicode_Type), 1, "value", 1))) __PYX_ERR(0, 299, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Request_6scheme_2__set__(((struct __pyx_obj_10blacksheep_8messages_Request *)__pyx_v_self), ((PyObject*)__pyx_v_value));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -10705,28 +10708,28 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "blacksheep/messages.pyx":304
+  /* "blacksheep/messages.pyx":301
  *     def scheme(self, value: str):
  *         # this can be set, for example when handling forward headers
  *         self.__dict__["scheme"] = value             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-    __PYX_ERR(0, 304, __pyx_L1_error)
+    __PYX_ERR(0, 301, __pyx_L1_error)
   }
-  if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_scheme, __pyx_v_value) < 0)) __PYX_ERR(0, 304, __pyx_L1_error)
+  if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_scheme, __pyx_v_value) < 0)) __PYX_ERR(0, 301, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":302
+  /* "blacksheep/messages.pyx":299
  * 
  *     @scheme.setter
  *     def scheme(self, value: str):             # <<<<<<<<<<<<<<
  *         # this can be set, for example when handling forward headers
  *         self.__dict__["scheme"] = value
  */
 
@@ -10737,15 +10740,15 @@
   __Pyx_AddTraceback("blacksheep.messages.Request.scheme.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":307
+/* "blacksheep/messages.pyx":304
  * 
  *     @property
  *     def host(self) -> str:             # <<<<<<<<<<<<<<
  *         if not self.__dict__.get("host"):
  *             if self._url is not None and self._url.is_absolute:
  */
 
@@ -10771,33 +10774,33 @@
   int __pyx_t_3;
   int __pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":308
+  /* "blacksheep/messages.pyx":305
  *     @property
  *     def host(self) -> str:
  *         if not self.__dict__.get("host"):             # <<<<<<<<<<<<<<
  *             if self._url is not None and self._url.is_absolute:
  *                 self.__dict__["host"] = self._url.host.decode()
  */
   if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get");
-    __PYX_ERR(0, 308, __pyx_L1_error)
+    __PYX_ERR(0, 305, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_PyDict_GetItemDefault(__pyx_v_self->__dict__, __pyx_n_u_host, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 308, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_GetItemDefault(__pyx_v_self->__dict__, __pyx_n_u_host, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 305, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 308, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 305, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = ((!__pyx_t_2) != 0);
   if (__pyx_t_3) {
 
-    /* "blacksheep/messages.pyx":309
+    /* "blacksheep/messages.pyx":306
  *     def host(self) -> str:
  *         if not self.__dict__.get("host"):
  *             if self._url is not None and self._url.is_absolute:             # <<<<<<<<<<<<<<
  *                 self.__dict__["host"] = self._url.host.decode()
  *             else:
  */
     __pyx_t_2 = (((PyObject *)__pyx_v_self->_url) != Py_None);
@@ -10808,140 +10811,140 @@
       goto __pyx_L5_bool_binop_done;
     }
     __pyx_t_4 = (__pyx_v_self->_url->is_absolute != 0);
     __pyx_t_3 = __pyx_t_4;
     __pyx_L5_bool_binop_done:;
     if (__pyx_t_3) {
 
-      /* "blacksheep/messages.pyx":310
+      /* "blacksheep/messages.pyx":307
  *         if not self.__dict__.get("host"):
  *             if self._url is not None and self._url.is_absolute:
  *                 self.__dict__["host"] = self._url.host.decode()             # <<<<<<<<<<<<<<
  *             else:
  *                 # default to host header
  */
       if (unlikely(__pyx_v_self->_url->host == Py_None)) {
         PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "decode");
-        __PYX_ERR(0, 310, __pyx_L1_error)
+        __PYX_ERR(0, 307, __pyx_L1_error)
       }
-      __pyx_t_1 = __Pyx_decode_bytes(__pyx_v_self->_url->host, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 310, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_decode_bytes(__pyx_v_self->_url->host, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 307, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-        __PYX_ERR(0, 310, __pyx_L1_error)
+        __PYX_ERR(0, 307, __pyx_L1_error)
       }
-      if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_host, __pyx_t_1) < 0)) __PYX_ERR(0, 310, __pyx_L1_error)
+      if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_host, __pyx_t_1) < 0)) __PYX_ERR(0, 307, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-      /* "blacksheep/messages.pyx":309
+      /* "blacksheep/messages.pyx":306
  *     def host(self) -> str:
  *         if not self.__dict__.get("host"):
  *             if self._url is not None and self._url.is_absolute:             # <<<<<<<<<<<<<<
  *                 self.__dict__["host"] = self._url.host.decode()
  *             else:
  */
       goto __pyx_L4;
     }
 
-    /* "blacksheep/messages.pyx":313
+    /* "blacksheep/messages.pyx":310
  *             else:
  *                 # default to host header
  *                 host_header = self.get_first_header(b'host')             # <<<<<<<<<<<<<<
  *                 if host_header is None:
  *                     raise BadRequest("Missing Host header")
  */
     /*else*/ {
-      __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_n_b_host, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 313, __pyx_L1_error)
+      __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_n_b_host, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 310, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __pyx_v_host_header = ((PyObject*)__pyx_t_1);
       __pyx_t_1 = 0;
 
-      /* "blacksheep/messages.pyx":314
+      /* "blacksheep/messages.pyx":311
  *                 # default to host header
  *                 host_header = self.get_first_header(b'host')
  *                 if host_header is None:             # <<<<<<<<<<<<<<
  *                     raise BadRequest("Missing Host header")
  *                 self.__dict__["host"] = host_header.decode()
  */
       __pyx_t_3 = (__pyx_v_host_header == ((PyObject*)Py_None));
       __pyx_t_4 = (__pyx_t_3 != 0);
       if (unlikely(__pyx_t_4)) {
 
-        /* "blacksheep/messages.pyx":315
+        /* "blacksheep/messages.pyx":312
  *                 host_header = self.get_first_header(b'host')
  *                 if host_header is None:
  *                     raise BadRequest("Missing Host header")             # <<<<<<<<<<<<<<
  *                 self.__dict__["host"] = host_header.decode()
  *         return self.__dict__["host"]
  */
-        __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_10exceptions_BadRequest), __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 315, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_10exceptions_BadRequest), __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 312, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_Raise(__pyx_t_1, 0, 0, 0);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __PYX_ERR(0, 315, __pyx_L1_error)
+        __PYX_ERR(0, 312, __pyx_L1_error)
 
-        /* "blacksheep/messages.pyx":314
+        /* "blacksheep/messages.pyx":311
  *                 # default to host header
  *                 host_header = self.get_first_header(b'host')
  *                 if host_header is None:             # <<<<<<<<<<<<<<
  *                     raise BadRequest("Missing Host header")
  *                 self.__dict__["host"] = host_header.decode()
  */
       }
 
-      /* "blacksheep/messages.pyx":316
+      /* "blacksheep/messages.pyx":313
  *                 if host_header is None:
  *                     raise BadRequest("Missing Host header")
  *                 self.__dict__["host"] = host_header.decode()             # <<<<<<<<<<<<<<
  *         return self.__dict__["host"]
  * 
  */
       if (unlikely(__pyx_v_host_header == Py_None)) {
         PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "decode");
-        __PYX_ERR(0, 316, __pyx_L1_error)
+        __PYX_ERR(0, 313, __pyx_L1_error)
       }
-      __pyx_t_1 = __Pyx_decode_bytes(__pyx_v_host_header, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 316, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_decode_bytes(__pyx_v_host_header, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 313, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-        __PYX_ERR(0, 316, __pyx_L1_error)
+        __PYX_ERR(0, 313, __pyx_L1_error)
       }
-      if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_host, __pyx_t_1) < 0)) __PYX_ERR(0, 316, __pyx_L1_error)
+      if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_host, __pyx_t_1) < 0)) __PYX_ERR(0, 313, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     }
     __pyx_L4:;
 
-    /* "blacksheep/messages.pyx":308
+    /* "blacksheep/messages.pyx":305
  *     @property
  *     def host(self) -> str:
  *         if not self.__dict__.get("host"):             # <<<<<<<<<<<<<<
  *             if self._url is not None and self._url.is_absolute:
  *                 self.__dict__["host"] = self._url.host.decode()
  */
   }
 
-  /* "blacksheep/messages.pyx":317
+  /* "blacksheep/messages.pyx":314
  *                     raise BadRequest("Missing Host header")
  *                 self.__dict__["host"] = host_header.decode()
  *         return self.__dict__["host"]             # <<<<<<<<<<<<<<
  * 
  *     @host.setter
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-    __PYX_ERR(0, 317, __pyx_L1_error)
+    __PYX_ERR(0, 314, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_PyDict_GetItem(__pyx_v_self->__dict__, __pyx_n_u_host); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 317, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_GetItem(__pyx_v_self->__dict__, __pyx_n_u_host); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 314, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":307
+  /* "blacksheep/messages.pyx":304
  * 
  *     @property
  *     def host(self) -> str:             # <<<<<<<<<<<<<<
  *         if not self.__dict__.get("host"):
  *             if self._url is not None and self._url.is_absolute:
  */
 
@@ -10953,15 +10956,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_host_header);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":320
+/* "blacksheep/messages.pyx":317
  * 
  *     @host.setter
  *     def host(self, value: str) -> None:             # <<<<<<<<<<<<<<
  *         # this can be set, for example when handling forward headers
  *         self.__dict__["host"] = value
  */
 
@@ -10970,15 +10973,15 @@
 static int __pyx_pw_10blacksheep_8messages_7Request_4host_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyUnicode_Type), 1, "value", 1))) __PYX_ERR(0, 320, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyUnicode_Type), 1, "value", 1))) __PYX_ERR(0, 317, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Request_4host_2__set__(((struct __pyx_obj_10blacksheep_8messages_Request *)__pyx_v_self), ((PyObject*)__pyx_v_value));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -10990,28 +10993,28 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "blacksheep/messages.pyx":322
+  /* "blacksheep/messages.pyx":319
  *     def host(self, value: str) -> None:
  *         # this can be set, for example when handling forward headers
  *         self.__dict__["host"] = value             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-    __PYX_ERR(0, 322, __pyx_L1_error)
+    __PYX_ERR(0, 319, __pyx_L1_error)
   }
-  if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_host, __pyx_v_value) < 0)) __PYX_ERR(0, 322, __pyx_L1_error)
+  if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_host, __pyx_v_value) < 0)) __PYX_ERR(0, 319, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":320
+  /* "blacksheep/messages.pyx":317
  * 
  *     @host.setter
  *     def host(self, value: str) -> None:             # <<<<<<<<<<<<<<
  *         # this can be set, for example when handling forward headers
  *         self.__dict__["host"] = value
  */
 
@@ -11022,15 +11025,15 @@
   __Pyx_AddTraceback("blacksheep.messages.Request.host.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":325
+/* "blacksheep/messages.pyx":322
  * 
  *     @property
  *     def path(self) -> str:             # <<<<<<<<<<<<<<
  *         return self._path.decode()
  * 
  */
 
@@ -11052,33 +11055,33 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":326
+  /* "blacksheep/messages.pyx":323
  *     @property
  *     def path(self) -> str:
  *         return self._path.decode()             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(__pyx_v_self->_path == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "decode");
-    __PYX_ERR(0, 326, __pyx_L1_error)
+    __PYX_ERR(0, 323, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_decode_bytes(__pyx_v_self->_path, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 326, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_decode_bytes(__pyx_v_self->_path, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 323, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":325
+  /* "blacksheep/messages.pyx":322
  * 
  *     @property
  *     def path(self) -> str:             # <<<<<<<<<<<<<<
  *         return self._path.decode()
  * 
  */
 
@@ -11089,15 +11092,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":329
+/* "blacksheep/messages.pyx":326
  * 
  *     @property
  *     def base_path(self) -> str:             # <<<<<<<<<<<<<<
  *         return self.__dict__.get("base_path", "")
  * 
  */
 
@@ -11119,33 +11122,33 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":330
+  /* "blacksheep/messages.pyx":327
  *     @property
  *     def base_path(self) -> str:
  *         return self.__dict__.get("base_path", "")             # <<<<<<<<<<<<<<
  * 
  *     @base_path.setter
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get");
-    __PYX_ERR(0, 330, __pyx_L1_error)
+    __PYX_ERR(0, 327, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_PyDict_GetItemDefault(__pyx_v_self->__dict__, __pyx_n_u_base_path, __pyx_kp_u__3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 330, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_GetItemDefault(__pyx_v_self->__dict__, __pyx_n_u_base_path, __pyx_kp_u__3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":329
+  /* "blacksheep/messages.pyx":326
  * 
  *     @property
  *     def base_path(self) -> str:             # <<<<<<<<<<<<<<
  *         return self.__dict__.get("base_path", "")
  * 
  */
 
@@ -11156,15 +11159,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":333
+/* "blacksheep/messages.pyx":330
  * 
  *     @base_path.setter
  *     def base_path(self, value: str):             # <<<<<<<<<<<<<<
  *         # this can be set, for example when handling forward headers
  *         self.__dict__["base_path"] = value
  */
 
@@ -11173,15 +11176,15 @@
 static int __pyx_pw_10blacksheep_8messages_7Request_9base_path_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyUnicode_Type), 1, "value", 1))) __PYX_ERR(0, 333, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyUnicode_Type), 1, "value", 1))) __PYX_ERR(0, 330, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Request_9base_path_2__set__(((struct __pyx_obj_10blacksheep_8messages_Request *)__pyx_v_self), ((PyObject*)__pyx_v_value));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -11193,28 +11196,28 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "blacksheep/messages.pyx":335
+  /* "blacksheep/messages.pyx":332
  *     def base_path(self, value: str):
  *         # this can be set, for example when handling forward headers
  *         self.__dict__["base_path"] = value             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-    __PYX_ERR(0, 335, __pyx_L1_error)
+    __PYX_ERR(0, 332, __pyx_L1_error)
   }
-  if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_base_path, __pyx_v_value) < 0)) __PYX_ERR(0, 335, __pyx_L1_error)
+  if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_base_path, __pyx_v_value) < 0)) __PYX_ERR(0, 332, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":333
+  /* "blacksheep/messages.pyx":330
  * 
  *     @base_path.setter
  *     def base_path(self, value: str):             # <<<<<<<<<<<<<<
  *         # this can be set, for example when handling forward headers
  *         self.__dict__["base_path"] = value
  */
 
@@ -11225,15 +11228,15 @@
   __Pyx_AddTraceback("blacksheep.messages.Request.base_path.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":338
+/* "blacksheep/messages.pyx":335
  * 
  *     @property
  *     def client_ip(self) -> str:             # <<<<<<<<<<<<<<
  *         if self.scope is None:
  *             return ""
  */
 
@@ -11263,122 +11266,122 @@
   PyObject *__pyx_t_6 = NULL;
   PyObject *(*__pyx_t_7)(PyObject *);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":339
+  /* "blacksheep/messages.pyx":336
  *     @property
  *     def client_ip(self) -> str:
  *         if self.scope is None:             # <<<<<<<<<<<<<<
  *             return ""
  *         client_ip, client_port = self.scope.get("client", ("", 0))
  */
   __pyx_t_1 = (__pyx_v_self->scope == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":340
+    /* "blacksheep/messages.pyx":337
  *     def client_ip(self) -> str:
  *         if self.scope is None:
  *             return ""             # <<<<<<<<<<<<<<
  *         client_ip, client_port = self.scope.get("client", ("", 0))
  *         return client_ip
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_kp_u__3);
     __pyx_r = __pyx_kp_u__3;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":339
+    /* "blacksheep/messages.pyx":336
  *     @property
  *     def client_ip(self) -> str:
  *         if self.scope is None:             # <<<<<<<<<<<<<<
  *             return ""
  *         client_ip, client_port = self.scope.get("client", ("", 0))
  */
   }
 
-  /* "blacksheep/messages.pyx":341
+  /* "blacksheep/messages.pyx":338
  *         if self.scope is None:
  *             return ""
  *         client_ip, client_port = self.scope.get("client", ("", 0))             # <<<<<<<<<<<<<<
  *         return client_ip
  * 
  */
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->scope, __pyx_n_s_get); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 341, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->scope, __pyx_n_s_get); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 338, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 341, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 338, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
     PyObject* sequence = __pyx_t_4;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 341, __pyx_L1_error)
+      __PYX_ERR(0, 338, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_5 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_5 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_t_5);
     #else
-    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 341, __pyx_L1_error)
+    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 338, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 341, __pyx_L1_error)
+    __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 338, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     #endif
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_6 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 341, __pyx_L1_error)
+    __pyx_t_6 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 338, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_7 = Py_TYPE(__pyx_t_6)->tp_iternext;
     index = 0; __pyx_t_3 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_3)) goto __pyx_L4_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_3);
     index = 1; __pyx_t_5 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_5)) goto __pyx_L4_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_5);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 2) < 0) __PYX_ERR(0, 341, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 2) < 0) __PYX_ERR(0, 338, __pyx_L1_error)
     __pyx_t_7 = NULL;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     goto __pyx_L5_unpacking_done;
     __pyx_L4_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_t_7 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 341, __pyx_L1_error)
+    __PYX_ERR(0, 338, __pyx_L1_error)
     __pyx_L5_unpacking_done:;
   }
   __pyx_v_client_ip = __pyx_t_3;
   __pyx_t_3 = 0;
   __pyx_v_client_port = __pyx_t_5;
   __pyx_t_5 = 0;
 
-  /* "blacksheep/messages.pyx":342
+  /* "blacksheep/messages.pyx":339
  *             return ""
  *         client_ip, client_port = self.scope.get("client", ("", 0))
  *         return client_ip             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_client_ip);
   __pyx_r = __pyx_v_client_ip;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":338
+  /* "blacksheep/messages.pyx":335
  * 
  *     @property
  *     def client_ip(self) -> str:             # <<<<<<<<<<<<<<
  *         if self.scope is None:
  *             return ""
  */
 
@@ -11394,15 +11397,15 @@
   __Pyx_XDECREF(__pyx_v_client_ip);
   __Pyx_XDECREF(__pyx_v_client_port);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":345
+/* "blacksheep/messages.pyx":342
  * 
  *     @property
  *     def original_client_ip(self) -> str:             # <<<<<<<<<<<<<<
  *         if "original_client_ip" in self.__dict__:
  *             return self.__dict__["original_client_ip"]
  */
 
@@ -11426,71 +11429,71 @@
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":346
+  /* "blacksheep/messages.pyx":343
  *     @property
  *     def original_client_ip(self) -> str:
  *         if "original_client_ip" in self.__dict__:             # <<<<<<<<<<<<<<
  *             return self.__dict__["original_client_ip"]
  * 
  */
   if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 346, __pyx_L1_error)
+    __PYX_ERR(0, 343, __pyx_L1_error)
   }
-  __pyx_t_1 = (__Pyx_PyDict_ContainsTF(__pyx_n_u_original_client_ip, __pyx_v_self->__dict__, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 346, __pyx_L1_error)
+  __pyx_t_1 = (__Pyx_PyDict_ContainsTF(__pyx_n_u_original_client_ip, __pyx_v_self->__dict__, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 343, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":347
+    /* "blacksheep/messages.pyx":344
  *     def original_client_ip(self) -> str:
  *         if "original_client_ip" in self.__dict__:
  *             return self.__dict__["original_client_ip"]             # <<<<<<<<<<<<<<
  * 
  *         return self.client_ip
  */
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 347, __pyx_L1_error)
+      __PYX_ERR(0, 344, __pyx_L1_error)
     }
-    __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_self->__dict__, __pyx_n_u_original_client_ip); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 347, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_self->__dict__, __pyx_n_u_original_client_ip); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 344, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":346
+    /* "blacksheep/messages.pyx":343
  *     @property
  *     def original_client_ip(self) -> str:
  *         if "original_client_ip" in self.__dict__:             # <<<<<<<<<<<<<<
  *             return self.__dict__["original_client_ip"]
  * 
  */
   }
 
-  /* "blacksheep/messages.pyx":349
+  /* "blacksheep/messages.pyx":346
  *             return self.__dict__["original_client_ip"]
  * 
  *         return self.client_ip             # <<<<<<<<<<<<<<
  * 
  *     @original_client_ip.setter
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_client_ip); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 349, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_client_ip); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 346, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":345
+  /* "blacksheep/messages.pyx":342
  * 
  *     @property
  *     def original_client_ip(self) -> str:             # <<<<<<<<<<<<<<
  *         if "original_client_ip" in self.__dict__:
  *             return self.__dict__["original_client_ip"]
  */
 
@@ -11501,15 +11504,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":352
+/* "blacksheep/messages.pyx":349
  * 
  *     @original_client_ip.setter
  *     def original_client_ip(self, value: str):             # <<<<<<<<<<<<<<
  *         self.__dict__["original_client_ip"] = value
  * 
  */
 
@@ -11518,15 +11521,15 @@
 static int __pyx_pw_10blacksheep_8messages_7Request_18original_client_ip_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyUnicode_Type), 1, "value", 1))) __PYX_ERR(0, 352, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyUnicode_Type), 1, "value", 1))) __PYX_ERR(0, 349, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Request_18original_client_ip_2__set__(((struct __pyx_obj_10blacksheep_8messages_Request *)__pyx_v_self), ((PyObject*)__pyx_v_value));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -11538,28 +11541,28 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "blacksheep/messages.pyx":353
+  /* "blacksheep/messages.pyx":350
  *     @original_client_ip.setter
  *     def original_client_ip(self, value: str):
  *         self.__dict__["original_client_ip"] = value             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-    __PYX_ERR(0, 353, __pyx_L1_error)
+    __PYX_ERR(0, 350, __pyx_L1_error)
   }
-  if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_original_client_ip, __pyx_v_value) < 0)) __PYX_ERR(0, 353, __pyx_L1_error)
+  if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_original_client_ip, __pyx_v_value) < 0)) __PYX_ERR(0, 350, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":352
+  /* "blacksheep/messages.pyx":349
  * 
  *     @original_client_ip.setter
  *     def original_client_ip(self, value: str):             # <<<<<<<<<<<<<<
  *         self.__dict__["original_client_ip"] = value
  * 
  */
 
@@ -11570,15 +11573,15 @@
   __Pyx_AddTraceback("blacksheep.messages.Request.original_client_ip.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":356
+/* "blacksheep/messages.pyx":353
  * 
  *     @property
  *     def session(self):             # <<<<<<<<<<<<<<
  *         if self._session is None:
  *             raise TypeError(
  */
 
@@ -11602,65 +11605,65 @@
   int __pyx_t_2;
   int __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":357
+  /* "blacksheep/messages.pyx":354
  *     @property
  *     def session(self):
  *         if self._session is None:             # <<<<<<<<<<<<<<
  *             raise TypeError(
  *                 "A session is not configured for this request, activate "
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_session); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 357, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_session); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 354, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = (__pyx_t_1 == Py_None);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (unlikely(__pyx_t_3)) {
 
-    /* "blacksheep/messages.pyx":358
+    /* "blacksheep/messages.pyx":355
  *     def session(self):
  *         if self._session is None:
  *             raise TypeError(             # <<<<<<<<<<<<<<
  *                 "A session is not configured for this request, activate "
  *                 "sessions using `app.use_sessions` method."
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__9, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 358, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__9, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 355, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 358, __pyx_L1_error)
+    __PYX_ERR(0, 355, __pyx_L1_error)
 
-    /* "blacksheep/messages.pyx":357
+    /* "blacksheep/messages.pyx":354
  *     @property
  *     def session(self):
  *         if self._session is None:             # <<<<<<<<<<<<<<
  *             raise TypeError(
  *                 "A session is not configured for this request, activate "
  */
   }
 
-  /* "blacksheep/messages.pyx":362
+  /* "blacksheep/messages.pyx":359
  *                 "sessions using `app.use_sessions` method."
  *             )
  *         return self._session             # <<<<<<<<<<<<<<
  * 
  *     @session.setter
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_session); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 362, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_session); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 359, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":356
+  /* "blacksheep/messages.pyx":353
  * 
  *     @property
  *     def session(self):             # <<<<<<<<<<<<<<
  *         if self._session is None:
  *             raise TypeError(
  */
 
@@ -11671,15 +11674,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":365
+/* "blacksheep/messages.pyx":362
  * 
  *     @session.setter
  *     def session(self, value: Session):             # <<<<<<<<<<<<<<
  *         self._session = value
  * 
  */
 
@@ -11700,24 +11703,24 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "blacksheep/messages.pyx":366
+  /* "blacksheep/messages.pyx":363
  *     @session.setter
  *     def session(self, value: Session):
  *         self._session = value             # <<<<<<<<<<<<<<
  * 
  *     @classmethod
  */
-  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_session, __pyx_v_value) < 0) __PYX_ERR(0, 366, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_session, __pyx_v_value) < 0) __PYX_ERR(0, 363, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":365
+  /* "blacksheep/messages.pyx":362
  * 
  *     @session.setter
  *     def session(self, value: Session):             # <<<<<<<<<<<<<<
  *         self._session = value
  * 
  */
 
@@ -11728,15 +11731,15 @@
   __Pyx_AddTraceback("blacksheep.messages.Request.session.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":369
+/* "blacksheep/messages.pyx":366
  * 
  *     @classmethod
  *     def incoming(cls, str method, bytes path, bytes query, list headers):             # <<<<<<<<<<<<<<
  *         request = cls(method, None, headers)
  *         request._path = path
  */
 
@@ -11776,31 +11779,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_method)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_path)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("incoming", 1, 4, 4, 1); __PYX_ERR(0, 369, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("incoming", 1, 4, 4, 1); __PYX_ERR(0, 366, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_query)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("incoming", 1, 4, 4, 2); __PYX_ERR(0, 369, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("incoming", 1, 4, 4, 2); __PYX_ERR(0, 366, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_headers)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("incoming", 1, 4, 4, 3); __PYX_ERR(0, 369, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("incoming", 1, 4, 4, 3); __PYX_ERR(0, 366, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "incoming") < 0)) __PYX_ERR(0, 369, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "incoming") < 0)) __PYX_ERR(0, 366, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -11809,24 +11812,24 @@
     __pyx_v_method = ((PyObject*)values[0]);
     __pyx_v_path = ((PyObject*)values[1]);
     __pyx_v_query = ((PyObject*)values[2]);
     __pyx_v_headers = ((PyObject*)values[3]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("incoming", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 369, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("incoming", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 366, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("blacksheep.messages.Request.incoming", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_method), (&PyUnicode_Type), 1, "method", 1))) __PYX_ERR(0, 369, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_path), (&PyBytes_Type), 1, "path", 1))) __PYX_ERR(0, 369, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_query), (&PyBytes_Type), 1, "query", 1))) __PYX_ERR(0, 369, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_headers), (&PyList_Type), 1, "headers", 1))) __PYX_ERR(0, 369, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_method), (&PyUnicode_Type), 1, "method", 1))) __PYX_ERR(0, 366, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_path), (&PyBytes_Type), 1, "path", 1))) __PYX_ERR(0, 366, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_query), (&PyBytes_Type), 1, "query", 1))) __PYX_ERR(0, 366, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_headers), (&PyList_Type), 1, "headers", 1))) __PYX_ERR(0, 366, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Request_2incoming(((PyTypeObject*)__pyx_v_cls), __pyx_v_method, __pyx_v_path, __pyx_v_query, __pyx_v_headers);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -11841,69 +11844,69 @@
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("incoming", 0);
 
-  /* "blacksheep/messages.pyx":370
+  /* "blacksheep/messages.pyx":367
  *     @classmethod
  *     def incoming(cls, str method, bytes path, bytes query, list headers):
  *         request = cls(method, None, headers)             # <<<<<<<<<<<<<<
  *         request._path = path
  *         request._raw_query = query
  */
-  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 370, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 367, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_v_method);
   __Pyx_GIVEREF(__pyx_v_method);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_method);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyTuple_SET_ITEM(__pyx_t_1, 1, Py_None);
   __Pyx_INCREF(__pyx_v_headers);
   __Pyx_GIVEREF(__pyx_v_headers);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_headers);
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 370, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 367, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_request = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "blacksheep/messages.pyx":371
+  /* "blacksheep/messages.pyx":368
  *     def incoming(cls, str method, bytes path, bytes query, list headers):
  *         request = cls(method, None, headers)
  *         request._path = path             # <<<<<<<<<<<<<<
  *         request._raw_query = query
  *         return request
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_request, __pyx_n_s_path_2, __pyx_v_path) < 0) __PYX_ERR(0, 371, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_request, __pyx_n_s_path_2, __pyx_v_path) < 0) __PYX_ERR(0, 368, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":372
+  /* "blacksheep/messages.pyx":369
  *         request = cls(method, None, headers)
  *         request._path = path
  *         request._raw_query = query             # <<<<<<<<<<<<<<
  *         return request
  * 
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_request, __pyx_n_s_raw_query, __pyx_v_query) < 0) __PYX_ERR(0, 372, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_request, __pyx_n_s_raw_query, __pyx_v_query) < 0) __PYX_ERR(0, 369, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":373
+  /* "blacksheep/messages.pyx":370
  *         request._path = path
  *         request._raw_query = query
  *         return request             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_request);
   __pyx_r = __pyx_v_request;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":369
+  /* "blacksheep/messages.pyx":366
  * 
  *     @classmethod
  *     def incoming(cls, str method, bytes path, bytes query, list headers):             # <<<<<<<<<<<<<<
  *         request = cls(method, None, headers)
  *         request._path = path
  */
 
@@ -11916,15 +11919,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_request);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":376
+/* "blacksheep/messages.pyx":373
  * 
  *     @property
  *     def query(self):             # <<<<<<<<<<<<<<
  *         if self._raw_query:
  *             return parse_qs(self._raw_query.decode("utf8"))
  */
 
@@ -11950,84 +11953,84 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":377
+  /* "blacksheep/messages.pyx":374
  *     @property
  *     def query(self):
  *         if self._raw_query:             # <<<<<<<<<<<<<<
  *             return parse_qs(self._raw_query.decode("utf8"))
  *         return {}
  */
   __pyx_t_1 = (__pyx_v_self->_raw_query != Py_None)&&(PyBytes_GET_SIZE(__pyx_v_self->_raw_query) != 0);
   if (__pyx_t_1) {
 
-    /* "blacksheep/messages.pyx":378
+    /* "blacksheep/messages.pyx":375
  *     def query(self):
  *         if self._raw_query:
  *             return parse_qs(self._raw_query.decode("utf8"))             # <<<<<<<<<<<<<<
  *         return {}
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_parse_qs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 378, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_parse_qs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 375, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     if (unlikely(__pyx_v_self->_raw_query == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "decode");
-      __PYX_ERR(0, 378, __pyx_L1_error)
+      __PYX_ERR(0, 375, __pyx_L1_error)
     }
-    __pyx_t_4 = __Pyx_decode_bytes(__pyx_v_self->_raw_query, 0, PY_SSIZE_T_MAX, NULL, NULL, PyUnicode_DecodeUTF8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 378, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_decode_bytes(__pyx_v_self->_raw_query, 0, PY_SSIZE_T_MAX, NULL, NULL, PyUnicode_DecodeUTF8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 375, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 378, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 375, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_r = __pyx_t_2;
     __pyx_t_2 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":377
+    /* "blacksheep/messages.pyx":374
  *     @property
  *     def query(self):
  *         if self._raw_query:             # <<<<<<<<<<<<<<
  *             return parse_qs(self._raw_query.decode("utf8"))
  *         return {}
  */
   }
 
-  /* "blacksheep/messages.pyx":379
+  /* "blacksheep/messages.pyx":376
  *         if self._raw_query:
  *             return parse_qs(self._raw_query.decode("utf8"))
  *         return {}             # <<<<<<<<<<<<<<
  * 
  *     @query.setter
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 379, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 376, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":376
+  /* "blacksheep/messages.pyx":373
  * 
  *     @property
  *     def query(self):             # <<<<<<<<<<<<<<
  *         if self._raw_query:
  *             return parse_qs(self._raw_query.decode("utf8"))
  */
 
@@ -12041,15 +12044,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":382
+/* "blacksheep/messages.pyx":379
  * 
  *     @query.setter
  *     def query(self, value):             # <<<<<<<<<<<<<<
  *         cdef bytes raw_query
  *         raw_query = urlencode(value, True).encode("utf8")
  */
 
@@ -12077,22 +12080,22 @@
   int __pyx_t_5;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "blacksheep/messages.pyx":384
+  /* "blacksheep/messages.pyx":381
  *     def query(self, value):
  *         cdef bytes raw_query
  *         raw_query = urlencode(value, True).encode("utf8")             # <<<<<<<<<<<<<<
  *         self._raw_query = raw_query
  *         self.url = self.url.with_query(raw_query)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_urlencode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 384, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_urlencode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 381, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_4 = NULL;
   __pyx_t_5 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -12101,110 +12104,110 @@
       __Pyx_DECREF_SET(__pyx_t_3, function);
       __pyx_t_5 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_3)) {
     PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_value, Py_True};
-    __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 384, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 381, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_GOTREF(__pyx_t_2);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
     PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_value, Py_True};
-    __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 384, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 381, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_GOTREF(__pyx_t_2);
   } else
   #endif
   {
-    __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 384, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 381, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     if (__pyx_t_4) {
       __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
     }
     __Pyx_INCREF(__pyx_v_value);
     __Pyx_GIVEREF(__pyx_v_value);
     PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_value);
     __Pyx_INCREF(Py_True);
     __Pyx_GIVEREF(Py_True);
     PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, Py_True);
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 384, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 381, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   }
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_encode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 384, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_encode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 381, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_n_u_utf8) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_n_u_utf8);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 384, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 381, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 384, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 381, __pyx_L1_error)
   __pyx_v_raw_query = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":385
+  /* "blacksheep/messages.pyx":382
  *         cdef bytes raw_query
  *         raw_query = urlencode(value, True).encode("utf8")
  *         self._raw_query = raw_query             # <<<<<<<<<<<<<<
  *         self.url = self.url.with_query(raw_query)
  * 
  */
   __Pyx_INCREF(__pyx_v_raw_query);
   __Pyx_GIVEREF(__pyx_v_raw_query);
   __Pyx_GOTREF(__pyx_v_self->_raw_query);
   __Pyx_DECREF(__pyx_v_self->_raw_query);
   __pyx_v_self->_raw_query = __pyx_v_raw_query;
 
-  /* "blacksheep/messages.pyx":386
+  /* "blacksheep/messages.pyx":383
  *         raw_query = urlencode(value, True).encode("utf8")
  *         self._raw_query = raw_query
  *         self.url = self.url.with_query(raw_query)             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_url); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 386, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_url); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 383, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_with_query); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 386, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_with_query); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 383, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_raw_query) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_raw_query);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 386, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 383, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_url, __pyx_t_1) < 0) __PYX_ERR(0, 386, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_url, __pyx_t_1) < 0) __PYX_ERR(0, 383, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":382
+  /* "blacksheep/messages.pyx":379
  * 
  *     @query.setter
  *     def query(self, value):             # <<<<<<<<<<<<<<
  *         cdef bytes raw_query
  *         raw_query = urlencode(value, True).encode("utf8")
  */
 
@@ -12221,15 +12224,15 @@
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_raw_query);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":389
+/* "blacksheep/messages.pyx":386
  * 
  *     @property
  *     def url(self):             # <<<<<<<<<<<<<<
  *         if self._url:
  *             return self._url
  */
 
@@ -12253,117 +12256,117 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":390
+  /* "blacksheep/messages.pyx":387
  *     @property
  *     def url(self):
  *         if self._url:             # <<<<<<<<<<<<<<
  *             return self._url
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_self->_url)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 390, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_self->_url)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 387, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "blacksheep/messages.pyx":391
+    /* "blacksheep/messages.pyx":388
  *     def url(self):
  *         if self._url:
  *             return self._url             # <<<<<<<<<<<<<<
  * 
  *         if self._raw_query:
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(((PyObject *)__pyx_v_self->_url));
     __pyx_r = ((PyObject *)__pyx_v_self->_url);
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":390
+    /* "blacksheep/messages.pyx":387
  *     @property
  *     def url(self):
  *         if self._url:             # <<<<<<<<<<<<<<
  *             return self._url
  * 
  */
   }
 
-  /* "blacksheep/messages.pyx":393
+  /* "blacksheep/messages.pyx":390
  *             return self._url
  * 
  *         if self._raw_query:             # <<<<<<<<<<<<<<
  *             self._url = URL(self._path + b'?' + self._raw_query)
  *         else:
  */
   __pyx_t_1 = (__pyx_v_self->_raw_query != Py_None)&&(PyBytes_GET_SIZE(__pyx_v_self->_raw_query) != 0);
   if (__pyx_t_1) {
 
-    /* "blacksheep/messages.pyx":394
+    /* "blacksheep/messages.pyx":391
  * 
  *         if self._raw_query:
  *             self._url = URL(self._path + b'?' + self._raw_query)             # <<<<<<<<<<<<<<
  *         else:
  *             self._url = URL(self._path)
  */
-    __pyx_t_2 = PyNumber_Add(__pyx_v_self->_path, __pyx_kp_b__10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 394, __pyx_L1_error)
+    __pyx_t_2 = PyNumber_Add(__pyx_v_self->_path, __pyx_kp_b__10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 391, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_v_self->_raw_query); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 394, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_v_self->_raw_query); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 391, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_10blacksheep_3url_URL), __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 394, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_10blacksheep_3url_URL), __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 391, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GIVEREF(__pyx_t_2);
     __Pyx_GOTREF(__pyx_v_self->_url);
     __Pyx_DECREF(((PyObject *)__pyx_v_self->_url));
     __pyx_v_self->_url = ((struct __pyx_obj_10blacksheep_3url_URL *)__pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "blacksheep/messages.pyx":393
+    /* "blacksheep/messages.pyx":390
  *             return self._url
  * 
  *         if self._raw_query:             # <<<<<<<<<<<<<<
  *             self._url = URL(self._path + b'?' + self._raw_query)
  *         else:
  */
     goto __pyx_L4;
   }
 
-  /* "blacksheep/messages.pyx":396
+  /* "blacksheep/messages.pyx":393
  *             self._url = URL(self._path + b'?' + self._raw_query)
  *         else:
  *             self._url = URL(self._path)             # <<<<<<<<<<<<<<
  *         return self._url
  * 
  */
   /*else*/ {
-    __pyx_t_2 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_10blacksheep_3url_URL), __pyx_v_self->_path); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 396, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_10blacksheep_3url_URL), __pyx_v_self->_path); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 393, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_GIVEREF(__pyx_t_2);
     __Pyx_GOTREF(__pyx_v_self->_url);
     __Pyx_DECREF(((PyObject *)__pyx_v_self->_url));
     __pyx_v_self->_url = ((struct __pyx_obj_10blacksheep_3url_URL *)__pyx_t_2);
     __pyx_t_2 = 0;
   }
   __pyx_L4:;
 
-  /* "blacksheep/messages.pyx":397
+  /* "blacksheep/messages.pyx":394
  *         else:
  *             self._url = URL(self._path)
  *         return self._url             # <<<<<<<<<<<<<<
  * 
  *     @url.setter
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self->_url));
   __pyx_r = ((PyObject *)__pyx_v_self->_url);
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":389
+  /* "blacksheep/messages.pyx":386
  * 
  *     @property
  *     def url(self):             # <<<<<<<<<<<<<<
  *         if self._url:
  *             return self._url
  */
 
@@ -12375,15 +12378,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":400
+/* "blacksheep/messages.pyx":397
  * 
  *     @url.setter
  *     def url(self, object value):             # <<<<<<<<<<<<<<
  *         cdef URL _url
  * 
  */
 
@@ -12410,296 +12413,296 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "blacksheep/messages.pyx":403
+  /* "blacksheep/messages.pyx":400
  *         cdef URL _url
  * 
  *         if value:             # <<<<<<<<<<<<<<
  *             if isinstance(value, bytes):
  *                 _url = URL(value)
  */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_value); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 403, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_value); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 400, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "blacksheep/messages.pyx":404
+    /* "blacksheep/messages.pyx":401
  * 
  *         if value:
  *             if isinstance(value, bytes):             # <<<<<<<<<<<<<<
  *                 _url = URL(value)
  *             elif isinstance(value, str):
  */
     __pyx_t_1 = PyBytes_Check(__pyx_v_value); 
     __pyx_t_2 = (__pyx_t_1 != 0);
     if (__pyx_t_2) {
 
-      /* "blacksheep/messages.pyx":405
+      /* "blacksheep/messages.pyx":402
  *         if value:
  *             if isinstance(value, bytes):
  *                 _url = URL(value)             # <<<<<<<<<<<<<<
  *             elif isinstance(value, str):
  *                 _url = URL(value.encode('utf8'))
  */
-      __pyx_t_3 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_10blacksheep_3url_URL), __pyx_v_value); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 405, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_10blacksheep_3url_URL), __pyx_v_value); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 402, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __pyx_v__url = ((struct __pyx_obj_10blacksheep_3url_URL *)__pyx_t_3);
       __pyx_t_3 = 0;
 
-      /* "blacksheep/messages.pyx":404
+      /* "blacksheep/messages.pyx":401
  * 
  *         if value:
  *             if isinstance(value, bytes):             # <<<<<<<<<<<<<<
  *                 _url = URL(value)
  *             elif isinstance(value, str):
  */
       goto __pyx_L4;
     }
 
-    /* "blacksheep/messages.pyx":406
+    /* "blacksheep/messages.pyx":403
  *             if isinstance(value, bytes):
  *                 _url = URL(value)
  *             elif isinstance(value, str):             # <<<<<<<<<<<<<<
  *                 _url = URL(value.encode('utf8'))
  *             elif isinstance(value, URL):
  */
     __pyx_t_2 = PyUnicode_Check(__pyx_v_value); 
     __pyx_t_1 = (__pyx_t_2 != 0);
     if (__pyx_t_1) {
 
-      /* "blacksheep/messages.pyx":407
+      /* "blacksheep/messages.pyx":404
  *                 _url = URL(value)
  *             elif isinstance(value, str):
  *                 _url = URL(value.encode('utf8'))             # <<<<<<<<<<<<<<
  *             elif isinstance(value, URL):
  *                 _url = value
  */
-      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_value, __pyx_n_s_encode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 407, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_value, __pyx_n_s_encode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 404, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __pyx_t_5 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
         __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
         if (likely(__pyx_t_5)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
           __Pyx_INCREF(__pyx_t_5);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_4, function);
         }
       }
       __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_n_u_utf8) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_n_u_utf8);
       __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 407, __pyx_L1_error)
+      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 404, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_4 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_10blacksheep_3url_URL), __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 407, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_10blacksheep_3url_URL), __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 404, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __pyx_v__url = ((struct __pyx_obj_10blacksheep_3url_URL *)__pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "blacksheep/messages.pyx":406
+      /* "blacksheep/messages.pyx":403
  *             if isinstance(value, bytes):
  *                 _url = URL(value)
  *             elif isinstance(value, str):             # <<<<<<<<<<<<<<
  *                 _url = URL(value.encode('utf8'))
  *             elif isinstance(value, URL):
  */
       goto __pyx_L4;
     }
 
-    /* "blacksheep/messages.pyx":408
+    /* "blacksheep/messages.pyx":405
  *             elif isinstance(value, str):
  *                 _url = URL(value.encode('utf8'))
  *             elif isinstance(value, URL):             # <<<<<<<<<<<<<<
  *                 _url = value
  *             else:
  */
     __pyx_t_1 = __Pyx_TypeCheck(__pyx_v_value, __pyx_ptype_10blacksheep_3url_URL); 
     __pyx_t_2 = (__pyx_t_1 != 0);
     if (likely(__pyx_t_2)) {
 
-      /* "blacksheep/messages.pyx":409
+      /* "blacksheep/messages.pyx":406
  *                 _url = URL(value.encode('utf8'))
  *             elif isinstance(value, URL):
  *                 _url = value             # <<<<<<<<<<<<<<
  *             else:
  *                 raise TypeError('Invalid value type, expected bytes, str, or URL')
  */
-      if (!(likely(((__pyx_v_value) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_value, __pyx_ptype_10blacksheep_3url_URL))))) __PYX_ERR(0, 409, __pyx_L1_error)
+      if (!(likely(((__pyx_v_value) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_value, __pyx_ptype_10blacksheep_3url_URL))))) __PYX_ERR(0, 406, __pyx_L1_error)
       __pyx_t_4 = __pyx_v_value;
       __Pyx_INCREF(__pyx_t_4);
       __pyx_v__url = ((struct __pyx_obj_10blacksheep_3url_URL *)__pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "blacksheep/messages.pyx":408
+      /* "blacksheep/messages.pyx":405
  *             elif isinstance(value, str):
  *                 _url = URL(value.encode('utf8'))
  *             elif isinstance(value, URL):             # <<<<<<<<<<<<<<
  *                 _url = value
  *             else:
  */
       goto __pyx_L4;
     }
 
-    /* "blacksheep/messages.pyx":411
+    /* "blacksheep/messages.pyx":408
  *                 _url = value
  *             else:
  *                 raise TypeError('Invalid value type, expected bytes, str, or URL')             # <<<<<<<<<<<<<<
  *         else:
  *             _url = None
  */
     /*else*/ {
-      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 411, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 408, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_Raise(__pyx_t_4, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __PYX_ERR(0, 411, __pyx_L1_error)
+      __PYX_ERR(0, 408, __pyx_L1_error)
     }
     __pyx_L4:;
 
-    /* "blacksheep/messages.pyx":403
+    /* "blacksheep/messages.pyx":400
  *         cdef URL _url
  * 
  *         if value:             # <<<<<<<<<<<<<<
  *             if isinstance(value, bytes):
  *                 _url = URL(value)
  */
     goto __pyx_L3;
   }
 
-  /* "blacksheep/messages.pyx":413
+  /* "blacksheep/messages.pyx":410
  *                 raise TypeError('Invalid value type, expected bytes, str, or URL')
  *         else:
  *             _url = None             # <<<<<<<<<<<<<<
  * 
  *         if _url:
  */
   /*else*/ {
     __Pyx_INCREF(Py_None);
     __pyx_v__url = ((struct __pyx_obj_10blacksheep_3url_URL *)Py_None);
   }
   __pyx_L3:;
 
-  /* "blacksheep/messages.pyx":415
+  /* "blacksheep/messages.pyx":412
  *             _url = None
  * 
  *         if _url:             # <<<<<<<<<<<<<<
  *             self._path = _url.path
  *             self._raw_query = _url.query
  */
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v__url)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 415, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v__url)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 412, __pyx_L1_error)
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":416
+    /* "blacksheep/messages.pyx":413
  * 
  *         if _url:
  *             self._path = _url.path             # <<<<<<<<<<<<<<
  *             self._raw_query = _url.query
  *         else:
  */
     __pyx_t_4 = __pyx_v__url->path;
     __Pyx_INCREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_4);
     __Pyx_GOTREF(__pyx_v_self->_path);
     __Pyx_DECREF(__pyx_v_self->_path);
     __pyx_v_self->_path = ((PyObject*)__pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "blacksheep/messages.pyx":417
+    /* "blacksheep/messages.pyx":414
  *         if _url:
  *             self._path = _url.path
  *             self._raw_query = _url.query             # <<<<<<<<<<<<<<
  *         else:
  *             self._path = None
  */
     __pyx_t_4 = __pyx_v__url->query;
     __Pyx_INCREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_4);
     __Pyx_GOTREF(__pyx_v_self->_raw_query);
     __Pyx_DECREF(__pyx_v_self->_raw_query);
     __pyx_v_self->_raw_query = ((PyObject*)__pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "blacksheep/messages.pyx":415
+    /* "blacksheep/messages.pyx":412
  *             _url = None
  * 
  *         if _url:             # <<<<<<<<<<<<<<
  *             self._path = _url.path
  *             self._raw_query = _url.query
  */
     goto __pyx_L5;
   }
 
-  /* "blacksheep/messages.pyx":419
+  /* "blacksheep/messages.pyx":416
  *             self._raw_query = _url.query
  *         else:
  *             self._path = None             # <<<<<<<<<<<<<<
  *             self._raw_query = None
  *         self._url = _url
  */
   /*else*/ {
     __Pyx_INCREF(Py_None);
     __Pyx_GIVEREF(Py_None);
     __Pyx_GOTREF(__pyx_v_self->_path);
     __Pyx_DECREF(__pyx_v_self->_path);
     __pyx_v_self->_path = ((PyObject*)Py_None);
 
-    /* "blacksheep/messages.pyx":420
+    /* "blacksheep/messages.pyx":417
  *         else:
  *             self._path = None
  *             self._raw_query = None             # <<<<<<<<<<<<<<
  *         self._url = _url
  *         # unset the cached host
  */
     __Pyx_INCREF(Py_None);
     __Pyx_GIVEREF(Py_None);
     __Pyx_GOTREF(__pyx_v_self->_raw_query);
     __Pyx_DECREF(__pyx_v_self->_raw_query);
     __pyx_v_self->_raw_query = ((PyObject*)Py_None);
   }
   __pyx_L5:;
 
-  /* "blacksheep/messages.pyx":421
+  /* "blacksheep/messages.pyx":418
  *             self._path = None
  *             self._raw_query = None
  *         self._url = _url             # <<<<<<<<<<<<<<
  *         # unset the cached host
  *         self.__dict__["host"] = None
  */
   __Pyx_INCREF(((PyObject *)__pyx_v__url));
   __Pyx_GIVEREF(((PyObject *)__pyx_v__url));
   __Pyx_GOTREF(__pyx_v_self->_url);
   __Pyx_DECREF(((PyObject *)__pyx_v_self->_url));
   __pyx_v_self->_url = __pyx_v__url;
 
-  /* "blacksheep/messages.pyx":423
+  /* "blacksheep/messages.pyx":420
  *         self._url = _url
  *         # unset the cached host
  *         self.__dict__["host"] = None             # <<<<<<<<<<<<<<
  *         self.remove_header(b"host")
  * 
  */
   if (unlikely(__pyx_v_self->__dict__ == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-    __PYX_ERR(0, 423, __pyx_L1_error)
+    __PYX_ERR(0, 420, __pyx_L1_error)
   }
-  if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_host, Py_None) < 0)) __PYX_ERR(0, 423, __pyx_L1_error)
+  if (unlikely(PyDict_SetItem(__pyx_v_self->__dict__, __pyx_n_u_host, Py_None) < 0)) __PYX_ERR(0, 420, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":424
+  /* "blacksheep/messages.pyx":421
  *         # unset the cached host
  *         self.__dict__["host"] = None
  *         self.remove_header(b"host")             # <<<<<<<<<<<<<<
  * 
  *     def __repr__(self):
  */
   ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.remove_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_n_b_host, 0);
 
-  /* "blacksheep/messages.pyx":400
+  /* "blacksheep/messages.pyx":397
  * 
  *     @url.setter
  *     def url(self, object value):             # <<<<<<<<<<<<<<
  *         cdef URL _url
  * 
  */
 
@@ -12714,15 +12717,15 @@
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__url);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":426
+/* "blacksheep/messages.pyx":423
  *         self.remove_header(b"host")
  * 
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         return f'<Request {self.method} {self.url.value.decode()}>'
  * 
  */
 
@@ -12749,84 +12752,84 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "blacksheep/messages.pyx":427
+  /* "blacksheep/messages.pyx":424
  * 
  *     def __repr__(self):
  *         return f'<Request {self.method} {self.url.value.decode()}>'             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 427, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u_Request);
   __pyx_t_2 += 9;
   __Pyx_GIVEREF(__pyx_kp_u_Request);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Request);
-  __pyx_t_4 = __Pyx_PyUnicode_Unicode(__pyx_v_self->method); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 427, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyUnicode_Unicode(__pyx_v_self->method); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
   __pyx_t_4 = 0;
   __Pyx_INCREF(__pyx_kp_u__12);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__12);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u__12);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_url); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 427, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_url); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_value); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 427, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_value); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_decode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 427, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_decode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 427, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 427, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__13);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__13);
   PyTuple_SET_ITEM(__pyx_t_1, 4, __pyx_kp_u__13);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 427, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":426
+  /* "blacksheep/messages.pyx":423
  *         self.remove_header(b"host")
  * 
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         return f'<Request {self.method} {self.url.value.decode()}>'
  * 
  */
 
@@ -12840,15 +12843,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":430
+/* "blacksheep/messages.pyx":427
  * 
  *     @property
  *     def cookies(self):             # <<<<<<<<<<<<<<
  *         cdef bytes header
  *         cdef list cookies_headers
  */
 
@@ -12893,134 +12896,134 @@
   PyObject *__pyx_t_15 = NULL;
   int __pyx_t_16;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":433
+  /* "blacksheep/messages.pyx":430
  *         cdef bytes header
  *         cdef list cookies_headers
  *         cdef dict cookies = {}             # <<<<<<<<<<<<<<
  * 
  *         cookies_headers = self.get_headers(b'cookie')
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 433, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 430, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_cookies = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":435
+  /* "blacksheep/messages.pyx":432
  *         cdef dict cookies = {}
  * 
  *         cookies_headers = self.get_headers(b'cookie')             # <<<<<<<<<<<<<<
  *         if cookies_headers:
  *             for header in cookies_headers:
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_headers(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_n_b_cookie, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 435, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_headers(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_n_b_cookie, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 432, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_cookies_headers = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":436
+  /* "blacksheep/messages.pyx":433
  * 
  *         cookies_headers = self.get_headers(b'cookie')
  *         if cookies_headers:             # <<<<<<<<<<<<<<
  *             for header in cookies_headers:
  *                 # a single cookie header is expected from the client, but anyway here
  */
   __pyx_t_2 = (__pyx_v_cookies_headers != Py_None)&&(PyList_GET_SIZE(__pyx_v_cookies_headers) != 0);
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":437
+    /* "blacksheep/messages.pyx":434
  *         cookies_headers = self.get_headers(b'cookie')
  *         if cookies_headers:
  *             for header in cookies_headers:             # <<<<<<<<<<<<<<
  *                 # a single cookie header is expected from the client, but anyway here
  *                 # multiple headers are handled:
  */
     if (unlikely(__pyx_v_cookies_headers == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-      __PYX_ERR(0, 437, __pyx_L1_error)
+      __PYX_ERR(0, 434, __pyx_L1_error)
     }
     __pyx_t_1 = __pyx_v_cookies_headers; __Pyx_INCREF(__pyx_t_1); __pyx_t_3 = 0;
     for (;;) {
       if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_1)) break;
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_4); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 437, __pyx_L1_error)
+      __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_4); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 434, __pyx_L1_error)
       #else
-      __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 437, __pyx_L1_error)
+      __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 434, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       #endif
-      if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 437, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 434, __pyx_L1_error)
       __Pyx_XDECREF_SET(__pyx_v_header, ((PyObject*)__pyx_t_4));
       __pyx_t_4 = 0;
 
-      /* "blacksheep/messages.pyx":440
+      /* "blacksheep/messages.pyx":437
  *                 # a single cookie header is expected from the client, but anyway here
  *                 # multiple headers are handled:
  *                 pairs = header.split(b'; ')             # <<<<<<<<<<<<<<
  * 
  *                 for fragment in pairs:
  */
-      __pyx_t_4 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PyBytes_Type_split, __pyx_v_header, __pyx_kp_b__14); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 440, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PyBytes_Type_split, __pyx_v_header, __pyx_kp_b__14); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 437, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_XDECREF_SET(__pyx_v_pairs, __pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "blacksheep/messages.pyx":442
+      /* "blacksheep/messages.pyx":439
  *                 pairs = header.split(b'; ')
  * 
  *                 for fragment in pairs:             # <<<<<<<<<<<<<<
  *                     try:
  *                         name, value = split_value(fragment, b"=")
  */
       if (likely(PyList_CheckExact(__pyx_v_pairs)) || PyTuple_CheckExact(__pyx_v_pairs)) {
         __pyx_t_4 = __pyx_v_pairs; __Pyx_INCREF(__pyx_t_4); __pyx_t_5 = 0;
         __pyx_t_6 = NULL;
       } else {
-        __pyx_t_5 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_pairs); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 442, __pyx_L1_error)
+        __pyx_t_5 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_pairs); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 439, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 442, __pyx_L1_error)
+        __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 439, __pyx_L1_error)
       }
       for (;;) {
         if (likely(!__pyx_t_6)) {
           if (likely(PyList_CheckExact(__pyx_t_4))) {
             if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_4)) break;
             #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            __pyx_t_7 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 442, __pyx_L1_error)
+            __pyx_t_7 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 439, __pyx_L1_error)
             #else
-            __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 442, __pyx_L1_error)
+            __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 439, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_7);
             #endif
           } else {
             if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
             #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 442, __pyx_L1_error)
+            __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 439, __pyx_L1_error)
             #else
-            __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 442, __pyx_L1_error)
+            __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 439, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_7);
             #endif
           }
         } else {
           __pyx_t_7 = __pyx_t_6(__pyx_t_4);
           if (unlikely(!__pyx_t_7)) {
             PyObject* exc_type = PyErr_Occurred();
             if (exc_type) {
               if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-              else __PYX_ERR(0, 442, __pyx_L1_error)
+              else __PYX_ERR(0, 439, __pyx_L1_error)
             }
             break;
           }
           __Pyx_GOTREF(__pyx_t_7);
         }
         __Pyx_XDECREF_SET(__pyx_v_fragment, __pyx_t_7);
         __pyx_t_7 = 0;
 
-        /* "blacksheep/messages.pyx":443
+        /* "blacksheep/messages.pyx":440
  * 
  *                 for fragment in pairs:
  *                     try:             # <<<<<<<<<<<<<<
  *                         name, value = split_value(fragment, b"=")
  *                     except ValueError as unpack_error:
  */
         {
@@ -13028,104 +13031,104 @@
           __Pyx_PyThreadState_assign
           __Pyx_ExceptionSave(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
           __Pyx_XGOTREF(__pyx_t_8);
           __Pyx_XGOTREF(__pyx_t_9);
           __Pyx_XGOTREF(__pyx_t_10);
           /*try:*/ {
 
-            /* "blacksheep/messages.pyx":444
+            /* "blacksheep/messages.pyx":441
  *                 for fragment in pairs:
  *                     try:
  *                         name, value = split_value(fragment, b"=")             # <<<<<<<<<<<<<<
  *                     except ValueError as unpack_error:
  *                         # discard cookie: in this case it's better to eat the exception
  */
-            if (!(likely(PyBytes_CheckExact(__pyx_v_fragment))||((__pyx_v_fragment) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_v_fragment)->tp_name), 0))) __PYX_ERR(0, 444, __pyx_L8_error)
-            __pyx_t_7 = __pyx_f_10blacksheep_7cookies_split_value(((PyObject*)__pyx_v_fragment), __pyx_kp_b__15); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 444, __pyx_L8_error)
+            if (!(likely(PyBytes_CheckExact(__pyx_v_fragment))||((__pyx_v_fragment) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_v_fragment)->tp_name), 0))) __PYX_ERR(0, 441, __pyx_L8_error)
+            __pyx_t_7 = __pyx_f_10blacksheep_7cookies_split_value(((PyObject*)__pyx_v_fragment), __pyx_kp_b__15); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 441, __pyx_L8_error)
             __Pyx_GOTREF(__pyx_t_7);
             if (likely(__pyx_t_7 != Py_None)) {
               PyObject* sequence = __pyx_t_7;
               Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
               if (unlikely(size != 2)) {
                 if (size > 2) __Pyx_RaiseTooManyValuesError(2);
                 else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-                __PYX_ERR(0, 444, __pyx_L8_error)
+                __PYX_ERR(0, 441, __pyx_L8_error)
               }
               #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
               __pyx_t_11 = PyTuple_GET_ITEM(sequence, 0); 
               __pyx_t_12 = PyTuple_GET_ITEM(sequence, 1); 
               __Pyx_INCREF(__pyx_t_11);
               __Pyx_INCREF(__pyx_t_12);
               #else
-              __pyx_t_11 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 444, __pyx_L8_error)
+              __pyx_t_11 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 441, __pyx_L8_error)
               __Pyx_GOTREF(__pyx_t_11);
-              __pyx_t_12 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 444, __pyx_L8_error)
+              __pyx_t_12 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 441, __pyx_L8_error)
               __Pyx_GOTREF(__pyx_t_12);
               #endif
               __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
             } else {
-              __Pyx_RaiseNoneNotIterableError(); __PYX_ERR(0, 444, __pyx_L8_error)
+              __Pyx_RaiseNoneNotIterableError(); __PYX_ERR(0, 441, __pyx_L8_error)
             }
             __Pyx_XDECREF_SET(__pyx_v_name, __pyx_t_11);
             __pyx_t_11 = 0;
             __Pyx_XDECREF_SET(__pyx_v_value, __pyx_t_12);
             __pyx_t_12 = 0;
 
-            /* "blacksheep/messages.pyx":443
+            /* "blacksheep/messages.pyx":440
  * 
  *                 for fragment in pairs:
  *                     try:             # <<<<<<<<<<<<<<
  *                         name, value = split_value(fragment, b"=")
  *                     except ValueError as unpack_error:
  */
           }
 
-          /* "blacksheep/messages.pyx":450
+          /* "blacksheep/messages.pyx":447
  *                         pass
  *                     else:
  *                         cookies[unquote(name.decode())] = unquote(value.rstrip(b'; ').decode())             # <<<<<<<<<<<<<<
  *         return cookies
  * 
  */
           /*else:*/ {
-            __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_unquote); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 450, __pyx_L10_except_error)
+            __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_unquote); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 447, __pyx_L10_except_error)
             __Pyx_GOTREF(__pyx_t_12);
-            __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_v_value, __pyx_n_s_rstrip); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 450, __pyx_L10_except_error)
+            __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_v_value, __pyx_n_s_rstrip); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 447, __pyx_L10_except_error)
             __Pyx_GOTREF(__pyx_t_14);
             __pyx_t_15 = NULL;
             if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_14))) {
               __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_14);
               if (likely(__pyx_t_15)) {
                 PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
                 __Pyx_INCREF(__pyx_t_15);
                 __Pyx_INCREF(function);
                 __Pyx_DECREF_SET(__pyx_t_14, function);
               }
             }
             __pyx_t_13 = (__pyx_t_15) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_15, __pyx_kp_b__14) : __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_kp_b__14);
             __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
-            if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 450, __pyx_L10_except_error)
+            if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 447, __pyx_L10_except_error)
             __Pyx_GOTREF(__pyx_t_13);
             __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-            __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_decode); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 450, __pyx_L10_except_error)
+            __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_decode); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 447, __pyx_L10_except_error)
             __Pyx_GOTREF(__pyx_t_14);
             __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
             __pyx_t_13 = NULL;
             if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_14))) {
               __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_14);
               if (likely(__pyx_t_13)) {
                 PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
                 __Pyx_INCREF(__pyx_t_13);
                 __Pyx_INCREF(function);
                 __Pyx_DECREF_SET(__pyx_t_14, function);
               }
             }
             __pyx_t_11 = (__pyx_t_13) ? __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_t_13) : __Pyx_PyObject_CallNoArg(__pyx_t_14);
             __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
-            if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 450, __pyx_L10_except_error)
+            if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 447, __pyx_L10_except_error)
             __Pyx_GOTREF(__pyx_t_11);
             __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
             __pyx_t_14 = NULL;
             if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_12))) {
               __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_12);
               if (likely(__pyx_t_14)) {
                 PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
@@ -13133,34 +13136,34 @@
                 __Pyx_INCREF(function);
                 __Pyx_DECREF_SET(__pyx_t_12, function);
               }
             }
             __pyx_t_7 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_12, __pyx_t_14, __pyx_t_11) : __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_t_11);
             __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
             __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-            if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 450, __pyx_L10_except_error)
+            if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 447, __pyx_L10_except_error)
             __Pyx_GOTREF(__pyx_t_7);
             __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-            __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_unquote); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 450, __pyx_L10_except_error)
+            __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_unquote); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 447, __pyx_L10_except_error)
             __Pyx_GOTREF(__pyx_t_11);
-            __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_name, __pyx_n_s_decode); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 450, __pyx_L10_except_error)
+            __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_name, __pyx_n_s_decode); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 447, __pyx_L10_except_error)
             __Pyx_GOTREF(__pyx_t_13);
             __pyx_t_15 = NULL;
             if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
               __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_13);
               if (likely(__pyx_t_15)) {
                 PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
                 __Pyx_INCREF(__pyx_t_15);
                 __Pyx_INCREF(function);
                 __Pyx_DECREF_SET(__pyx_t_13, function);
               }
             }
             __pyx_t_14 = (__pyx_t_15) ? __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_15) : __Pyx_PyObject_CallNoArg(__pyx_t_13);
             __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
-            if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 450, __pyx_L10_except_error)
+            if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 447, __pyx_L10_except_error)
             __Pyx_GOTREF(__pyx_t_14);
             __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
             __pyx_t_13 = NULL;
             if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
               __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_11);
               if (likely(__pyx_t_13)) {
                 PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
@@ -13168,41 +13171,41 @@
                 __Pyx_INCREF(function);
                 __Pyx_DECREF_SET(__pyx_t_11, function);
               }
             }
             __pyx_t_12 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_13, __pyx_t_14) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_14);
             __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
             __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-            if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 450, __pyx_L10_except_error)
+            if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 447, __pyx_L10_except_error)
             __Pyx_GOTREF(__pyx_t_12);
             __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-            if (unlikely(PyDict_SetItem(__pyx_v_cookies, __pyx_t_12, __pyx_t_7) < 0)) __PYX_ERR(0, 450, __pyx_L10_except_error)
+            if (unlikely(PyDict_SetItem(__pyx_v_cookies, __pyx_t_12, __pyx_t_7) < 0)) __PYX_ERR(0, 447, __pyx_L10_except_error)
             __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
             __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
           }
           __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
           __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
           __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
           goto __pyx_L15_try_end;
           __pyx_L8_error:;
           __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
           __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
           __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-          /* "blacksheep/messages.pyx":445
+          /* "blacksheep/messages.pyx":442
  *                     try:
  *                         name, value = split_value(fragment, b"=")
  *                     except ValueError as unpack_error:             # <<<<<<<<<<<<<<
  *                         # discard cookie: in this case it's better to eat the exception
  *                         # than blocking a request just because a cookie is malformed
  */
           __pyx_t_16 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_ValueError);
           if (__pyx_t_16) {
             __Pyx_AddTraceback("blacksheep.messages.Request.cookies.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
-            if (__Pyx_GetException(&__pyx_t_7, &__pyx_t_12, &__pyx_t_11) < 0) __PYX_ERR(0, 445, __pyx_L10_except_error)
+            if (__Pyx_GetException(&__pyx_t_7, &__pyx_t_12, &__pyx_t_11) < 0) __PYX_ERR(0, 442, __pyx_L10_except_error)
             __Pyx_GOTREF(__pyx_t_7);
             __Pyx_GOTREF(__pyx_t_12);
             __Pyx_GOTREF(__pyx_t_11);
             __Pyx_INCREF(__pyx_t_12);
             __pyx_v_unpack_error = __pyx_t_12;
             /*try:*/ {
             }
@@ -13218,15 +13221,15 @@
             __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
             __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
             goto __pyx_L9_exception_handled;
           }
           goto __pyx_L10_except_error;
           __pyx_L10_except_error:;
 
-          /* "blacksheep/messages.pyx":443
+          /* "blacksheep/messages.pyx":440
  * 
  *                 for fragment in pairs:
  *                     try:             # <<<<<<<<<<<<<<
  *                         name, value = split_value(fragment, b"=")
  *                     except ValueError as unpack_error:
  */
           __Pyx_XGIVEREF(__pyx_t_8);
@@ -13238,56 +13241,56 @@
           __Pyx_XGIVEREF(__pyx_t_8);
           __Pyx_XGIVEREF(__pyx_t_9);
           __Pyx_XGIVEREF(__pyx_t_10);
           __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
           __pyx_L15_try_end:;
         }
 
-        /* "blacksheep/messages.pyx":442
+        /* "blacksheep/messages.pyx":439
  *                 pairs = header.split(b'; ')
  * 
  *                 for fragment in pairs:             # <<<<<<<<<<<<<<
  *                     try:
  *                         name, value = split_value(fragment, b"=")
  */
       }
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-      /* "blacksheep/messages.pyx":437
+      /* "blacksheep/messages.pyx":434
  *         cookies_headers = self.get_headers(b'cookie')
  *         if cookies_headers:
  *             for header in cookies_headers:             # <<<<<<<<<<<<<<
  *                 # a single cookie header is expected from the client, but anyway here
  *                 # multiple headers are handled:
  */
     }
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "blacksheep/messages.pyx":436
+    /* "blacksheep/messages.pyx":433
  * 
  *         cookies_headers = self.get_headers(b'cookie')
  *         if cookies_headers:             # <<<<<<<<<<<<<<
  *             for header in cookies_headers:
  *                 # a single cookie header is expected from the client, but anyway here
  */
   }
 
-  /* "blacksheep/messages.pyx":451
+  /* "blacksheep/messages.pyx":448
  *                     else:
  *                         cookies[unquote(name.decode())] = unquote(value.rstrip(b'; ').decode())
  *         return cookies             # <<<<<<<<<<<<<<
  * 
  *     def get_cookie(self, str name):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_cookies);
   __pyx_r = __pyx_v_cookies;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":430
+  /* "blacksheep/messages.pyx":427
  * 
  *     @property
  *     def cookies(self):             # <<<<<<<<<<<<<<
  *         cdef bytes header
  *         cdef list cookies_headers
  */
 
@@ -13313,15 +13316,15 @@
   __Pyx_XDECREF(__pyx_v_value);
   __Pyx_XDECREF(__pyx_v_unpack_error);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":453
+/* "blacksheep/messages.pyx":450
  *         return cookies
  * 
  *     def get_cookie(self, str name):             # <<<<<<<<<<<<<<
  *         return self.cookies.get(name)
  * 
  */
 
@@ -13330,15 +13333,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_7Request_7get_cookie(PyObject *__pyx_v_self, PyObject *__pyx_v_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("get_cookie (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_name), (&PyUnicode_Type), 1, "name", 1))) __PYX_ERR(0, 453, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_name), (&PyUnicode_Type), 1, "name", 1))) __PYX_ERR(0, 450, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Request_6get_cookie(((struct __pyx_obj_10blacksheep_8messages_Request *)__pyx_v_self), ((PyObject*)__pyx_v_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -13353,47 +13356,47 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_cookie", 0);
 
-  /* "blacksheep/messages.pyx":454
+  /* "blacksheep/messages.pyx":451
  * 
  *     def get_cookie(self, str name):
  *         return self.cookies.get(name)             # <<<<<<<<<<<<<<
  * 
  *     def set_cookie(self, str name, str value):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_cookies); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 454, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_cookies); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 451, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_get); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 454, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_get); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 451, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_name) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_name);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 454, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 451, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":453
+  /* "blacksheep/messages.pyx":450
  *         return cookies
  * 
  *     def get_cookie(self, str name):             # <<<<<<<<<<<<<<
  *         return self.cookies.get(name)
  * 
  */
 
@@ -13406,15 +13409,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":456
+/* "blacksheep/messages.pyx":453
  *         return self.cookies.get(name)
  * 
  *     def set_cookie(self, str name, str value):             # <<<<<<<<<<<<<<
  *         """
  *         Sets a cookie in the request. This method also ensures that a single
  */
 
@@ -13449,39 +13452,39 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_value)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("set_cookie", 1, 2, 2, 1); __PYX_ERR(0, 456, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("set_cookie", 1, 2, 2, 1); __PYX_ERR(0, 453, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_cookie") < 0)) __PYX_ERR(0, 456, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_cookie") < 0)) __PYX_ERR(0, 453, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_name = ((PyObject*)values[0]);
     __pyx_v_value = ((PyObject*)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("set_cookie", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 456, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("set_cookie", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 453, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("blacksheep.messages.Request.set_cookie", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_name), (&PyUnicode_Type), 1, "name", 1))) __PYX_ERR(0, 456, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyUnicode_Type), 1, "value", 1))) __PYX_ERR(0, 456, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_name), (&PyUnicode_Type), 1, "name", 1))) __PYX_ERR(0, 453, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), (&PyUnicode_Type), 1, "value", 1))) __PYX_ERR(0, 453, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_7Request_8set_cookie(((struct __pyx_obj_10blacksheep_8messages_Request *)__pyx_v_self), __pyx_v_name, __pyx_v_value);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -13502,157 +13505,157 @@
   int __pyx_t_6;
   int __pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_cookie", 0);
 
-  /* "blacksheep/messages.pyx":464
+  /* "blacksheep/messages.pyx":461
  *         cdef bytes existing_cookie
  * 
  *         new_value = (quote(name) + "=" + quote(value)).encode()             # <<<<<<<<<<<<<<
  *         existing_cookie = self.get_first_header(b"cookie")
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_quote); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 464, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_quote); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 461, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_name) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_name);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 464, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_kp_u__15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 464, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_kp_u__15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 461, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_quote); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 464, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_quote); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 461, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_value) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_value);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 464, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 464, __pyx_L1_error)
+  __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 461, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_encode); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 464, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_encode); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 464, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 461, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 464, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 461, __pyx_L1_error)
   __pyx_v_new_value = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":465
+  /* "blacksheep/messages.pyx":462
  * 
  *         new_value = (quote(name) + "=" + quote(value)).encode()
  *         existing_cookie = self.get_first_header(b"cookie")             # <<<<<<<<<<<<<<
  * 
  *         if existing_cookie:
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_n_b_cookie, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 465, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_n_b_cookie, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 462, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_existing_cookie = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":467
+  /* "blacksheep/messages.pyx":464
  *         existing_cookie = self.get_first_header(b"cookie")
  * 
  *         if existing_cookie:             # <<<<<<<<<<<<<<
  *             self.set_header(b"cookie", existing_cookie + b";" + new_value)
  *         else:
  */
   __pyx_t_6 = (__pyx_v_existing_cookie != Py_None)&&(PyBytes_GET_SIZE(__pyx_v_existing_cookie) != 0);
   if (__pyx_t_6) {
 
-    /* "blacksheep/messages.pyx":468
+    /* "blacksheep/messages.pyx":465
  * 
  *         if existing_cookie:
  *             self.set_header(b"cookie", existing_cookie + b";" + new_value)             # <<<<<<<<<<<<<<
  *         else:
  *             self.__headers.append((b"cookie", new_value))
  */
-    __pyx_t_1 = PyNumber_Add(__pyx_v_existing_cookie, __pyx_kp_b__16); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 468, __pyx_L1_error)
+    __pyx_t_1 = PyNumber_Add(__pyx_v_existing_cookie, __pyx_kp_b__16); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 465, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = PyNumber_Add(__pyx_t_1, __pyx_v_new_value); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+    __pyx_t_2 = PyNumber_Add(__pyx_t_1, __pyx_v_new_value); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 465, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.set_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_n_b_cookie, ((PyObject*)__pyx_t_2), 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "blacksheep/messages.pyx":467
+    /* "blacksheep/messages.pyx":464
  *         existing_cookie = self.get_first_header(b"cookie")
  * 
  *         if existing_cookie:             # <<<<<<<<<<<<<<
  *             self.set_header(b"cookie", existing_cookie + b";" + new_value)
  *         else:
  */
     goto __pyx_L3;
   }
 
-  /* "blacksheep/messages.pyx":470
+  /* "blacksheep/messages.pyx":467
  *             self.set_header(b"cookie", existing_cookie + b";" + new_value)
  *         else:
  *             self.__headers.append((b"cookie", new_value))             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   /*else*/ {
     if (unlikely(__pyx_v_self->__pyx_base.__pyx___headers == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "append");
-      __PYX_ERR(0, 470, __pyx_L1_error)
+      __PYX_ERR(0, 467, __pyx_L1_error)
     }
-    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 470, __pyx_L1_error)
+    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 467, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_INCREF(__pyx_n_b_cookie);
     __Pyx_GIVEREF(__pyx_n_b_cookie);
     PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_n_b_cookie);
     __Pyx_INCREF(__pyx_v_new_value);
     __Pyx_GIVEREF(__pyx_v_new_value);
     PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_new_value);
-    __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_self->__pyx_base.__pyx___headers, __pyx_t_2); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 470, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_self->__pyx_base.__pyx___headers, __pyx_t_2); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 467, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   }
   __pyx_L3:;
 
-  /* "blacksheep/messages.pyx":456
+  /* "blacksheep/messages.pyx":453
  *         return self.cookies.get(name)
  * 
  *     def set_cookie(self, str name, str value):             # <<<<<<<<<<<<<<
  *         """
  *         Sets a cookie in the request. This method also ensures that a single
  */
 
@@ -13671,15 +13674,15 @@
   __Pyx_XDECREF(__pyx_v_new_value);
   __Pyx_XDECREF(__pyx_v_existing_cookie);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":473
+/* "blacksheep/messages.pyx":470
  * 
  *     @property
  *     def etag(self):             # <<<<<<<<<<<<<<
  *         return self.get_first_header(b"etag")
  * 
  */
 
@@ -13701,29 +13704,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":474
+  /* "blacksheep/messages.pyx":471
  *     @property
  *     def etag(self):
  *         return self.get_first_header(b"etag")             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_n_b_etag, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 474, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_n_b_etag, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 471, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":473
+  /* "blacksheep/messages.pyx":470
  * 
  *     @property
  *     def etag(self):             # <<<<<<<<<<<<<<
  *         return self.get_first_header(b"etag")
  * 
  */
 
@@ -13734,15 +13737,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":477
+/* "blacksheep/messages.pyx":474
  * 
  *     @property
  *     def if_none_match(self):             # <<<<<<<<<<<<<<
  *         return self.get_first_header(b"if-none-match")
  * 
  */
 
@@ -13764,29 +13767,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":478
+  /* "blacksheep/messages.pyx":475
  *     @property
  *     def if_none_match(self):
  *         return self.get_first_header(b"if-none-match")             # <<<<<<<<<<<<<<
  * 
  *     cpdef bint expect_100_continue(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_kp_b_if_none_match, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 478, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_kp_b_if_none_match, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 475, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":477
+  /* "blacksheep/messages.pyx":474
  * 
  *     @property
  *     def if_none_match(self):             # <<<<<<<<<<<<<<
  *         return self.get_first_header(b"if-none-match")
  * 
  */
 
@@ -13797,15 +13800,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":480
+/* "blacksheep/messages.pyx":477
  *         return self.get_first_header(b"if-none-match")
  * 
  *     cpdef bint expect_100_continue(self):             # <<<<<<<<<<<<<<
  *         cdef bytes value
  *         value = self.get_first_header(b'expect')
  */
 
@@ -13829,15 +13832,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_expect_100_continue); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 480, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_expect_100_continue); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 477, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_7Request_11expect_100_continue)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -13845,18 +13848,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 480, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 477, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 480, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 477, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -13867,77 +13870,77 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":482
+  /* "blacksheep/messages.pyx":479
  *     cpdef bint expect_100_continue(self):
  *         cdef bytes value
  *         value = self.get_first_header(b'expect')             # <<<<<<<<<<<<<<
  *         if value and value.lower() == b'100-continue':
  *             return True
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_n_b_expect, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 482, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_n_b_expect, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 479, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_value = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":483
+  /* "blacksheep/messages.pyx":480
  *         cdef bytes value
  *         value = self.get_first_header(b'expect')
  *         if value and value.lower() == b'100-continue':             # <<<<<<<<<<<<<<
  *             return True
  *         return False
  */
   __pyx_t_6 = (__pyx_v_value != Py_None)&&(PyBytes_GET_SIZE(__pyx_v_value) != 0);
   if (__pyx_t_6) {
   } else {
     __pyx_t_5 = __pyx_t_6;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_value); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 483, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyBytes_Type_lower, __pyx_v_value); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 480, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = (__Pyx_PyBytes_Equals(__pyx_t_1, __pyx_kp_b_100_continue, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 483, __pyx_L1_error)
+  __pyx_t_6 = (__Pyx_PyBytes_Equals(__pyx_t_1, __pyx_kp_b_100_continue, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 480, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_5) {
 
-    /* "blacksheep/messages.pyx":484
+    /* "blacksheep/messages.pyx":481
  *         value = self.get_first_header(b'expect')
  *         if value and value.lower() == b'100-continue':
  *             return True             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
     __pyx_r = 1;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":483
+    /* "blacksheep/messages.pyx":480
  *         cdef bytes value
  *         value = self.get_first_header(b'expect')
  *         if value and value.lower() == b'100-continue':             # <<<<<<<<<<<<<<
  *             return True
  *         return False
  */
   }
 
-  /* "blacksheep/messages.pyx":485
+  /* "blacksheep/messages.pyx":482
  *         if value and value.lower() == b'100-continue':
  *             return True
  *         return False             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":480
+  /* "blacksheep/messages.pyx":477
  *         return self.get_first_header(b"if-none-match")
  * 
  *     cpdef bint expect_100_continue(self):             # <<<<<<<<<<<<<<
  *         cdef bytes value
  *         value = self.get_first_header(b'expect')
  */
 
@@ -13973,15 +13976,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("expect_100_continue", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_7Request_expect_100_continue(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 480, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_7Request_expect_100_continue(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 477, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -14048,15 +14051,15 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
-  if (!(likely(PyUnicode_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(1, 46, __pyx_L1_error)
+  if (!(likely(PyUnicode_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(1, 46, __pyx_L1_error)
   __pyx_t_1 = __pyx_v_value;
   __Pyx_INCREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v_self->method);
   __Pyx_DECREF(__pyx_v_self->method);
   __pyx_v_self->method = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
@@ -14264,15 +14267,15 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
-  if (!(likely(PyBytes_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(1, 48, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(1, 48, __pyx_L1_error)
   __pyx_t_1 = __pyx_v_value;
   __Pyx_INCREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v_self->_path);
   __Pyx_DECREF(__pyx_v_self->_path);
   __pyx_v_self->_path = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
@@ -14372,15 +14375,15 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
-  if (!(likely(PyBytes_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(1, 49, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(1, 49, __pyx_L1_error)
   __pyx_t_1 = __pyx_v_value;
   __Pyx_INCREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v_self->_raw_query);
   __Pyx_DECREF(__pyx_v_self->_raw_query);
   __pyx_v_self->_raw_query = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
@@ -14954,15 +14957,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_Request, (type(self), 0x0c41d18, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_Request__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_8messages___pyx_unpickle_Request__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_Request, (type(self), 0x0c41d18, state)
@@ -14979,15 +14982,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":490
+/* "blacksheep/messages.pyx":487
  * cdef class Response(Message):
  * 
  *     def __init__(             # <<<<<<<<<<<<<<
  *         self,
  *         int status,
  */
 
@@ -15003,24 +15006,24 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_status,&__pyx_n_s_headers,&__pyx_n_s_content,0};
     PyObject* values[3] = {0,0,0};
 
-    /* "blacksheep/messages.pyx":493
+    /* "blacksheep/messages.pyx":490
  *         self,
  *         int status,
  *         list headers = None,             # <<<<<<<<<<<<<<
  *         Content content = None
  *     ):
  */
     values[1] = ((PyObject*)Py_None);
 
-    /* "blacksheep/messages.pyx":494
+    /* "blacksheep/messages.pyx":491
  *         int status,
  *         list headers = None,
  *         Content content = None             # <<<<<<<<<<<<<<
  *     ):
  *         self.__headers = headers or []
  */
     values[2] = (PyObject *)((struct __pyx_obj_10blacksheep_8contents_Content *)Py_None);
@@ -15052,44 +15055,44 @@
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_content);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 490, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 487, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
-    __pyx_v_status = __Pyx_PyInt_As_int(values[0]); if (unlikely((__pyx_v_status == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 492, __pyx_L3_error)
+    __pyx_v_status = __Pyx_PyInt_As_int(values[0]); if (unlikely((__pyx_v_status == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 489, __pyx_L3_error)
     __pyx_v_headers = ((PyObject*)values[1]);
     __pyx_v_content = ((struct __pyx_obj_10blacksheep_8contents_Content *)values[2]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 490, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 487, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("blacksheep.messages.Response.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_headers), (&PyList_Type), 1, "headers", 1))) __PYX_ERR(0, 493, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_content), __pyx_ptype_10blacksheep_8contents_Content, 1, "content", 0))) __PYX_ERR(0, 494, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_headers), (&PyList_Type), 1, "headers", 1))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_content), __pyx_ptype_10blacksheep_8contents_Content, 1, "content", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_8Response___init__(((struct __pyx_obj_10blacksheep_8messages_Response *)__pyx_v_self), __pyx_v_status, __pyx_v_headers, __pyx_v_content);
 
-  /* "blacksheep/messages.pyx":490
+  /* "blacksheep/messages.pyx":487
  * cdef class Response(Message):
  * 
  *     def __init__(             # <<<<<<<<<<<<<<
  *         self,
  *         int status,
  */
 
@@ -15109,63 +15112,63 @@
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "blacksheep/messages.pyx":496
+  /* "blacksheep/messages.pyx":493
  *         Content content = None
  *     ):
  *         self.__headers = headers or []             # <<<<<<<<<<<<<<
  *         self.status = status
  *         self.content = content
  */
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_headers); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 496, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_headers); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 493, __pyx_L1_error)
   if (!__pyx_t_2) {
   } else {
     __Pyx_INCREF(__pyx_v_headers);
     __pyx_t_1 = __pyx_v_headers;
     goto __pyx_L3_bool_binop_done;
   }
-  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 496, __pyx_L1_error)
+  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 493, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(__pyx_t_3);
   __pyx_t_1 = __pyx_t_3;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_L3_bool_binop_done:;
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v_self->__pyx_base.__pyx___headers);
   __Pyx_DECREF(__pyx_v_self->__pyx_base.__pyx___headers);
   __pyx_v_self->__pyx_base.__pyx___headers = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":497
+  /* "blacksheep/messages.pyx":494
  *     ):
  *         self.__headers = headers or []
  *         self.status = status             # <<<<<<<<<<<<<<
  *         self.content = content
  * 
  */
   __pyx_v_self->status = __pyx_v_status;
 
-  /* "blacksheep/messages.pyx":498
+  /* "blacksheep/messages.pyx":495
  *         self.__headers = headers or []
  *         self.status = status
  *         self.content = content             # <<<<<<<<<<<<<<
  * 
  *     def __repr__(self):
  */
   __Pyx_INCREF(((PyObject *)__pyx_v_content));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_content));
   __Pyx_GOTREF(__pyx_v_self->__pyx_base.content);
   __Pyx_DECREF(((PyObject *)__pyx_v_self->__pyx_base.content));
   __pyx_v_self->__pyx_base.content = __pyx_v_content;
 
-  /* "blacksheep/messages.pyx":490
+  /* "blacksheep/messages.pyx":487
  * cdef class Response(Message):
  * 
  *     def __init__(             # <<<<<<<<<<<<<<
  *         self,
  *         int status,
  */
 
@@ -15178,15 +15181,15 @@
   __Pyx_AddTraceback("blacksheep.messages.Response.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":500
+/* "blacksheep/messages.pyx":497
  *         self.content = content
  * 
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         return f'<Response {self.status}>'
  * 
  */
 
@@ -15211,48 +15214,48 @@
   Py_UCS4 __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "blacksheep/messages.pyx":501
+  /* "blacksheep/messages.pyx":498
  * 
  *     def __repr__(self):
  *         return f'<Response {self.status}>'             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 501, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 498, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u_Response);
   __pyx_t_2 += 10;
   __Pyx_GIVEREF(__pyx_kp_u_Response);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Response);
-  __pyx_t_4 = __Pyx_PyUnicode_From_int(__pyx_v_self->status, 0, ' ', 'd'); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 501, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyUnicode_From_int(__pyx_v_self->status, 0, ' ', 'd'); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 498, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
   __pyx_t_4 = 0;
   __Pyx_INCREF(__pyx_kp_u__13);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__13);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u__13);
-  __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 501, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 498, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_4;
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":500
+  /* "blacksheep/messages.pyx":497
  *         self.content = content
  * 
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         return f'<Response {self.status}>'
  * 
  */
 
@@ -15264,15 +15267,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":504
+/* "blacksheep/messages.pyx":501
  * 
  *     @property
  *     def cookies(self):             # <<<<<<<<<<<<<<
  *         return self.get_cookies()
  * 
  */
 
@@ -15296,44 +15299,44 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":505
+  /* "blacksheep/messages.pyx":502
  *     @property
  *     def cookies(self):
  *         return self.get_cookies()             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_cookies); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 505, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_cookies); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 502, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 505, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 502, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":504
+  /* "blacksheep/messages.pyx":501
  * 
  *     @property
  *     def cookies(self):             # <<<<<<<<<<<<<<
  *         return self.get_cookies()
  * 
  */
 
@@ -15346,15 +15349,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":508
+/* "blacksheep/messages.pyx":505
  * 
  *     @property
  *     def reason(self) -> str:             # <<<<<<<<<<<<<<
  *         return http.HTTPStatus(self.status).phrase
  * 
  */
 
@@ -15379,53 +15382,53 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "blacksheep/messages.pyx":509
+  /* "blacksheep/messages.pyx":506
  *     @property
  *     def reason(self) -> str:
  *         return http.HTTPStatus(self.status).phrase             # <<<<<<<<<<<<<<
  * 
  *     def get_cookies(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_http); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 509, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_http); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_HTTPStatus); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 509, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_HTTPStatus); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->status); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 509, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->status); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 509, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_phrase); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 509, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_phrase); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":508
+  /* "blacksheep/messages.pyx":505
  * 
  *     @property
  *     def reason(self) -> str:             # <<<<<<<<<<<<<<
  *         return http.HTTPStatus(self.status).phrase
  * 
  */
 
@@ -15439,15 +15442,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":511
+/* "blacksheep/messages.pyx":508
  *         return http.HTTPStatus(self.status).phrase
  * 
  *     def get_cookies(self):             # <<<<<<<<<<<<<<
  *         cdef bytes value
  *         cdef Cookie cookie
  */
 
@@ -15476,128 +15479,128 @@
   Py_ssize_t __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_cookies", 0);
 
-  /* "blacksheep/messages.pyx":517
+  /* "blacksheep/messages.pyx":514
  *         cdef list set_cookies_headers
  * 
  *         cookies = {}             # <<<<<<<<<<<<<<
  *         set_cookies_headers = self.get_headers(b'set-cookie')
  *         if set_cookies_headers:
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 517, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_cookies = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":518
+  /* "blacksheep/messages.pyx":515
  * 
  *         cookies = {}
  *         set_cookies_headers = self.get_headers(b'set-cookie')             # <<<<<<<<<<<<<<
  *         if set_cookies_headers:
  *             for value in set_cookies_headers:
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Response *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_headers(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_kp_b_set_cookie, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 518, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Response *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_headers(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_kp_b_set_cookie, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 515, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_set_cookies_headers = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":519
+  /* "blacksheep/messages.pyx":516
  *         cookies = {}
  *         set_cookies_headers = self.get_headers(b'set-cookie')
  *         if set_cookies_headers:             # <<<<<<<<<<<<<<
  *             for value in set_cookies_headers:
  *                 cookie = parse_cookie(value)
  */
   __pyx_t_2 = (__pyx_v_set_cookies_headers != Py_None)&&(PyList_GET_SIZE(__pyx_v_set_cookies_headers) != 0);
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":520
+    /* "blacksheep/messages.pyx":517
  *         set_cookies_headers = self.get_headers(b'set-cookie')
  *         if set_cookies_headers:
  *             for value in set_cookies_headers:             # <<<<<<<<<<<<<<
  *                 cookie = parse_cookie(value)
  *                 cookies[cookie.name] = cookie
  */
     if (unlikely(__pyx_v_set_cookies_headers == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 517, __pyx_L1_error)
     }
     __pyx_t_1 = __pyx_v_set_cookies_headers; __Pyx_INCREF(__pyx_t_1); __pyx_t_3 = 0;
     for (;;) {
       if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_1)) break;
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_4); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 520, __pyx_L1_error)
+      __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_4); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 517, __pyx_L1_error)
       #else
-      __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 520, __pyx_L1_error)
+      __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 517, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       #endif
-      if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 520, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 517, __pyx_L1_error)
       __Pyx_XDECREF_SET(__pyx_v_value, ((PyObject*)__pyx_t_4));
       __pyx_t_4 = 0;
 
-      /* "blacksheep/messages.pyx":521
+      /* "blacksheep/messages.pyx":518
  *         if set_cookies_headers:
  *             for value in set_cookies_headers:
  *                 cookie = parse_cookie(value)             # <<<<<<<<<<<<<<
  *                 cookies[cookie.name] = cookie
  *         return cookies
  */
-      __pyx_t_4 = ((PyObject *)__pyx_f_10blacksheep_7cookies_parse_cookie(__pyx_v_value, 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 521, __pyx_L1_error)
+      __pyx_t_4 = ((PyObject *)__pyx_f_10blacksheep_7cookies_parse_cookie(__pyx_v_value, 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 518, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_XDECREF_SET(__pyx_v_cookie, ((struct __pyx_obj_10blacksheep_7cookies_Cookie *)__pyx_t_4));
       __pyx_t_4 = 0;
 
-      /* "blacksheep/messages.pyx":522
+      /* "blacksheep/messages.pyx":519
  *             for value in set_cookies_headers:
  *                 cookie = parse_cookie(value)
  *                 cookies[cookie.name] = cookie             # <<<<<<<<<<<<<<
  *         return cookies
  * 
  */
-      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cookie), __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 522, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cookie), __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 519, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      if (unlikely(PyDict_SetItem(__pyx_v_cookies, __pyx_t_4, ((PyObject *)__pyx_v_cookie)) < 0)) __PYX_ERR(0, 522, __pyx_L1_error)
+      if (unlikely(PyDict_SetItem(__pyx_v_cookies, __pyx_t_4, ((PyObject *)__pyx_v_cookie)) < 0)) __PYX_ERR(0, 519, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-      /* "blacksheep/messages.pyx":520
+      /* "blacksheep/messages.pyx":517
  *         set_cookies_headers = self.get_headers(b'set-cookie')
  *         if set_cookies_headers:
  *             for value in set_cookies_headers:             # <<<<<<<<<<<<<<
  *                 cookie = parse_cookie(value)
  *                 cookies[cookie.name] = cookie
  */
     }
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "blacksheep/messages.pyx":519
+    /* "blacksheep/messages.pyx":516
  *         cookies = {}
  *         set_cookies_headers = self.get_headers(b'set-cookie')
  *         if set_cookies_headers:             # <<<<<<<<<<<<<<
  *             for value in set_cookies_headers:
  *                 cookie = parse_cookie(value)
  */
   }
 
-  /* "blacksheep/messages.pyx":523
+  /* "blacksheep/messages.pyx":520
  *                 cookie = parse_cookie(value)
  *                 cookies[cookie.name] = cookie
  *         return cookies             # <<<<<<<<<<<<<<
  * 
  *     def get_cookie(self, str name):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_cookies);
   __pyx_r = __pyx_v_cookies;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":511
+  /* "blacksheep/messages.pyx":508
  *         return http.HTTPStatus(self.status).phrase
  * 
  *     def get_cookies(self):             # <<<<<<<<<<<<<<
  *         cdef bytes value
  *         cdef Cookie cookie
  */
 
@@ -15613,15 +15616,15 @@
   __Pyx_XDECREF(__pyx_v_cookies);
   __Pyx_XDECREF(__pyx_v_set_cookies_headers);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":525
+/* "blacksheep/messages.pyx":522
  *         return cookies
  * 
  *     def get_cookie(self, str name):             # <<<<<<<<<<<<<<
  *         cdef bytes value
  *         cdef list set_cookies_headers = self.get_headers(b'set-cookie')
  */
 
@@ -15630,15 +15633,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_8Response_7get_cookie(PyObject *__pyx_v_self, PyObject *__pyx_v_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("get_cookie (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_name), (&PyUnicode_Type), 1, "name", 1))) __PYX_ERR(0, 525, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_name), (&PyUnicode_Type), 1, "name", 1))) __PYX_ERR(0, 522, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_8Response_6get_cookie(((struct __pyx_obj_10blacksheep_8messages_Response *)__pyx_v_self), ((PyObject*)__pyx_v_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -15657,138 +15660,138 @@
   Py_ssize_t __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_cookie", 0);
 
-  /* "blacksheep/messages.pyx":527
+  /* "blacksheep/messages.pyx":524
  *     def get_cookie(self, str name):
  *         cdef bytes value
  *         cdef list set_cookies_headers = self.get_headers(b'set-cookie')             # <<<<<<<<<<<<<<
  * 
  *         if set_cookies_headers:
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Response *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_headers(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_kp_b_set_cookie, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 527, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Response *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_headers(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_kp_b_set_cookie, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 524, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_set_cookies_headers = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":529
+  /* "blacksheep/messages.pyx":526
  *         cdef list set_cookies_headers = self.get_headers(b'set-cookie')
  * 
  *         if set_cookies_headers:             # <<<<<<<<<<<<<<
  *             for value in set_cookies_headers:
  *                 cookie = parse_cookie(value)
  */
   __pyx_t_2 = (__pyx_v_set_cookies_headers != Py_None)&&(PyList_GET_SIZE(__pyx_v_set_cookies_headers) != 0);
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":530
+    /* "blacksheep/messages.pyx":527
  * 
  *         if set_cookies_headers:
  *             for value in set_cookies_headers:             # <<<<<<<<<<<<<<
  *                 cookie = parse_cookie(value)
  *                 if cookie.name == name:
  */
     if (unlikely(__pyx_v_set_cookies_headers == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-      __PYX_ERR(0, 530, __pyx_L1_error)
+      __PYX_ERR(0, 527, __pyx_L1_error)
     }
     __pyx_t_1 = __pyx_v_set_cookies_headers; __Pyx_INCREF(__pyx_t_1); __pyx_t_3 = 0;
     for (;;) {
       if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_1)) break;
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_4); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 530, __pyx_L1_error)
+      __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_4); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 527, __pyx_L1_error)
       #else
-      __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 530, __pyx_L1_error)
+      __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 527, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       #endif
-      if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 530, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 527, __pyx_L1_error)
       __Pyx_XDECREF_SET(__pyx_v_value, ((PyObject*)__pyx_t_4));
       __pyx_t_4 = 0;
 
-      /* "blacksheep/messages.pyx":531
+      /* "blacksheep/messages.pyx":528
  *         if set_cookies_headers:
  *             for value in set_cookies_headers:
  *                 cookie = parse_cookie(value)             # <<<<<<<<<<<<<<
  *                 if cookie.name == name:
  *                     return cookie
  */
-      __pyx_t_4 = ((PyObject *)__pyx_f_10blacksheep_7cookies_parse_cookie(__pyx_v_value, 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 531, __pyx_L1_error)
+      __pyx_t_4 = ((PyObject *)__pyx_f_10blacksheep_7cookies_parse_cookie(__pyx_v_value, 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 528, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_XDECREF_SET(__pyx_v_cookie, ((struct __pyx_obj_10blacksheep_7cookies_Cookie *)__pyx_t_4));
       __pyx_t_4 = 0;
 
-      /* "blacksheep/messages.pyx":532
+      /* "blacksheep/messages.pyx":529
  *             for value in set_cookies_headers:
  *                 cookie = parse_cookie(value)
  *                 if cookie.name == name:             # <<<<<<<<<<<<<<
  *                     return cookie
  * 
  */
-      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cookie), __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 532, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cookie), __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 529, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_t_4, __pyx_v_name, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 532, __pyx_L1_error)
+      __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_t_4, __pyx_v_name, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 529, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       if (__pyx_t_2) {
 
-        /* "blacksheep/messages.pyx":533
+        /* "blacksheep/messages.pyx":530
  *                 cookie = parse_cookie(value)
  *                 if cookie.name == name:
  *                     return cookie             # <<<<<<<<<<<<<<
  * 
  *         return None
  */
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(((PyObject *)__pyx_v_cookie));
         __pyx_r = ((PyObject *)__pyx_v_cookie);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
 
-        /* "blacksheep/messages.pyx":532
+        /* "blacksheep/messages.pyx":529
  *             for value in set_cookies_headers:
  *                 cookie = parse_cookie(value)
  *                 if cookie.name == name:             # <<<<<<<<<<<<<<
  *                     return cookie
  * 
  */
       }
 
-      /* "blacksheep/messages.pyx":530
+      /* "blacksheep/messages.pyx":527
  * 
  *         if set_cookies_headers:
  *             for value in set_cookies_headers:             # <<<<<<<<<<<<<<
  *                 cookie = parse_cookie(value)
  *                 if cookie.name == name:
  */
     }
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "blacksheep/messages.pyx":529
+    /* "blacksheep/messages.pyx":526
  *         cdef list set_cookies_headers = self.get_headers(b'set-cookie')
  * 
  *         if set_cookies_headers:             # <<<<<<<<<<<<<<
  *             for value in set_cookies_headers:
  *                 cookie = parse_cookie(value)
  */
   }
 
-  /* "blacksheep/messages.pyx":535
+  /* "blacksheep/messages.pyx":532
  *                     return cookie
  * 
  *         return None             # <<<<<<<<<<<<<<
  * 
  *     def set_cookie(self, Cookie cookie):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":525
+  /* "blacksheep/messages.pyx":522
  *         return cookies
  * 
  *     def get_cookie(self, str name):             # <<<<<<<<<<<<<<
  *         cdef bytes value
  *         cdef list set_cookies_headers = self.get_headers(b'set-cookie')
  */
 
@@ -15803,15 +15806,15 @@
   __Pyx_XDECREF(__pyx_v_set_cookies_headers);
   __Pyx_XDECREF((PyObject *)__pyx_v_cookie);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":537
+/* "blacksheep/messages.pyx":534
  *         return None
  * 
  *     def set_cookie(self, Cookie cookie):             # <<<<<<<<<<<<<<
  *         self.__headers.append((b'set-cookie', write_cookie_for_response(cookie)))
  * 
  */
 
@@ -15820,15 +15823,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_8Response_9set_cookie(PyObject *__pyx_v_self, PyObject *__pyx_v_cookie) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_cookie (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cookie), __pyx_ptype_10blacksheep_7cookies_Cookie, 1, "cookie", 0))) __PYX_ERR(0, 537, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cookie), __pyx_ptype_10blacksheep_7cookies_Cookie, 1, "cookie", 0))) __PYX_ERR(0, 534, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_8Response_8set_cookie(((struct __pyx_obj_10blacksheep_8messages_Response *)__pyx_v_self), ((struct __pyx_obj_10blacksheep_7cookies_Cookie *)__pyx_v_cookie));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -15843,39 +15846,39 @@
   PyObject *__pyx_t_2 = NULL;
   int __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_cookie", 0);
 
-  /* "blacksheep/messages.pyx":538
+  /* "blacksheep/messages.pyx":535
  * 
  *     def set_cookie(self, Cookie cookie):
  *         self.__headers.append((b'set-cookie', write_cookie_for_response(cookie)))             # <<<<<<<<<<<<<<
  * 
  *     def set_cookies(self, list cookies):
  */
   if (unlikely(__pyx_v_self->__pyx_base.__pyx___headers == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "append");
-    __PYX_ERR(0, 538, __pyx_L1_error)
+    __PYX_ERR(0, 535, __pyx_L1_error)
   }
-  __pyx_t_1 = __pyx_f_10blacksheep_7cookies_write_cookie_for_response(__pyx_v_cookie); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_10blacksheep_7cookies_write_cookie_for_response(__pyx_v_cookie); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 535, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 538, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 535, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(__pyx_kp_b_set_cookie);
   __Pyx_GIVEREF(__pyx_kp_b_set_cookie);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_b_set_cookie);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_3 = __Pyx_PyList_Append(__pyx_v_self->__pyx_base.__pyx___headers, __pyx_t_2); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 538, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyList_Append(__pyx_v_self->__pyx_base.__pyx___headers, __pyx_t_2); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 535, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "blacksheep/messages.pyx":537
+  /* "blacksheep/messages.pyx":534
  *         return None
  * 
  *     def set_cookie(self, Cookie cookie):             # <<<<<<<<<<<<<<
  *         self.__headers.append((b'set-cookie', write_cookie_for_response(cookie)))
  * 
  */
 
@@ -15889,15 +15892,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":540
+/* "blacksheep/messages.pyx":537
  *         self.__headers.append((b'set-cookie', write_cookie_for_response(cookie)))
  * 
  *     def set_cookies(self, list cookies):             # <<<<<<<<<<<<<<
  *         cdef Cookie cookie
  *         for cookie in cookies:
  */
 
@@ -15906,15 +15909,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_8Response_11set_cookies(PyObject *__pyx_v_self, PyObject *__pyx_v_cookies) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_cookies (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cookies), (&PyList_Type), 1, "cookies", 1))) __PYX_ERR(0, 540, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cookies), (&PyList_Type), 1, "cookies", 1))) __PYX_ERR(0, 537, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_8Response_10set_cookies(((struct __pyx_obj_10blacksheep_8messages_Response *)__pyx_v_self), ((PyObject*)__pyx_v_cookies));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -15932,75 +15935,75 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_cookies", 0);
 
-  /* "blacksheep/messages.pyx":542
+  /* "blacksheep/messages.pyx":539
  *     def set_cookies(self, list cookies):
  *         cdef Cookie cookie
  *         for cookie in cookies:             # <<<<<<<<<<<<<<
  *             self.set_cookie(cookie)
  * 
  */
   if (unlikely(__pyx_v_cookies == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 542, __pyx_L1_error)
+    __PYX_ERR(0, 539, __pyx_L1_error)
   }
   __pyx_t_1 = __pyx_v_cookies; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
   for (;;) {
     if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 542, __pyx_L1_error)
+    __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 539, __pyx_L1_error)
     #else
-    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 542, __pyx_L1_error)
+    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 539, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     #endif
-    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_10blacksheep_7cookies_Cookie))))) __PYX_ERR(0, 542, __pyx_L1_error)
+    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_10blacksheep_7cookies_Cookie))))) __PYX_ERR(0, 539, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_cookie, ((struct __pyx_obj_10blacksheep_7cookies_Cookie *)__pyx_t_3));
     __pyx_t_3 = 0;
 
-    /* "blacksheep/messages.pyx":543
+    /* "blacksheep/messages.pyx":540
  *         cdef Cookie cookie
  *         for cookie in cookies:
  *             self.set_cookie(cookie)             # <<<<<<<<<<<<<<
  * 
  *     def unset_cookie(self, str name):
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_cookie_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 543, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_cookie_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 540, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, ((PyObject *)__pyx_v_cookie)) : __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)__pyx_v_cookie));
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 543, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 540, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "blacksheep/messages.pyx":542
+    /* "blacksheep/messages.pyx":539
  *     def set_cookies(self, list cookies):
  *         cdef Cookie cookie
  *         for cookie in cookies:             # <<<<<<<<<<<<<<
  *             self.set_cookie(cookie)
  * 
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":540
+  /* "blacksheep/messages.pyx":537
  *         self.__headers.append((b'set-cookie', write_cookie_for_response(cookie)))
  * 
  *     def set_cookies(self, list cookies):             # <<<<<<<<<<<<<<
  *         cdef Cookie cookie
  *         for cookie in cookies:
  */
 
@@ -16017,15 +16020,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v_cookie);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":545
+/* "blacksheep/messages.pyx":542
  *             self.set_cookie(cookie)
  * 
  *     def unset_cookie(self, str name):             # <<<<<<<<<<<<<<
  *         self.set_cookie(
  *             Cookie(
  */
 
@@ -16034,15 +16037,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_8Response_13unset_cookie(PyObject *__pyx_v_self, PyObject *__pyx_v_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("unset_cookie (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_name), (&PyUnicode_Type), 1, "name", 1))) __PYX_ERR(0, 545, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_name), (&PyUnicode_Type), 1, "name", 1))) __PYX_ERR(0, 542, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_8Response_12unset_cookie(((struct __pyx_obj_10blacksheep_8messages_Response *)__pyx_v_self), ((PyObject*)__pyx_v_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -16060,84 +16063,84 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("unset_cookie", 0);
 
-  /* "blacksheep/messages.pyx":546
+  /* "blacksheep/messages.pyx":543
  * 
  *     def unset_cookie(self, str name):
  *         self.set_cookie(             # <<<<<<<<<<<<<<
  *             Cookie(
  *                 name,
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_cookie_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 546, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_cookie_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 543, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "blacksheep/messages.pyx":550
+  /* "blacksheep/messages.pyx":547
  *                 name,
  *                 '',
  *                 datetime.utcnow() - timedelta(days=365)             # <<<<<<<<<<<<<<
  *             )
  *         )
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_datetime); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 550, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_datetime); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_utcnow); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 550, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_utcnow); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 550, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_timedelta); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 550, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_timedelta); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 550, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_days, __pyx_int_365) < 0) __PYX_ERR(0, 550, __pyx_L1_error)
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_empty_tuple, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 550, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_days, __pyx_int_365) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_empty_tuple, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyNumber_Subtract(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 550, __pyx_L1_error)
+  __pyx_t_4 = PyNumber_Subtract(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-  /* "blacksheep/messages.pyx":547
+  /* "blacksheep/messages.pyx":544
  *     def unset_cookie(self, str name):
  *         self.set_cookie(
  *             Cookie(             # <<<<<<<<<<<<<<
  *                 name,
  *                 '',
  */
-  __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 547, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 544, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_INCREF(__pyx_v_name);
   __Pyx_GIVEREF(__pyx_v_name);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_name);
   __Pyx_INCREF(__pyx_kp_u__3);
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_kp_u__3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_7cookies_Cookie), __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 547, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_10blacksheep_7cookies_Cookie), __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 544, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -16145,20 +16148,20 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_6, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 546, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 543, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":545
+  /* "blacksheep/messages.pyx":542
  *             self.set_cookie(cookie)
  * 
  *     def unset_cookie(self, str name):             # <<<<<<<<<<<<<<
  *         self.set_cookie(
  *             Cookie(
  */
 
@@ -16176,15 +16179,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":554
+/* "blacksheep/messages.pyx":551
  *         )
  * 
  *     def remove_cookie(self, str name):             # <<<<<<<<<<<<<<
  *         cdef list to_remove = []
  *         cdef tuple value
  */
 
@@ -16193,15 +16196,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_8Response_15remove_cookie(PyObject *__pyx_v_self, PyObject *__pyx_v_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("remove_cookie (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_name), (&PyUnicode_Type), 1, "name", 1))) __PYX_ERR(0, 554, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_name), (&PyUnicode_Type), 1, "name", 1))) __PYX_ERR(0, 551, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_8Response_14remove_cookie(((struct __pyx_obj_10blacksheep_8messages_Response *)__pyx_v_self), ((PyObject*)__pyx_v_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -16223,152 +16226,152 @@
   PyObject *__pyx_t_5 = NULL;
   int __pyx_t_6;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("remove_cookie", 0);
 
-  /* "blacksheep/messages.pyx":555
+  /* "blacksheep/messages.pyx":552
  * 
  *     def remove_cookie(self, str name):
  *         cdef list to_remove = []             # <<<<<<<<<<<<<<
  *         cdef tuple value
  *         cdef list set_cookies_headers = self.get_headers_tuples(b'set-cookie')
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 555, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 552, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_to_remove = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":557
+  /* "blacksheep/messages.pyx":554
  *         cdef list to_remove = []
  *         cdef tuple value
  *         cdef list set_cookies_headers = self.get_headers_tuples(b'set-cookie')             # <<<<<<<<<<<<<<
  * 
  *         if set_cookies_headers:
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Response *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_headers_tuples(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_kp_b_set_cookie); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 557, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Response *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.get_headers_tuples(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_kp_b_set_cookie); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 554, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_set_cookies_headers = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":559
+  /* "blacksheep/messages.pyx":556
  *         cdef list set_cookies_headers = self.get_headers_tuples(b'set-cookie')
  * 
  *         if set_cookies_headers:             # <<<<<<<<<<<<<<
  *             for value in set_cookies_headers:
  *                 cookie = parse_cookie(value[1])
  */
   __pyx_t_2 = (__pyx_v_set_cookies_headers != Py_None)&&(PyList_GET_SIZE(__pyx_v_set_cookies_headers) != 0);
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":560
+    /* "blacksheep/messages.pyx":557
  * 
  *         if set_cookies_headers:
  *             for value in set_cookies_headers:             # <<<<<<<<<<<<<<
  *                 cookie = parse_cookie(value[1])
  *                 if cookie.name == name:
  */
     if (unlikely(__pyx_v_set_cookies_headers == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-      __PYX_ERR(0, 560, __pyx_L1_error)
+      __PYX_ERR(0, 557, __pyx_L1_error)
     }
     __pyx_t_1 = __pyx_v_set_cookies_headers; __Pyx_INCREF(__pyx_t_1); __pyx_t_3 = 0;
     for (;;) {
       if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_1)) break;
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_4); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 560, __pyx_L1_error)
+      __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_4); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 557, __pyx_L1_error)
       #else
-      __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 560, __pyx_L1_error)
+      __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 557, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       #endif
-      if (!(likely(PyTuple_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 560, __pyx_L1_error)
+      if (!(likely(PyTuple_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 557, __pyx_L1_error)
       __Pyx_XDECREF_SET(__pyx_v_value, ((PyObject*)__pyx_t_4));
       __pyx_t_4 = 0;
 
-      /* "blacksheep/messages.pyx":561
+      /* "blacksheep/messages.pyx":558
  *         if set_cookies_headers:
  *             for value in set_cookies_headers:
  *                 cookie = parse_cookie(value[1])             # <<<<<<<<<<<<<<
  *                 if cookie.name == name:
  *                     to_remove.append(value)
  */
       if (unlikely(__pyx_v_value == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-        __PYX_ERR(0, 561, __pyx_L1_error)
+        __PYX_ERR(0, 558, __pyx_L1_error)
       }
-      __pyx_t_4 = __Pyx_GetItemInt_Tuple(__pyx_v_value, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 561, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_GetItemInt_Tuple(__pyx_v_value, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 558, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 561, __pyx_L1_error)
-      __pyx_t_5 = ((PyObject *)__pyx_f_10blacksheep_7cookies_parse_cookie(((PyObject*)__pyx_t_4), 0)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 561, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 558, __pyx_L1_error)
+      __pyx_t_5 = ((PyObject *)__pyx_f_10blacksheep_7cookies_parse_cookie(((PyObject*)__pyx_t_4), 0)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 558, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_XDECREF_SET(__pyx_v_cookie, ((struct __pyx_obj_10blacksheep_7cookies_Cookie *)__pyx_t_5));
       __pyx_t_5 = 0;
 
-      /* "blacksheep/messages.pyx":562
+      /* "blacksheep/messages.pyx":559
  *             for value in set_cookies_headers:
  *                 cookie = parse_cookie(value[1])
  *                 if cookie.name == name:             # <<<<<<<<<<<<<<
  *                     to_remove.append(value)
  * 
  */
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cookie), __pyx_n_s_name); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 562, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cookie), __pyx_n_s_name); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 559, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_t_5, __pyx_v_name, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 562, __pyx_L1_error)
+      __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_t_5, __pyx_v_name, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 559, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       if (__pyx_t_2) {
 
-        /* "blacksheep/messages.pyx":563
+        /* "blacksheep/messages.pyx":560
  *                 cookie = parse_cookie(value[1])
  *                 if cookie.name == name:
  *                     to_remove.append(value)             # <<<<<<<<<<<<<<
  * 
  *         self.remove_headers(to_remove)
  */
-        __pyx_t_6 = __Pyx_PyList_Append(__pyx_v_to_remove, __pyx_v_value); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 563, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyList_Append(__pyx_v_to_remove, __pyx_v_value); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 560, __pyx_L1_error)
 
-        /* "blacksheep/messages.pyx":562
+        /* "blacksheep/messages.pyx":559
  *             for value in set_cookies_headers:
  *                 cookie = parse_cookie(value[1])
  *                 if cookie.name == name:             # <<<<<<<<<<<<<<
  *                     to_remove.append(value)
  * 
  */
       }
 
-      /* "blacksheep/messages.pyx":560
+      /* "blacksheep/messages.pyx":557
  * 
  *         if set_cookies_headers:
  *             for value in set_cookies_headers:             # <<<<<<<<<<<<<<
  *                 cookie = parse_cookie(value[1])
  *                 if cookie.name == name:
  */
     }
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "blacksheep/messages.pyx":559
+    /* "blacksheep/messages.pyx":556
  *         cdef list set_cookies_headers = self.get_headers_tuples(b'set-cookie')
  * 
  *         if set_cookies_headers:             # <<<<<<<<<<<<<<
  *             for value in set_cookies_headers:
  *                 cookie = parse_cookie(value[1])
  */
   }
 
-  /* "blacksheep/messages.pyx":565
+  /* "blacksheep/messages.pyx":562
  *                     to_remove.append(value)
  * 
  *         self.remove_headers(to_remove)             # <<<<<<<<<<<<<<
  * 
  *     cpdef bint is_redirect(self):
  */
   ((struct __pyx_vtabstruct_10blacksheep_8messages_Response *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.remove_headers(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_self), __pyx_v_to_remove);
 
-  /* "blacksheep/messages.pyx":554
+  /* "blacksheep/messages.pyx":551
  *         )
  * 
  *     def remove_cookie(self, str name):             # <<<<<<<<<<<<<<
  *         cdef list to_remove = []
  *         cdef tuple value
  */
 
@@ -16387,15 +16390,15 @@
   __Pyx_XDECREF(__pyx_v_set_cookies_headers);
   __Pyx_XDECREF((PyObject *)__pyx_v_cookie);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":567
+/* "blacksheep/messages.pyx":564
  *         self.remove_headers(to_remove)
  * 
  *     cpdef bint is_redirect(self):             # <<<<<<<<<<<<<<
  *         return self.status in {301, 302, 303, 307, 308}
  * 
  */
 
@@ -16417,15 +16420,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_redirect); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 567, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_redirect); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 564, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_10blacksheep_8messages_8Response_17is_redirect)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -16433,18 +16436,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 567, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 564, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 567, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 564, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -16455,15 +16458,15 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "blacksheep/messages.pyx":568
+  /* "blacksheep/messages.pyx":565
  * 
  *     cpdef bint is_redirect(self):
  *         return self.status in {301, 302, 303, 307, 308}             # <<<<<<<<<<<<<<
  * 
  * 
  */
   switch (__pyx_v_self->status) {
@@ -16477,15 +16480,15 @@
     default:
     __pyx_t_5 = 0;
     break;
   }
   __pyx_r = __pyx_t_5;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":567
+  /* "blacksheep/messages.pyx":564
  *         self.remove_headers(to_remove)
  * 
  *     cpdef bint is_redirect(self):             # <<<<<<<<<<<<<<
  *         return self.status in {301, 302, 303, 307, 308}
  * 
  */
 
@@ -16520,15 +16523,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("is_redirect", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_8Response_is_redirect(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 567, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_8Response_is_redirect(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 564, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -16993,15 +16996,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_Response, (type(self), 0x0322460, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_Response__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_8messages___pyx_unpickle_Response__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_Response, (type(self), 0x0322460, state)
@@ -17018,15 +17021,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":571
+/* "blacksheep/messages.pyx":568
  * 
  * 
  * cpdef bint is_cors_request(Request request):             # <<<<<<<<<<<<<<
  *     return bool(request.get_first_header(b"Origin"))
  * 
  */
 
@@ -17037,29 +17040,29 @@
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("is_cors_request", 0);
 
-  /* "blacksheep/messages.pyx":572
+  /* "blacksheep/messages.pyx":569
  * 
  * cpdef bint is_cors_request(Request request):
  *     return bool(request.get_first_header(b"Origin"))             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_request->__pyx_base.__pyx_vtab)->__pyx_base.get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_request), __pyx_n_b_Origin, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 572, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_request->__pyx_base.__pyx_vtab)->__pyx_base.get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_request), __pyx_n_b_Origin, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 569, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = (__pyx_t_1 != Py_None)&&(PyBytes_GET_SIZE(__pyx_t_1) != 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = (!(!__pyx_t_2));
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":571
+  /* "blacksheep/messages.pyx":568
  * 
  * 
  * cpdef bint is_cors_request(Request request):             # <<<<<<<<<<<<<<
  *     return bool(request.get_first_header(b"Origin"))
  * 
  */
 
@@ -17078,15 +17081,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_5is_cors_request(PyObject *__pyx_self, PyObject *__pyx_v_request) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_cors_request (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_request), __pyx_ptype_10blacksheep_8messages_Request, 1, "request", 0))) __PYX_ERR(0, 571, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_request), __pyx_ptype_10blacksheep_8messages_Request, 1, "request", 0))) __PYX_ERR(0, 568, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_4is_cors_request(__pyx_self, ((struct __pyx_obj_10blacksheep_8messages_Request *)__pyx_v_request));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -17099,15 +17102,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("is_cors_request", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_is_cors_request(__pyx_v_request, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 571, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_is_cors_request(__pyx_v_request, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 568, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -17116,15 +17119,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":575
+/* "blacksheep/messages.pyx":572
  * 
  * 
  * cpdef bint is_cors_preflight_request(Request request):             # <<<<<<<<<<<<<<
  *     if request.method != "OPTIONS" or not is_cors_request(request):
  *         return False
  */
 
@@ -17138,76 +17141,76 @@
   int __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("is_cors_preflight_request", 0);
 
-  /* "blacksheep/messages.pyx":576
+  /* "blacksheep/messages.pyx":573
  * 
  * cpdef bint is_cors_preflight_request(Request request):
  *     if request.method != "OPTIONS" or not is_cors_request(request):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
-  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_request->method, __pyx_n_u_OPTIONS, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 576, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_request->method, __pyx_n_u_OPTIONS, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 573, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (!__pyx_t_3) {
   } else {
     __pyx_t_1 = __pyx_t_3;
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_3 = ((!(__pyx_f_10blacksheep_8messages_is_cors_request(__pyx_v_request, 0) != 0)) != 0);
   __pyx_t_1 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "blacksheep/messages.pyx":577
+    /* "blacksheep/messages.pyx":574
  * cpdef bint is_cors_preflight_request(Request request):
  *     if request.method != "OPTIONS" or not is_cors_request(request):
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     next_request_method = request.get_first_header(
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":576
+    /* "blacksheep/messages.pyx":573
  * 
  * cpdef bint is_cors_preflight_request(Request request):
  *     if request.method != "OPTIONS" or not is_cors_request(request):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   }
 
-  /* "blacksheep/messages.pyx":579
+  /* "blacksheep/messages.pyx":576
  *         return False
  * 
  *     next_request_method = request.get_first_header(             # <<<<<<<<<<<<<<
  *         b"Access-Control-Request-Method"
  *     )
  */
-  __pyx_t_4 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_request->__pyx_base.__pyx_vtab)->__pyx_base.get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_request), __pyx_kp_b_Access_Control_Request_Method, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 579, __pyx_L1_error)
+  __pyx_t_4 = ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_request->__pyx_base.__pyx_vtab)->__pyx_base.get_first_header(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_request), __pyx_kp_b_Access_Control_Request_Method, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 576, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_v_next_request_method = ((PyObject*)__pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "blacksheep/messages.pyx":583
+  /* "blacksheep/messages.pyx":580
  *     )
  * 
  *     return bool(next_request_method)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_t_1 = (__pyx_v_next_request_method != Py_None)&&(PyBytes_GET_SIZE(__pyx_v_next_request_method) != 0);
   __pyx_r = (!(!__pyx_t_1));
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":575
+  /* "blacksheep/messages.pyx":572
  * 
  * 
  * cpdef bint is_cors_preflight_request(Request request):             # <<<<<<<<<<<<<<
  *     if request.method != "OPTIONS" or not is_cors_request(request):
  *         return False
  */
 
@@ -17227,15 +17230,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_7is_cors_preflight_request(PyObject *__pyx_self, PyObject *__pyx_v_request) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_cors_preflight_request (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_request), __pyx_ptype_10blacksheep_8messages_Request, 1, "request", 0))) __PYX_ERR(0, 575, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_request), __pyx_ptype_10blacksheep_8messages_Request, 1, "request", 0))) __PYX_ERR(0, 572, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_6is_cors_preflight_request(__pyx_self, ((struct __pyx_obj_10blacksheep_8messages_Request *)__pyx_v_request));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -17248,15 +17251,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("is_cors_preflight_request", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_is_cors_preflight_request(__pyx_v_request, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 575, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_10blacksheep_8messages_is_cors_preflight_request(__pyx_v_request, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 572, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -17265,15 +17268,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":586
+/* "blacksheep/messages.pyx":583
  * 
  * 
  * cdef bytes ensure_bytes(value):             # <<<<<<<<<<<<<<
  *     if isinstance(value, str):
  *         return value.encode()
  */
 
@@ -17286,111 +17289,111 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("ensure_bytes", 0);
 
-  /* "blacksheep/messages.pyx":587
+  /* "blacksheep/messages.pyx":584
  * 
  * cdef bytes ensure_bytes(value):
  *     if isinstance(value, str):             # <<<<<<<<<<<<<<
  *         return value.encode()
  *     if isinstance(value, bytes):
  */
   __pyx_t_1 = PyUnicode_Check(__pyx_v_value); 
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "blacksheep/messages.pyx":588
+    /* "blacksheep/messages.pyx":585
  * cdef bytes ensure_bytes(value):
  *     if isinstance(value, str):
  *         return value.encode()             # <<<<<<<<<<<<<<
  *     if isinstance(value, bytes):
  *         return value
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_value, __pyx_n_s_encode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 588, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_value, __pyx_n_s_encode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 588, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 588, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 585, __pyx_L1_error)
     __pyx_r = ((PyObject*)__pyx_t_3);
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":587
+    /* "blacksheep/messages.pyx":584
  * 
  * cdef bytes ensure_bytes(value):
  *     if isinstance(value, str):             # <<<<<<<<<<<<<<
  *         return value.encode()
  *     if isinstance(value, bytes):
  */
   }
 
-  /* "blacksheep/messages.pyx":589
+  /* "blacksheep/messages.pyx":586
  *     if isinstance(value, str):
  *         return value.encode()
  *     if isinstance(value, bytes):             # <<<<<<<<<<<<<<
  *         return value
  *     raise ValueError("Input value must be bytes or str")
  */
   __pyx_t_2 = PyBytes_Check(__pyx_v_value); 
   __pyx_t_1 = (__pyx_t_2 != 0);
   if (__pyx_t_1) {
 
-    /* "blacksheep/messages.pyx":590
+    /* "blacksheep/messages.pyx":587
  *         return value.encode()
  *     if isinstance(value, bytes):
  *         return value             # <<<<<<<<<<<<<<
  *     raise ValueError("Input value must be bytes or str")
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    if (!(likely(PyBytes_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(0, 590, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_v_value)->tp_name), 0))) __PYX_ERR(0, 587, __pyx_L1_error)
     __Pyx_INCREF(__pyx_v_value);
     __pyx_r = ((PyObject*)__pyx_v_value);
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":589
+    /* "blacksheep/messages.pyx":586
  *     if isinstance(value, str):
  *         return value.encode()
  *     if isinstance(value, bytes):             # <<<<<<<<<<<<<<
  *         return value
  *     raise ValueError("Input value must be bytes or str")
  */
   }
 
-  /* "blacksheep/messages.pyx":591
+  /* "blacksheep/messages.pyx":588
  *     if isinstance(value, bytes):
  *         return value
  *     raise ValueError("Input value must be bytes or str")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__17, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 591, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__17, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 588, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_Raise(__pyx_t_3, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __PYX_ERR(0, 591, __pyx_L1_error)
+  __PYX_ERR(0, 588, __pyx_L1_error)
 
-  /* "blacksheep/messages.pyx":586
+  /* "blacksheep/messages.pyx":583
  * 
  * 
  * cdef bytes ensure_bytes(value):             # <<<<<<<<<<<<<<
  *     if isinstance(value, str):
  *         return value.encode()
  */
 
@@ -17403,15 +17406,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":594
+/* "blacksheep/messages.pyx":591
  * 
  * 
  * cpdef URL get_request_absolute_url(Request request):             # <<<<<<<<<<<<<<
  *     if request.url.is_absolute:
  *         # outgoing request
  */
 
@@ -17426,130 +17429,130 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_request_absolute_url", 0);
 
-  /* "blacksheep/messages.pyx":595
+  /* "blacksheep/messages.pyx":592
  * 
  * cpdef URL get_request_absolute_url(Request request):
  *     if request.url.is_absolute:             # <<<<<<<<<<<<<<
  *         # outgoing request
  *         return request.url
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_url); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 595, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_url); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 592, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_is_absolute); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 595, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_is_absolute); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 592, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 595, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 592, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   if (__pyx_t_3) {
 
-    /* "blacksheep/messages.pyx":597
+    /* "blacksheep/messages.pyx":594
  *     if request.url.is_absolute:
  *         # outgoing request
  *         return request.url             # <<<<<<<<<<<<<<
  * 
  *     # incoming request
  */
     __Pyx_XDECREF(((PyObject *)__pyx_r));
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_url); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 597, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_url); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 594, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_10blacksheep_3url_URL))))) __PYX_ERR(0, 597, __pyx_L1_error)
+    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_10blacksheep_3url_URL))))) __PYX_ERR(0, 594, __pyx_L1_error)
     __pyx_r = ((struct __pyx_obj_10blacksheep_3url_URL *)__pyx_t_2);
     __pyx_t_2 = 0;
     goto __pyx_L0;
 
-    /* "blacksheep/messages.pyx":595
+    /* "blacksheep/messages.pyx":592
  * 
  * cpdef URL get_request_absolute_url(Request request):
  *     if request.url.is_absolute:             # <<<<<<<<<<<<<<
  *         # outgoing request
  *         return request.url
  */
   }
 
-  /* "blacksheep/messages.pyx":600
+  /* "blacksheep/messages.pyx":597
  * 
  *     # incoming request
  *     return build_absolute_url(             # <<<<<<<<<<<<<<
  *         ensure_bytes(request.scheme),
  *         ensure_bytes(request.host),
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
 
-  /* "blacksheep/messages.pyx":601
+  /* "blacksheep/messages.pyx":598
  *     # incoming request
  *     return build_absolute_url(
  *         ensure_bytes(request.scheme),             # <<<<<<<<<<<<<<
  *         ensure_bytes(request.host),
  *         ensure_bytes(request.base_path),
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_scheme); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 601, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_scheme); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 598, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __pyx_f_10blacksheep_8messages_ensure_bytes(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 601, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_10blacksheep_8messages_ensure_bytes(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 598, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "blacksheep/messages.pyx":602
+  /* "blacksheep/messages.pyx":599
  *     return build_absolute_url(
  *         ensure_bytes(request.scheme),
  *         ensure_bytes(request.host),             # <<<<<<<<<<<<<<
  *         ensure_bytes(request.base_path),
  *         request._path
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_host); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 602, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_host); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 599, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __pyx_f_10blacksheep_8messages_ensure_bytes(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 602, __pyx_L1_error)
+  __pyx_t_4 = __pyx_f_10blacksheep_8messages_ensure_bytes(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 599, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "blacksheep/messages.pyx":603
+  /* "blacksheep/messages.pyx":600
  *         ensure_bytes(request.scheme),
  *         ensure_bytes(request.host),
  *         ensure_bytes(request.base_path),             # <<<<<<<<<<<<<<
  *         request._path
  *     )
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_base_path); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 603, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_base_path); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = __pyx_f_10blacksheep_8messages_ensure_bytes(__pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 603, __pyx_L1_error)
+  __pyx_t_5 = __pyx_f_10blacksheep_8messages_ensure_bytes(__pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "blacksheep/messages.pyx":604
+  /* "blacksheep/messages.pyx":601
  *         ensure_bytes(request.host),
  *         ensure_bytes(request.base_path),
  *         request._path             # <<<<<<<<<<<<<<
  *     )
  * 
  */
   __pyx_t_2 = __pyx_v_request->_path;
   __Pyx_INCREF(__pyx_t_2);
 
-  /* "blacksheep/messages.pyx":600
+  /* "blacksheep/messages.pyx":597
  * 
  *     # incoming request
  *     return build_absolute_url(             # <<<<<<<<<<<<<<
  *         ensure_bytes(request.scheme),
  *         ensure_bytes(request.host),
  */
-  __pyx_t_6 = ((PyObject *)__pyx_f_10blacksheep_3url_build_absolute_url(((PyObject*)__pyx_t_1), ((PyObject*)__pyx_t_4), ((PyObject*)__pyx_t_5), ((PyObject*)__pyx_t_2), 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 600, __pyx_L1_error)
+  __pyx_t_6 = ((PyObject *)__pyx_f_10blacksheep_3url_build_absolute_url(((PyObject*)__pyx_t_1), ((PyObject*)__pyx_t_4), ((PyObject*)__pyx_t_5), ((PyObject*)__pyx_t_2), 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 597, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = ((struct __pyx_obj_10blacksheep_3url_URL *)__pyx_t_6);
   __pyx_t_6 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":594
+  /* "blacksheep/messages.pyx":591
  * 
  * 
  * cpdef URL get_request_absolute_url(Request request):             # <<<<<<<<<<<<<<
  *     if request.url.is_absolute:
  *         # outgoing request
  */
 
@@ -17573,15 +17576,15 @@
 static PyObject *__pyx_pw_10blacksheep_8messages_9get_request_absolute_url(PyObject *__pyx_self, PyObject *__pyx_v_request) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("get_request_absolute_url (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_request), __pyx_ptype_10blacksheep_8messages_Request, 1, "request", 0))) __PYX_ERR(0, 594, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_request), __pyx_ptype_10blacksheep_8messages_Request, 1, "request", 0))) __PYX_ERR(0, 591, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_8get_request_absolute_url(__pyx_self, ((struct __pyx_obj_10blacksheep_8messages_Request *)__pyx_v_request));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -17594,15 +17597,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_request_absolute_url", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_10blacksheep_8messages_get_request_absolute_url(__pyx_v_request, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 594, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_10blacksheep_8messages_get_request_absolute_url(__pyx_v_request, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 591, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -17611,15 +17614,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "blacksheep/messages.pyx":608
+/* "blacksheep/messages.pyx":605
  * 
  * 
  * cpdef URL get_absolute_url_to_path(Request request, str path):             # <<<<<<<<<<<<<<
  *     return build_absolute_url(
  *         ensure_bytes(request.scheme),
  */
 
@@ -17633,89 +17636,89 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_absolute_url_to_path", 0);
 
-  /* "blacksheep/messages.pyx":609
+  /* "blacksheep/messages.pyx":606
  * 
  * cpdef URL get_absolute_url_to_path(Request request, str path):
  *     return build_absolute_url(             # <<<<<<<<<<<<<<
  *         ensure_bytes(request.scheme),
  *         ensure_bytes(request.host),
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
 
-  /* "blacksheep/messages.pyx":610
+  /* "blacksheep/messages.pyx":607
  * cpdef URL get_absolute_url_to_path(Request request, str path):
  *     return build_absolute_url(
  *         ensure_bytes(request.scheme),             # <<<<<<<<<<<<<<
  *         ensure_bytes(request.host),
  *         ensure_bytes(request.base_path),
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_scheme); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 610, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_scheme); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 607, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_f_10blacksheep_8messages_ensure_bytes(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 610, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_10blacksheep_8messages_ensure_bytes(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 607, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":611
+  /* "blacksheep/messages.pyx":608
  *     return build_absolute_url(
  *         ensure_bytes(request.scheme),
  *         ensure_bytes(request.host),             # <<<<<<<<<<<<<<
  *         ensure_bytes(request.base_path),
  *         ensure_bytes(path)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_host); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 611, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_host); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 608, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __pyx_f_10blacksheep_8messages_ensure_bytes(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 611, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_10blacksheep_8messages_ensure_bytes(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 608, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":612
+  /* "blacksheep/messages.pyx":609
  *         ensure_bytes(request.scheme),
  *         ensure_bytes(request.host),
  *         ensure_bytes(request.base_path),             # <<<<<<<<<<<<<<
  *         ensure_bytes(path)
  *     )
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_base_path); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 612, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_base_path); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 609, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __pyx_f_10blacksheep_8messages_ensure_bytes(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 612, __pyx_L1_error)
+  __pyx_t_4 = __pyx_f_10blacksheep_8messages_ensure_bytes(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 609, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":613
+  /* "blacksheep/messages.pyx":610
  *         ensure_bytes(request.host),
  *         ensure_bytes(request.base_path),
  *         ensure_bytes(path)             # <<<<<<<<<<<<<<
  *     )
  */
-  __pyx_t_1 = __pyx_f_10blacksheep_8messages_ensure_bytes(__pyx_v_path); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 613, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_10blacksheep_8messages_ensure_bytes(__pyx_v_path); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 610, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
 
-  /* "blacksheep/messages.pyx":609
+  /* "blacksheep/messages.pyx":606
  * 
  * cpdef URL get_absolute_url_to_path(Request request, str path):
  *     return build_absolute_url(             # <<<<<<<<<<<<<<
  *         ensure_bytes(request.scheme),
  *         ensure_bytes(request.host),
  */
-  __pyx_t_5 = ((PyObject *)__pyx_f_10blacksheep_3url_build_absolute_url(((PyObject*)__pyx_t_2), ((PyObject*)__pyx_t_3), ((PyObject*)__pyx_t_4), ((PyObject*)__pyx_t_1), 0)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 609, __pyx_L1_error)
+  __pyx_t_5 = ((PyObject *)__pyx_f_10blacksheep_3url_build_absolute_url(((PyObject*)__pyx_t_2), ((PyObject*)__pyx_t_3), ((PyObject*)__pyx_t_4), ((PyObject*)__pyx_t_1), 0)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 606, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = ((struct __pyx_obj_10blacksheep_3url_URL *)__pyx_t_5);
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "blacksheep/messages.pyx":608
+  /* "blacksheep/messages.pyx":605
  * 
  * 
  * cpdef URL get_absolute_url_to_path(Request request, str path):             # <<<<<<<<<<<<<<
  *     return build_absolute_url(
  *         ensure_bytes(request.scheme),
  */
 
@@ -17764,39 +17767,39 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_request)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_path)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("get_absolute_url_to_path", 1, 2, 2, 1); __PYX_ERR(0, 608, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_absolute_url_to_path", 1, 2, 2, 1); __PYX_ERR(0, 605, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_absolute_url_to_path") < 0)) __PYX_ERR(0, 608, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_absolute_url_to_path") < 0)) __PYX_ERR(0, 605, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_request = ((struct __pyx_obj_10blacksheep_8messages_Request *)values[0]);
     __pyx_v_path = ((PyObject*)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_absolute_url_to_path", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 608, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_absolute_url_to_path", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 605, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("blacksheep.messages.get_absolute_url_to_path", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_request), __pyx_ptype_10blacksheep_8messages_Request, 1, "request", 0))) __PYX_ERR(0, 608, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_path), (&PyUnicode_Type), 1, "path", 1))) __PYX_ERR(0, 608, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_request), __pyx_ptype_10blacksheep_8messages_Request, 1, "request", 0))) __PYX_ERR(0, 605, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_path), (&PyUnicode_Type), 1, "path", 1))) __PYX_ERR(0, 605, __pyx_L1_error)
   __pyx_r = __pyx_pf_10blacksheep_8messages_10get_absolute_url_to_path(__pyx_self, __pyx_v_request, __pyx_v_path);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -17809,15 +17812,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_absolute_url_to_path", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_10blacksheep_8messages_get_absolute_url_to_path(__pyx_v_request, __pyx_v_path, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 608, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_10blacksheep_8messages_get_absolute_url_to_path(__pyx_v_request, __pyx_v_path, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 605, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -18047,15 +18050,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = Message.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Message__set_state(<Message> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_Message__set_state(Message __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_8messages___pyx_unpickle_Message__set_state(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x976f334, 0x6a36ccd, 0x4337ce2) = (__headers, content))" % __pyx_checksum)
  *     __pyx_result = Message.__new__(__pyx_type)
@@ -18132,15 +18135,15 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx___headers);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx___headers);
   __pyx_v___pyx_result->__pyx___headers = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -18461,15 +18464,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = Request.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Request__set_state(<Request> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_Request__set_state(Request __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_8messages___pyx_unpickle_Request__set_state(((struct __pyx_obj_10blacksheep_8messages_Request *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x0c41d18, 0x3b6f9e9, 0xa5b4208) = (__headers, _path, _raw_query, _url, content, method, route_values, scope))" % __pyx_checksum)
  *     __pyx_result = Request.__new__(__pyx_type)
@@ -18546,39 +18549,39 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.__pyx___headers);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.__pyx___headers);
   __pyx_v___pyx_result->__pyx_base.__pyx___headers = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->_path);
   __Pyx_DECREF(__pyx_v___pyx_result->_path);
   __pyx_v___pyx_result->_path = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->_raw_query);
   __Pyx_DECREF(__pyx_v___pyx_result->_raw_query);
   __pyx_v___pyx_result->_raw_query = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -18606,15 +18609,15 @@
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->method);
   __Pyx_DECREF(__pyx_v___pyx_result->method);
   __pyx_v___pyx_result->method = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -18942,15 +18945,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = Response.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Response__set_state(<Response> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_Response__set_state(Response __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_8messages___pyx_unpickle_Response__set_state(((struct __pyx_obj_10blacksheep_8messages_Response *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x0322460, 0x7438fdd, 0x1f8e2ff) = (__headers, active, content, status))" % __pyx_checksum)
  *     __pyx_result = Response.__new__(__pyx_type)
@@ -19028,15 +19031,15 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(2, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
+  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(2, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.__pyx___headers);
   __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.__pyx___headers);
   __pyx_v___pyx_result->__pyx_base.__pyx___headers = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -21814,15 +21817,14 @@
   {&__pyx_n_u_GET, __pyx_k_GET, sizeof(__pyx_k_GET), 0, 1, 0, 1},
   {&__pyx_n_u_HEAD, __pyx_k_HEAD, sizeof(__pyx_k_HEAD), 0, 1, 0, 1},
   {&__pyx_n_s_HTTPStatus, __pyx_k_HTTPStatus, sizeof(__pyx_k_HTTPStatus), 0, 0, 1, 1},
   {&__pyx_kp_u_Headers_contains_more_than_one_h, __pyx_k_Headers_contains_more_than_one_h, sizeof(__pyx_k_Headers_contains_more_than_one_h), 0, 1, 0, 0},
   {&__pyx_kp_u_Headers_does_not_contain_one_hea, __pyx_k_Headers_does_not_contain_one_hea, sizeof(__pyx_k_Headers_does_not_contain_one_hea), 0, 1, 0, 0},
   {&__pyx_n_s_I, __pyx_k_I, sizeof(__pyx_k_I), 0, 0, 1, 1},
   {&__pyx_kp_u_ISO_8859_1, __pyx_k_ISO_8859_1, sizeof(__pyx_k_ISO_8859_1), 0, 1, 0, 0},
-  {&__pyx_n_s_ImportError, __pyx_k_ImportError, sizeof(__pyx_k_ImportError), 0, 0, 1, 1},
   {&__pyx_kp_s_Incompatible_checksums_0x_x_vs_0, __pyx_k_Incompatible_checksums_0x_x_vs_0, sizeof(__pyx_k_Incompatible_checksums_0x_x_vs_0), 0, 0, 1, 0},
   {&__pyx_kp_s_Incompatible_checksums_0x_x_vs_0_2, __pyx_k_Incompatible_checksums_0x_x_vs_0_2, sizeof(__pyx_k_Incompatible_checksums_0x_x_vs_0_2), 0, 0, 1, 0},
   {&__pyx_kp_s_Incompatible_checksums_0x_x_vs_0_3, __pyx_k_Incompatible_checksums_0x_x_vs_0_3, sizeof(__pyx_k_Incompatible_checksums_0x_x_vs_0_3), 0, 0, 1, 0},
   {&__pyx_kp_u_Input_value_must_be_bytes_or_str, __pyx_k_Input_value_must_be_bytes_or_str, sizeof(__pyx_k_Input_value_must_be_bytes_or_str), 0, 1, 0, 0},
   {&__pyx_kp_u_Invalid_value_type_expected_byte, __pyx_k_Invalid_value_type_expected_byte, sizeof(__pyx_k_Invalid_value_type_expected_byte), 0, 1, 0, 0},
   {&__pyx_n_s_JSONDecodeError, __pyx_k_JSONDecodeError, sizeof(__pyx_k_JSONDecodeError), 0, 0, 1, 1},
   {&__pyx_n_s_Message, __pyx_k_Message, sizeof(__pyx_k_Message), 0, 0, 1, 1},
@@ -21865,17 +21867,16 @@
   {&__pyx_n_s_base_path, __pyx_k_base_path, sizeof(__pyx_k_base_path), 0, 0, 1, 1},
   {&__pyx_n_u_base_path, __pyx_k_base_path, sizeof(__pyx_k_base_path), 0, 1, 0, 1},
   {&__pyx_n_s_blacksheep_messages, __pyx_k_blacksheep_messages, sizeof(__pyx_k_blacksheep_messages), 0, 0, 1, 1},
   {&__pyx_n_s_blacksheep_multipart, __pyx_k_blacksheep_multipart, sizeof(__pyx_k_blacksheep_multipart), 0, 0, 1, 1},
   {&__pyx_n_s_blacksheep_sessions, __pyx_k_blacksheep_sessions, sizeof(__pyx_k_blacksheep_sessions), 0, 0, 1, 1},
   {&__pyx_n_s_blacksheep_settings_json, __pyx_k_blacksheep_settings_json, sizeof(__pyx_k_blacksheep_settings_json), 0, 0, 1, 1},
   {&__pyx_kp_u_but_the_content_cannot_be_parse, __pyx_k_but_the_content_cannot_be_parse, sizeof(__pyx_k_but_the_content_cannot_be_parse), 0, 1, 0, 0},
-  {&__pyx_n_s_cchardet, __pyx_k_cchardet, sizeof(__pyx_k_cchardet), 0, 0, 1, 1},
-  {&__pyx_n_s_chardet, __pyx_k_chardet, sizeof(__pyx_k_chardet), 0, 0, 1, 1},
   {&__pyx_n_s_charset, __pyx_k_charset, sizeof(__pyx_k_charset), 0, 0, 1, 1},
+  {&__pyx_n_s_charset_normalizer, __pyx_k_charset_normalizer, sizeof(__pyx_k_charset_normalizer), 0, 0, 1, 1},
   {&__pyx_n_s_charset_rx, __pyx_k_charset_rx, sizeof(__pyx_k_charset_rx), 0, 0, 1, 1},
   {&__pyx_kp_b_charset_s, __pyx_k_charset_s, sizeof(__pyx_k_charset_s), 0, 0, 0, 0},
   {&__pyx_n_u_client, __pyx_k_client, sizeof(__pyx_k_client), 0, 1, 0, 1},
   {&__pyx_n_s_client_ip, __pyx_k_client_ip, sizeof(__pyx_k_client_ip), 0, 0, 1, 1},
   {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
   {&__pyx_n_s_close, __pyx_k_close, sizeof(__pyx_k_close), 0, 0, 1, 1},
   {&__pyx_n_s_compile, __pyx_k_compile, sizeof(__pyx_k_compile), 0, 0, 1, 1},
@@ -21991,115 +21992,114 @@
   {&__pyx_n_s_value, __pyx_k_value, sizeof(__pyx_k_value), 0, 0, 1, 1},
   {&__pyx_n_s_with_content, __pyx_k_with_content, sizeof(__pyx_k_with_content), 0, 0, 1, 1},
   {&__pyx_n_s_with_query, __pyx_k_with_query, sizeof(__pyx_k_with_query), 0, 0, 1, 1},
   {&__pyx_n_b_xml, __pyx_k_xml, sizeof(__pyx_k_xml), 0, 0, 0, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_ImportError = __Pyx_GetBuiltinName(__pyx_n_s_ImportError); if (!__pyx_builtin_ImportError) __PYX_ERR(0, 9, __pyx_L1_error)
-  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 77, __pyx_L1_error)
-  __pyx_builtin_UnicodeDecodeError = __Pyx_GetBuiltinName(__pyx_n_s_UnicodeDecodeError); if (!__pyx_builtin_UnicodeDecodeError) __PYX_ERR(0, 148, __pyx_L1_error)
-  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 358, __pyx_L1_error)
+  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_builtin_UnicodeDecodeError = __Pyx_GetBuiltinName(__pyx_n_s_UnicodeDecodeError); if (!__pyx_builtin_UnicodeDecodeError) __PYX_ERR(0, 145, __pyx_L1_error)
+  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 355, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "blacksheep/messages.pyx":77
+  /* "blacksheep/messages.pyx":74
  *         cdef list results = self.get_headers(key)
  *         if len(results) > 1:
  *             raise ValueError('Headers contains more than one header with the given key')             # <<<<<<<<<<<<<<
  *         if len(results) < 1:
  *             raise ValueError('Headers does not contain one header with the given key')
  */
-  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_Headers_contains_more_than_one_h); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_Headers_contains_more_than_one_h); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 74, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple_);
   __Pyx_GIVEREF(__pyx_tuple_);
 
-  /* "blacksheep/messages.pyx":79
+  /* "blacksheep/messages.pyx":76
  *             raise ValueError('Headers contains more than one header with the given key')
  *         if len(results) < 1:
  *             raise ValueError('Headers does not contain one header with the given key')             # <<<<<<<<<<<<<<
  *         return results[0]
  * 
  */
-  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_u_Headers_does_not_contain_one_hea); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_u_Headers_does_not_contain_one_hea); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__2);
   __Pyx_GIVEREF(__pyx_tuple__2);
 
-  /* "blacksheep/messages.pyx":299
+  /* "blacksheep/messages.pyx":296
  *     @property
  *     def scheme(self) -> str:
  *         return self.__dict__.get("scheme") or (self.scope.get("scheme", "") if self.scope else "")             # <<<<<<<<<<<<<<
  * 
  *     @scheme.setter
  */
-  __pyx_tuple__5 = PyTuple_Pack(2, __pyx_n_u_scheme, __pyx_kp_u__3); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 299, __pyx_L1_error)
+  __pyx_tuple__5 = PyTuple_Pack(2, __pyx_n_u_scheme, __pyx_kp_u__3); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 296, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__5);
   __Pyx_GIVEREF(__pyx_tuple__5);
 
-  /* "blacksheep/messages.pyx":315
+  /* "blacksheep/messages.pyx":312
  *                 host_header = self.get_first_header(b'host')
  *                 if host_header is None:
  *                     raise BadRequest("Missing Host header")             # <<<<<<<<<<<<<<
  *                 self.__dict__["host"] = host_header.decode()
  *         return self.__dict__["host"]
  */
-  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_u_Missing_Host_header); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 315, __pyx_L1_error)
+  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_u_Missing_Host_header); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 312, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__6);
   __Pyx_GIVEREF(__pyx_tuple__6);
 
-  /* "blacksheep/messages.pyx":341
+  /* "blacksheep/messages.pyx":338
  *         if self.scope is None:
  *             return ""
  *         client_ip, client_port = self.scope.get("client", ("", 0))             # <<<<<<<<<<<<<<
  *         return client_ip
  * 
  */
-  __pyx_tuple__7 = PyTuple_Pack(2, __pyx_kp_u__3, __pyx_int_0); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 341, __pyx_L1_error)
+  __pyx_tuple__7 = PyTuple_Pack(2, __pyx_kp_u__3, __pyx_int_0); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 338, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__7);
   __Pyx_GIVEREF(__pyx_tuple__7);
-  __pyx_tuple__8 = PyTuple_Pack(2, __pyx_n_u_client, __pyx_tuple__7); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(0, 341, __pyx_L1_error)
+  __pyx_tuple__8 = PyTuple_Pack(2, __pyx_n_u_client, __pyx_tuple__7); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(0, 338, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__8);
   __Pyx_GIVEREF(__pyx_tuple__8);
 
-  /* "blacksheep/messages.pyx":358
+  /* "blacksheep/messages.pyx":355
  *     def session(self):
  *         if self._session is None:
  *             raise TypeError(             # <<<<<<<<<<<<<<
  *                 "A session is not configured for this request, activate "
  *                 "sessions using `app.use_sessions` method."
  */
-  __pyx_tuple__9 = PyTuple_Pack(1, __pyx_kp_u_A_session_is_not_configured_for); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 358, __pyx_L1_error)
+  __pyx_tuple__9 = PyTuple_Pack(1, __pyx_kp_u_A_session_is_not_configured_for); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 355, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__9);
   __Pyx_GIVEREF(__pyx_tuple__9);
 
-  /* "blacksheep/messages.pyx":411
+  /* "blacksheep/messages.pyx":408
  *                 _url = value
  *             else:
  *                 raise TypeError('Invalid value type, expected bytes, str, or URL')             # <<<<<<<<<<<<<<
  *         else:
  *             _url = None
  */
-  __pyx_tuple__11 = PyTuple_Pack(1, __pyx_kp_u_Invalid_value_type_expected_byte); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 411, __pyx_L1_error)
+  __pyx_tuple__11 = PyTuple_Pack(1, __pyx_kp_u_Invalid_value_type_expected_byte); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 408, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__11);
   __Pyx_GIVEREF(__pyx_tuple__11);
 
-  /* "blacksheep/messages.pyx":591
+  /* "blacksheep/messages.pyx":588
  *     if isinstance(value, bytes):
  *         return value
  *     raise ValueError("Input value must be bytes or str")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_tuple__17 = PyTuple_Pack(1, __pyx_kp_u_Input_value_must_be_bytes_or_str); if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 591, __pyx_L1_error)
+  __pyx_tuple__17 = PyTuple_Pack(1, __pyx_kp_u_Input_value_must_be_bytes_or_str); if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 588, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__17);
   __Pyx_GIVEREF(__pyx_tuple__17);
 
   /* "(tree fragment)":4
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  *     if __pyx_checksum not in (0x976f334, 0x6a36ccd, 0x4337ce2):             # <<<<<<<<<<<<<<
@@ -22140,15 +22140,15 @@
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
   __pyx_umethod_PyBytes_Type_lower.type = (PyObject*)&PyBytes_Type;
   __pyx_umethod_PyBytes_Type_split.type = (PyObject*)&PyBytes_Type;
   __pyx_umethod_PyDict_Type_get.type = (PyObject*)&PyDict_Type;
-  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_365 = PyInt_FromLong(365); if (unlikely(!__pyx_int_365)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_3286112 = PyInt_FromLong(3286112L); if (unlikely(!__pyx_int_3286112)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_12852504 = PyInt_FromLong(12852504L); if (unlikely(!__pyx_int_12852504)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_33088255 = PyInt_FromLong(33088255L); if (unlikely(!__pyx_int_33088255)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_62323177 = PyInt_FromLong(62323177L); if (unlikely(!__pyx_int_62323177)) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -22228,101 +22228,101 @@
   __pyx_vtable_10blacksheep_8messages_Message.remove_headers = (void (*)(struct __pyx_obj_10blacksheep_8messages_Message *, PyObject *))__pyx_f_10blacksheep_8messages_7Message_remove_headers;
   __pyx_vtable_10blacksheep_8messages_Message.get_headers_tuples = (PyObject *(*)(struct __pyx_obj_10blacksheep_8messages_Message *, PyObject *))__pyx_f_10blacksheep_8messages_7Message_get_headers_tuples;
   __pyx_vtable_10blacksheep_8messages_Message.with_content = (struct __pyx_obj_10blacksheep_8messages_Message *(*)(struct __pyx_obj_10blacksheep_8messages_Message *, struct __pyx_obj_10blacksheep_8contents_Content *, int __pyx_skip_dispatch))__pyx_f_10blacksheep_8messages_7Message_with_content;
   __pyx_vtable_10blacksheep_8messages_Message.has_body = (int (*)(struct __pyx_obj_10blacksheep_8messages_Message *, int __pyx_skip_dispatch))__pyx_f_10blacksheep_8messages_7Message_has_body;
   __pyx_vtable_10blacksheep_8messages_Message.declares_content_type = (int (*)(struct __pyx_obj_10blacksheep_8messages_Message *, PyObject *, int __pyx_skip_dispatch))__pyx_f_10blacksheep_8messages_7Message_declares_content_type;
   __pyx_vtable_10blacksheep_8messages_Message.declares_json = (int (*)(struct __pyx_obj_10blacksheep_8messages_Message *, int __pyx_skip_dispatch))__pyx_f_10blacksheep_8messages_7Message_declares_json;
   __pyx_vtable_10blacksheep_8messages_Message.declares_xml = (int (*)(struct __pyx_obj_10blacksheep_8messages_Message *, int __pyx_skip_dispatch))__pyx_f_10blacksheep_8messages_7Message_declares_xml;
-  if (PyType_Ready(&__pyx_type_10blacksheep_8messages_Message) < 0) __PYX_ERR(0, 32, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10blacksheep_8messages_Message) < 0) __PYX_ERR(0, 29, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_8messages_Message.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10blacksheep_8messages_Message.tp_dictoffset && __pyx_type_10blacksheep_8messages_Message.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10blacksheep_8messages_Message.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_10blacksheep_8messages_Message.tp_dict, __pyx_vtabptr_10blacksheep_8messages_Message) < 0) __PYX_ERR(0, 32, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Message, (PyObject *)&__pyx_type_10blacksheep_8messages_Message) < 0) __PYX_ERR(0, 32, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_10blacksheep_8messages_Message.tp_dict, __pyx_vtabptr_10blacksheep_8messages_Message) < 0) __PYX_ERR(0, 29, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Message, (PyObject *)&__pyx_type_10blacksheep_8messages_Message) < 0) __PYX_ERR(0, 29, __pyx_L1_error)
   if (__pyx_type_10blacksheep_8messages_Message.tp_weaklistoffset == 0) __pyx_type_10blacksheep_8messages_Message.tp_weaklistoffset = offsetof(struct __pyx_obj_10blacksheep_8messages_Message, __weakref__);
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_10blacksheep_8messages_Message) < 0) __PYX_ERR(0, 32, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_10blacksheep_8messages_Message) < 0) __PYX_ERR(0, 29, __pyx_L1_error)
   __pyx_ptype_10blacksheep_8messages_Message = &__pyx_type_10blacksheep_8messages_Message;
   __pyx_vtabptr_10blacksheep_8messages_Request = &__pyx_vtable_10blacksheep_8messages_Request;
   __pyx_vtable_10blacksheep_8messages_Request.__pyx_base = *__pyx_vtabptr_10blacksheep_8messages_Message;
   __pyx_vtable_10blacksheep_8messages_Request.expect_100_continue = (int (*)(struct __pyx_obj_10blacksheep_8messages_Request *, int __pyx_skip_dispatch))__pyx_f_10blacksheep_8messages_7Request_expect_100_continue;
   __pyx_type_10blacksheep_8messages_Request.tp_base = __pyx_ptype_10blacksheep_8messages_Message;
-  if (PyType_Ready(&__pyx_type_10blacksheep_8messages_Request) < 0) __PYX_ERR(0, 264, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10blacksheep_8messages_Request) < 0) __PYX_ERR(0, 261, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_8messages_Request.tp_print = 0;
   #endif
-  if (__Pyx_SetVtable(__pyx_type_10blacksheep_8messages_Request.tp_dict, __pyx_vtabptr_10blacksheep_8messages_Request) < 0) __PYX_ERR(0, 264, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Request_2, (PyObject *)&__pyx_type_10blacksheep_8messages_Request) < 0) __PYX_ERR(0, 264, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_10blacksheep_8messages_Request.tp_dict, __pyx_vtabptr_10blacksheep_8messages_Request) < 0) __PYX_ERR(0, 261, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Request_2, (PyObject *)&__pyx_type_10blacksheep_8messages_Request) < 0) __PYX_ERR(0, 261, __pyx_L1_error)
   if (__pyx_type_10blacksheep_8messages_Request.tp_weaklistoffset == 0) __pyx_type_10blacksheep_8messages_Request.tp_weaklistoffset = offsetof(struct __pyx_obj_10blacksheep_8messages_Request, __pyx_base.__weakref__);
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_10blacksheep_8messages_Request) < 0) __PYX_ERR(0, 264, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_10blacksheep_8messages_Request) < 0) __PYX_ERR(0, 261, __pyx_L1_error)
   __pyx_ptype_10blacksheep_8messages_Request = &__pyx_type_10blacksheep_8messages_Request;
   __pyx_vtabptr_10blacksheep_8messages_Response = &__pyx_vtable_10blacksheep_8messages_Response;
   __pyx_vtable_10blacksheep_8messages_Response.__pyx_base = *__pyx_vtabptr_10blacksheep_8messages_Message;
   __pyx_vtable_10blacksheep_8messages_Response.is_redirect = (int (*)(struct __pyx_obj_10blacksheep_8messages_Response *, int __pyx_skip_dispatch))__pyx_f_10blacksheep_8messages_8Response_is_redirect;
   __pyx_type_10blacksheep_8messages_Response.tp_base = __pyx_ptype_10blacksheep_8messages_Message;
-  if (PyType_Ready(&__pyx_type_10blacksheep_8messages_Response) < 0) __PYX_ERR(0, 488, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10blacksheep_8messages_Response) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_8messages_Response.tp_print = 0;
   #endif
-  if (__Pyx_SetVtable(__pyx_type_10blacksheep_8messages_Response.tp_dict, __pyx_vtabptr_10blacksheep_8messages_Response) < 0) __PYX_ERR(0, 488, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Response_2, (PyObject *)&__pyx_type_10blacksheep_8messages_Response) < 0) __PYX_ERR(0, 488, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_10blacksheep_8messages_Response.tp_dict, __pyx_vtabptr_10blacksheep_8messages_Response) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Response_2, (PyObject *)&__pyx_type_10blacksheep_8messages_Response) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   if (__pyx_type_10blacksheep_8messages_Response.tp_weaklistoffset == 0) __pyx_type_10blacksheep_8messages_Response.tp_weaklistoffset = offsetof(struct __pyx_obj_10blacksheep_8messages_Response, __pyx_base.__weakref__);
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_10blacksheep_8messages_Response) < 0) __PYX_ERR(0, 488, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_10blacksheep_8messages_Response) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __pyx_ptype_10blacksheep_8messages_Response = &__pyx_type_10blacksheep_8messages_Response;
-  if (PyType_Ready(&__pyx_type_10blacksheep_8messages___pyx_scope_struct__read) < 0) __PYX_ERR(0, 128, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10blacksheep_8messages___pyx_scope_struct__read) < 0) __PYX_ERR(0, 125, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_8messages___pyx_scope_struct__read.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10blacksheep_8messages___pyx_scope_struct__read.tp_dictoffset && __pyx_type_10blacksheep_8messages___pyx_scope_struct__read.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10blacksheep_8messages___pyx_scope_struct__read.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10blacksheep_8messages___pyx_scope_struct__read = &__pyx_type_10blacksheep_8messages___pyx_scope_struct__read;
-  if (PyType_Ready(&__pyx_type_10blacksheep_8messages___pyx_scope_struct_1_stream) < 0) __PYX_ERR(0, 134, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10blacksheep_8messages___pyx_scope_struct_1_stream) < 0) __PYX_ERR(0, 131, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_8messages___pyx_scope_struct_1_stream.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10blacksheep_8messages___pyx_scope_struct_1_stream.tp_dictoffset && __pyx_type_10blacksheep_8messages___pyx_scope_struct_1_stream.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10blacksheep_8messages___pyx_scope_struct_1_stream.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10blacksheep_8messages___pyx_scope_struct_1_stream = &__pyx_type_10blacksheep_8messages___pyx_scope_struct_1_stream;
-  if (PyType_Ready(&__pyx_type_10blacksheep_8messages___pyx_scope_struct_2_text) < 0) __PYX_ERR(0, 141, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10blacksheep_8messages___pyx_scope_struct_2_text) < 0) __PYX_ERR(0, 138, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_8messages___pyx_scope_struct_2_text.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10blacksheep_8messages___pyx_scope_struct_2_text.tp_dictoffset && __pyx_type_10blacksheep_8messages___pyx_scope_struct_2_text.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10blacksheep_8messages___pyx_scope_struct_2_text.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10blacksheep_8messages___pyx_scope_struct_2_text = &__pyx_type_10blacksheep_8messages___pyx_scope_struct_2_text;
-  if (PyType_Ready(&__pyx_type_10blacksheep_8messages___pyx_scope_struct_3_form) < 0) __PYX_ERR(0, 159, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10blacksheep_8messages___pyx_scope_struct_3_form) < 0) __PYX_ERR(0, 156, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_8messages___pyx_scope_struct_3_form.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10blacksheep_8messages___pyx_scope_struct_3_form.tp_dictoffset && __pyx_type_10blacksheep_8messages___pyx_scope_struct_3_form.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10blacksheep_8messages___pyx_scope_struct_3_form.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10blacksheep_8messages___pyx_scope_struct_3_form = &__pyx_type_10blacksheep_8messages___pyx_scope_struct_3_form;
-  if (PyType_Ready(&__pyx_type_10blacksheep_8messages___pyx_scope_struct_4_multipart) < 0) __PYX_ERR(0, 176, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10blacksheep_8messages___pyx_scope_struct_4_multipart) < 0) __PYX_ERR(0, 173, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_8messages___pyx_scope_struct_4_multipart.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10blacksheep_8messages___pyx_scope_struct_4_multipart.tp_dictoffset && __pyx_type_10blacksheep_8messages___pyx_scope_struct_4_multipart.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10blacksheep_8messages___pyx_scope_struct_4_multipart.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10blacksheep_8messages___pyx_scope_struct_4_multipart = &__pyx_type_10blacksheep_8messages___pyx_scope_struct_4_multipart;
-  if (PyType_Ready(&__pyx_type_10blacksheep_8messages___pyx_scope_struct_5_files) < 0) __PYX_ERR(0, 205, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10blacksheep_8messages___pyx_scope_struct_5_files) < 0) __PYX_ERR(0, 202, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_8messages___pyx_scope_struct_5_files.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10blacksheep_8messages___pyx_scope_struct_5_files.tp_dictoffset && __pyx_type_10blacksheep_8messages___pyx_scope_struct_5_files.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10blacksheep_8messages___pyx_scope_struct_5_files.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10blacksheep_8messages___pyx_scope_struct_5_files = &__pyx_type_10blacksheep_8messages___pyx_scope_struct_5_files;
-  if (PyType_Ready(&__pyx_type_10blacksheep_8messages___pyx_scope_struct_6_json) < 0) __PYX_ERR(0, 218, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10blacksheep_8messages___pyx_scope_struct_6_json) < 0) __PYX_ERR(0, 215, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10blacksheep_8messages___pyx_scope_struct_6_json.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10blacksheep_8messages___pyx_scope_struct_6_json.tp_dictoffset && __pyx_type_10blacksheep_8messages___pyx_scope_struct_6_json.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10blacksheep_8messages___pyx_scope_struct_6_json.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10blacksheep_8messages___pyx_scope_struct_6_json = &__pyx_type_10blacksheep_8messages___pyx_scope_struct_6_json;
@@ -22339,92 +22339,117 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule("blacksheep.contents"); if (unlikely(!__pyx_t_1)) __PYX_ERR(4, 8, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_8contents_Content = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "Content", sizeof(struct __pyx_obj_10blacksheep_8contents_Content), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_Content = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "Content", sizeof(struct __pyx_obj_10blacksheep_8contents_Content), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_Content),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_Content) __PYX_ERR(4, 8, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_StreamedContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "StreamedContent", sizeof(struct __pyx_obj_10blacksheep_8contents_StreamedContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_StreamedContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "StreamedContent", sizeof(struct __pyx_obj_10blacksheep_8contents_StreamedContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_StreamedContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_StreamedContent) __PYX_ERR(4, 14, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_ASGIContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "ASGIContent", sizeof(struct __pyx_obj_10blacksheep_8contents_ASGIContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_ASGIContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "ASGIContent", sizeof(struct __pyx_obj_10blacksheep_8contents_ASGIContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_ASGIContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_ASGIContent) __PYX_ERR(4, 18, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_8contents_ASGIContent = (struct __pyx_vtabstruct_10blacksheep_8contents_ASGIContent*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_8contents_ASGIContent->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_8contents_ASGIContent)) __PYX_ERR(4, 18, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_TextContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "TextContent", sizeof(struct __pyx_obj_10blacksheep_8contents_TextContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_TextContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "TextContent", sizeof(struct __pyx_obj_10blacksheep_8contents_TextContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_TextContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_TextContent) __PYX_ERR(4, 23, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_HTMLContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "HTMLContent", sizeof(struct __pyx_obj_10blacksheep_8contents_HTMLContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_HTMLContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "HTMLContent", sizeof(struct __pyx_obj_10blacksheep_8contents_HTMLContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_HTMLContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_HTMLContent) __PYX_ERR(4, 27, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_JSONContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "JSONContent", sizeof(struct __pyx_obj_10blacksheep_8contents_JSONContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_JSONContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "JSONContent", sizeof(struct __pyx_obj_10blacksheep_8contents_JSONContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_JSONContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_JSONContent) __PYX_ERR(4, 31, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_FormContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "FormContent", sizeof(struct __pyx_obj_10blacksheep_8contents_FormContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_FormContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "FormContent", sizeof(struct __pyx_obj_10blacksheep_8contents_FormContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_FormContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_FormContent) __PYX_ERR(4, 35, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_FormPart = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "FormPart", sizeof(struct __pyx_obj_10blacksheep_8contents_FormPart), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_FormPart = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "FormPart", sizeof(struct __pyx_obj_10blacksheep_8contents_FormPart), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_FormPart),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_FormPart) __PYX_ERR(4, 39, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_MultiPartFormData = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "MultiPartFormData", sizeof(struct __pyx_obj_10blacksheep_8contents_MultiPartFormData), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_MultiPartFormData = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "MultiPartFormData", sizeof(struct __pyx_obj_10blacksheep_8contents_MultiPartFormData), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_MultiPartFormData),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_MultiPartFormData) __PYX_ERR(4, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(5, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyHeapTypeObject),
   #endif
   __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(5, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("datetime"); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_8datetime_date = __Pyx_ImportType(__pyx_t_1, "datetime", "date", sizeof(PyDateTime_Date), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_date = __Pyx_ImportType(__pyx_t_1, "datetime", "date", sizeof(PyDateTime_Date), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_Date),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_date) __PYX_ERR(3, 9, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_time = __Pyx_ImportType(__pyx_t_1, "datetime", "time", sizeof(PyDateTime_Time), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_time = __Pyx_ImportType(__pyx_t_1, "datetime", "time", sizeof(PyDateTime_Time), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_Time),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_time) __PYX_ERR(3, 12, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_datetime = __Pyx_ImportType(__pyx_t_1, "datetime", "datetime", sizeof(PyDateTime_DateTime), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_datetime = __Pyx_ImportType(__pyx_t_1, "datetime", "datetime", sizeof(PyDateTime_DateTime), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_DateTime),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_datetime) __PYX_ERR(3, 15, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_timedelta = __Pyx_ImportType(__pyx_t_1, "datetime", "timedelta", sizeof(PyDateTime_Delta), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_timedelta = __Pyx_ImportType(__pyx_t_1, "datetime", "timedelta", sizeof(PyDateTime_Delta), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_Delta),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_timedelta) __PYX_ERR(3, 18, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_tzinfo = __Pyx_ImportType(__pyx_t_1, "datetime", "tzinfo", sizeof(PyDateTime_TZInfo), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_tzinfo = __Pyx_ImportType(__pyx_t_1, "datetime", "tzinfo", sizeof(PyDateTime_TZInfo), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_TZInfo),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_tzinfo) __PYX_ERR(3, 21, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("blacksheep.cookies"); if (unlikely(!__pyx_t_1)) __PYX_ERR(6, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_7cookies_Cookie = __Pyx_ImportType(__pyx_t_1, "blacksheep.cookies", "Cookie", sizeof(struct __pyx_obj_10blacksheep_7cookies_Cookie), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_7cookies_Cookie = __Pyx_ImportType(__pyx_t_1, "blacksheep.cookies", "Cookie", sizeof(struct __pyx_obj_10blacksheep_7cookies_Cookie), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_7cookies_Cookie),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_7cookies_Cookie) __PYX_ERR(6, 17, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_7cookies_Cookie = (struct __pyx_vtabstruct_10blacksheep_7cookies_Cookie*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_7cookies_Cookie->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_7cookies_Cookie)) __PYX_ERR(6, 17, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("blacksheep.exceptions"); if (unlikely(!__pyx_t_1)) __PYX_ERR(7, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_10exceptions_MessageAborted = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "MessageAborted", sizeof(struct __pyx_obj_10blacksheep_10exceptions_MessageAborted), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_MessageAborted = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "MessageAborted", sizeof(struct __pyx_obj_10blacksheep_10exceptions_MessageAborted), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_MessageAborted),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_MessageAborted) __PYX_ERR(7, 4, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_HTTPException = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "HTTPException", sizeof(struct __pyx_obj_10blacksheep_10exceptions_HTTPException), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_HTTPException = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "HTTPException", sizeof(struct __pyx_obj_10blacksheep_10exceptions_HTTPException), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_HTTPException),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_HTTPException) __PYX_ERR(7, 8, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_BadRequest = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequest", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequest), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_BadRequest = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequest", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequest), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_BadRequest),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_BadRequest) __PYX_ERR(7, 12, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_BadRequestFormat = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequestFormat", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_BadRequestFormat = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequestFormat", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_BadRequestFormat) __PYX_ERR(7, 16, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_NotFound = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "NotFound", sizeof(struct __pyx_obj_10blacksheep_10exceptions_NotFound), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_NotFound = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "NotFound", sizeof(struct __pyx_obj_10blacksheep_10exceptions_NotFound), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_NotFound),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_NotFound) __PYX_ERR(7, 20, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_InvalidArgument = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidArgument", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidArgument), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_InvalidArgument = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidArgument", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidArgument), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_InvalidArgument),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_InvalidArgument) __PYX_ERR(7, 24, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_InvalidOperation = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidOperation", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidOperation), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_InvalidOperation = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidOperation", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidOperation), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_InvalidOperation),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_InvalidOperation) __PYX_ERR(7, 28, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("blacksheep.url"); if (unlikely(!__pyx_t_1)) __PYX_ERR(8, 8, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_3url_URL = __Pyx_ImportType(__pyx_t_1, "blacksheep.url", "URL", sizeof(struct __pyx_obj_10blacksheep_3url_URL), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_3url_URL = __Pyx_ImportType(__pyx_t_1, "blacksheep.url", "URL", sizeof(struct __pyx_obj_10blacksheep_3url_URL), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_3url_URL),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_3url_URL) __PYX_ERR(8, 8, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_3url_URL = (struct __pyx_vtabstruct_10blacksheep_3url_URL*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_3url_URL->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_3url_URL)) __PYX_ERR(8, 8, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("blacksheep.headers"); if (unlikely(!__pyx_t_1)) __PYX_ERR(9, 8, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_7headers_Header = __Pyx_ImportType(__pyx_t_1, "blacksheep.headers", "Header", sizeof(struct __pyx_obj_10blacksheep_7headers_Header), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_7headers_Header = __Pyx_ImportType(__pyx_t_1, "blacksheep.headers", "Header", sizeof(struct __pyx_obj_10blacksheep_7headers_Header), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_7headers_Header),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_7headers_Header) __PYX_ERR(9, 8, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_7headers_Headers = __Pyx_ImportType(__pyx_t_1, "blacksheep.headers", "Headers", sizeof(struct __pyx_obj_10blacksheep_7headers_Headers), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_7headers_Headers = __Pyx_ImportType(__pyx_t_1, "blacksheep.headers", "Headers", sizeof(struct __pyx_obj_10blacksheep_7headers_Headers), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_7headers_Headers),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_7headers_Headers) __PYX_ERR(9, 13, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_7headers_Headers = (struct __pyx_vtabstruct_10blacksheep_7headers_Headers*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_7headers_Headers->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_7headers_Headers)) __PYX_ERR(9, 13, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -22565,19 +22590,14 @@
 static CYTHON_SMALL_CODE int __pyx_pymod_exec_messages(PyObject *__pyx_pyinit_module)
 #endif
 #endif
 {
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
-  int __pyx_t_6;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   if (__pyx_m) {
     if (__pyx_m == __pyx_pyinit_module) return 0;
@@ -22641,15 +22661,15 @@
   #endif
   __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_d);
   __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_b);
   __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_cython_runtime);
-  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Initialize various global constants etc. ---*/
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   if (__pyx_module_is_main_blacksheep__messages) {
     if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name_2, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -22750,15 +22770,15 @@
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "blacksheep/messages.pyx":5
  * from datetime import datetime, timedelta
  * from json.decoder import JSONDecodeError
  * from urllib.parse import parse_qs, quote, unquote, urlencode             # <<<<<<<<<<<<<<
  * 
- * try:
+ * import charset_normalizer
  */
   __pyx_t_1 = PyList_New(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_n_s_parse_qs);
   __Pyx_GIVEREF(__pyx_n_s_parse_qs);
   PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_parse_qs);
   __Pyx_INCREF(__pyx_n_s_quote);
@@ -22790,301 +22810,214 @@
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_urlencode, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "blacksheep/messages.pyx":7
  * from urllib.parse import parse_qs, quote, unquote, urlencode
  * 
- * try:             # <<<<<<<<<<<<<<
- *     import cchardet as chardet
- * except ImportError:
- */
-  {
-    __Pyx_PyThreadState_declare
-    __Pyx_PyThreadState_assign
-    __Pyx_ExceptionSave(&__pyx_t_3, &__pyx_t_4, &__pyx_t_5);
-    __Pyx_XGOTREF(__pyx_t_3);
-    __Pyx_XGOTREF(__pyx_t_4);
-    __Pyx_XGOTREF(__pyx_t_5);
-    /*try:*/ {
-
-      /* "blacksheep/messages.pyx":8
- * 
- * try:
- *     import cchardet as chardet             # <<<<<<<<<<<<<<
- * except ImportError:
- *     import chardet
- */
-      __pyx_t_2 = __Pyx_Import(__pyx_n_s_cchardet, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 8, __pyx_L2_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      if (PyDict_SetItem(__pyx_d, __pyx_n_s_chardet, __pyx_t_2) < 0) __PYX_ERR(0, 8, __pyx_L2_error)
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-
-      /* "blacksheep/messages.pyx":7
- * from urllib.parse import parse_qs, quote, unquote, urlencode
- * 
- * try:             # <<<<<<<<<<<<<<
- *     import cchardet as chardet
- * except ImportError:
- */
-    }
-    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    goto __pyx_L7_try_end;
-    __pyx_L2_error:;
-    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-
-    /* "blacksheep/messages.pyx":9
- * try:
- *     import cchardet as chardet
- * except ImportError:             # <<<<<<<<<<<<<<
- *     import chardet
- * 
- */
-    __pyx_t_6 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_ImportError);
-    if (__pyx_t_6) {
-      __Pyx_AddTraceback("blacksheep.messages", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_2, &__pyx_t_1, &__pyx_t_7) < 0) __PYX_ERR(0, 9, __pyx_L4_except_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_GOTREF(__pyx_t_1);
-      __Pyx_GOTREF(__pyx_t_7);
-
-      /* "blacksheep/messages.pyx":10
- *     import cchardet as chardet
- * except ImportError:
- *     import chardet             # <<<<<<<<<<<<<<
+ * import charset_normalizer             # <<<<<<<<<<<<<<
  * 
  * from blacksheep.multipart import parse_multipart
  */
-      __pyx_t_8 = __Pyx_Import(__pyx_n_s_chardet, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 10, __pyx_L4_except_error)
-      __Pyx_GOTREF(__pyx_t_8);
-      if (PyDict_SetItem(__pyx_d, __pyx_n_s_chardet, __pyx_t_8) < 0) __PYX_ERR(0, 10, __pyx_L4_except_error)
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-      goto __pyx_L3_exception_handled;
-    }
-    goto __pyx_L4_except_error;
-    __pyx_L4_except_error:;
-
-    /* "blacksheep/messages.pyx":7
- * from urllib.parse import parse_qs, quote, unquote, urlencode
- * 
- * try:             # <<<<<<<<<<<<<<
- *     import cchardet as chardet
- * except ImportError:
- */
-    __Pyx_XGIVEREF(__pyx_t_3);
-    __Pyx_XGIVEREF(__pyx_t_4);
-    __Pyx_XGIVEREF(__pyx_t_5);
-    __Pyx_ExceptionReset(__pyx_t_3, __pyx_t_4, __pyx_t_5);
-    goto __pyx_L1_error;
-    __pyx_L3_exception_handled:;
-    __Pyx_XGIVEREF(__pyx_t_3);
-    __Pyx_XGIVEREF(__pyx_t_4);
-    __Pyx_XGIVEREF(__pyx_t_5);
-    __Pyx_ExceptionReset(__pyx_t_3, __pyx_t_4, __pyx_t_5);
-    __pyx_L7_try_end:;
-  }
+  __pyx_t_2 = __Pyx_Import(__pyx_n_s_charset_normalizer, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 7, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_charset_normalizer, __pyx_t_2) < 0) __PYX_ERR(0, 7, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "blacksheep/messages.pyx":12
- *     import chardet
+  /* "blacksheep/messages.pyx":9
+ * import charset_normalizer
  * 
  * from blacksheep.multipart import parse_multipart             # <<<<<<<<<<<<<<
  * from blacksheep.sessions import Session
  * from blacksheep.settings.json import json_settings
  */
-  __pyx_t_7 = PyList_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 12, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_7);
+  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 9, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(__pyx_n_s_parse_multipart);
   __Pyx_GIVEREF(__pyx_n_s_parse_multipart);
-  PyList_SET_ITEM(__pyx_t_7, 0, __pyx_n_s_parse_multipart);
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_blacksheep_multipart, __pyx_t_7, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 12, __pyx_L1_error)
+  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_parse_multipart);
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_blacksheep_multipart, __pyx_t_2, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_ImportFrom(__pyx_t_1, __pyx_n_s_parse_multipart); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 12, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_7);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_parse_multipart, __pyx_t_7) < 0) __PYX_ERR(0, 12, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_1, __pyx_n_s_parse_multipart); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 9, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_parse_multipart, __pyx_t_2) < 0) __PYX_ERR(0, 9, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":13
+  /* "blacksheep/messages.pyx":10
  * 
  * from blacksheep.multipart import parse_multipart
  * from blacksheep.sessions import Session             # <<<<<<<<<<<<<<
  * from blacksheep.settings.json import json_settings
  * 
  */
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 13, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 10, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_n_s_Session);
   __Pyx_GIVEREF(__pyx_n_s_Session);
   PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_Session);
-  __pyx_t_7 = __Pyx_Import(__pyx_n_s_blacksheep_sessions, __pyx_t_1, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 13, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_7);
+  __pyx_t_2 = __Pyx_Import(__pyx_n_s_blacksheep_sessions, __pyx_t_1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 10, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_7, __pyx_n_s_Session); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 13, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_Session); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 10, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_Session, __pyx_t_1) < 0) __PYX_ERR(0, 13, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_Session, __pyx_t_1) < 0) __PYX_ERR(0, 10, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "blacksheep/messages.pyx":14
+  /* "blacksheep/messages.pyx":11
  * from blacksheep.multipart import parse_multipart
  * from blacksheep.sessions import Session
  * from blacksheep.settings.json import json_settings             # <<<<<<<<<<<<<<
  * 
  * from .contents cimport Content, multiparts_to_dictionary, parse_www_form_urlencoded
  */
-  __pyx_t_7 = PyList_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 14, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_7);
+  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 11, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(__pyx_n_s_json_settings);
   __Pyx_GIVEREF(__pyx_n_s_json_settings);
-  PyList_SET_ITEM(__pyx_t_7, 0, __pyx_n_s_json_settings);
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_blacksheep_settings_json, __pyx_t_7, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
+  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_json_settings);
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_blacksheep_settings_json, __pyx_t_2, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 11, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_ImportFrom(__pyx_t_1, __pyx_n_s_json_settings); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 14, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_7);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_json_settings, __pyx_t_7) < 0) __PYX_ERR(0, 14, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_1, __pyx_n_s_json_settings); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 11, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_json_settings, __pyx_t_2) < 0) __PYX_ERR(0, 11, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":22
+  /* "blacksheep/messages.pyx":19
  * from .url cimport URL, build_absolute_url
  * 
  * _charset_rx = re.compile(b'charset=([^;]+)\\s', re.I)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_re); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_re); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_compile); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 22, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_7);
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_compile); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 19, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_re); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_re); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_I); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 22, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_I); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 19, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_kp_b_charset_s);
   __Pyx_GIVEREF(__pyx_kp_b_charset_s);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_b_charset_s);
-  __Pyx_GIVEREF(__pyx_t_2);
-  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 22, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_charset_rx, __pyx_t_2) < 0) __PYX_ERR(0, 22, __pyx_L1_error)
+  __Pyx_GIVEREF(__pyx_t_3);
+  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3);
+  __pyx_t_3 = 0;
+  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 19, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_charset_rx, __pyx_t_3) < 0) __PYX_ERR(0, 19, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "blacksheep/messages.pyx":218
+  /* "blacksheep/messages.pyx":215
  *         return [part for part in data if part.file_name]
  * 
  *     async def json(self, loads=json_settings.loads):             # <<<<<<<<<<<<<<
  *         if not self.declares_json():
  *             return None
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_json_settings); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 218, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_loads); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 218, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_json_settings); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 215, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_loads); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 215, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_k__4 = __pyx_t_1;
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "blacksheep/messages.pyx":369
+  /* "blacksheep/messages.pyx":366
  * 
  *     @classmethod
  *     def incoming(cls, str method, bytes path, bytes query, list headers):             # <<<<<<<<<<<<<<
  *         request = cls(method, None, headers)
  *         request._path = path
  */
-  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_10blacksheep_8messages_Request, __pyx_n_s_incoming); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 369, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_10blacksheep_8messages_Request, __pyx_n_s_incoming); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 366, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
 
-  /* "blacksheep/messages.pyx":368
+  /* "blacksheep/messages.pyx":365
  *         self._session = value
  * 
  *     @classmethod             # <<<<<<<<<<<<<<
  *     def incoming(cls, str method, bytes path, bytes query, list headers):
  *         request = cls(method, None, headers)
  */
-  __pyx_t_2 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 368, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 365, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_10blacksheep_8messages_Request->tp_dict, __pyx_n_s_incoming, __pyx_t_2) < 0) __PYX_ERR(0, 369, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_10blacksheep_8messages_Request->tp_dict, __pyx_n_s_incoming, __pyx_t_3) < 0) __PYX_ERR(0, 366, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   PyType_Modified(__pyx_ptype_10blacksheep_8messages_Request);
 
   /* "(tree fragment)":1
  * def __pyx_unpickle_Message(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  */
-  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_10blacksheep_8messages_13__pyx_unpickle_Message, NULL, __pyx_n_s_blacksheep_messages); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_Message, __pyx_t_2) < 0) __PYX_ERR(2, 1, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_3 = PyCFunction_NewEx(&__pyx_mdef_10blacksheep_8messages_13__pyx_unpickle_Message, NULL, __pyx_n_s_blacksheep_messages); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_Message, __pyx_t_3) < 0) __PYX_ERR(2, 1, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
   /* "(tree fragment)":11
  *         __pyx_unpickle_Message__set_state(<Message> __pyx_result, __pyx_state)
  *     return __pyx_result
  * cdef __pyx_unpickle_Message__set_state(Message __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
  *     __pyx_result.__headers = __pyx_state[0]; __pyx_result.content = __pyx_state[1]
  *     if len(__pyx_state) > 2 and hasattr(__pyx_result, '__dict__'):
  */
-  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_10blacksheep_8messages_15__pyx_unpickle_Request, NULL, __pyx_n_s_blacksheep_messages); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_Request, __pyx_t_2) < 0) __PYX_ERR(2, 1, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_3 = PyCFunction_NewEx(&__pyx_mdef_10blacksheep_8messages_15__pyx_unpickle_Request, NULL, __pyx_n_s_blacksheep_messages); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_Request, __pyx_t_3) < 0) __PYX_ERR(2, 1, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
   /* "(tree fragment)":1
  * def __pyx_unpickle_Response(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  */
-  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_10blacksheep_8messages_17__pyx_unpickle_Response, NULL, __pyx_n_s_blacksheep_messages); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_Response, __pyx_t_2) < 0) __PYX_ERR(2, 1, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_3 = PyCFunction_NewEx(&__pyx_mdef_10blacksheep_8messages_17__pyx_unpickle_Response, NULL, __pyx_n_s_blacksheep_messages); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_Response, __pyx_t_3) < 0) __PYX_ERR(2, 1, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
   /* "blacksheep/messages.pyx":1
  * import http             # <<<<<<<<<<<<<<
  * import re
  * from datetime import datetime, timedelta
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_3) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
   /* "cpython/datetime.pxd":211
  * 
  * # Get microseconds of timedelta
  * cdef inline int timedelta_microseconds(object o):             # <<<<<<<<<<<<<<
  *     return (<PyDateTime_Delta*>o).microseconds
  */
 
   /*--- Wrapped vars code ---*/
 
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_XDECREF(__pyx_t_3);
   if (__pyx_m) {
     if (__pyx_d) {
       __Pyx_AddTraceback("init blacksheep.messages", __pyx_clineno, __pyx_lineno, __pyx_filename);
     }
     Py_CLEAR(__pyx_m);
   } else if (!PyErr_Occurred()) {
     PyErr_SetString(PyExc_ImportError, "init blacksheep.messages");
@@ -23788,15 +23721,15 @@
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
 #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(func)) {
         return __Pyx_PyFunction_FastCall(func, NULL, 0);
     }
 #endif
-#ifdef __Pyx_CyFunction_USED
+#if defined(__Pyx_CyFunction_USED) && defined(NDEBUG)
     if (likely(PyCFunction_Check(func) || __Pyx_CyFunction_Check(func)))
 #else
     if (likely(PyCFunction_Check(func)))
 #endif
     {
         if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
             return __Pyx_PyObject_CallMethO(func, NULL);
@@ -24010,28 +23943,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -24043,17 +23976,15 @@
     PyObject *old_exc, *old_val, *old_tb;
     PyObject *ctx;
     __Pyx_PyThreadState_declare
 #ifdef WITH_THREAD
     PyGILState_STATE state;
     if (nogil)
         state = PyGILState_Ensure();
-#ifdef _MSC_VER
-    else state = (PyGILState_STATE)-1;
-#endif
+    else state = (PyGILState_STATE)0;
 #endif
     __Pyx_PyThreadState_assign
     __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
     if (full_traceback) {
         Py_XINCREF(old_exc);
         Py_XINCREF(old_val);
         Py_XINCREF(old_tb);
@@ -24128,18 +24059,16 @@
 
 /* UnpackItemEndCheck */
 static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected) {
     if (unlikely(retval)) {
         Py_DECREF(retval);
         __Pyx_RaiseTooManyValuesError(expected);
         return -1;
-    } else {
-        return __Pyx_IterFinish();
     }
-    return 0;
+    return __Pyx_IterFinish();
 }
 
 /* FetchCommonType */
 static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type) {
     PyObject* fake_module;
     PyTypeObject* cached_type = NULL;
     fake_module = PyImport_AddModule((char*) "_cython_" CYTHON_ABI);
@@ -25642,15 +25571,19 @@
 #endif
 #if PY_VERSION_HEX >= 0x030500B2 || defined(PyCoro_CheckExact)
     if (PyCoro_CheckExact(obj)) {
         return __Pyx_NewRef(obj);
     } else
 #endif
 #if CYTHON_COMPILING_IN_CPYTHON && defined(CO_ITERABLE_COROUTINE)
+#if PY_VERSION_HEX >= 0x030C00A6
+    if (PyGen_CheckExact(obj) && (PyGen_GetCode(obj)->co_flags & CO_ITERABLE_COROUTINE)) {
+#else
     if (PyGen_CheckExact(obj) && ((PyGenObject*)obj)->gi_code && ((PyCodeObject *)((PyGenObject*)obj)->gi_code)->co_flags & CO_ITERABLE_COROUTINE) {
+#endif
         return __Pyx_NewRef(obj);
     } else
 #endif
     {
         PyObject *method = NULL;
         int is_method = __Pyx_PyObject_GetMethod(obj, __pyx_n_s_await, &method);
         if (likely(is_method)) {
@@ -25692,15 +25625,15 @@
                  "object %.100s can't be used in 'await' expression",
                  Py_TYPE(obj)->tp_name);
 bad:
     return NULL;
 }
 
 /* CoroutineYieldFrom */
-static PyObject* __Pyx__Coroutine_Yield_From_Generic(__pyx_CoroutineObject *gen, PyObject *source) {
+  static PyObject* __Pyx__Coroutine_Yield_From_Generic(__pyx_CoroutineObject *gen, PyObject *source) {
     PyObject *retval;
     PyObject *source_gen = __Pyx__Coroutine_GetAwaitableIter(source);
     if (unlikely(!source_gen)) {
         return NULL;
     }
     if (__Pyx_Coroutine_Check(source_gen)) {
         retval = __Pyx_Generator_Next(source_gen);
@@ -25739,15 +25672,15 @@
         Py_INCREF(source);
         gen->yieldfrom = source;
     }
     return retval;
 }
 
 /* ReturnWithStopIteration */
-static void __Pyx__ReturnWithStopIteration(PyObject* value) {
+  static void __Pyx__ReturnWithStopIteration(PyObject* value) {
     PyObject *exc, *args;
 #if CYTHON_COMPILING_IN_CPYTHON || CYTHON_COMPILING_IN_PYSTON
     __Pyx_PyThreadState_declare
     if ((PY_VERSION_HEX >= 0x03030000 && PY_VERSION_HEX < 0x030500B1)
             || unlikely(PyTuple_Check(value) || PyExceptionInstance_Check(value))) {
         args = PyTuple_New(1);
         if (unlikely(!args)) return;
@@ -25781,15 +25714,15 @@
     if (unlikely(!exc)) return;
 #endif
     PyErr_SetObject(PyExc_StopIteration, exc);
     Py_DECREF(exc);
 }
 
 /* PyObjectCallMethod0 */
-static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name) {
+  static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name) {
     PyObject *method = NULL, *result = NULL;
     int is_method = __Pyx_PyObject_GetMethod(obj, method_name, &method);
     if (likely(is_method)) {
         result = __Pyx_PyObject_CallOneArg(method, obj);
         Py_DECREF(method);
         return result;
     }
@@ -25797,15 +25730,15 @@
     result = __Pyx_PyObject_CallNoArg(method);
     Py_DECREF(method);
 bad:
     return result;
 }
 
 /* AsyncIter */
-static PyObject *__Pyx_Coroutine_GetAsyncIter_Generic(PyObject *obj) {
+  static PyObject *__Pyx_Coroutine_GetAsyncIter_Generic(PyObject *obj) {
 #if PY_VERSION_HEX < 0x030500B1
     {
         PyObject *iter = __Pyx_PyObject_CallMethod0(obj, __pyx_n_s_aiter);
         if (likely(iter))
             return iter;
         if (!PyErr_ExceptionMatches(PyExc_AttributeError))
             return NULL;
@@ -25860,15 +25793,15 @@
         }
     }
 #endif
     return __Pyx__Coroutine_AsyncIterNext(obj);
 }
 
 /* StopAsyncIteration */
-#if PY_VERSION_HEX < 0x030500B1
+  #if PY_VERSION_HEX < 0x030500B1
 static PyTypeObject __Pyx__PyExc_StopAsyncIteration_type = {
     PyVarObject_HEAD_INIT(0, 0)
     "StopAsyncIteration",
     sizeof(PyBaseExceptionObject),
     0,
     0,
     0,
@@ -25944,15 +25877,15 @@
     if (builtins && unlikely(PyMapping_SetItemString(builtins, (char*) "StopAsyncIteration", __Pyx_PyExc_StopAsyncIteration) < 0))
         return -1;
 #endif
     return 0;
 }
 
 /* PyErrExceptionMatches */
-#if CYTHON_FAST_THREAD_STATE
+  #if CYTHON_FAST_THREAD_STATE
 static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
     Py_ssize_t i, n;
     n = PyTuple_GET_SIZE(tuple);
 #if PY_MAJOR_VERSION >= 3
     for (i=0; i<n; i++) {
         if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
     }
@@ -25969,15 +25902,15 @@
     if (unlikely(PyTuple_Check(err)))
         return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
     return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
 }
 #endif
 
 /* GetException */
-#if CYTHON_FAST_THREAD_STATE
+  #if CYTHON_FAST_THREAD_STATE
 static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
 #else
 static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
 #endif
 {
     PyObject *local_type, *local_value, *local_tb;
 #if CYTHON_FAST_THREAD_STATE
@@ -26043,15 +25976,15 @@
     Py_XDECREF(local_type);
     Py_XDECREF(local_value);
     Py_XDECREF(local_tb);
     return -1;
 }
 
 /* UnicodeEquals */
-static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals) {
+  static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals) {
 #if CYTHON_COMPILING_IN_PYPY
     return PyObject_RichCompareBool(s1, s2, equals);
 #else
 #if PY_MAJOR_VERSION < 3
     PyObject* owned_ref = NULL;
 #endif
     int s1_is_unicode, s2_is_unicode;
@@ -26145,15 +26078,15 @@
     Py_XDECREF(owned_ref);
     #endif
     return (equals == Py_NE);
 #endif
 }
 
 /* FastTypeChecks */
-#if CYTHON_COMPILING_IN_CPYTHON
+  #if CYTHON_COMPILING_IN_CPYTHON
 static int __Pyx_InBases(PyTypeObject *a, PyTypeObject *b) {
     while (a) {
         a = a->tp_base;
         if (a == b)
             return 1;
     }
     return b == &PyBaseObject_Type;
@@ -26245,15 +26178,15 @@
         return __Pyx_inner_PyErr_GivenExceptionMatches2(err, exc_type1, exc_type2);
     }
     return (PyErr_GivenExceptionMatches(err, exc_type1) || PyErr_GivenExceptionMatches(err, exc_type2));
 }
 #endif
 
 /* decode_c_bytes */
-static CYTHON_INLINE PyObject* __Pyx_decode_c_bytes(
+  static CYTHON_INLINE PyObject* __Pyx_decode_c_bytes(
          const char* cstring, Py_ssize_t length, Py_ssize_t start, Py_ssize_t stop,
          const char* encoding, const char* errors,
          PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors)) {
     if (unlikely((start < 0) | (stop < 0))) {
         if (start < 0) {
             start += length;
             if (start < 0)
@@ -26272,15 +26205,15 @@
         return decode_func(cstring, length, errors);
     } else {
         return PyUnicode_Decode(cstring, length, encoding, errors);
     }
 }
 
 /* JoinPyUnicode */
-static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
+  static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
                                       CYTHON_UNUSED Py_UCS4 max_char) {
 #if CYTHON_USE_UNICODE_INTERNALS && CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     PyObject *result_uval;
     int result_ukind;
     Py_ssize_t i, char_pos;
     void *result_udata;
 #if CYTHON_PEP393_ENABLED
@@ -26334,68 +26267,68 @@
     result_ulength++;
     value_count++;
     return PyUnicode_Join(__pyx_empty_unicode, value_tuple);
 #endif
 }
 
 /* GetAttr */
-static CYTHON_INLINE PyObject *__Pyx_GetAttr(PyObject *o, PyObject *n) {
+  static CYTHON_INLINE PyObject *__Pyx_GetAttr(PyObject *o, PyObject *n) {
 #if CYTHON_USE_TYPE_SLOTS
 #if PY_MAJOR_VERSION >= 3
     if (likely(PyUnicode_Check(n)))
 #else
     if (likely(PyString_Check(n)))
 #endif
         return __Pyx_PyObject_GetAttrStr(o, n);
 #endif
     return PyObject_GetAttr(o, n);
 }
 
 /* GetAttr3 */
-static PyObject *__Pyx_GetAttr3Default(PyObject *d) {
+  static PyObject *__Pyx_GetAttr3Default(PyObject *d) {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     if (unlikely(!__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
         return NULL;
     __Pyx_PyErr_Clear();
     Py_INCREF(d);
     return d;
 }
 static CYTHON_INLINE PyObject *__Pyx_GetAttr3(PyObject *o, PyObject *n, PyObject *d) {
     PyObject *r = __Pyx_GetAttr(o, n);
     return (likely(r)) ? r : __Pyx_GetAttr3Default(d);
 }
 
 /* PyObjectSetAttrStr */
-#if CYTHON_USE_TYPE_SLOTS
+  #if CYTHON_USE_TYPE_SLOTS
 static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value) {
     PyTypeObject* tp = Py_TYPE(obj);
     if (likely(tp->tp_setattro))
         return tp->tp_setattro(obj, attr_name, value);
 #if PY_MAJOR_VERSION < 3
     if (likely(tp->tp_setattr))
         return tp->tp_setattr(obj, PyString_AS_STRING(attr_name), value);
 #endif
     return PyObject_SetAttr(obj, attr_name, value);
 }
 #endif
 
 /* CallUnboundCMethod1 */
-#if CYTHON_COMPILING_IN_CPYTHON
+  #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg) {
     if (likely(cfunc->func)) {
         int flag = cfunc->flag;
         if (flag == METH_O) {
             return (*(cfunc->func))(self, arg);
         } else if (PY_VERSION_HEX >= 0x030600B1 && flag == METH_FASTCALL) {
-            if (PY_VERSION_HEX >= 0x030700A0) {
+            #if PY_VERSION_HEX >= 0x030700A0
                 return (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)cfunc->func)(self, &arg, 1);
-            } else {
+            #else
                 return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
-            }
+            #endif
         } else if (PY_VERSION_HEX >= 0x030700A0 && flag == (METH_FASTCALL | METH_KEYWORDS)) {
             return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
         }
     }
     return __Pyx__CallUnboundCMethod1(cfunc, self, arg);
 }
 #endif
@@ -26428,15 +26361,15 @@
 #endif
 bad:
     Py_XDECREF(args);
     return result;
 }
 
 /* CallUnboundCMethod2 */
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030600B1
+  #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030600B1
 static CYTHON_INLINE PyObject *__Pyx_CallUnboundCMethod2(__Pyx_CachedCFunction *cfunc, PyObject *self, PyObject *arg1, PyObject *arg2) {
     if (likely(cfunc->func)) {
         PyObject *args[2] = {arg1, arg2};
         if (cfunc->flag == METH_FASTCALL) {
             #if PY_VERSION_HEX >= 0x030700A0
             return (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)cfunc->func)(self, args, 2);
             #else
@@ -26484,15 +26417,15 @@
 #endif
 bad:
     Py_XDECREF(args);
     return result;
 }
 
 /* dict_getitem_default */
-static PyObject* __Pyx_PyDict_GetItemDefault(PyObject* d, PyObject* key, PyObject* default_value) {
+  static PyObject* __Pyx_PyDict_GetItemDefault(PyObject* d, PyObject* key, PyObject* default_value) {
     PyObject* value;
 #if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY
     value = PyDict_GetItemWithError(d, key);
     if (unlikely(!value)) {
         if (unlikely(PyErr_Occurred()))
             return NULL;
         value = default_value;
@@ -26514,27 +26447,27 @@
         else
             value = __Pyx_CallUnboundCMethod2(&__pyx_umethod_PyDict_Type_get, d, key, default_value);
     }
     return value;
 }
 
 /* PyUnicode_Unicode */
-static CYTHON_INLINE PyObject* __Pyx_PyUnicode_Unicode(PyObject *obj) {
+  static CYTHON_INLINE PyObject* __Pyx_PyUnicode_Unicode(PyObject *obj) {
     if (unlikely(obj == Py_None))
         obj = __pyx_kp_u_None;
     return __Pyx_NewRef(obj);
 }
 
 /* RaiseNoneIterError */
-static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void) {
+  static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
 }
 
 /* CIntToDigits */
-static const char DIGIT_PAIRS_10[2*10*10+1] = {
+  static const char DIGIT_PAIRS_10[2*10*10+1] = {
     "00010203040506070809"
     "10111213141516171819"
     "20212223242526272829"
     "30313233343536373839"
     "40414243444546474849"
     "50515253545556575859"
     "60616263646566676869"
@@ -26554,15 +26487,15 @@
 };
 static const char DIGITS_HEX[2*16+1] = {
     "0123456789abcdef"
     "0123456789ABCDEF"
 };
 
 /* BuildPyUnicode */
-static PyObject* __Pyx_PyUnicode_BuildFromAscii(Py_ssize_t ulength, char* chars, int clength,
+  static PyObject* __Pyx_PyUnicode_BuildFromAscii(Py_ssize_t ulength, char* chars, int clength,
                                                 int prepend_sign, char padding_char) {
     PyObject *uval;
     Py_ssize_t uoffset = ulength - clength;
 #if CYTHON_USE_UNICODE_INTERNALS
     Py_ssize_t i;
 #if CYTHON_PEP393_ENABLED
     void *udata;
@@ -26628,15 +26561,15 @@
         Py_XDECREF(sign);
     }
 #endif
     return uval;
 }
 
 /* CIntToPyUnicode */
-static CYTHON_INLINE PyObject* __Pyx_PyUnicode_From_int(int value, Py_ssize_t width, char padding_char, char format_char) {
+  static CYTHON_INLINE PyObject* __Pyx_PyUnicode_From_int(int value, Py_ssize_t width, char padding_char, char format_char) {
     char digits[sizeof(int)*3+2];
     char *dpos, *end = digits + sizeof(int)*3+2;
     const char *hex_digits = DIGITS_HEX;
     Py_ssize_t length, ulength;
     int prepend_sign, last_one_off;
     int remaining;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
@@ -26703,15 +26636,15 @@
     if (ulength == 1) {
         return PyUnicode_FromOrdinal(*dpos);
     }
     return __Pyx_PyUnicode_BuildFromAscii(ulength, dpos, (int) length, prepend_sign, padding_char);
 }
 
 /* Import */
-static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
+  static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
     PyObject *empty_list = 0;
     PyObject *module = 0;
     PyObject *global_dict = 0;
     PyObject *empty_dict = 0;
     PyObject *list;
     #if PY_MAJOR_VERSION < 3
     PyObject *py_import;
@@ -26768,29 +26701,29 @@
     #endif
     Py_XDECREF(empty_list);
     Py_XDECREF(empty_dict);
     return module;
 }
 
 /* ImportFrom */
-static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name) {
+  static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name) {
     PyObject* value = __Pyx_PyObject_GetAttrStr(module, name);
     if (unlikely(!value) && PyErr_ExceptionMatches(PyExc_AttributeError)) {
         PyErr_Format(PyExc_ImportError,
         #if PY_MAJOR_VERSION < 3
             "cannot import name %.230s", PyString_AS_STRING(name));
         #else
             "cannot import name %S", name);
         #endif
     }
     return value;
 }
 
 /* HasAttr */
-static CYTHON_INLINE int __Pyx_HasAttr(PyObject *o, PyObject *n) {
+  static CYTHON_INLINE int __Pyx_HasAttr(PyObject *o, PyObject *n) {
     PyObject *r;
     if (unlikely(!__Pyx_PyBaseString_Check(n))) {
         PyErr_SetString(PyExc_TypeError,
                         "hasattr(): attribute name must be string");
         return -1;
     }
     r = __Pyx_GetAttr(o, n);
@@ -26800,25 +26733,25 @@
     } else {
         Py_DECREF(r);
         return 1;
     }
 }
 
 /* PyObject_GenericGetAttr */
-#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
+  #if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
 static PyObject* __Pyx_PyObject_GenericGetAttr(PyObject* obj, PyObject* attr_name) {
     if (unlikely(Py_TYPE(obj)->tp_dictoffset)) {
         return PyObject_GenericGetAttr(obj, attr_name);
     }
     return __Pyx_PyObject_GenericGetAttrNoDict(obj, attr_name);
 }
 #endif
 
 /* SetVTable */
-static int __Pyx_SetVtable(PyObject *dict, void *vtable) {
+  static int __Pyx_SetVtable(PyObject *dict, void *vtable) {
 #if PY_VERSION_HEX >= 0x02070000
     PyObject *ob = PyCapsule_New(vtable, 0, 0);
 #else
     PyObject *ob = PyCObject_FromVoidPtr(vtable, 0);
 #endif
     if (!ob)
         goto bad;
@@ -26828,15 +26761,15 @@
     return 0;
 bad:
     Py_XDECREF(ob);
     return -1;
 }
 
 /* PyObjectGetAttrStrNoError */
-static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
+  static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     if (likely(__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
         __Pyx_PyErr_Clear();
 }
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name) {
     PyObject *result;
@@ -26850,15 +26783,15 @@
     if (unlikely(!result)) {
         __Pyx_PyObject_GetAttrStr_ClearAttributeError();
     }
     return result;
 }
 
 /* SetupReduce */
-static int __Pyx_setup_reduce_is_named(PyObject* meth, PyObject* name) {
+  static int __Pyx_setup_reduce_is_named(PyObject* meth, PyObject* name) {
   int ret;
   PyObject *name_attr;
   name_attr = __Pyx_PyObject_GetAttrStr(meth, __pyx_n_s_name_2);
   if (likely(name_attr)) {
       ret = PyObject_RichCompareBool(name_attr, name, Py_EQ);
   } else {
       ret = -1;
@@ -26954,47 +26887,65 @@
     Py_XDECREF(reduce_cython);
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 
 /* TypeImport */
-#ifndef __PYX_HAVE_RT_ImportType
+  #ifndef __PYX_HAVE_RT_ImportType
 #define __PYX_HAVE_RT_ImportType
 static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, enum __Pyx_ImportType_CheckSize check_size)
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
+    Py_ssize_t itemsize;
 #ifdef Py_LIMITED_API
     PyObject *py_basicsize;
+    PyObject *py_itemsize;
 #endif
     result = PyObject_GetAttrString(module, class_name);
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
         PyErr_Format(PyExc_TypeError,
             "%.200s.%.200s is not a type object",
             module_name, class_name);
         goto bad;
     }
 #ifndef Py_LIMITED_API
     basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
 #else
     py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
     if (!py_basicsize)
         goto bad;
     basicsize = PyLong_AsSsize_t(py_basicsize);
     Py_DECREF(py_basicsize);
     py_basicsize = 0;
     if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
         goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
 #endif
-    if ((size_t)basicsize < size) {
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
     if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
@@ -27015,15 +26966,15 @@
 bad:
     Py_XDECREF(result);
     return NULL;
 }
 #endif
 
 /* GetVTable */
-static void* __Pyx_GetVtable(PyObject *dict) {
+  static void* __Pyx_GetVtable(PyObject *dict) {
     void* ptr;
     PyObject *ob = PyObject_GetItem(dict, __pyx_n_s_pyx_vtable);
     if (!ob)
         goto bad;
 #if PY_VERSION_HEX >= 0x02070000
     ptr = PyCapsule_GetPointer(ob, 0);
 #else
@@ -27035,15 +26986,15 @@
     return ptr;
 bad:
     Py_XDECREF(ob);
     return NULL;
 }
 
 /* ClassMethod */
-static PyObject* __Pyx_Method_ClassMethod(PyObject *method) {
+  static PyObject* __Pyx_Method_ClassMethod(PyObject *method) {
 #if CYTHON_COMPILING_IN_PYPY && PYPY_VERSION_NUM <= 0x05080000
     if (PyObject_TypeCheck(method, &PyWrapperDescr_Type)) {
         return PyClassMethod_New(method);
     }
 #else
 #if CYTHON_COMPILING_IN_PYSTON || CYTHON_COMPILING_IN_PYPY
     if (PyMethodDescr_Check(method))
@@ -27076,15 +27027,15 @@
     }
     else {
         return PyClassMethod_New(method);
     }
 }
 
 /* GetNameInClass */
-static PyObject *__Pyx_GetGlobalNameAfterAttributeLookup(PyObject *name) {
+  static PyObject *__Pyx_GetGlobalNameAfterAttributeLookup(PyObject *name) {
     PyObject *result;
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     if (unlikely(!__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
         return NULL;
     __Pyx_PyErr_Clear();
     __Pyx_GetModuleGlobalNameUncached(result, name);
@@ -27096,16 +27047,16 @@
     if (!result) {
         result = __Pyx_GetGlobalNameAfterAttributeLookup(name);
     }
     return result;
 }
 
 /* CLineInTraceback */
-#ifndef CYTHON_CLINE_IN_TRACEBACK
-static int __Pyx_CLineForTraceback(CYTHON_NCP_UNUSED PyThreadState *tstate, int c_line) {
+  #ifndef CYTHON_CLINE_IN_TRACEBACK
+static int __Pyx_CLineForTraceback(CYTHON_UNUSED PyThreadState *tstate, int c_line) {
     PyObject *use_cline;
     PyObject *ptype, *pvalue, *ptraceback;
 #if CYTHON_COMPILING_IN_CPYTHON
     PyObject **cython_runtime_dict;
 #endif
     if (unlikely(!__pyx_cython_runtime)) {
         return c_line;
@@ -27138,15 +27089,15 @@
     }
     __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
     return c_line;
 }
 #endif
 
 /* CodeObjectCache */
-static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
+  static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
     int start = 0, mid = 0, end = count - 1;
     if (end >= 0 && code_line > entries[end].code_line) {
         return count;
     }
     while (start < end) {
         mid = start + (end - start) / 2;
         if (code_line < entries[mid].code_line) {
@@ -27218,15 +27169,15 @@
     entries[pos].code_line = code_line;
     entries[pos].code_object = code_object;
     __pyx_code_cache.count++;
     Py_INCREF(code_object);
 }
 
 /* AddTraceback */
-#include "compile.h"
+  #include "compile.h"
 #include "frameobject.h"
 #include "traceback.h"
 #if PY_VERSION_HEX >= 0x030b00a6
   #ifndef Py_BUILD_CORE
     #define Py_BUILD_CORE 1
   #endif
   #include "internal/pycore_frame.h"
@@ -27325,15 +27276,15 @@
     PyTraceBack_Here(py_frame);
 bad:
     Py_XDECREF(py_code);
     Py_XDECREF(py_frame);
 }
 
 /* CIntFromPyVerify */
-#define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
+  #define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
     __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
 #define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
     __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
 #define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
     {\
         func_type value = func_value;\
         if (sizeof(target_type) < sizeof(func_type)) {\
@@ -27347,15 +27298,15 @@
                     goto raise_overflow;\
             }\
         }\
         return (target_type) value;\
     }
 
 /* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
+  static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const int neg_one = (int) -1, const_zero = (int) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -27385,15 +27336,15 @@
         unsigned char *bytes = (unsigned char *)&value;
         return _PyLong_FromByteArray(bytes, sizeof(int),
                                      little, !is_unsigned);
     }
 }
 
 /* CIntFromPy */
-static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
+  static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const int neg_one = (int) -1, const_zero = (int) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -27581,15 +27532,15 @@
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to int");
     return (int) -1;
 }
 
 /* CIntFromPy */
-static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
+  static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const long neg_one = (long) -1, const_zero = (long) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -27777,15 +27728,15 @@
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to long");
     return (long) -1;
 }
 
 /* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
+  static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const long neg_one = (long) -1, const_zero = (long) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -27815,15 +27766,15 @@
         unsigned char *bytes = (unsigned char *)&value;
         return _PyLong_FromByteArray(bytes, sizeof(long),
                                      little, !is_unsigned);
     }
 }
 
 /* AsyncGeneratorInitFinalizer */
-#if PY_VERSION_HEX < 0x030600B0
+  #if PY_VERSION_HEX < 0x030600B0
 static int __Pyx_async_gen_init_hooks(__pyx_PyAsyncGenObject *o) {
 #if 0
     PyThreadState *tstate;
     PyObject *finalizer;
     PyObject *firstiter;
 #endif
     if (likely(o->ag_hooks_inited)) {
@@ -27850,15 +27801,15 @@
     }
 #endif
     return 0;
 }
 #endif
 
 /* AsyncGenerator */
-PyDoc_STRVAR(__Pyx_async_gen_send_doc,
+  PyDoc_STRVAR(__Pyx_async_gen_send_doc,
 "send(arg) -> send 'arg' into generator,\n\
 return next yielded value or raise StopIteration.");
 PyDoc_STRVAR(__Pyx_async_gen_close_doc,
 "close() -> raise GeneratorExit inside generator.");
 PyDoc_STRVAR(__Pyx_async_gen_throw_doc,
 "throw(typ[,val[,tb]]) -> raise exception in generator,\n\
 return next yielded value or raise StopIteration.");
@@ -28682,18 +28633,18 @@
     __pyx__PyAsyncGenASendType = __Pyx_FetchCommonType(&__pyx__PyAsyncGenASendType_type);
     if (unlikely(!__pyx__PyAsyncGenASendType))
         return -1;
     return 0;
 }
 
 /* AsyncGen */
-
+  
 
 /* CheckBinaryVersion */
-static int __Pyx_check_binary_version(void) {
+  static int __Pyx_check_binary_version(void) {
     char ctversion[5];
     int same=1, i, found_dot;
     const char* rt_from_call = Py_GetVersion();
     PyOS_snprintf(ctversion, 5, "%d.%d", PY_MAJOR_VERSION, PY_MINOR_VERSION);
     found_dot = 0;
     for (i = 0; i < 4; i++) {
         if (!ctversion[i]) {
@@ -28723,15 +28674,15 @@
                       ctversion, __Pyx_MODULE_NAME, rtversion);
         return PyErr_WarnEx(NULL, message, 1);
     }
     return 0;
 }
 
 /* FunctionExport */
-static int __Pyx_ExportFunction(const char *name, void (*f)(void), const char *sig) {
+  static int __Pyx_ExportFunction(const char *name, void (*f)(void), const char *sig) {
     PyObject *d = 0;
     PyObject *cobj = 0;
     union {
         void (*fp)(void);
         void *p;
     } tmp;
     d = PyObject_GetAttrString(__pyx_m, (char *)"__pyx_capi__");
@@ -28760,15 +28711,15 @@
 bad:
     Py_XDECREF(cobj);
     Py_XDECREF(d);
     return -1;
 }
 
 /* FunctionImport */
-#ifndef __PYX_HAVE_RT_ImportFunction
+  #ifndef __PYX_HAVE_RT_ImportFunction
 #define __PYX_HAVE_RT_ImportFunction
 static int __Pyx_ImportFunction(PyObject *module, const char *funcname, void (**f)(void), const char *sig) {
     PyObject *d = 0;
     PyObject *cobj = 0;
     union {
         void (*fp)(void);
         void *p;
@@ -28814,15 +28765,15 @@
 bad:
     Py_XDECREF(d);
     return -1;
 }
 #endif
 
 /* InitStrings */
-static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
+  static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
     while (t->p) {
         #if PY_MAJOR_VERSION < 3
         if (t->is_unicode) {
             *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
         } else if (t->intern) {
             *t->p = PyString_InternFromString(t->s);
         } else {
```

### Comparing `blacksheep-2.0a5/blacksheep/messages.pxd` & `blacksheep-2.0a6/blacksheep/messages.pxd`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/messages.pyi` & `blacksheep-2.0a6/blacksheep/messages.pyi`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/messages.pyx` & `blacksheep-2.0a6/blacksheep/messages.pyx`

 * *Files 0% similar despite different names*

```diff
@@ -1,17 +1,14 @@
 import http
 import re
 from datetime import datetime, timedelta
 from json.decoder import JSONDecodeError
 from urllib.parse import parse_qs, quote, unquote, urlencode
 
-try:
-    import cchardet as chardet
-except ImportError:
-    import chardet
+import charset_normalizer
 
 from blacksheep.multipart import parse_multipart
 from blacksheep.sessions import Session
 from blacksheep.settings.json import json_settings
 
 from .contents cimport Content, multiparts_to_dictionary, parse_www_form_urlencoded
 from .cookies cimport Cookie, parse_cookie, split_value, write_cookie_for_response
@@ -149,16 +146,16 @@
             # this can happen when the server returned a declared charset,
             # but its content is not actually using the declared encoding
             # a common encoding is 'ISO-8859-1', so before using chardet, we try with this
             if self.charset != 'ISO-8859-1':
                 try:
                     return body.decode('ISO-8859-1')
                 except UnicodeDecodeError:
-                    # fallback to chardet;
-                    return body.decode(chardet.detect(body)['encoding'])
+                    # fallback to trying to detect the encoding;
+                    return body.decode(charset_normalizer.detect(body)['encoding'])
 
     async def form(self):
         cdef str text
         cdef bytes body
         cdef bytes content_type_value = self.content_type()
 
         if not content_type_value:
```

### Comparing `blacksheep-2.0a5/blacksheep/middlewares.py` & `blacksheep-2.0a6/blacksheep/middlewares.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/multipart.py` & `blacksheep-2.0a6/blacksheep/multipart.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/ranges.py` & `blacksheep-2.0a6/blacksheep/ranges.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/scribe.c` & `blacksheep-2.0a6/blacksheep/scribe.c`

 * *Files 0% similar despite different names*

```diff
@@ -1,20 +1,20 @@
-/* Generated by Cython 0.29.32 */
+/* Generated by Cython 0.29.34 */
 
 #ifndef PY_SSIZE_T_CLEAN
 #define PY_SSIZE_T_CLEAN
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_32"
-#define CYTHON_HEX_VERSION 0x001D20F0
+#define CYTHON_ABI "0_29_34"
+#define CYTHON_HEX_VERSION 0x001D22F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -83,15 +83,15 @@
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
-    #define CYTHON_UPDATE_DESCRIPTOR_DOC (PYPY_VERSION_HEX >= 0x07030900)
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
 #elif defined(PYSTON_VERSION)
   #define CYTHON_COMPILING_IN_PYPY 0
   #define CYTHON_COMPILING_IN_PYSTON 1
   #define CYTHON_COMPILING_IN_CPYTHON 0
   #define CYTHON_COMPILING_IN_NOGIL 0
   #ifndef CYTHON_USE_TYPE_SLOTS
@@ -199,15 +199,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -238,15 +238,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -548,35 +548,35 @@
 #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && CYTHON_USE_UNICODE_INTERNALS
 #define __Pyx_PyDict_GetItemStr(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
 #else
 #define __Pyx_PyDict_GetItemStr(dict, name)  PyDict_GetItem(dict, name)
 #endif
 #if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
   #define CYTHON_PEP393_ENABLED 1
-  #if defined(PyUnicode_IS_READY)
-  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
-                                              0 : _PyUnicode_Ready((PyObject *)(op)))
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_READY(op)       (0)
   #else
-  #define __Pyx_PyUnicode_READY(op)       (0)
+    #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
+                                                0 : _PyUnicode_Ready((PyObject *)(op)))
   #endif
   #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
   #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
   #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
   #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
   #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
   #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
   #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, ch)
-  #if defined(PyUnicode_IS_READY) && defined(PyUnicode_GET_SIZE)
-  #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
   #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
-  #endif
-  #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
+    #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
+    #else
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
+    #endif
   #endif
 #else
   #define CYTHON_PEP393_ENABLED 0
   #define PyUnicode_1BYTE_KIND  1
   #define PyUnicode_2BYTE_KIND  2
   #define PyUnicode_4BYTE_KIND  4
   #define __Pyx_PyUnicode_READY(op)       (0)
@@ -949,22 +949,22 @@
 static int __pyx_lineno;
 static int __pyx_clineno = 0;
 static const char * __pyx_cfilenm= __FILE__;
 static const char *__pyx_filename;
 
 
 static const char *__pyx_f[] = {
-  "blacksheep/scribe.pyx",
+  "blacksheep\\scribe.pyx",
   "datetime.pxd",
-  "blacksheep/contents.pxd",
+  "blacksheep\\contents.pxd",
   "type.pxd",
-  "blacksheep/cookies.pxd",
-  "blacksheep/exceptions.pxd",
-  "blacksheep/url.pxd",
-  "blacksheep/messages.pxd",
+  "blacksheep\\cookies.pxd",
+  "blacksheep\\exceptions.pxd",
+  "blacksheep\\url.pxd",
+  "blacksheep\\messages.pxd",
 };
 
 /*--- Type declarations ---*/
 struct __pyx_obj_10blacksheep_8contents_Content;
 struct __pyx_obj_10blacksheep_8contents_StreamedContent;
 struct __pyx_obj_10blacksheep_8contents_ASGIContent;
 struct __pyx_obj_10blacksheep_8contents_TextContent;
@@ -1778,26 +1778,26 @@
 #define __PYX_GET_DICT_VERSION(dict)  (0)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
 #define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
 #endif
 
 /* GetModuleGlobalName.proto */
 #if CYTHON_USE_DICT_VERSIONS
-#define __Pyx_GetModuleGlobalName(var, name)  {\
+#define __Pyx_GetModuleGlobalName(var, name)  do {\
     static PY_UINT64_T __pyx_dict_version = 0;\
     static PyObject *__pyx_dict_cached_value = NULL;\
     (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
         (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
         __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  {\
+} while(0)
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  do {\
     PY_UINT64_T __pyx_dict_version;\
     PyObject *__pyx_dict_cached_value;\
     (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
+} while(0)
 static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
 #else
 #define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 #define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
 #endif
 
@@ -2007,20 +2007,28 @@
 
 /* IncludeStringH.proto */
 #include <string.h>
 
 /* TypeImport.proto */
 #ifndef __PYX_HAVE_RT_ImportType_proto
 #define __PYX_HAVE_RT_ImportType_proto
+#if __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT(s) sizeof(void*)
+#endif
 enum __Pyx_ImportType_CheckSize {
    __Pyx_ImportType_CheckSize_Error = 0,
    __Pyx_ImportType_CheckSize_Warn = 1,
    __Pyx_ImportType_CheckSize_Ignore = 2
 };
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
+static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize check_size);
 #endif
 
 /* GetVTable.proto */
 static void* __Pyx_GetVtable(PyObject *dict);
 
 /* Import.proto */
 static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level);
@@ -2302,15 +2310,15 @@
 static const char __pyx_k_write_response[] = "write_response";
 static const char __pyx_k_blacksheep_scribe[] = "blacksheep.scribe";
 static const char __pyx_k_transfer_encoding[] = "transfer-encoding";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
 static const char __pyx_k_http_response_body[] = "http.response.body";
 static const char __pyx_k_send_asgi_response[] = "send_asgi_response";
 static const char __pyx_k_http_response_start[] = "http.response.start";
-static const char __pyx_k_blacksheep_scribe_pyx[] = "blacksheep/scribe.pyx";
+static const char __pyx_k_blacksheep_scribe_pyx[] = "blacksheep\\scribe.pyx";
 static const char __pyx_k_write_response_content[] = "write_response_content";
 static const char __pyx_k_Missing_request_content[] = "Missing request content";
 static const char __pyx_k_write_request_body_only[] = "write_request_body_only";
 static const char __pyx_k_application_octet_stream[] = "application/octet-stream";
 static PyObject *__pyx_kp_b_;
 static PyObject *__pyx_kp_b_0;
 static PyObject *__pyx_kp_b_0_2;
@@ -2482,15 +2490,15 @@
   __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyNumber_Add(__pyx_t_3, __pyx_kp_b__2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 12, __pyx_L1_error)
   __pyx_r = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* "blacksheep/scribe.pyx":11
  * 
  * 
@@ -2562,15 +2570,15 @@
     if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 20, __pyx_L1_error)
     #else
     __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 20, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     #endif
-    if (!(likely(PyTuple_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 20, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 20, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_header, ((PyObject*)__pyx_t_3));
     __pyx_t_3 = 0;
 
     /* "blacksheep/scribe.pyx":21
  *     value = bytearray()
  *     for header in headers:
  *         value.extend(write_header(header))             # <<<<<<<<<<<<<<
@@ -2667,15 +2675,15 @@
     if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 28, __pyx_L1_error)
     #else
     __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 28, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     #endif
-    if (!(likely(PyTuple_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 28, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 28, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v_header, ((PyObject*)__pyx_t_3));
     __pyx_t_3 = 0;
 
     /* "blacksheep/scribe.pyx":29
  * 
  *     for header in headers:
  *         data.extend(write_header(header))             # <<<<<<<<<<<<<<
@@ -2830,15 +2838,15 @@
       __pyx_t_6 = PyNumber_Add(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 34, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __pyx_t_5 = PyNumber_Add(__pyx_t_6, __pyx_kp_b__2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 34, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      if (!(likely(PyBytes_CheckExact(__pyx_t_5))||((__pyx_t_5) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_5)->tp_name), 0))) __PYX_ERR(0, 34, __pyx_L3_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_5))||((__pyx_t_5) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_5)->tp_name), 0))) __PYX_ERR(0, 34, __pyx_L3_error)
       __pyx_r = ((PyObject*)__pyx_t_5);
       __pyx_t_5 = 0;
       goto __pyx_L7_try_return;
 
       /* "blacksheep/scribe.pyx":33
  * 
  * cdef bytes _get_status_line(int status_code):
@@ -2888,15 +2896,15 @@
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __pyx_t_7 = PyNumber_Add(__pyx_kp_b_HTTP_1_1, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __pyx_t_8 = PyNumber_Add(__pyx_t_7, __pyx_kp_b__2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 36, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 36, __pyx_L5_except_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 36, __pyx_L5_except_error)
       __pyx_r = ((PyObject*)__pyx_t_8);
       __pyx_t_8 = 0;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       goto __pyx_L6_except_return;
     }
@@ -2981,15 +2989,15 @@
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_STATUS_LINES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 56, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_status, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 56, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 56, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 56, __pyx_L1_error)
   __pyx_r = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* "blacksheep/scribe.pyx":55
  * }
  * 
@@ -3211,15 +3219,15 @@
  * 
  */
   __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_request), __pyx_n_s_url); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 70, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_host); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 70, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 70, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 70, __pyx_L1_error)
   ((struct __pyx_vtabstruct_10blacksheep_8messages_Request *)__pyx_v_request->__pyx_base.__pyx_vtab)->__pyx_base._add_header_if_missing(((struct __pyx_obj_10blacksheep_8messages_Message *)__pyx_v_request), __pyx_n_b_host, ((PyObject*)__pyx_t_2));
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "blacksheep/scribe.pyx":68
  * 
  * 
  * cdef void ensure_host_header(Request request):             # <<<<<<<<<<<<<<
@@ -5346,15 +5354,15 @@
             PyErr_Clear();
             break;
           }
           __pyx_t_1 = NULL;
           if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 199, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
         }
-        if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 199, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 199, __pyx_L1_error)
         __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_chunk);
         __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_chunk, ((PyObject*)__pyx_t_1));
         __Pyx_GIVEREF(__pyx_t_1);
         __pyx_t_1 = 0;
 
         /* "blacksheep/scribe.pyx":200
  *         if should_use_chunked_encoding(content):
@@ -5483,15 +5491,15 @@
                 if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                 else __PYX_ERR(0, 205, __pyx_L1_error)
               }
               break;
             }
             __Pyx_GOTREF(__pyx_t_3);
           }
-          if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 205, __pyx_L1_error)
+          if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 205, __pyx_L1_error)
           __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_chunk);
           __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_chunk, ((PyObject*)__pyx_t_3));
           __Pyx_GIVEREF(__pyx_t_3);
           __pyx_t_3 = 0;
 
           /* "blacksheep/scribe.pyx":206
  *             if content.length > MAX_RESPONSE_CHUNK_SIZE:
@@ -5896,15 +5904,15 @@
             PyErr_Clear();
             break;
           }
           __pyx_t_1 = NULL;
           if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 229, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
         }
-        if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 229, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 229, __pyx_L1_error)
         __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_chunk);
         __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_chunk, ((PyObject*)__pyx_t_1));
         __Pyx_GIVEREF(__pyx_t_1);
         __pyx_t_1 = 0;
 
         /* "blacksheep/scribe.pyx":230
  *         if should_use_chunked_encoding(content):
@@ -6033,15 +6041,15 @@
                 if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                 else __PYX_ERR(0, 235, __pyx_L1_error)
               }
               break;
             }
             __Pyx_GOTREF(__pyx_t_3);
           }
-          if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 235, __pyx_L1_error)
+          if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 235, __pyx_L1_error)
           __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_chunk);
           __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_chunk, ((PyObject*)__pyx_t_3));
           __Pyx_GIVEREF(__pyx_t_3);
           __pyx_t_3 = 0;
 
           /* "blacksheep/scribe.pyx":236
  *             if content.length > MAX_RESPONSE_CHUNK_SIZE:
@@ -6590,15 +6598,15 @@
             PyErr_Clear();
             break;
           }
           __pyx_t_3 = NULL;
           if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_3) < 0) __PYX_ERR(0, 262, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
         }
-        if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 262, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 262, __pyx_L1_error)
         __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_chunk);
         __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_chunk, ((PyObject*)__pyx_t_3));
         __Pyx_GIVEREF(__pyx_t_3);
         __pyx_t_3 = 0;
 
         /* "blacksheep/scribe.pyx":263
  *         if should_use_chunked_encoding(content):
@@ -6727,15 +6735,15 @@
                 if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                 else __PYX_ERR(0, 268, __pyx_L1_error)
               }
               break;
             }
             __Pyx_GOTREF(__pyx_t_1);
           }
-          if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 268, __pyx_L1_error)
+          if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 268, __pyx_L1_error)
           __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_chunk);
           __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_chunk, ((PyObject*)__pyx_t_1));
           __Pyx_GIVEREF(__pyx_t_1);
           __pyx_t_1 = 0;
 
           /* "blacksheep/scribe.pyx":269
  *             if content.length > MAX_RESPONSE_CHUNK_SIZE:
@@ -7033,15 +7041,15 @@
             PyErr_Clear();
             break;
           }
           __pyx_t_1 = NULL;
           if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 281, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
         }
-        if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 281, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 281, __pyx_L1_error)
         __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_chunk);
         __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_chunk, ((PyObject*)__pyx_t_1));
         __Pyx_GIVEREF(__pyx_t_1);
         __pyx_t_1 = 0;
 
         /* "blacksheep/scribe.pyx":282
  *         if should_use_chunked_encoding(content):
@@ -7170,15 +7178,15 @@
                 if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                 else __PYX_ERR(0, 287, __pyx_L1_error)
               }
               break;
             }
             __Pyx_GOTREF(__pyx_t_3);
           }
-          if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 287, __pyx_L1_error)
+          if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 287, __pyx_L1_error)
           __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_chunk);
           __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_chunk, ((PyObject*)__pyx_t_3));
           __Pyx_GIVEREF(__pyx_t_3);
           __pyx_t_3 = 0;
 
           /* "blacksheep/scribe.pyx":288
  *             if content.length > MAX_RESPONSE_CHUNK_SIZE:
@@ -7608,15 +7616,15 @@
             PyErr_Clear();
             break;
           }
           __pyx_t_1 = NULL;
           if (__Pyx_PyGen_FetchStopIterationValue(&__pyx_t_1) < 0) __PYX_ERR(0, 308, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
         }
-        if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 308, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 308, __pyx_L1_error)
         __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_chunk);
         __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_chunk, ((PyObject*)__pyx_t_1));
         __Pyx_GIVEREF(__pyx_t_1);
         __pyx_t_1 = 0;
 
         /* "blacksheep/scribe.pyx":310
  *             async for chunk in content.get_parts():
@@ -7783,15 +7791,15 @@
                 if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                 else __PYX_ERR(0, 316, __pyx_L1_error)
               }
               break;
             }
             __Pyx_GOTREF(__pyx_t_3);
           }
-          if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 316, __pyx_L1_error)
+          if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 316, __pyx_L1_error)
           __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_chunk);
           __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_chunk, ((PyObject*)__pyx_t_3));
           __Pyx_GIVEREF(__pyx_t_3);
           __pyx_t_3 = 0;
 
           /* "blacksheep/scribe.pyx":318
  *                 for chunk in get_chunks(content.body):
@@ -10148,15 +10156,15 @@
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
   __pyx_umethod_PyByteArray_Type_extend.type = (PyObject*)&PyByteArray_Type;
-  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_2 = PyInt_FromLong(2); if (unlikely(!__pyx_int_2)) __PYX_ERR(0, 1, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_modinit_global_init_code(void); /*proto*/
@@ -10283,96 +10291,122 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule("blacksheep.contents"); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 8, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_8contents_Content = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "Content", sizeof(struct __pyx_obj_10blacksheep_8contents_Content), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_Content = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "Content", sizeof(struct __pyx_obj_10blacksheep_8contents_Content), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_Content),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_Content) __PYX_ERR(2, 8, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_StreamedContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "StreamedContent", sizeof(struct __pyx_obj_10blacksheep_8contents_StreamedContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_StreamedContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "StreamedContent", sizeof(struct __pyx_obj_10blacksheep_8contents_StreamedContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_StreamedContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_StreamedContent) __PYX_ERR(2, 14, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_ASGIContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "ASGIContent", sizeof(struct __pyx_obj_10blacksheep_8contents_ASGIContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_ASGIContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "ASGIContent", sizeof(struct __pyx_obj_10blacksheep_8contents_ASGIContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_ASGIContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_ASGIContent) __PYX_ERR(2, 18, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_8contents_ASGIContent = (struct __pyx_vtabstruct_10blacksheep_8contents_ASGIContent*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_8contents_ASGIContent->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_8contents_ASGIContent)) __PYX_ERR(2, 18, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_TextContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "TextContent", sizeof(struct __pyx_obj_10blacksheep_8contents_TextContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_TextContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "TextContent", sizeof(struct __pyx_obj_10blacksheep_8contents_TextContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_TextContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_TextContent) __PYX_ERR(2, 23, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_HTMLContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "HTMLContent", sizeof(struct __pyx_obj_10blacksheep_8contents_HTMLContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_HTMLContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "HTMLContent", sizeof(struct __pyx_obj_10blacksheep_8contents_HTMLContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_HTMLContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_HTMLContent) __PYX_ERR(2, 27, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_JSONContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "JSONContent", sizeof(struct __pyx_obj_10blacksheep_8contents_JSONContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_JSONContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "JSONContent", sizeof(struct __pyx_obj_10blacksheep_8contents_JSONContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_JSONContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_JSONContent) __PYX_ERR(2, 31, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_FormContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "FormContent", sizeof(struct __pyx_obj_10blacksheep_8contents_FormContent), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_FormContent = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "FormContent", sizeof(struct __pyx_obj_10blacksheep_8contents_FormContent), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_FormContent),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_FormContent) __PYX_ERR(2, 35, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_FormPart = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "FormPart", sizeof(struct __pyx_obj_10blacksheep_8contents_FormPart), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_FormPart = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "FormPart", sizeof(struct __pyx_obj_10blacksheep_8contents_FormPart), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_FormPart),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_FormPart) __PYX_ERR(2, 39, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8contents_MultiPartFormData = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "MultiPartFormData", sizeof(struct __pyx_obj_10blacksheep_8contents_MultiPartFormData), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8contents_MultiPartFormData = __Pyx_ImportType(__pyx_t_1, "blacksheep.contents", "MultiPartFormData", sizeof(struct __pyx_obj_10blacksheep_8contents_MultiPartFormData), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8contents_MultiPartFormData),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8contents_MultiPartFormData) __PYX_ERR(2, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyHeapTypeObject),
   #endif
   __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("datetime"); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_8datetime_date = __Pyx_ImportType(__pyx_t_1, "datetime", "date", sizeof(PyDateTime_Date), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_date = __Pyx_ImportType(__pyx_t_1, "datetime", "date", sizeof(PyDateTime_Date), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_Date),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_date) __PYX_ERR(1, 9, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_time = __Pyx_ImportType(__pyx_t_1, "datetime", "time", sizeof(PyDateTime_Time), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_time = __Pyx_ImportType(__pyx_t_1, "datetime", "time", sizeof(PyDateTime_Time), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_Time),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_time) __PYX_ERR(1, 12, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_datetime = __Pyx_ImportType(__pyx_t_1, "datetime", "datetime", sizeof(PyDateTime_DateTime), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_datetime = __Pyx_ImportType(__pyx_t_1, "datetime", "datetime", sizeof(PyDateTime_DateTime), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_DateTime),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_datetime) __PYX_ERR(1, 15, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_timedelta = __Pyx_ImportType(__pyx_t_1, "datetime", "timedelta", sizeof(PyDateTime_Delta), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_timedelta = __Pyx_ImportType(__pyx_t_1, "datetime", "timedelta", sizeof(PyDateTime_Delta), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_Delta),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_timedelta) __PYX_ERR(1, 18, __pyx_L1_error)
-  __pyx_ptype_7cpython_8datetime_tzinfo = __Pyx_ImportType(__pyx_t_1, "datetime", "tzinfo", sizeof(PyDateTime_TZInfo), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_7cpython_8datetime_tzinfo = __Pyx_ImportType(__pyx_t_1, "datetime", "tzinfo", sizeof(PyDateTime_TZInfo), __PYX_GET_STRUCT_ALIGNMENT(PyDateTime_TZInfo),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_8datetime_tzinfo) __PYX_ERR(1, 21, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("blacksheep.cookies"); if (unlikely(!__pyx_t_1)) __PYX_ERR(4, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_7cookies_Cookie = __Pyx_ImportType(__pyx_t_1, "blacksheep.cookies", "Cookie", sizeof(struct __pyx_obj_10blacksheep_7cookies_Cookie), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_7cookies_Cookie = __Pyx_ImportType(__pyx_t_1, "blacksheep.cookies", "Cookie", sizeof(struct __pyx_obj_10blacksheep_7cookies_Cookie), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_7cookies_Cookie),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_7cookies_Cookie) __PYX_ERR(4, 17, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_7cookies_Cookie = (struct __pyx_vtabstruct_10blacksheep_7cookies_Cookie*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_7cookies_Cookie->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_7cookies_Cookie)) __PYX_ERR(4, 17, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("blacksheep.exceptions"); if (unlikely(!__pyx_t_1)) __PYX_ERR(5, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_10exceptions_MessageAborted = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "MessageAborted", sizeof(struct __pyx_obj_10blacksheep_10exceptions_MessageAborted), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_MessageAborted = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "MessageAborted", sizeof(struct __pyx_obj_10blacksheep_10exceptions_MessageAborted), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_MessageAborted),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_MessageAborted) __PYX_ERR(5, 4, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_HTTPException = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "HTTPException", sizeof(struct __pyx_obj_10blacksheep_10exceptions_HTTPException), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_HTTPException = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "HTTPException", sizeof(struct __pyx_obj_10blacksheep_10exceptions_HTTPException), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_HTTPException),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_HTTPException) __PYX_ERR(5, 8, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_BadRequest = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequest", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequest), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_BadRequest = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequest", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequest), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_BadRequest),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_BadRequest) __PYX_ERR(5, 12, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_BadRequestFormat = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequestFormat", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_BadRequestFormat = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "BadRequestFormat", sizeof(struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_BadRequestFormat),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_BadRequestFormat) __PYX_ERR(5, 16, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_NotFound = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "NotFound", sizeof(struct __pyx_obj_10blacksheep_10exceptions_NotFound), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_NotFound = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "NotFound", sizeof(struct __pyx_obj_10blacksheep_10exceptions_NotFound), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_NotFound),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_NotFound) __PYX_ERR(5, 20, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_InvalidArgument = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidArgument", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidArgument), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_InvalidArgument = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidArgument", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidArgument), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_InvalidArgument),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_InvalidArgument) __PYX_ERR(5, 24, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_10exceptions_InvalidOperation = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidOperation", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidOperation), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_10exceptions_InvalidOperation = __Pyx_ImportType(__pyx_t_1, "blacksheep.exceptions", "InvalidOperation", sizeof(struct __pyx_obj_10blacksheep_10exceptions_InvalidOperation), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_10exceptions_InvalidOperation),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_10exceptions_InvalidOperation) __PYX_ERR(5, 28, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("blacksheep.url"); if (unlikely(!__pyx_t_1)) __PYX_ERR(6, 8, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_3url_URL = __Pyx_ImportType(__pyx_t_1, "blacksheep.url", "URL", sizeof(struct __pyx_obj_10blacksheep_3url_URL), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_3url_URL = __Pyx_ImportType(__pyx_t_1, "blacksheep.url", "URL", sizeof(struct __pyx_obj_10blacksheep_3url_URL), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_3url_URL),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_3url_URL) __PYX_ERR(6, 8, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_3url_URL = (struct __pyx_vtabstruct_10blacksheep_3url_URL*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_3url_URL->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_3url_URL)) __PYX_ERR(6, 8, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("blacksheep.messages"); if (unlikely(!__pyx_t_1)) __PYX_ERR(7, 18, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_10blacksheep_8messages_Message = __Pyx_ImportType(__pyx_t_1, "blacksheep.messages", "Message", sizeof(struct __pyx_obj_10blacksheep_8messages_Message), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8messages_Message = __Pyx_ImportType(__pyx_t_1, "blacksheep.messages", "Message", sizeof(struct __pyx_obj_10blacksheep_8messages_Message), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8messages_Message),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8messages_Message) __PYX_ERR(7, 18, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_8messages_Message = (struct __pyx_vtabstruct_10blacksheep_8messages_Message*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_8messages_Message->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_8messages_Message)) __PYX_ERR(7, 18, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8messages_Request = __Pyx_ImportType(__pyx_t_1, "blacksheep.messages", "Request", sizeof(struct __pyx_obj_10blacksheep_8messages_Request), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8messages_Request = __Pyx_ImportType(__pyx_t_1, "blacksheep.messages", "Request", sizeof(struct __pyx_obj_10blacksheep_8messages_Request), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8messages_Request),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8messages_Request) __PYX_ERR(7, 45, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_8messages_Request = (struct __pyx_vtabstruct_10blacksheep_8messages_Request*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_8messages_Request->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_8messages_Request)) __PYX_ERR(7, 45, __pyx_L1_error)
-  __pyx_ptype_10blacksheep_8messages_Response = __Pyx_ImportType(__pyx_t_1, "blacksheep.messages", "Response", sizeof(struct __pyx_obj_10blacksheep_8messages_Response), __Pyx_ImportType_CheckSize_Warn);
+  __pyx_ptype_10blacksheep_8messages_Response = __Pyx_ImportType(__pyx_t_1, "blacksheep.messages", "Response", sizeof(struct __pyx_obj_10blacksheep_8messages_Response), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_10blacksheep_8messages_Response),
+  __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_10blacksheep_8messages_Response) __PYX_ERR(7, 58, __pyx_L1_error)
   __pyx_vtabptr_10blacksheep_8messages_Response = (struct __pyx_vtabstruct_10blacksheep_8messages_Response*)__Pyx_GetVtable(__pyx_ptype_10blacksheep_8messages_Response->tp_dict); if (unlikely(!__pyx_vtabptr_10blacksheep_8messages_Response)) __PYX_ERR(7, 58, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -10579,15 +10613,15 @@
   #endif
   __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_d);
   __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_b);
   __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_cython_runtime);
-  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Initialize various global constants etc. ---*/
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   if (__pyx_module_is_main_blacksheep__scribe) {
     if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -11113,15 +11147,15 @@
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
 #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(func)) {
         return __Pyx_PyFunction_FastCall(func, NULL, 0);
     }
 #endif
-#ifdef __Pyx_CyFunction_USED
+#if defined(__Pyx_CyFunction_USED) && defined(NDEBUG)
     if (likely(PyCFunction_Check(func) || __Pyx_CyFunction_Check(func)))
 #else
     if (likely(PyCFunction_Check(func)))
 #endif
     {
         if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
             return __Pyx_PyObject_CallMethO(func, NULL);
@@ -11155,19 +11189,19 @@
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg) {
     if (likely(cfunc->func)) {
         int flag = cfunc->flag;
         if (flag == METH_O) {
             return (*(cfunc->func))(self, arg);
         } else if (PY_VERSION_HEX >= 0x030600B1 && flag == METH_FASTCALL) {
-            if (PY_VERSION_HEX >= 0x030700A0) {
+            #if PY_VERSION_HEX >= 0x030700A0
                 return (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)cfunc->func)(self, &arg, 1);
-            } else {
+            #else
                 return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
-            }
+            #endif
         } else if (PY_VERSION_HEX >= 0x030700A0 && flag == (METH_FASTCALL | METH_KEYWORDS)) {
             return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
         }
     }
     return __Pyx__CallUnboundCMethod1(cfunc, self, arg);
 }
 #endif
@@ -11297,17 +11331,15 @@
     PyObject *old_exc, *old_val, *old_tb;
     PyObject *ctx;
     __Pyx_PyThreadState_declare
 #ifdef WITH_THREAD
     PyGILState_STATE state;
     if (nogil)
         state = PyGILState_Ensure();
-#ifdef _MSC_VER
-    else state = (PyGILState_STATE)-1;
-#endif
+    else state = (PyGILState_STATE)0;
 #endif
     __Pyx_PyThreadState_assign
     __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
     if (full_traceback) {
         Py_XINCREF(old_exc);
         Py_XINCREF(old_val);
         Py_XINCREF(old_tb);
@@ -11759,15 +11791,19 @@
 #endif
 #if PY_VERSION_HEX >= 0x030500B2 || defined(PyCoro_CheckExact)
     if (PyCoro_CheckExact(obj)) {
         return __Pyx_NewRef(obj);
     } else
 #endif
 #if CYTHON_COMPILING_IN_CPYTHON && defined(CO_ITERABLE_COROUTINE)
+#if PY_VERSION_HEX >= 0x030C00A6
+    if (PyGen_CheckExact(obj) && (PyGen_GetCode(obj)->co_flags & CO_ITERABLE_COROUTINE)) {
+#else
     if (PyGen_CheckExact(obj) && ((PyGenObject*)obj)->gi_code && ((PyCodeObject *)((PyGenObject*)obj)->gi_code)->co_flags & CO_ITERABLE_COROUTINE) {
+#endif
         return __Pyx_NewRef(obj);
     } else
 #endif
     {
         PyObject *method = NULL;
         int is_method = __Pyx_PyObject_GetMethod(obj, __pyx_n_s_await, &method);
         if (likely(is_method)) {
@@ -11809,15 +11845,15 @@
                  "object %.100s can't be used in 'await' expression",
                  Py_TYPE(obj)->tp_name);
 bad:
     return NULL;
 }
 
 /* PyObjectCallMethod0 */
-static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name) {
+  static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name) {
     PyObject *method = NULL, *result = NULL;
     int is_method = __Pyx_PyObject_GetMethod(obj, method_name, &method);
     if (likely(is_method)) {
         result = __Pyx_PyObject_CallOneArg(method, obj);
         Py_DECREF(method);
         return result;
     }
@@ -11825,15 +11861,15 @@
     result = __Pyx_PyObject_CallNoArg(method);
     Py_DECREF(method);
 bad:
     return result;
 }
 
 /* AsyncIter */
-static PyObject *__Pyx_Coroutine_GetAsyncIter_Generic(PyObject *obj) {
+  static PyObject *__Pyx_Coroutine_GetAsyncIter_Generic(PyObject *obj) {
 #if PY_VERSION_HEX < 0x030500B1
     {
         PyObject *iter = __Pyx_PyObject_CallMethod0(obj, __pyx_n_s_aiter);
         if (likely(iter))
             return iter;
         if (!PyErr_ExceptionMatches(PyExc_AttributeError))
             return NULL;
@@ -11888,15 +11924,15 @@
         }
     }
 #endif
     return __Pyx__Coroutine_AsyncIterNext(obj);
 }
 
 /* FetchCommonType */
-static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type) {
+  static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type) {
     PyObject* fake_module;
     PyTypeObject* cached_type = NULL;
     fake_module = PyImport_AddModule((char*) "_cython_" CYTHON_ABI);
     if (!fake_module) return NULL;
     Py_INCREF(fake_module);
     cached_type = (PyTypeObject*) PyObject_GetAttrString(fake_module, type->tp_name);
     if (cached_type) {
@@ -11927,15 +11963,15 @@
 bad:
     Py_XDECREF(cached_type);
     cached_type = NULL;
     goto done;
 }
 
 /* RaiseException */
-#if PY_MAJOR_VERSION < 3
+  #if PY_MAJOR_VERSION < 3
 static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb,
                         CYTHON_UNUSED PyObject *cause) {
     __Pyx_PyThreadState_declare
     Py_XINCREF(type);
     if (!value || value == Py_None)
         value = NULL;
     else
@@ -12063,38 +12099,38 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
 
 /* SwapException */
-#if CYTHON_FAST_THREAD_STATE
+  #if CYTHON_FAST_THREAD_STATE
 static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
     PyObject *tmp_type, *tmp_value, *tmp_tb;
     #if CYTHON_USE_EXC_INFO_STACK
     _PyErr_StackItem *exc_info = tstate->exc_info;
     tmp_type = exc_info->exc_type;
     tmp_value = exc_info->exc_value;
     tmp_tb = exc_info->exc_traceback;
@@ -12121,15 +12157,15 @@
     *type = tmp_type;
     *value = tmp_value;
     *tb = tmp_tb;
 }
 #endif
 
 /* PyObjectCallMethod1 */
-static PyObject* __Pyx__PyObject_CallMethod1(PyObject* method, PyObject* arg) {
+  static PyObject* __Pyx__PyObject_CallMethod1(PyObject* method, PyObject* arg) {
     PyObject *result = __Pyx_PyObject_CallOneArg(method, arg);
     Py_DECREF(method);
     return result;
 }
 static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg) {
     PyObject *method = NULL, *result;
     int is_method = __Pyx_PyObject_GetMethod(obj, method_name, &method);
@@ -12139,15 +12175,15 @@
         return result;
     }
     if (unlikely(!method)) return NULL;
     return __Pyx__PyObject_CallMethod1(method, arg);
 }
 
 /* CoroutineBase */
-#include <structmember.h>
+  #include <structmember.h>
 #include <frameobject.h>
 #if PY_VERSION_HEX >= 0x030b00a6
   #ifndef Py_BUILD_CORE
     #define Py_BUILD_CORE 1
   #endif
   #include "internal/pycore_frame.h"
 #endif
@@ -12933,15 +12969,15 @@
     gen->gi_code = code;
     gen->gi_frame = NULL;
     PyObject_GC_Track(gen);
     return gen;
 }
 
 /* PyObject_GenericGetAttrNoDict */
-#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
+  #if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
 static PyObject *__Pyx_RaiseGenericGetAttributeError(PyTypeObject *tp, PyObject *attr_name) {
     PyErr_Format(PyExc_AttributeError,
 #if PY_MAJOR_VERSION >= 3
                  "'%.50s' object has no attribute '%U'",
                  tp->tp_name, attr_name);
 #else
                  "'%.50s' object has no attribute '%.400s'",
@@ -12973,15 +13009,15 @@
         }
     }
     return descr;
 }
 #endif
 
 /* PatchModuleWithCoroutine */
-static PyObject* __Pyx_Coroutine_patch_module(PyObject* module, const char* py_code) {
+  static PyObject* __Pyx_Coroutine_patch_module(PyObject* module, const char* py_code) {
 #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
     int result;
     PyObject *globals, *result_obj;
     globals = PyDict_New();  if (unlikely(!globals)) goto ignore;
     result = PyDict_SetItemString(globals, "_cython_coroutine_type",
     #ifdef __Pyx_Coroutine_USED
         (PyObject*)__pyx_CoroutineType);
@@ -13013,15 +13049,15 @@
 #else
     py_code++;
 #endif
     return module;
 }
 
 /* PatchGeneratorABC */
-#ifndef CYTHON_REGISTER_ABCS
+  #ifndef CYTHON_REGISTER_ABCS
 #define CYTHON_REGISTER_ABCS 1
 #endif
 #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
 static PyObject* __Pyx_patch_abc_module(PyObject *module);
 static PyObject* __Pyx_patch_abc_module(PyObject *module) {
     module = __Pyx_Coroutine_patch_module(
         module, ""
@@ -13070,15 +13106,15 @@
 #else
     if ((0)) __Pyx_Coroutine_patch_module(NULL, NULL);
 #endif
     return 0;
 }
 
 /* Coroutine */
-static void __Pyx_CoroutineAwait_dealloc(PyObject *self) {
+  static void __Pyx_CoroutineAwait_dealloc(PyObject *self) {
     PyObject_GC_UnTrack(self);
     Py_CLEAR(((__pyx_CoroutineAwaitObject*)self)->coroutine);
     PyObject_GC_Del(self);
 }
 static int __Pyx_CoroutineAwait_traverse(__pyx_CoroutineAwaitObject *self, visitproc visit, void *arg) {
     Py_VISIT(self->coroutine);
     return 0;
@@ -13347,15 +13383,15 @@
     __pyx_CoroutineAwaitType = __Pyx_FetchCommonType(&__pyx_CoroutineAwaitType_type);
     if (unlikely(!__pyx_CoroutineAwaitType))
         return -1;
     return 0;
 }
 
 /* CoroutineYieldFrom */
-static PyObject* __Pyx__Coroutine_Yield_From_Generic(__pyx_CoroutineObject *gen, PyObject *source) {
+  static PyObject* __Pyx__Coroutine_Yield_From_Generic(__pyx_CoroutineObject *gen, PyObject *source) {
     PyObject *retval;
     PyObject *source_gen = __Pyx__Coroutine_GetAwaitableIter(source);
     if (unlikely(!source_gen)) {
         return NULL;
     }
     if (__Pyx_Coroutine_Check(source_gen)) {
         retval = __Pyx_Generator_Next(source_gen);
@@ -13394,15 +13430,15 @@
         Py_INCREF(source);
         gen->yieldfrom = source;
     }
     return retval;
 }
 
 /* StopAsyncIteration */
-#if PY_VERSION_HEX < 0x030500B1
+  #if PY_VERSION_HEX < 0x030500B1
 static PyTypeObject __Pyx__PyExc_StopAsyncIteration_type = {
     PyVarObject_HEAD_INIT(0, 0)
     "StopAsyncIteration",
     sizeof(PyBaseExceptionObject),
     0,
     0,
     0,
@@ -13478,15 +13514,15 @@
     if (builtins && unlikely(PyMapping_SetItemString(builtins, (char*) "StopAsyncIteration", __Pyx_PyExc_StopAsyncIteration) < 0))
         return -1;
 #endif
     return 0;
 }
 
 /* SliceObject */
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(PyObject* obj,
+  static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(PyObject* obj,
         Py_ssize_t cstart, Py_ssize_t cstop,
         PyObject** _py_start, PyObject** _py_stop, PyObject** _py_slice,
         int has_cstart, int has_cstop, CYTHON_UNUSED int wraparound) {
 #if CYTHON_USE_TYPE_SLOTS
     PyMappingMethods* mp;
 #if PY_MAJOR_VERSION < 3
     PySequenceMethods* ms = Py_TYPE(obj)->tp_as_sequence;
@@ -13575,15 +13611,15 @@
     PyErr_Format(PyExc_TypeError,
         "'%.200s' object is unsliceable", Py_TYPE(obj)->tp_name);
 bad:
     return NULL;
 }
 
 /* DictGetItem */
-#if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY
+  #if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY
 static PyObject *__Pyx_PyDict_GetItem(PyObject *d, PyObject* key) {
     PyObject *value;
     value = PyDict_GetItemWithError(d, key);
     if (unlikely(!value)) {
         if (!PyErr_Occurred()) {
             if (unlikely(PyTuple_Check(key))) {
                 PyObject* args = PyTuple_Pack(1, key);
@@ -13599,15 +13635,15 @@
     }
     Py_INCREF(value);
     return value;
 }
 #endif
 
 /* RaiseArgTupleInvalid */
-static void __Pyx_RaiseArgtupleInvalid(
+  static void __Pyx_RaiseArgtupleInvalid(
     const char* func_name,
     int exact,
     Py_ssize_t num_min,
     Py_ssize_t num_max,
     Py_ssize_t num_found)
 {
     Py_ssize_t num_expected;
@@ -13625,29 +13661,29 @@
     PyErr_Format(PyExc_TypeError,
                  "%.200s() takes %.8s %" CYTHON_FORMAT_SSIZE_T "d positional argument%.1s (%" CYTHON_FORMAT_SSIZE_T "d given)",
                  func_name, more_or_less, num_expected,
                  (num_expected == 1) ? "" : "s", num_found);
 }
 
 /* RaiseDoubleKeywords */
-static void __Pyx_RaiseDoubleKeywordsError(
+  static void __Pyx_RaiseDoubleKeywordsError(
     const char* func_name,
     PyObject* kw_name)
 {
     PyErr_Format(PyExc_TypeError,
         #if PY_MAJOR_VERSION >= 3
         "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
         #else
         "%s() got multiple values for keyword argument '%s'", func_name,
         PyString_AsString(kw_name));
         #endif
 }
 
 /* ParseKeywords */
-static int __Pyx_ParseOptionalKeywords(
+  static int __Pyx_ParseOptionalKeywords(
     PyObject *kwds,
     PyObject **argnames[],
     PyObject *kwds2,
     PyObject *values[],
     Py_ssize_t num_pos_args,
     const char* function_name)
 {
@@ -13741,47 +13777,65 @@
         function_name, key);
     #endif
 bad:
     return -1;
 }
 
 /* TypeImport */
-#ifndef __PYX_HAVE_RT_ImportType
+  #ifndef __PYX_HAVE_RT_ImportType
 #define __PYX_HAVE_RT_ImportType
 static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, enum __Pyx_ImportType_CheckSize check_size)
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
+    Py_ssize_t itemsize;
 #ifdef Py_LIMITED_API
     PyObject *py_basicsize;
+    PyObject *py_itemsize;
 #endif
     result = PyObject_GetAttrString(module, class_name);
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
         PyErr_Format(PyExc_TypeError,
             "%.200s.%.200s is not a type object",
             module_name, class_name);
         goto bad;
     }
 #ifndef Py_LIMITED_API
     basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
 #else
     py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
     if (!py_basicsize)
         goto bad;
     basicsize = PyLong_AsSsize_t(py_basicsize);
     Py_DECREF(py_basicsize);
     py_basicsize = 0;
     if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
         goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
 #endif
-    if ((size_t)basicsize < size) {
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
     if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
@@ -13802,15 +13856,15 @@
 bad:
     Py_XDECREF(result);
     return NULL;
 }
 #endif
 
 /* GetVTable */
-static void* __Pyx_GetVtable(PyObject *dict) {
+  static void* __Pyx_GetVtable(PyObject *dict) {
     void* ptr;
     PyObject *ob = PyObject_GetItem(dict, __pyx_n_s_pyx_vtable);
     if (!ob)
         goto bad;
 #if PY_VERSION_HEX >= 0x02070000
     ptr = PyCapsule_GetPointer(ob, 0);
 #else
@@ -13822,15 +13876,15 @@
     return ptr;
 bad:
     Py_XDECREF(ob);
     return NULL;
 }
 
 /* Import */
-static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
+  static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
     PyObject *empty_list = 0;
     PyObject *module = 0;
     PyObject *global_dict = 0;
     PyObject *empty_dict = 0;
     PyObject *list;
     #if PY_MAJOR_VERSION < 3
     PyObject *py_import;
@@ -13887,16 +13941,16 @@
     #endif
     Py_XDECREF(empty_list);
     Py_XDECREF(empty_dict);
     return module;
 }
 
 /* CLineInTraceback */
-#ifndef CYTHON_CLINE_IN_TRACEBACK
-static int __Pyx_CLineForTraceback(CYTHON_NCP_UNUSED PyThreadState *tstate, int c_line) {
+  #ifndef CYTHON_CLINE_IN_TRACEBACK
+static int __Pyx_CLineForTraceback(CYTHON_UNUSED PyThreadState *tstate, int c_line) {
     PyObject *use_cline;
     PyObject *ptype, *pvalue, *ptraceback;
 #if CYTHON_COMPILING_IN_CPYTHON
     PyObject **cython_runtime_dict;
 #endif
     if (unlikely(!__pyx_cython_runtime)) {
         return c_line;
@@ -13929,15 +13983,15 @@
     }
     __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
     return c_line;
 }
 #endif
 
 /* CodeObjectCache */
-static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
+  static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
     int start = 0, mid = 0, end = count - 1;
     if (end >= 0 && code_line > entries[end].code_line) {
         return count;
     }
     while (start < end) {
         mid = start + (end - start) / 2;
         if (code_line < entries[mid].code_line) {
@@ -14009,15 +14063,15 @@
     entries[pos].code_line = code_line;
     entries[pos].code_object = code_object;
     __pyx_code_cache.count++;
     Py_INCREF(code_object);
 }
 
 /* AddTraceback */
-#include "compile.h"
+  #include "compile.h"
 #include "frameobject.h"
 #include "traceback.h"
 #if PY_VERSION_HEX >= 0x030b00a6
   #ifndef Py_BUILD_CORE
     #define Py_BUILD_CORE 1
   #endif
   #include "internal/pycore_frame.h"
@@ -14116,15 +14170,15 @@
     PyTraceBack_Here(py_frame);
 bad:
     Py_XDECREF(py_code);
     Py_XDECREF(py_frame);
 }
 
 /* CIntFromPyVerify */
-#define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
+  #define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
     __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
 #define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
     __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
 #define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
     {\
         func_type value = func_value;\
         if (sizeof(target_type) < sizeof(func_type)) {\
@@ -14138,15 +14192,15 @@
                     goto raise_overflow;\
             }\
         }\
         return (target_type) value;\
     }
 
 /* CIntFromPy */
-static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
+  static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const int neg_one = (int) -1, const_zero = (int) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -14334,15 +14388,15 @@
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to int");
     return (int) -1;
 }
 
 /* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
+  static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const long neg_one = (long) -1, const_zero = (long) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -14372,15 +14426,15 @@
         unsigned char *bytes = (unsigned char *)&value;
         return _PyLong_FromByteArray(bytes, sizeof(long),
                                      little, !is_unsigned);
     }
 }
 
 /* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
+  static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const int neg_one = (int) -1, const_zero = (int) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -14410,15 +14464,15 @@
         unsigned char *bytes = (unsigned char *)&value;
         return _PyLong_FromByteArray(bytes, sizeof(int),
                                      little, !is_unsigned);
     }
 }
 
 /* CIntFromPy */
-static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
+  static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const long neg_one = (long) -1, const_zero = (long) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
@@ -14606,15 +14660,15 @@
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to long");
     return (long) -1;
 }
 
 /* FastTypeChecks */
-#if CYTHON_COMPILING_IN_CPYTHON
+  #if CYTHON_COMPILING_IN_CPYTHON
 static int __Pyx_InBases(PyTypeObject *a, PyTypeObject *b) {
     while (a) {
         a = a->tp_base;
         if (a == b)
             return 1;
     }
     return b == &PyBaseObject_Type;
@@ -14706,15 +14760,15 @@
         return __Pyx_inner_PyErr_GivenExceptionMatches2(err, exc_type1, exc_type2);
     }
     return (PyErr_GivenExceptionMatches(err, exc_type1) || PyErr_GivenExceptionMatches(err, exc_type2));
 }
 #endif
 
 /* AsyncGeneratorInitFinalizer */
-#if PY_VERSION_HEX < 0x030600B0
+  #if PY_VERSION_HEX < 0x030600B0
 static int __Pyx_async_gen_init_hooks(__pyx_PyAsyncGenObject *o) {
 #if 0
     PyThreadState *tstate;
     PyObject *finalizer;
     PyObject *firstiter;
 #endif
     if (likely(o->ag_hooks_inited)) {
@@ -14741,15 +14795,15 @@
     }
 #endif
     return 0;
 }
 #endif
 
 /* ReturnWithStopIteration */
-static void __Pyx__ReturnWithStopIteration(PyObject* value) {
+  static void __Pyx__ReturnWithStopIteration(PyObject* value) {
     PyObject *exc, *args;
 #if CYTHON_COMPILING_IN_CPYTHON || CYTHON_COMPILING_IN_PYSTON
     __Pyx_PyThreadState_declare
     if ((PY_VERSION_HEX >= 0x03030000 && PY_VERSION_HEX < 0x030500B1)
             || unlikely(PyTuple_Check(value) || PyExceptionInstance_Check(value))) {
         args = PyTuple_New(1);
         if (unlikely(!args)) return;
@@ -14783,15 +14837,15 @@
     if (unlikely(!exc)) return;
 #endif
     PyErr_SetObject(PyExc_StopIteration, exc);
     Py_DECREF(exc);
 }
 
 /* AsyncGenerator */
-PyDoc_STRVAR(__Pyx_async_gen_send_doc,
+  PyDoc_STRVAR(__Pyx_async_gen_send_doc,
 "send(arg) -> send 'arg' into generator,\n\
 return next yielded value or raise StopIteration.");
 PyDoc_STRVAR(__Pyx_async_gen_close_doc,
 "close() -> raise GeneratorExit inside generator.");
 PyDoc_STRVAR(__Pyx_async_gen_throw_doc,
 "throw(typ[,val[,tb]]) -> raise exception in generator,\n\
 return next yielded value or raise StopIteration.");
@@ -15615,18 +15669,18 @@
     __pyx__PyAsyncGenASendType = __Pyx_FetchCommonType(&__pyx__PyAsyncGenASendType_type);
     if (unlikely(!__pyx__PyAsyncGenASendType))
         return -1;
     return 0;
 }
 
 /* AsyncGen */
-
+  
 
 /* Generator */
-static PyMethodDef __pyx_Generator_methods[] = {
+  static PyMethodDef __pyx_Generator_methods[] = {
     {"send", (PyCFunction) __Pyx_Coroutine_Send, METH_O,
      (char*) PyDoc_STR("send(arg) -> send 'arg' into generator,\nreturn next yielded value or raise StopIteration.")},
     {"throw", (PyCFunction) __Pyx_Coroutine_Throw, METH_VARARGS,
      (char*) PyDoc_STR("throw(typ[,val[,tb]]) -> raise exception in generator,\nreturn next yielded value or raise StopIteration.")},
     {"close", (PyCFunction) __Pyx_Coroutine_Close_Method, METH_NOARGS,
      (char*) PyDoc_STR("close() -> raise GeneratorExit inside generator.")},
     {0, 0, 0, 0}
@@ -15721,15 +15775,15 @@
     if (unlikely(!__pyx_GeneratorType)) {
         return -1;
     }
     return 0;
 }
 
 /* CheckBinaryVersion */
-static int __Pyx_check_binary_version(void) {
+  static int __Pyx_check_binary_version(void) {
     char ctversion[5];
     int same=1, i, found_dot;
     const char* rt_from_call = Py_GetVersion();
     PyOS_snprintf(ctversion, 5, "%d.%d", PY_MAJOR_VERSION, PY_MINOR_VERSION);
     found_dot = 0;
     for (i = 0; i < 4; i++) {
         if (!ctversion[i]) {
@@ -15759,15 +15813,15 @@
                       ctversion, __Pyx_MODULE_NAME, rtversion);
         return PyErr_WarnEx(NULL, message, 1);
     }
     return 0;
 }
 
 /* FunctionExport */
-static int __Pyx_ExportFunction(const char *name, void (*f)(void), const char *sig) {
+  static int __Pyx_ExportFunction(const char *name, void (*f)(void), const char *sig) {
     PyObject *d = 0;
     PyObject *cobj = 0;
     union {
         void (*fp)(void);
         void *p;
     } tmp;
     d = PyObject_GetAttrString(__pyx_m, (char *)"__pyx_capi__");
@@ -15796,15 +15850,15 @@
 bad:
     Py_XDECREF(cobj);
     Py_XDECREF(d);
     return -1;
 }
 
 /* FunctionImport */
-#ifndef __PYX_HAVE_RT_ImportFunction
+  #ifndef __PYX_HAVE_RT_ImportFunction
 #define __PYX_HAVE_RT_ImportFunction
 static int __Pyx_ImportFunction(PyObject *module, const char *funcname, void (**f)(void), const char *sig) {
     PyObject *d = 0;
     PyObject *cobj = 0;
     union {
         void (*fp)(void);
         void *p;
@@ -15850,15 +15904,15 @@
 bad:
     Py_XDECREF(d);
     return -1;
 }
 #endif
 
 /* InitStrings */
-static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
+  static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
     while (t->p) {
         #if PY_MAJOR_VERSION < 3
         if (t->is_unicode) {
             *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
         } else if (t->intern) {
             *t->p = PyString_InternFromString(t->s);
         } else {
```

### Comparing `blacksheep-2.0a5/blacksheep/scribe.pxd` & `blacksheep-2.0a6/blacksheep/scribe.pxd`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/scribe.pyi` & `blacksheep-2.0a6/blacksheep/scribe.pyi`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/scribe.pyx` & `blacksheep-2.0a6/blacksheep/scribe.pyx`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/application.py` & `blacksheep-2.0a6/blacksheep/server/application.py`

 * *Files 2% similar despite different names*

```diff
@@ -54,21 +54,24 @@
 from blacksheep.server.files import DefaultFileOptions
 from blacksheep.server.files.dynamic import serve_files_dynamic
 from blacksheep.server.normalization import normalize_handler, normalize_middleware
 from blacksheep.server.responses import _ensure_bytes
 from blacksheep.server.routing import (
     MountRegistry,
     RegisteredRoute,
+    RouteMethod,
     Router,
     RoutesRegistry,
 )
+from blacksheep.server.routing import router as default_router
 from blacksheep.server.websocket import WebSocket
 from blacksheep.sessions import SessionMiddleware, SessionSerializer
 from blacksheep.settings.di import di_settings
 from blacksheep.utils import ensure_bytes, join_fragments
+from blacksheep.utils.meta import get_parent_file, import_child_modules
 
 
 def get_default_headers_middleware(
     headers: Sequence[Tuple[str, str]],
 ) -> Callable[..., Awaitable[Response]]:
     raw_headers = tuple((name.encode(), value.encode()) for name, value in headers)
 
@@ -148,15 +151,15 @@
     async def fire(self, *args: Any, **keywargs: Any) -> None:
         raise TypeError(
             "The event handlers in this ApplicationEvent must be synchronous!"
         )
 
 
 class ApplicationStartupError(RuntimeError):
-    ...
+    """Base class for errors occurring when an application starts."""
 
 
 class ApplicationAlreadyStartedCORSError(TypeError):
     def __init__(self) -> None:
         super().__init__(
             "The application is already running, configure CORS rules "
             "before starting the application"
@@ -169,32 +172,28 @@
     """
 
     def __init__(
         self,
         *,
         router: Optional[Router] = None,
         services: Optional[ContainerProtocol] = None,
-        debug: bool = False,
-        show_error_details: Optional[bool] = None,
+        show_error_details: bool = False,
         mount: Optional[MountRegistry] = None,
     ):
         env_settings = EnvironmentSettings()
         if router is None:
-            router = Router()
+            router = default_router if env_settings.use_default_router else Router()
         if services is None:
             services = di_settings.get_default_container()
-        if show_error_details is None:
-            show_error_details = env_settings.show_error_details
         if mount is None:
             mount = MountRegistry(env_settings.mount_auto_events)
-        super().__init__(show_error_details, router)
+        super().__init__(show_error_details or env_settings.show_error_details, router)
 
         assert services is not None
         self._services: ContainerProtocol = services
-        self.debug = debug
         self.middlewares: List[Callable[..., Awaitable[Response]]] = []
         self._default_headers: Optional[Tuple[Tuple[str, str], ...]] = None
         self._middlewares_configured = False
         self._cors_strategy: Optional[CORSStrategy] = None
         self._authentication_strategy: Optional[AuthenticationStrategy] = None
         self._authorization_strategy: Optional[AuthorizationStrategy] = None
         self.on_start = ApplicationEvent(self)
@@ -204,14 +203,19 @@
         self.started = False
         self.controllers_router: RoutesRegistry = controllers_router
         self.files_handler = FilesHandler()
         self.server_error_details_handler = ServerErrorDetailsHandler()
         self._session_middleware: Optional[SessionMiddleware] = None
         self.base_path: str = ""
         self._mount_registry = mount
+        parent_file = get_parent_file()
+
+        if parent_file:
+            _auto_import_controllers(parent_file)
+            _auto_import_routes(parent_file)
 
     @property
     def services(self) -> ContainerProtocol:
         """
         Returns the object that provides services of this application.
         """
         return self._services
@@ -726,15 +730,18 @@
         message = await receive()
         assert message["type"] == "lifespan.shutdown"
         await self.stop()
         await send({"type": "lifespan.shutdown.complete"})
 
     async def _handle_websocket(self, scope, receive, send):
         ws = WebSocket(scope, receive, send)
-        route = self.router.get_ws_match(scope["path"])
+        # TODO: support filters
+        route = self.router.get_match_by_method_and_path(
+            RouteMethod.GET_WS, scope["path"]
+        )
 
         if route:
             ws.route_values = route.values
             try:
                 return await route.handler(ws)
             except UnauthorizedError:
                 await ws.close(401, "Unauthorized")
@@ -818,7 +825,22 @@
                 raw_path = scope["raw_path"]
                 if raw_path == route.pattern.rstrip(b"/*") and scope["type"] == "http":
                     return await self._handle_redirect_to_mount_root(scope, send)
                 self.handle_mount_path(scope, route_match)
                 return await route.handler(scope, receive, send)
 
         return await super().__call__(scope, receive, send)  # type: ignore
+
+
+def _auto_import(parent_file: str, folder_name):
+    parent_folder = Path(parent_file).parent
+    controllers_path = parent_folder / folder_name
+    if controllers_path.exists():
+        import_child_modules(controllers_path)
+
+
+def _auto_import_controllers(parent_file: str):
+    _auto_import(parent_file, "controllers")
+
+
+def _auto_import_routes(parent_file: str):
+    _auto_import(parent_file, "routes")
```

### Comparing `blacksheep-2.0a5/blacksheep/server/asgi.py` & `blacksheep-2.0a6/blacksheep/server/asgi.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/authentication/__init__.py` & `blacksheep-2.0a6/blacksheep/server/authentication/__init__.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/authentication/cookie.py` & `blacksheep-2.0a6/blacksheep/server/authentication/cookie.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/authentication/jwt.py` & `blacksheep-2.0a6/blacksheep/server/authentication/jwt.py`

 * *Files 0% similar despite different names*

```diff
@@ -28,15 +28,15 @@
         valid_audiences: Sequence[str],
         valid_issuers: Optional[Sequence[str]] = None,
         authority: Optional[str] = None,
         require_kid: bool = True,
         keys_provider: Optional[KeysProvider] = None,
         keys_url: Optional[str] = None,
         cache_time: float = 10800,
-        auth_mode: str = "JWT Bearer"
+        auth_mode: str = "JWT Bearer",
     ):
         """
         Creates a new instance of JWTBearerAuthentication, which tries to
         obtains the identity of the user from the "Authorization" request header,
         handling JWT Bearer tokens. Only standard authorization headers starting
         with the `Bearer ` string are handled.
```

### Comparing `blacksheep-2.0a5/blacksheep/server/authentication/oidc.py` & `blacksheep-2.0a6/blacksheep/server/authentication/oidc.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/authorization/__init__.py` & `blacksheep-2.0a6/blacksheep/server/authorization/__init__.py`

 * *Files 0% similar despite different names*

```diff
@@ -20,15 +20,15 @@
     "Policy",
 )
 
 
 def auth(
     policy: Optional[str] = "authenticated",
     *,
-    authentication_schemes: Optional[Sequence[str]] = None
+    authentication_schemes: Optional[Sequence[str]] = None,
 ) -> Callable[..., Any]:
     """
     Configures authorization for a decorated request handler, optionally with a policy.
     If no policy is specified, the default policy to require authenticated users is
     used.
 
     :param policy: optional, name of the policy to use for authorization.
```

### Comparing `blacksheep-2.0a5/blacksheep/server/bindings.py` & `blacksheep-2.0a6/blacksheep/server/bindings.py`

 * *Files 2% similar despite different names*

```diff
@@ -461,15 +461,22 @@
             from blacksheep.server.normalization import (
                 UnsupportedForwardRefInSignatureError,
             )
 
             raise UnsupportedForwardRefInSignatureError(expected_type)
 
         item_converter = self._get_default_converter_single(item_type)
-        return lambda values: generic_type(item_converter(value) for value in values)
+
+        def list_converter(values):
+            if not isinstance(values, list):
+                raise BadRequest("Invalid input: expected a list of objects.")
+
+            return generic_type(item_converter(value) for value in values)
+
+        return list_converter
 
     def get_default_binder_for_body(self, expected_type: Type):
         if self.is_generic_iterable_annotation(expected_type) or expected_type in {
             list,
             set,
             tuple,
         }:
```

### Comparing `blacksheep-2.0a5/blacksheep/server/controllers.py` & `blacksheep-2.0a6/blacksheep/server/controllers.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/cors.py` & `blacksheep-2.0a6/blacksheep/server/cors.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/csrf.py` & `blacksheep-2.0a6/blacksheep/server/csrf.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/dataprotection.py` & `blacksheep-2.0a6/blacksheep/server/dataprotection.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/di.py` & `blacksheep-2.0a6/blacksheep/server/di.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/errors.py` & `blacksheep-2.0a6/blacksheep/server/errors.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/files/__init__.py` & `blacksheep-2.0a6/blacksheep/server/files/__init__.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/files/dynamic.py` & `blacksheep-2.0a6/blacksheep/server/files/dynamic.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/files/static.py` & `blacksheep-2.0a6/blacksheep/server/files/static.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/headers/cache.py` & `blacksheep-2.0a6/blacksheep/server/headers/cache.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/normalization.py` & `blacksheep-2.0a6/blacksheep/server/normalization.py`

 * *Files 1% similar despite different names*

```diff
@@ -108,15 +108,15 @@
             value.annotation = annotations[key]
     return params
 
 
 # endregion
 
 
-def ensure_response(result) -> Response:
+def ensure_response(result) -> Optional[Response]:
     """
     When a request handler returns a result that is not an instance of Response,
     this method normalizes the output of the method to be either `None`. or an instance
     of `blacksheep.messages.Response` class.
 
     Use this method in custom decorators for request handlers.
     """
```

### Comparing `blacksheep-2.0a5/blacksheep/server/openapi/common.py` & `blacksheep-2.0a6/blacksheep/server/openapi/common.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/openapi/docstrings.py` & `blacksheep-2.0a6/blacksheep/server/openapi/docstrings.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/openapi/exceptions.py` & `blacksheep-2.0a6/blacksheep/server/openapi/exceptions.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/openapi/ui.py` & `blacksheep-2.0a6/blacksheep/server/openapi/ui.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/openapi/v3.py` & `blacksheep-2.0a6/blacksheep/server/openapi/v3.py`

 * *Files 2% similar despite different names*

```diff
@@ -22,15 +22,15 @@
     Parameter,
     ParameterLocation,
     PathItem,
     Reference,
     RequestBody,
 )
 from openapidocs.v3 import Response as ResponseDoc
-from openapidocs.v3 import Schema, Server, ValueFormat, ValueType
+from openapidocs.v3 import Schema, Server, Tag, ValueFormat, ValueType
 
 from blacksheep.server.bindings import (
     Binder,
     BodyBinder,
     CookieBinder,
     HeaderBinder,
     QueryBinder,
@@ -274,23 +274,25 @@
         *,
         info: Info,
         ui_path: str = "/docs",
         json_spec_path: str = "/openapi.json",
         yaml_spec_path: str = "/openapi.yaml",
         preferred_format: Format = Format.JSON,
         anonymous_access: bool = True,
+        tags: Optional[List[Tag]] = None,
     ) -> None:
         super().__init__(
             ui_path=ui_path,
             json_spec_path=json_spec_path,
             yaml_spec_path=yaml_spec_path,
             preferred_format=preferred_format,
             anonymous_access=anonymous_access,
         )
         self.info = info
+        self._tags = tags
         self.components = Components()
         self._objects_references: Dict[Any, Reference] = {}
         self.servers: List[Server] = []
         self.common_responses: Dict[ResponseStatusType, ResponseDoc] = {}
         self._object_types_handlers: List[ObjectTypeHandler] = [
             DataClassTypeHandler(),
             PydanticModelTypeHandler(),
@@ -302,18 +304,45 @@
     @property
     def object_types_handlers(self) -> List[ObjectTypeHandler]:
         return self._object_types_handlers
 
     def get_ui_page_title(self) -> str:
         return self.info.title
 
+    def _iter_tags(self, paths: Dict[str, PathItem]) -> Iterable[str]:
+        methods = (
+            "get",
+            "post",
+            "put",
+            "delete",
+            "options",
+            "head",
+            "patch",
+            "trace",
+        )
+
+        for path in paths.values():
+            for method in methods:
+                prop: Optional[Operation] = getattr(path, method)
+
+                if prop is not None and prop.tags is not None:
+                    yield from prop.tags
+
+    def _tags_from_paths(self, paths: Dict[str, PathItem]) -> List[Tag]:
+        unique_tags = set(self._iter_tags(paths))
+        return [Tag(name=name) for name in sorted(unique_tags)]
+
     def generate_documentation(self, app: Application) -> OpenAPI:
         self._optimize_binders_docs()
+        paths = self.get_paths(app)
         return OpenAPI(
-            info=self.info, paths=self.get_paths(app), components=self.components
+            info=self.info,
+            paths=paths,
+            components=self.components,
+            tags=self._tags or self._tags_from_paths(paths),
         )
 
     def get_paths(self, app: Application, path_prefix: str = "") -> Dict[str, PathItem]:
         own_paths = self.get_routes_docs(app.router, path_prefix)
 
         if app.mount_registry.mounted_apps and app.mount_registry.handle_docs:
             for route in app.mount_registry.mounted_apps:
```

### Comparing `blacksheep-2.0a5/blacksheep/server/remotes/forwarding.py` & `blacksheep-2.0a6/blacksheep/server/remotes/forwarding.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/remotes/hosts.py` & `blacksheep-2.0a6/blacksheep/server/remotes/hosts.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/rendering/abc.py` & `blacksheep-2.0a6/blacksheep/server/rendering/abc.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/rendering/jinja2.py` & `blacksheep-2.0a6/blacksheep/server/rendering/jinja2.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/res/error.css` & `blacksheep-2.0a6/blacksheep/server/res/error.css`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/res/error.html` & `blacksheep-2.0a6/blacksheep/server/res/error.html`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/res/redoc-ui.html` & `blacksheep-2.0a6/blacksheep/server/res/redoc-ui.html`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/res/swagger-ui.html` & `blacksheep-2.0a6/blacksheep/server/res/swagger-ui.html`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/responses.py` & `blacksheep-2.0a6/blacksheep/server/responses.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/server/routing.py` & `blacksheep-2.0a6/blacksheep/server/routing.py`

 * *Files 3% similar despite different names*

```diff
@@ -12,25 +12,14 @@
     ParamsType,
     normalize_headers,
     normalize_params,
 )
 from blacksheep.messages import Request
 from blacksheep.utils import ensure_bytes, ensure_str
 
-__all__ = [
-    "HTTPMethod",
-    "Router",
-    "Route",
-    "RouteMatch",
-    "RouteDuplicate",
-    "RegisteredRoute",
-    "RoutesRegistry",
-    "RouteMethod",
-]
-
 
 class RouteMethod:
     GET = "GET"
     GET_WS = "GET_WS"
     HEAD = "HEAD"
     POST = "POST"
     PUT = "PUT"
@@ -739,18 +728,14 @@
             if match:
                 return match
         if self._fallback is None:
             return None
 
         return RouteMatch(self._fallback, None)
 
-    def get_ws_match(self, value: AnyStr) -> Optional[RouteMatch]:
-        # TODO: this does not suppor filters
-        return self.get_match_by_method_and_path(RouteMethod.GET_WS, value)
-
     @lru_cache(maxsize=1200)
     def get_matching_route(self, method: AnyStr, value: AnyStr) -> Optional[Route]:
         for route in self.routes[ensure_bytes(method)]:
             match = route.match_by_path(ensure_bytes(value))
             if match:
                 return route
         return None
@@ -839,7 +824,25 @@
             path = f"{path.rstrip('/*')}/*"
 
         self._mounted_apps.append(Route(path, app))
 
 
 # For backward compatibility
 Mount = MountRegistry
+
+
+# singleton router used to store initial configuration,
+# before the application starts
+# this is used as *default* router, but it can be overridden
+router = Router()
+
+
+head = router.head
+get = router.get
+post = router.post
+put = router.put
+patch = router.patch
+delete = router.delete
+trace = router.trace
+options = router.options
+connect = router.connect
+ws = router.ws
```

### Comparing `blacksheep-2.0a5/blacksheep/server/security/hsts.py` & `blacksheep-2.0a6/blacksheep/server/security/hsts.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 from blacksheep.messages import Request, Response
 
 
-def _get_hsts_value(max_age: int, include_subdomains: bool) -> bytes:
+def write_hsts_header_value(max_age: int, include_subdomains: bool) -> bytes:
     value = f"max-age={max_age};"
 
     if include_subdomains:
         value = value + " includeSubDomains;"
 
     return value.encode()
 
@@ -17,13 +17,13 @@
     """
 
     def __init__(
         self,
         max_age: int = 31536000,
         include_subdomains: bool = True,
     ) -> None:
-        self._value = _get_hsts_value(max_age, include_subdomains)
+        self._value = write_hsts_header_value(max_age, include_subdomains)
 
     async def __call__(self, request: Request, handler):
         response: Response = await handler(request)
         response.headers.add(b"Strict-Transport-Security", self._value)
         return response
```

### Comparing `blacksheep-2.0a5/blacksheep/server/websocket.py` & `blacksheep-2.0a6/blacksheep/server/websocket.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/sessions/__init__.py` & `blacksheep-2.0a6/blacksheep/sessions/__init__.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/settings/di.py` & `blacksheep-2.0a6/blacksheep/settings/di.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/settings/html.py` & `blacksheep-2.0a6/blacksheep/settings/html.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/settings/json.py` & `blacksheep-2.0a6/blacksheep/settings/json.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/testing/client.py` & `blacksheep-2.0a6/blacksheep/testing/client.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/testing/helpers.py` & `blacksheep-2.0a6/blacksheep/testing/helpers.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/testing/messages.py` & `blacksheep-2.0a6/blacksheep/testing/messages.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/testing/simulator.py` & `blacksheep-2.0a6/blacksheep/testing/simulator.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/url.c` & `blacksheep-2.0a6/blacksheep/url.c`

 * *Files 0% similar despite different names*

```diff
@@ -1,20 +1,20 @@
-/* Generated by Cython 0.29.32 */
+/* Generated by Cython 0.29.34 */
 
 #ifndef PY_SSIZE_T_CLEAN
 #define PY_SSIZE_T_CLEAN
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_32"
-#define CYTHON_HEX_VERSION 0x001D20F0
+#define CYTHON_ABI "0_29_34"
+#define CYTHON_HEX_VERSION 0x001D22F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -83,15 +83,15 @@
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
-    #define CYTHON_UPDATE_DESCRIPTOR_DOC (PYPY_VERSION_HEX >= 0x07030900)
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
 #elif defined(PYSTON_VERSION)
   #define CYTHON_COMPILING_IN_PYPY 0
   #define CYTHON_COMPILING_IN_PYSTON 1
   #define CYTHON_COMPILING_IN_CPYTHON 0
   #define CYTHON_COMPILING_IN_NOGIL 0
   #ifndef CYTHON_USE_TYPE_SLOTS
@@ -199,15 +199,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -238,15 +238,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -548,35 +548,35 @@
 #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && CYTHON_USE_UNICODE_INTERNALS
 #define __Pyx_PyDict_GetItemStr(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
 #else
 #define __Pyx_PyDict_GetItemStr(dict, name)  PyDict_GetItem(dict, name)
 #endif
 #if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
   #define CYTHON_PEP393_ENABLED 1
-  #if defined(PyUnicode_IS_READY)
-  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
-                                              0 : _PyUnicode_Ready((PyObject *)(op)))
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_READY(op)       (0)
   #else
-  #define __Pyx_PyUnicode_READY(op)       (0)
+    #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
+                                                0 : _PyUnicode_Ready((PyObject *)(op)))
   #endif
   #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
   #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
   #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
   #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
   #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
   #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
   #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, ch)
-  #if defined(PyUnicode_IS_READY) && defined(PyUnicode_GET_SIZE)
-  #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
-  #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
-  #endif
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
   #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
+    #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
+    #else
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
+    #endif
   #endif
 #else
   #define CYTHON_PEP393_ENABLED 0
   #define PyUnicode_1BYTE_KIND  1
   #define PyUnicode_2BYTE_KIND  2
   #define PyUnicode_4BYTE_KIND  4
   #define __Pyx_PyUnicode_READY(op)       (0)
@@ -946,17 +946,17 @@
 static int __pyx_lineno;
 static int __pyx_clineno = 0;
 static const char * __pyx_cfilenm= __FILE__;
 static const char *__pyx_filename;
 
 
 static const char *__pyx_f[] = {
-  "blacksheep/url.pyx",
+  "blacksheep\\url.pyx",
   "stringsource",
-  "blacksheep/url.pxd",
+  "blacksheep\\url.pxd",
 };
 
 /*--- Type declarations ---*/
 struct __pyx_obj_10blacksheep_3url_URL;
 struct __pyx_obj_10blacksheep_3url_InvalidURL;
 
 /* "blacksheep/url.pxd":8
@@ -1232,26 +1232,26 @@
 #define __PYX_GET_DICT_VERSION(dict)  (0)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
 #define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
 #endif
 
 /* GetModuleGlobalName.proto */
 #if CYTHON_USE_DICT_VERSIONS
-#define __Pyx_GetModuleGlobalName(var, name)  {\
+#define __Pyx_GetModuleGlobalName(var, name)  do {\
     static PY_UINT64_T __pyx_dict_version = 0;\
     static PyObject *__pyx_dict_cached_value = NULL;\
     (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
         (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
         __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  {\
+} while(0)
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  do {\
     PY_UINT64_T __pyx_dict_version;\
     PyObject *__pyx_dict_cached_value;\
     (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
+} while(0)
 static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
 #else
 #define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 #define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
 #endif
 
@@ -1582,15 +1582,15 @@
 static const char __pyx_k_reduce_cython[] = "__reduce_cython__";
 static const char __pyx_k_NotImplemented[] = "NotImplemented";
 static const char __pyx_k_blacksheep_url[] = "blacksheep.url";
 static const char __pyx_k_pyx_PickleError[] = "__pyx_PickleError";
 static const char __pyx_k_setstate_cython[] = "__setstate_cython__";
 static const char __pyx_k_httptools_parser[] = "httptools.parser";
 static const char __pyx_k_pyx_unpickle_URL[] = "__pyx_unpickle_URL";
-static const char __pyx_k_blacksheep_url_pyx[] = "blacksheep/url.pyx";
+static const char __pyx_k_blacksheep_url_pyx[] = "blacksheep\\url.pyx";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
 static const char __pyx_k_pyx_unpickle_InvalidURL[] = "__pyx_unpickle_InvalidURL";
 static const char __pyx_k_HttpParserInvalidURLError[] = "HttpParserInvalidURLError";
 static const char __pyx_k_Cannot_concatenate_a_URL_with_qu[] = "Cannot concatenate a URL with query or fragment to another URL portion";
 static const char __pyx_k_Cannot_concatenate_to_an_absolut[] = "Cannot concatenate to an absolute URL (";
 static const char __pyx_k_Cannot_generate_a_URL_from_a_par[] = "Cannot generate a URL from a partial URL";
 static const char __pyx_k_Expected_http_or_https_schema_go[] = "Expected http or https schema; got instead ";
@@ -2122,15 +2122,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_InvalidURL, (type(self), 0xd41d8cd, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_InvalidURL__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_3url___pyx_unpickle_InvalidURL__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_InvalidURL, (type(self), 0xd41d8cd, state)
@@ -2565,15 +2565,15 @@
  *             raise InvalidURL(f'The value cannot be parsed as URL ({value.decode()})')
  *         schema = parsed.schema             # <<<<<<<<<<<<<<
  *         valid_schema(schema)
  * 
  */
   __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_parsed, __pyx_n_s_schema); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 30, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 30, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 30, __pyx_L1_error)
   __pyx_v_schema = ((PyObject*)__pyx_t_7);
   __pyx_t_7 = 0;
 
   /* "blacksheep/url.pyx":31
  *             raise InvalidURL(f'The value cannot be parsed as URL ({value.decode()})')
  *         schema = parsed.schema
  *         valid_schema(schema)             # <<<<<<<<<<<<<<
@@ -2640,15 +2640,15 @@
  *         self.schema = schema
  *         self.host = parsed.host             # <<<<<<<<<<<<<<
  *         self.port = parsed.port or 0
  *         self.path = parsed.path
  */
   __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_parsed, __pyx_n_s_host); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 35, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 35, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 35, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_7);
   __Pyx_GOTREF(__pyx_v_self->host);
   __Pyx_DECREF(__pyx_v_self->host);
   __pyx_v_self->host = ((PyObject*)__pyx_t_7);
   __pyx_t_7 = 0;
 
   /* "blacksheep/url.pyx":36
@@ -2678,15 +2678,15 @@
  *         self.port = parsed.port or 0
  *         self.path = parsed.path             # <<<<<<<<<<<<<<
  *         self.query = parsed.query
  *         self.fragment = parsed.fragment
  */
   __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_parsed, __pyx_n_s_path); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 37, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 37, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 37, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_7);
   __Pyx_GOTREF(__pyx_v_self->path);
   __Pyx_DECREF(__pyx_v_self->path);
   __pyx_v_self->path = ((PyObject*)__pyx_t_7);
   __pyx_t_7 = 0;
 
   /* "blacksheep/url.pyx":38
@@ -2694,15 +2694,15 @@
  *         self.path = parsed.path
  *         self.query = parsed.query             # <<<<<<<<<<<<<<
  *         self.fragment = parsed.fragment
  *         self.is_absolute = parsed.schema is not None
  */
   __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_parsed, __pyx_n_s_query); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 38, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 38, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 38, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_7);
   __Pyx_GOTREF(__pyx_v_self->query);
   __Pyx_DECREF(__pyx_v_self->query);
   __pyx_v_self->query = ((PyObject*)__pyx_t_7);
   __pyx_t_7 = 0;
 
   /* "blacksheep/url.pyx":39
@@ -2710,15 +2710,15 @@
  *         self.query = parsed.query
  *         self.fragment = parsed.fragment             # <<<<<<<<<<<<<<
  *         self.is_absolute = parsed.schema is not None
  * 
  */
   __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_parsed, __pyx_n_s_fragment); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 39, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 39, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 39, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_7);
   __Pyx_GOTREF(__pyx_v_self->fragment);
   __Pyx_DECREF(__pyx_v_self->fragment);
   __pyx_v_self->fragment = ((PyObject*)__pyx_t_7);
   __pyx_t_7 = 0;
 
   /* "blacksheep/url.pyx":40
@@ -3460,15 +3460,15 @@
       __pyx_t_1 = PyUnicode_AsEncodedString(((PyObject*)__pyx_t_3), NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 68, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      if (!(likely(PyBytes_CheckExact(__pyx_t_3))||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 68, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 68, __pyx_L1_error)
       __Pyx_DECREF_SET(__pyx_v_base_url, ((PyObject*)__pyx_t_3));
       __pyx_t_3 = 0;
 
       /* "blacksheep/url.pyx":67
  * 
  *         if self.port != 0:
  *             if (self.schema == b'http' and self.port != 80) or (self.schema == b'https' and self.port != 443):             # <<<<<<<<<<<<<<
@@ -5199,15 +5199,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_URL, (type(self), 0x34a39a6, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_URL__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
   __pyx_t_1 = __pyx_f_10blacksheep_3url___pyx_unpickle_URL__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_URL, (type(self), 0x34a39a6, state)
@@ -5748,15 +5748,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = InvalidURL.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_InvalidURL__set_state(<InvalidURL> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_InvalidURL__set_state(InvalidURL __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_3url___pyx_unpickle_InvalidURL__set_state(((struct __pyx_obj_10blacksheep_3url_InvalidURL *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xd41d8cd, 0xe3b0c44, 0xda39a3e) = ())" % __pyx_checksum)
  *     __pyx_result = InvalidURL.__new__(__pyx_type)
@@ -6130,15 +6130,15 @@
     /* "(tree fragment)":9
  *     __pyx_result = URL.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_URL__set_state(<URL> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_URL__set_state(URL __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_10blacksheep_3url___pyx_unpickle_URL__set_state(((struct __pyx_obj_10blacksheep_3url_URL *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0x34a39a6, 0x9303e4b, 0x06acbd0) = (fragment, host, is_absolute, path, port, query, schema, value))" % __pyx_checksum)
  *     __pyx_result = URL.__new__(__pyx_type)
@@ -6216,27 +6216,27 @@
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(1, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->fragment);
   __Pyx_DECREF(__pyx_v___pyx_result->fragment);
   __pyx_v___pyx_result->fragment = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(1, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->host);
   __Pyx_DECREF(__pyx_v___pyx_result->host);
   __pyx_v___pyx_result->host = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -6249,15 +6249,15 @@
   __pyx_v___pyx_result->is_absolute = __pyx_t_2;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(1, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->path);
   __Pyx_DECREF(__pyx_v___pyx_result->path);
   __pyx_v___pyx_result->path = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
@@ -6270,39 +6270,39 @@
   __pyx_v___pyx_result->port = __pyx_t_3;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(1, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->query);
   __Pyx_DECREF(__pyx_v___pyx_result->query);
   __pyx_v___pyx_result->query = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(1, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 6, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->schema);
   __Pyx_DECREF(__pyx_v___pyx_result->schema);
   __pyx_v___pyx_result->schema = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
     __PYX_ERR(1, 12, __pyx_L1_error)
   }
   __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 7, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->value);
   __Pyx_DECREF(__pyx_v___pyx_result->value);
   __pyx_v___pyx_result->value = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":13
@@ -6966,15 +6966,15 @@
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
   __pyx_umethod_PyBytes_Type_lstrip.type = (PyObject*)&PyBytes_Type;
-  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_46 = PyInt_FromLong(46); if (unlikely(!__pyx_int_46)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_47 = PyInt_FromLong(47); if (unlikely(!__pyx_int_47)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_6998992 = PyInt_FromLong(6998992L); if (unlikely(!__pyx_int_6998992)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_55196070 = PyInt_FromLong(55196070L); if (unlikely(!__pyx_int_55196070)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_154156619 = PyInt_FromLong(154156619L); if (unlikely(!__pyx_int_154156619)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_222419149 = PyInt_FromLong(222419149L); if (unlikely(!__pyx_int_222419149)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_228825662 = PyInt_FromLong(228825662L); if (unlikely(!__pyx_int_228825662)) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -7252,15 +7252,15 @@
   #endif
   __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_d);
   __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_b);
   __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_cython_runtime);
-  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Initialize various global constants etc. ---*/
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   if (__pyx_module_is_main_blacksheep__url) {
     if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -8038,15 +8038,15 @@
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
 #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(func)) {
         return __Pyx_PyFunction_FastCall(func, NULL, 0);
     }
 #endif
-#ifdef __Pyx_CyFunction_USED
+#if defined(__Pyx_CyFunction_USED) && defined(NDEBUG)
     if (likely(PyCFunction_Check(func) || __Pyx_CyFunction_Check(func)))
 #else
     if (likely(PyCFunction_Check(func)))
 #endif
     {
         if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
             return __Pyx_PyObject_CallMethO(func, NULL);
@@ -8189,28 +8189,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -8725,19 +8725,19 @@
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg) {
     if (likely(cfunc->func)) {
         int flag = cfunc->flag;
         if (flag == METH_O) {
             return (*(cfunc->func))(self, arg);
         } else if (PY_VERSION_HEX >= 0x030600B1 && flag == METH_FASTCALL) {
-            if (PY_VERSION_HEX >= 0x030700A0) {
+            #if PY_VERSION_HEX >= 0x030700A0
                 return (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)cfunc->func)(self, &arg, 1);
-            } else {
+            #else
                 return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
-            }
+            #endif
         } else if (PY_VERSION_HEX >= 0x030700A0 && flag == (METH_FASTCALL | METH_KEYWORDS)) {
             return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
         }
     }
     return __Pyx__CallUnboundCMethod1(cfunc, self, arg);
 }
 #endif
@@ -9062,15 +9062,15 @@
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 
 /* CLineInTraceback */
 #ifndef CYTHON_CLINE_IN_TRACEBACK
-static int __Pyx_CLineForTraceback(CYTHON_NCP_UNUSED PyThreadState *tstate, int c_line) {
+static int __Pyx_CLineForTraceback(CYTHON_UNUSED PyThreadState *tstate, int c_line) {
     PyObject *use_cline;
     PyObject *ptype, *pvalue, *ptraceback;
 #if CYTHON_COMPILING_IN_CPYTHON
     PyObject **cython_runtime_dict;
 #endif
     if (unlikely(!__pyx_cython_runtime)) {
         return c_line;
```

### Comparing `blacksheep-2.0a5/blacksheep/url.pxd` & `blacksheep-2.0a6/blacksheep/url.pxd`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/url.pyi` & `blacksheep-2.0a6/blacksheep/url.pyi`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/url.pyx` & `blacksheep-2.0a6/blacksheep/url.pyx`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep/utils/__init__.py` & `blacksheep-2.0a6/blacksheep/utils/__init__.py`

 * *Files 27% similar despite different names*

```diff
@@ -33,7 +33,13 @@
 
 def get_class_hierarchy(cls: Type[T]) -> Tuple[Type[T], ...]:
     return cls.__mro__
 
 
 def get_class_instance_hierarchy(instance: T) -> Tuple[Type[T], ...]:
     return get_class_hierarchy(type(instance))
+
+
+def truthy(value: str, default: bool = False) -> bool:
+    if not value:
+        return default
+    return value.upper() in {"1", "TRUE"}
```

### Comparing `blacksheep-2.0a5/blacksheep/utils/aio.py` & `blacksheep-2.0a6/blacksheep/utils/aio.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/blacksheep.egg-info/PKG-INFO` & `blacksheep-2.0a6/blacksheep.egg-info/PKG-INFO`

 * *Files 13% similar despite different names*

```diff
@@ -1,643 +1,667 @@
 00000000: 4d65 7461 6461 7461 2d56 6572 7369 6f6e  Metadata-Version
-00000010: 3a20 322e 310a 4e61 6d65 3a20 626c 6163  : 2.1.Name: blac
-00000020: 6b73 6865 6570 0a56 6572 7369 6f6e 3a20  ksheep.Version: 
-00000030: 322e 3061 350a 5375 6d6d 6172 793a 2046  2.0a5.Summary: F
-00000040: 6173 7420 7765 6220 6672 616d 6577 6f72  ast web framewor
-00000050: 6b20 666f 7220 5079 7468 6f6e 2061 7379  k for Python asy
-00000060: 6e63 696f 0a48 6f6d 652d 7061 6765 3a20  ncio.Home-page: 
-00000070: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-00000080: 6f6d 2f4e 656f 7465 726f 692f 426c 6163  om/Neoteroi/Blac
-00000090: 6b53 6865 6570 0a41 7574 686f 723a 2052  kSheep.Author: R
-000000a0: 6f62 6572 746f 2050 7265 7661 746f 0a41  oberto Prevato.A
-000000b0: 7574 686f 722d 656d 6169 6c3a 2072 6f62  uthor-email: rob
-000000c0: 6572 746f 2e70 7265 7661 746f 4067 6d61  erto.prevato@gma
-000000d0: 696c 2e63 6f6d 0a4c 6963 656e 7365 3a20  il.com.License: 
-000000e0: 4d49 540a 4b65 7977 6f72 6473 3a20 426c  MIT.Keywords: Bl
-000000f0: 6163 6b53 6865 6570 2077 6562 2066 7261  ackSheep web fra
-00000100: 6d65 776f 726b 0a50 6c61 7466 6f72 6d3a  mework.Platform:
-00000110: 202a 6e69 780a 436c 6173 7369 6669 6572   *nix.Classifier
-00000120: 3a20 4465 7665 6c6f 706d 656e 7420 5374  : Development St
-00000130: 6174 7573 203a 3a20 3320 2d20 416c 7068  atus :: 3 - Alph
-00000140: 610a 436c 6173 7369 6669 6572 3a20 4c69  a.Classifier: Li
-00000150: 6365 6e73 6520 3a3a 204f 5349 2041 7070  cense :: OSI App
-00000160: 726f 7665 6420 3a3a 204d 4954 204c 6963  roved :: MIT Lic
-00000170: 656e 7365 0a43 6c61 7373 6966 6965 723a  ense.Classifier:
-00000180: 2050 726f 6772 616d 6d69 6e67 204c 616e   Programming Lan
-00000190: 6775 6167 6520 3a3a 2050 7974 686f 6e20  guage :: Python 
-000001a0: 3a3a 2033 2e38 0a43 6c61 7373 6966 6965  :: 3.8.Classifie
-000001b0: 723a 2050 726f 6772 616d 6d69 6e67 204c  r: Programming L
-000001c0: 616e 6775 6167 6520 3a3a 2050 7974 686f  anguage :: Pytho
-000001d0: 6e20 3a3a 2033 2e39 0a43 6c61 7373 6966  n :: 3.9.Classif
-000001e0: 6965 723a 2050 726f 6772 616d 6d69 6e67  ier: Programming
-000001f0: 204c 616e 6775 6167 6520 3a3a 2050 7974   Language :: Pyt
-00000200: 686f 6e20 3a3a 2033 2e31 300a 436c 6173  hon :: 3.10.Clas
-00000210: 7369 6669 6572 3a20 5072 6f67 7261 6d6d  sifier: Programm
-00000220: 696e 6720 4c61 6e67 7561 6765 203a 3a20  ing Language :: 
-00000230: 5079 7468 6f6e 203a 3a20 332e 3131 0a43  Python :: 3.11.C
-00000240: 6c61 7373 6966 6965 723a 2045 6e76 6972  lassifier: Envir
-00000250: 6f6e 6d65 6e74 203a 3a20 5765 6220 456e  onment :: Web En
-00000260: 7669 726f 6e6d 656e 740a 436c 6173 7369  vironment.Classi
-00000270: 6669 6572 3a20 4f70 6572 6174 696e 6720  fier: Operating 
-00000280: 5379 7374 656d 203a 3a20 4f53 2049 6e64  System :: OS Ind
-00000290: 6570 656e 6465 6e74 0a43 6c61 7373 6966  ependent.Classif
-000002a0: 6965 723a 2046 7261 6d65 776f 726b 203a  ier: Framework :
-000002b0: 3a20 4173 796e 6349 4f0a 4465 7363 7269  : AsyncIO.Descri
-000002c0: 7074 696f 6e2d 436f 6e74 656e 742d 5479  ption-Content-Ty
-000002d0: 7065 3a20 7465 7874 2f6d 6172 6b64 6f77  pe: text/markdow
-000002e0: 6e0a 5072 6f76 6964 6573 2d45 7874 7261  n.Provides-Extra
-000002f0: 3a20 6675 6c6c 0a50 726f 7669 6465 732d  : full.Provides-
-00000300: 4578 7472 613a 206a 696e 6a61 0a4c 6963  Extra: jinja.Lic
-00000310: 656e 7365 2d46 696c 653a 204c 4943 454e  ense-File: LICEN
-00000320: 5345 0a0a 5b21 5b42 7569 6c64 5d28 6874  SE..[![Build](ht
-00000330: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
-00000340: 2f4e 656f 7465 726f 692f 426c 6163 6b53  /Neoteroi/BlackS
-00000350: 6865 6570 2f77 6f72 6b66 6c6f 7773 2f4d  heep/workflows/M
-00000360: 6169 6e2f 6261 6467 652e 7376 6729 5d28  ain/badge.svg)](
-00000370: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-00000380: 6f6d 2f4e 656f 7465 726f 692f 426c 6163  om/Neoteroi/Blac
-00000390: 6b53 6865 6570 2f61 6374 696f 6e73 290a  kSheep/actions).
-000003a0: 5b21 5b70 7970 695d 2868 7474 7073 3a2f  [![pypi](https:/
-000003b0: 2f69 6d67 2e73 6869 656c 6473 2e69 6f2f  /img.shields.io/
-000003c0: 7079 7069 2f76 2f42 6c61 636b 5368 6565  pypi/v/BlackShee
-000003d0: 702e 7376 673f 636f 6c6f 723d 626c 7565  p.svg?color=blue
-000003e0: 295d 2868 7474 7073 3a2f 2f70 7970 692e  )](https://pypi.
-000003f0: 6f72 672f 7072 6f6a 6563 742f 426c 6163  org/project/Blac
-00000400: 6b53 6865 6570 2f29 0a5b 215b 7665 7273  kSheep/).[![vers
-00000410: 696f 6e73 5d28 6874 7470 733a 2f2f 696d  ions](https://im
-00000420: 672e 7368 6965 6c64 732e 696f 2f70 7970  g.shields.io/pyp
-00000430: 692f 7079 7665 7273 696f 6e73 2f62 6c61  i/pyversions/bla
-00000440: 636b 7368 6565 702e 7376 6729 5d28 6874  cksheep.svg)](ht
-00000450: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
-00000460: 2f72 6f62 6572 746f 7072 6576 6174 6f2f  /robertoprevato/
-00000470: 626c 6163 6b73 6865 6570 290a 5b21 5b63  blacksheep).[![c
-00000480: 6f64 6563 6f76 5d28 6874 7470 733a 2f2f  odecov](https://
-00000490: 636f 6465 636f 762e 696f 2f67 682f 4e65  codecov.io/gh/Ne
-000004a0: 6f74 6572 6f69 2f42 6c61 636b 5368 6565  oteroi/BlackShee
-000004b0: 702f 6272 616e 6368 2f6d 6173 7465 722f  p/branch/master/
-000004c0: 6772 6170 682f 6261 6467 652e 7376 673f  graph/badge.svg?
-000004d0: 746f 6b65 6e3d 4e7a 6932 394c 3045 6731  token=Nzi29L0Eg1
-000004e0: 295d 2868 7474 7073 3a2f 2f63 6f64 6563  )](https://codec
-000004f0: 6f76 2e69 6f2f 6768 2f4e 656f 7465 726f  ov.io/gh/Neotero
-00000500: 692f 426c 6163 6b53 6865 6570 290a 5b21  i/BlackSheep).[!
-00000510: 5b6c 6963 656e 7365 5d28 6874 7470 733a  [license](https:
-00000520: 2f2f 696d 672e 7368 6965 6c64 732e 696f  //img.shields.io
-00000530: 2f67 6974 6875 622f 6c69 6365 6e73 652f  /github/license/
-00000540: 4e65 6f74 6572 6f69 2f62 6c61 636b 7368  Neoteroi/blacksh
-00000550: 6565 702e 7376 6729 5d28 6874 7470 733a  eep.svg)](https:
-00000560: 2f2f 6769 7468 7562 2e63 6f6d 2f4e 656f  //github.com/Neo
-00000570: 7465 726f 692f 626c 6163 6b73 6865 6570  teroi/blacksheep
-00000580: 2f62 6c6f 622f 6d61 696e 2f4c 4943 454e  /blob/main/LICEN
-00000590: 5345 2920 5b21 5b4a 6f69 6e20 7468 6520  SE) [![Join the 
-000005a0: 6368 6174 2061 7420 6874 7470 733a 2f2f  chat at https://
-000005b0: 6769 7474 6572 2e69 6d2f 4e65 6f74 6572  gitter.im/Neoter
-000005c0: 6f69 2f42 6c61 636b 5368 6565 705d 2868  oi/BlackSheep](h
-000005d0: 7474 7073 3a2f 2f62 6164 6765 732e 6769  ttps://badges.gi
-000005e0: 7474 6572 2e69 6d2f 4e65 6f74 6572 6f69  tter.im/Neoteroi
-000005f0: 2f42 6c61 636b 5368 6565 702e 7376 6729  /BlackSheep.svg)
-00000600: 5d28 6874 7470 733a 2f2f 6769 7474 6572  ](https://gitter
-00000610: 2e69 6d2f 4e65 6f74 6572 6f69 2f42 6c61  .im/Neoteroi/Bla
-00000620: 636b 5368 6565 703f 7574 6d5f 736f 7572  ckSheep?utm_sour
-00000630: 6365 3d62 6164 6765 2675 746d 5f6d 6564  ce=badge&utm_med
-00000640: 6975 6d3d 6261 6467 6526 7574 6d5f 6361  ium=badge&utm_ca
-00000650: 6d70 6169 676e 3d70 722d 6261 6467 6526  mpaign=pr-badge&
-00000660: 7574 6d5f 636f 6e74 656e 743d 6261 6467  utm_content=badg
-00000670: 6529 205b 215b 646f 6375 6d65 6e74 6174  e) [![documentat
-00000680: 696f 6e5d 2868 7474 7073 3a2f 2f69 6d67  ion](https://img
-00000690: 2e73 6869 656c 6473 2e69 6f2f 6261 6467  .shields.io/badg
-000006a0: 652f f09f 9396 2d64 6f63 732d 7075 7270  e/....-docs-purp
-000006b0: 6c65 295d 2868 7474 7073 3a2f 2f77 7777  le)](https://www
-000006c0: 2e6e 656f 7465 726f 692e 6465 762f 626c  .neoteroi.dev/bl
-000006d0: 6163 6b73 6865 6570 2f29 0a0a 2320 426c  acksheep/)..# Bl
-000006e0: 6163 6b53 6865 6570 0a42 6c61 636b 5368  ackSheep.BlackSh
-000006f0: 6565 7020 6973 2061 6e20 6173 796e 6368  eep is an asynch
-00000700: 726f 6e6f 7573 2077 6562 2066 7261 6d65  ronous web frame
-00000710: 776f 726b 2074 6f20 6275 696c 6420 6576  work to build ev
-00000720: 656e 7420 6261 7365 6420 7765 620a 6170  ent based web.ap
-00000730: 706c 6963 6174 696f 6e73 2077 6974 6820  plications with 
-00000740: 5079 7468 6f6e 2e20 4974 2069 7320 696e  Python. It is in
-00000750: 7370 6972 6564 2062 790a 5b46 6c61 736b  spired by.[Flask
-00000760: 5d28 6874 7470 733a 2f2f 7061 6c6c 6574  ](https://pallet
-00000770: 7370 726f 6a65 6374 732e 636f 6d2f 702f  sprojects.com/p/
-00000780: 666c 6173 6b2f 292c 205b 4153 502e 4e45  flask/), [ASP.NE
-00000790: 540a 436f 7265 5d28 6874 7470 733a 2f2f  T.Core](https://
-000007a0: 646f 6373 2e6d 6963 726f 736f 6674 2e63  docs.microsoft.c
-000007b0: 6f6d 2f65 6e2d 7573 2f61 7370 6e65 742f  om/en-us/aspnet/
-000007c0: 636f 7265 2f29 2c20 616e 6420 7468 6520  core/), and the 
-000007d0: 776f 726b 2062 7920 5b59 7572 790a 5365  work by [Yury.Se
-000007e0: 6c69 7661 6e6f 765d 2868 7474 7073 3a2f  livanov](https:/
-000007f0: 2f6d 6167 6963 2e69 6f2f 626c 6f67 2f75  /magic.io/blog/u
-00000800: 766c 6f6f 702d 626c 617a 696e 672d 6661  vloop-blazing-fa
-00000810: 7374 2d70 7974 686f 6e2d 6e65 7477 6f72  st-python-networ
-00000820: 6b69 6e67 2f29 2e0a 0a3c 7020 616c 6967  king/)...<p alig
-00000830: 6e3d 226c 6566 7422 3e0a 2020 3c61 2068  n="left">.  <a h
-00000840: 7265 663d 2223 626c 6163 6b73 6865 6570  ref="#blacksheep
-00000850: 223e 3c69 6d67 2077 6964 7468 3d22 3332  "><img width="32
-00000860: 3022 2068 6569 6768 743d 2232 3731 2220  0" height="271" 
-00000870: 7372 633d 2268 7474 7073 3a2f 2f77 7777  src="https://www
-00000880: 2e6e 656f 7465 726f 692e 6465 762f 626c  .neoteroi.dev/bl
-00000890: 6163 6b73 6865 6570 2f69 6d67 2f62 6c61  acksheep/img/bla
-000008a0: 636b 7368 6565 702e 706e 6722 2061 6c74  cksheep.png" alt
-000008b0: 3d22 426c 6163 6b20 5368 6565 7022 3e3c  ="Black Sheep"><
-000008c0: 2f61 3e0a 3c2f 703e 0a0a 6060 6062 6173  /a>.</p>..```bas
-000008d0: 680a 7069 7020 696e 7374 616c 6c20 626c  h.pip install bl
-000008e0: 6163 6b73 6865 6570 0a60 6060 0a0a 2d2d  acksheep.```..--
-000008f0: 2d0a 0a60 6060 7079 7468 6f6e 0a66 726f  -..```python.fro
-00000900: 6d20 6461 7465 7469 6d65 2069 6d70 6f72  m datetime impor
-00000910: 7420 6461 7465 7469 6d65 0a0a 6672 6f6d  t datetime..from
-00000920: 2062 6c61 636b 7368 6565 7020 696d 706f   blacksheep impo
-00000930: 7274 2041 7070 6c69 6361 7469 6f6e 0a0a  rt Application..
-00000940: 0a61 7070 203d 2041 7070 6c69 6361 7469  .app = Applicati
-00000950: 6f6e 2829 0a0a 4061 7070 2e72 6f75 7465  on()..@app.route
-00000960: 2822 2f22 290a 6173 796e 6320 6465 6620  ("/").async def 
-00000970: 686f 6d65 2829 3a0a 2020 2020 7265 7475  home():.    retu
-00000980: 726e 2066 2248 656c 6c6f 2c20 576f 726c  rn f"Hello, Worl
-00000990: 6421 207b 6461 7465 7469 6d65 2e75 7463  d! {datetime.utc
-000009a0: 6e6f 7728 292e 6973 6f66 6f72 6d61 7428  now().isoformat(
-000009b0: 297d 220a 0a60 6060 0a0a 2323 2047 6574  )}"..```..## Get
-000009c0: 7469 6e67 2073 7461 7274 6564 0a0a 5468  ting started..Th
-000009d0: 6520 646f 6375 6d65 6e74 6174 696f 6e20  e documentation 
-000009e0: 6f66 6665 7273 2067 6574 7469 6e67 2073  offers getting s
-000009f0: 7461 7274 6564 2074 7574 6f72 6961 6c73  tarted tutorials
-00000a00: 3a0a 2a20 5b47 6574 7469 6e67 2073 7461  :.* [Getting sta
-00000a10: 7274 6564 3a0a 2020 6261 7369 6373 5d28  rted:.  basics](
-00000a20: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
-00000a30: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
-00000a40: 6565 702f 6765 7474 696e 672d 7374 6172  eep/getting-star
-00000a50: 7465 642f 290a 2a20 5b47 6574 7469 6e67  ted/).* [Getting
-00000a60: 2073 7461 7274 6564 3a20 7468 6520 4d56   started: the MV
-00000a70: 4320 7072 6f6a 6563 740a 2020 7465 6d70  C project.  temp
-00000a80: 6c61 7465 5d28 6874 7470 733a 2f2f 7777  late](https://ww
-00000a90: 772e 6e65 6f74 6572 6f69 2e64 6576 2f62  w.neoteroi.dev/b
-00000aa0: 6c61 636b 7368 6565 702f 6d76 632d 7072  lacksheep/mvc-pr
-00000ab0: 6f6a 6563 742d 7465 6d70 6c61 7465 2f29  oject-template/)
-00000ac0: 0a0a 5468 6573 6520 7072 6f6a 6563 7420  ..These project 
-00000ad0: 7465 6d70 6c61 7465 7320 6361 6e20 6265  templates can be
-00000ae0: 2075 7365 6420 746f 2073 7461 7274 206e   used to start n
-00000af0: 6577 2061 7070 6c69 6361 7469 6f6e 7320  ew applications 
-00000b00: 6661 7374 6572 3a0a 0a2a 205b 4d56 4320  faster:..* [MVC 
-00000b10: 7072 6f6a 6563 740a 2020 7465 6d70 6c61  project.  templa
-00000b20: 7465 5d28 6874 7470 733a 2f2f 6769 7468  te](https://gith
-00000b30: 7562 2e63 6f6d 2f4e 656f 7465 726f 692f  ub.com/Neoteroi/
-00000b40: 426c 6163 6b53 6865 6570 4d56 4329 0a2a  BlackSheepMVC).*
-00000b50: 205b 456d 7074 7920 7072 6f6a 6563 740a   [Empty project.
-00000b60: 2020 7465 6d70 6c61 7465 5d28 6874 7470    template](http
-00000b70: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f4e  s://github.com/N
-00000b80: 656f 7465 726f 692f 426c 6163 6b53 6865  eoteroi/BlackShe
-00000b90: 6570 456d 7074 7950 726f 6a65 6374 290a  epEmptyProject).
-00000ba0: 0a23 2320 5265 7175 6972 656d 656e 7473  .## Requirements
-00000bb0: 0a0a 5b50 7974 686f 6e5d 2868 7474 7073  ..[Python](https
-00000bc0: 3a2f 2f77 7777 2e70 7974 686f 6e2e 6f72  ://www.python.or
-00000bd0: 6729 3a20 616e 7920 7665 7273 696f 6e20  g): any version 
-00000be0: 6c69 7374 6564 2069 6e20 7468 6520 7072  listed in the pr
-00000bf0: 6f6a 6563 7427 730a 636c 6173 7369 6669  oject's.classifi
-00000c00: 6572 732e 2054 6865 2063 7572 7265 6e74  ers. The current
-00000c10: 206c 6973 7420 6973 3a0a 0a5b 215b 7665   list is:..[![ve
-00000c20: 7273 696f 6e73 5d28 6874 7470 733a 2f2f  rsions](https://
-00000c30: 696d 672e 7368 6965 6c64 732e 696f 2f70  img.shields.io/p
-00000c40: 7970 692f 7079 7665 7273 696f 6e73 2f62  ypi/pyversions/b
-00000c50: 6c61 636b 7368 6565 702e 7376 6729 5d28  lacksheep.svg)](
-00000c60: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-00000c70: 6f6d 2f72 6f62 6572 746f 7072 6576 6174  om/robertoprevat
-00000c80: 6f2f 626c 6163 6b73 6865 6570 290a 0a0a  o/blacksheep)...
-00000c90: 426c 6163 6b53 6865 6570 2062 656c 6f6e  BlackSheep belon
-00000ca0: 6773 2074 6f20 7468 6520 6361 7465 676f  gs to the catego
-00000cb0: 7279 206f 660a 5b41 5347 495d 2868 7474  ry of.[ASGI](htt
-00000cc0: 7073 3a2f 2f61 7367 692e 7265 6164 7468  ps://asgi.readth
-00000cd0: 6564 6f63 732e 696f 2f65 6e2f 6c61 7465  edocs.io/en/late
-00000ce0: 7374 2f29 2077 6562 2066 7261 6d65 776f  st/) web framewo
-00000cf0: 726b 732c 2073 6f20 6974 2072 6571 7569  rks, so it requi
-00000d00: 7265 730a 616e 2041 5347 4920 4854 5450  res.an ASGI HTTP
-00000d10: 2073 6572 7665 7220 746f 2072 756e 2c20   server to run, 
-00000d20: 7375 6368 2061 7320 5b75 7669 636f 726e  such as [uvicorn
-00000d30: 5d28 6874 7470 3a2f 2f77 7777 2e75 7669  ](http://www.uvi
-00000d40: 636f 726e 2e6f 7267 2f29 2c20 6f72 0a5b  corn.org/), or.[
-00000d50: 6879 7065 7263 6f72 6e5d 2868 7474 7073  hypercorn](https
-00000d60: 3a2f 2f70 676a 6f6e 6573 2e67 6974 6c61  ://pgjones.gitla
-00000d70: 622e 696f 2f68 7970 6572 636f 726e 2f29  b.io/hypercorn/)
-00000d80: 2e20 466f 7220 6578 616d 706c 652c 2074  . For example, t
-00000d90: 6f20 7573 6520 6974 2077 6974 680a 7576  o use it with.uv
-00000da0: 6963 6f72 6e3a 0a0a 6060 6062 6173 680a  icorn:..```bash.
-00000db0: 2420 7069 7020 696e 7374 616c 6c20 7576  $ pip install uv
-00000dc0: 6963 6f72 6e0a 6060 600a 0a54 6f20 7275  icorn.```..To ru
-00000dd0: 6e20 616e 2061 7070 6c69 6361 7469 6f6e  n an application
-00000de0: 206c 696b 6520 696e 2074 6865 2065 7861   like in the exa
-00000df0: 6d70 6c65 2061 626f 7665 2c20 7573 6520  mple above, use 
-00000e00: 7468 6520 6d65 7468 6f64 7320 7072 6f76  the methods prov
-00000e10: 6964 6564 2062 790a 7468 6520 4153 4749  ided by.the ASGI
-00000e20: 2048 5454 5020 5365 7276 6572 3a0a 0a60   HTTP Server:..`
-00000e30: 6060 6261 7368 0a23 2069 6620 7468 6520  ``bash.# if the 
-00000e40: 426c 6163 6b53 6865 6570 2061 7070 2069  BlackSheep app i
-00000e50: 7320 6465 6669 6e65 6420 696e 2061 2066  s defined in a f
-00000e60: 696c 6520 6073 6572 7665 722e 7079 600a  ile `server.py`.
-00000e70: 0a24 2075 7669 636f 726e 2073 6572 7665  .$ uvicorn serve
-00000e80: 723a 6170 700a 6060 600a 0a54 6f20 7275  r:app.```..To ru
-00000e90: 6e20 666f 7220 7072 6f64 7563 7469 6f6e  n for production
-00000ea0: 2c20 7265 6665 7220 746f 2074 6865 2064  , refer to the d
-00000eb0: 6f63 756d 656e 7461 7469 6f6e 206f 6620  ocumentation of 
-00000ec0: 7468 6520 6368 6f73 656e 2041 5347 4920  the chosen ASGI 
-00000ed0: 7365 7276 6572 0a28 692e 652e 2066 6f72  server.(i.e. for
-00000ee0: 205b 7576 6963 6f72 6e5d 2868 7474 7073   [uvicorn](https
-00000ef0: 3a2f 2f77 7777 2e75 7669 636f 726e 2e6f  ://www.uvicorn.o
-00000f00: 7267 2f23 7275 6e6e 696e 672d 7769 7468  rg/#running-with
-00000f10: 2d67 756e 6963 6f72 6e29 292e 0a0a 2323  -gunicorn))...##
-00000f20: 2041 7574 6f6d 6174 6963 2062 696e 6469   Automatic bindi
-00000f30: 6e67 7320 616e 6420 6465 7065 6e64 656e  ngs and dependen
-00000f40: 6379 2069 6e6a 6563 7469 6f6e 0a42 6c61  cy injection.Bla
-00000f50: 636b 5368 6565 7020 7375 7070 6f72 7473  ckSheep supports
-00000f60: 2061 7574 6f6d 6174 6963 2062 696e 6469   automatic bindi
-00000f70: 6e67 206f 6620 7661 6c75 6573 2066 6f72  ng of values for
-00000f80: 2072 6571 7565 7374 2068 616e 646c 6572   request handler
-00000f90: 732c 2062 7920 7479 7065 0a61 6e6e 6f74  s, by type.annot
-00000fa0: 6174 696f 6e20 6f72 2062 7920 636f 6e76  ation or by conv
-00000fb0: 656e 7469 6f6e 732e 2053 6565 205b 6d6f  entions. See [mo
-00000fc0: 7265 0a68 6572 655d 2868 7474 7073 3a2f  re.here](https:/
-00000fd0: 2f77 7777 2e6e 656f 7465 726f 692e 6465  /www.neoteroi.de
-00000fe0: 762f 626c 6163 6b73 6865 6570 2f72 6571  v/blacksheep/req
-00000ff0: 7565 7374 732f 292e 0a0a 6060 6070 7974  uests/)...```pyt
-00001000: 686f 6e0a 6672 6f6d 2064 6174 6163 6c61  hon.from datacla
-00001010: 7373 6573 2069 6d70 6f72 7420 6461 7461  sses import data
-00001020: 636c 6173 730a 0a66 726f 6d20 626c 6163  class..from blac
-00001030: 6b73 6865 6570 2069 6d70 6f72 7420 4170  ksheep import Ap
-00001040: 706c 6963 6174 696f 6e2c 2046 726f 6d4a  plication, FromJ
-00001050: 534f 4e2c 2046 726f 6d51 7565 7279 0a0a  SON, FromQuery..
-00001060: 0a61 7070 203d 2041 7070 6c69 6361 7469  .app = Applicati
-00001070: 6f6e 2829 0a0a 0a40 6461 7461 636c 6173  on()...@dataclas
-00001080: 730a 636c 6173 7320 4372 6561 7465 4361  s.class CreateCa
-00001090: 7449 6e70 7574 3a0a 2020 2020 6e61 6d65  tInput:.    name
-000010a0: 3a20 7374 720a 0a0a 4061 7070 2e72 6f75  : str...@app.rou
-000010b0: 7465 722e 706f 7374 2822 2f61 7069 2f63  ter.post("/api/c
-000010c0: 6174 7322 290a 6173 796e 6320 6465 6620  ats").async def 
-000010d0: 6578 616d 706c 6528 6461 7461 3a20 4672  example(data: Fr
-000010e0: 6f6d 4a53 4f4e 5b43 7265 6174 6543 6174  omJSON[CreateCat
-000010f0: 496e 7075 745d 293a 0a20 2020 2023 2069  Input]):.    # i
-00001100: 6e20 7468 6973 2065 7861 6d70 6c65 2c20  n this example, 
-00001110: 6461 7461 2069 7320 626f 756e 6420 6175  data is bound au
-00001120: 746f 6d61 7469 6361 6c6c 7920 7265 6164  tomatically read
-00001130: 696e 6720 7468 6520 4a53 4f4e 0a20 2020  ing the JSON.   
-00001140: 2023 2070 6179 6c6f 6164 2061 6e64 2063   # payload and c
-00001150: 7265 6174 696e 6720 616e 2069 6e73 7461  reating an insta
-00001160: 6e63 6520 6f66 2060 4372 6561 7465 4361  nce of `CreateCa
-00001170: 7449 6e70 7574 600a 2020 2020 2e2e 2e0a  tInput`.    ....
-00001180: 0a0a 4061 7070 2e72 6f75 7465 722e 6765  ..@app.router.ge
-00001190: 7428 222f 3a63 756c 7475 7265 5f63 6f64  t("/:culture_cod
-000011a0: 652f 3a61 7265 6122 290a 6173 796e 6320  e/:area").async 
-000011b0: 6465 6620 686f 6d65 2863 756c 7475 7265  def home(culture
-000011c0: 5f63 6f64 652c 2061 7265 6129 3a0a 2020  _code, area):.  
-000011d0: 2020 2320 696e 2074 6869 7320 6578 616d    # in this exam
-000011e0: 706c 652c 2062 6f74 6820 7061 7261 6d65  ple, both parame
-000011f0: 7465 7273 2061 7265 206f 6274 6169 6e65  ters are obtaine
-00001200: 6420 6672 6f6d 2072 6f75 7465 7320 7769  d from routes wi
-00001210: 7468 0a20 2020 2023 206d 6174 6368 696e  th.    # matchin
-00001220: 6720 6e61 6d65 730a 2020 2020 7265 7475  g names.    retu
-00001230: 726e 2066 2252 6571 7565 7374 2066 6f72  rn f"Request for
-00001240: 3a20 7b63 756c 7475 7265 5f63 6f64 657d  : {culture_code}
-00001250: 207b 6172 6561 7d22 0a0a 0a40 6170 702e   {area}"...@app.
-00001260: 726f 7574 6572 2e67 6574 2822 2f61 7069  router.get("/api
-00001270: 2f70 726f 6475 6374 7322 290a 6465 6620  /products").def 
-00001280: 6765 745f 7072 6f64 7563 7473 280a 2020  get_products(.  
-00001290: 2020 7061 6765 3a20 696e 7420 3d20 312c    page: int = 1,
-000012a0: 0a20 2020 2073 697a 653a 2069 6e74 203d  .    size: int =
-000012b0: 2033 302c 0a20 2020 2073 6561 7263 683a   30,.    search:
-000012c0: 2073 7472 203d 2022 222c 0a29 3a0a 2020   str = "",.):.  
-000012d0: 2020 2320 7468 6973 2065 7861 6d70 6c65    # this example
-000012e0: 2069 6c6c 7573 7472 6174 6573 2073 7570   illustrates sup
-000012f0: 706f 7274 2066 6f72 2069 6d70 6c69 6369  port for implici
-00001300: 7420 7175 6572 7920 7061 7261 6d65 7465  t query paramete
-00001310: 7273 2077 6974 680a 2020 2020 2320 6465  rs with.    # de
-00001320: 6661 756c 7420 7661 6c75 6573 0a20 2020  fault values.   
-00001330: 2023 2073 696e 6365 2074 6865 2073 6f75   # since the sou
-00001340: 7263 6520 6f66 2070 6167 652c 2073 697a  rce of page, siz
-00001350: 652c 2061 6e64 2073 6561 7263 6820 6973  e, and search is
-00001360: 206e 6f74 2073 7065 6369 6669 6564 2061   not specified a
-00001370: 6e64 206e 6f0a 2020 2020 2320 726f 7574  nd no.    # rout
-00001380: 6520 7061 7261 6d65 7465 7220 6d61 7463  e parameter matc
-00001390: 6865 7320 7468 6569 7220 6e61 6d65 2c20  hes their name, 
-000013a0: 7468 6579 2061 7265 206f 6274 6169 6e65  they are obtaine
-000013b0: 6420 6672 6f6d 2071 7565 7279 2073 7472  d from query str
-000013c0: 696e 670a 2020 2020 2e2e 2e0a 0a0a 4061  ing.    ......@a
-000013d0: 7070 2e72 6f75 7465 722e 6765 7428 222f  pp.router.get("/
-000013e0: 6170 692f 7072 6f64 7563 7473 3222 290a  api/products2").
-000013f0: 6465 6620 6765 745f 7072 6f64 7563 7473  def get_products
-00001400: 3228 0a20 2020 2070 6167 653a 2046 726f  2(.    page: Fro
-00001410: 6d51 7565 7279 5b69 6e74 5d20 3d20 4672  mQuery[int] = Fr
-00001420: 6f6d 5175 6572 7928 3129 2c0a 2020 2020  omQuery(1),.    
-00001430: 7369 7a65 3a20 4672 6f6d 5175 6572 795b  size: FromQuery[
-00001440: 696e 745d 203d 2046 726f 6d51 7565 7279  int] = FromQuery
-00001450: 2833 3029 2c0a 2020 2020 7365 6172 6368  (30),.    search
-00001460: 3a20 4672 6f6d 5175 6572 795b 7374 725d  : FromQuery[str]
-00001470: 203d 2046 726f 6d51 7565 7279 2822 2229   = FromQuery("")
-00001480: 2c0a 293a 0a20 2020 2023 2074 6869 7320  ,.):.    # this 
-00001490: 6578 616d 706c 6520 696c 6c75 7374 7261  example illustra
-000014a0: 7465 7320 7375 7070 6f72 7420 666f 7220  tes support for 
-000014b0: 6578 706c 6963 6974 2071 7565 7279 2070  explicit query p
-000014c0: 6172 616d 6574 6572 7320 7769 7468 0a20  arameters with. 
-000014d0: 2020 2023 2064 6566 6175 6c74 2076 616c     # default val
-000014e0: 7565 730a 2020 2020 2320 696e 2074 6869  ues.    # in thi
-000014f0: 7320 6361 7365 2c20 7061 7261 6d65 7465  s case, paramete
-00001500: 7273 2061 7265 2065 7870 6c69 6369 746c  rs are explicitl
-00001510: 7920 7265 6164 2066 726f 6d20 7175 6572  y read from quer
-00001520: 7920 7374 7269 6e67 0a20 2020 202e 2e2e  y string.    ...
-00001530: 0a0a 6060 600a 0a49 7420 616c 736f 2073  ..```..It also s
-00001540: 7570 706f 7274 7320 5b64 6570 656e 6465  upports [depende
-00001550: 6e63 790a 696e 6a65 6374 696f 6e5d 2868  ncy.injection](h
-00001560: 7474 7073 3a2f 2f77 7777 2e6e 656f 7465  ttps://www.neote
-00001570: 726f 692e 6465 762f 626c 6163 6b73 6865  roi.dev/blackshe
-00001580: 6570 2f64 6570 656e 6465 6e63 792d 696e  ep/dependency-in
-00001590: 6a65 6374 696f 6e2f 292c 2061 0a66 6561  jection/), a.fea
-000015a0: 7475 7265 2074 6861 7420 7072 6f76 6964  ture that provid
-000015b0: 6573 2061 2063 6f6e 7369 7374 656e 7420  es a consistent 
-000015c0: 616e 6420 636c 6561 6e20 7761 7920 746f  and clean way to
-000015d0: 2075 7365 2064 6570 656e 6465 6e63 6965   use dependencie
-000015e0: 7320 696e 2072 6571 7565 7374 0a68 616e  s in request.han
-000015f0: 646c 6572 732e 0a0a 2323 2047 656e 6572  dlers...## Gener
-00001600: 6174 696f 6e20 6f66 204f 7065 6e41 5049  ation of OpenAPI
-00001610: 2044 6f63 756d 656e 7461 7469 6f6e 0a5b   Documentation.[
-00001620: 4765 6e65 7261 7469 6f6e 206f 6620 4f70  Generation of Op
-00001630: 656e 4150 4920 446f 6375 6d65 6e74 6174  enAPI Documentat
-00001640: 696f 6e5d 2868 7474 7073 3a2f 2f77 7777  ion](https://www
-00001650: 2e6e 656f 7465 726f 692e 6465 762f 626c  .neoteroi.dev/bl
-00001660: 6163 6b73 6865 6570 2f6f 7065 6e61 7069  acksheep/openapi
-00001670: 2f29 2e0a 0a23 2320 5374 7261 7465 6769  /)...## Strategi
-00001680: 6573 2074 6f20 6861 6e64 6c65 2061 7574  es to handle aut
-00001690: 6865 6e74 6963 6174 696f 6e20 616e 6420  hentication and 
-000016a0: 6175 7468 6f72 697a 6174 696f 6e0a 426c  authorization.Bl
-000016b0: 6163 6b53 6865 6570 2069 6d70 6c65 6d65  ackSheep impleme
-000016c0: 6e74 7320 7374 7261 7465 6769 6573 2074  nts strategies t
-000016d0: 6f20 6861 6e64 6c65 2061 7574 6865 6e74  o handle authent
-000016e0: 6963 6174 696f 6e20 616e 6420 6175 7468  ication and auth
-000016f0: 6f72 697a 6174 696f 6e2e 0a54 6865 7365  orization..These
-00001700: 2066 6561 7475 7265 7320 6172 6520 646f   features are do
-00001710: 6375 6d65 6e74 6564 2068 6572 653a 0a0a  cumented here:..
-00001720: 2a20 5b41 7574 6865 6e74 6963 6174 696f  * [Authenticatio
-00001730: 6e5d 2868 7474 7073 3a2f 2f77 7777 2e6e  n](https://www.n
-00001740: 656f 7465 726f 692e 6465 762f 626c 6163  eoteroi.dev/blac
-00001750: 6b73 6865 6570 2f61 7574 6865 6e74 6963  ksheep/authentic
-00001760: 6174 696f 6e2f 290a 2a20 5b41 7574 686f  ation/).* [Autho
-00001770: 7269 7a61 7469 6f6e 5d28 6874 7470 733a  rization](https:
-00001780: 2f2f 7777 772e 6e65 6f74 6572 6f69 2e64  //www.neoteroi.d
-00001790: 6576 2f62 6c61 636b 7368 6565 702f 6175  ev/blacksheep/au
-000017a0: 7468 6f72 697a 6174 696f 6e2f 290a 0a60  thorization/)..`
-000017b0: 6060 7079 7468 6f6e 0a61 7070 2e75 7365  ``python.app.use
-000017c0: 5f61 7574 6865 6e74 6963 6174 696f 6e28  _authentication(
-000017d0: 295c 0a20 2020 202e 6164 6428 4578 616d  )\.    .add(Exam
-000017e0: 706c 6541 7574 6865 6e74 6963 6174 696f  pleAuthenticatio
-000017f0: 6e48 616e 646c 6572 2829 290a 0a0a 6170  nHandler())...ap
-00001800: 702e 7573 655f 6175 7468 6f72 697a 6174  p.use_authorizat
-00001810: 696f 6e28 295c 0a20 2020 202e 6164 6428  ion()\.    .add(
-00001820: 4164 6d69 6e73 506f 6c69 6379 2829 290a  AdminsPolicy()).
-00001830: 0a0a 4061 7574 6828 2261 646d 696e 2229  ..@auth("admin")
-00001840: 0a40 6170 702e 726f 7574 6572 2e67 6574  .@app.router.get
-00001850: 2822 2f22 290a 6173 796e 6320 6465 6620  ("/").async def 
-00001860: 6f6e 6c79 5f66 6f72 5f61 646d 696e 7328  only_for_admins(
-00001870: 293a 0a20 2020 202e 2e2e 0a0a 0a40 6175  ):.    ......@au
-00001880: 7468 2829 0a40 6170 702e 726f 7574 6572  th().@app.router
-00001890: 2e67 6574 2822 2f22 290a 6173 796e 6320  .get("/").async 
-000018a0: 6465 6620 6f6e 6c79 5f66 6f72 5f61 7574  def only_for_aut
-000018b0: 6865 6e74 6963 6174 6564 5f75 7365 7273  henticated_users
-000018c0: 2829 3a0a 2020 2020 2e2e 2e0a 6060 600a  ():.    ....```.
-000018d0: 0a53 696e 6365 2076 6572 7369 6f6e 2060  .Since version `
-000018e0: 312e 322e 3160 2c20 426c 6163 6b53 6865  1.2.1`, BlackShe
-000018f0: 6570 2069 6d70 6c65 6d65 6e74 733a 0a0a  ep implements:..
-00001900: 2a20 5b42 7569 6c74 2d69 6e20 7375 7070  * [Built-in supp
-00001910: 6f72 7420 666f 7220 4f70 656e 4944 2043  ort for OpenID C
-00001920: 6f6e 6e65 6374 2061 7574 6865 6e74 6963  onnect authentic
-00001930: 6174 696f 6e5d 2868 7474 7073 3a2f 2f77  ation](https://w
-00001940: 7777 2e6e 656f 7465 726f 692e 6465 762f  ww.neoteroi.dev/
-00001950: 626c 6163 6b73 6865 6570 2f61 7574 6865  blacksheep/authe
-00001960: 6e74 6963 6174 696f 6e2f 236f 6964 6329  ntication/#oidc)
-00001970: 0a2a 205b 4275 696c 742d 696e 2073 7570  .* [Built-in sup
-00001980: 706f 7274 2066 6f72 204a 5754 2042 6561  port for JWT Bea
-00001990: 7265 7220 6175 7468 656e 7469 6361 7469  rer authenticati
-000019a0: 6f6e 5d28 6874 7470 733a 2f2f 7777 772e  on](https://www.
-000019b0: 6e65 6f74 6572 6f69 2e64 6576 2f62 6c61  neoteroi.dev/bla
-000019c0: 636b 7368 6565 702f 6175 7468 656e 7469  cksheep/authenti
-000019d0: 6361 7469 6f6e 2f23 6a77 742d 6265 6172  cation/#jwt-bear
-000019e0: 6572 290a 0a4d 6561 6e69 6e67 2074 6861  er)..Meaning tha
-000019f0: 7420 6974 2069 7320 6561 7379 2074 6f20  t it is easy to 
-00001a00: 696e 7465 6772 6174 6520 7769 7468 2073  integrate with s
-00001a10: 6572 7669 6365 7320 7375 6368 2061 733a  ervices such as:
-00001a20: 0a2a 205b 4175 7468 305d 2868 7474 7073  .* [Auth0](https
-00001a30: 3a2f 2f61 7574 6830 2e63 6f6d 290a 2a20  ://auth0.com).* 
-00001a40: 5b41 7a75 7265 2041 6374 6976 6520 4469  [Azure Active Di
-00001a50: 7265 6374 6f72 795d 2868 7474 7073 3a2f  rectory](https:/
-00001a60: 2f61 7a75 7265 2e6d 6963 726f 736f 6674  /azure.microsoft
-00001a70: 2e63 6f6d 2f65 6e2d 7573 2f73 6572 7669  .com/en-us/servi
-00001a80: 6365 732f 6163 7469 7665 2d64 6972 6563  ces/active-direc
-00001a90: 746f 7279 2f29 0a2a 205b 417a 7572 6520  tory/).* [Azure 
-00001aa0: 4163 7469 7665 2044 6972 6563 746f 7279  Active Directory
-00001ab0: 2042 3243 5d28 6874 7470 733a 2f2f 646f   B2C](https://do
-00001ac0: 6373 2e6d 6963 726f 736f 6674 2e63 6f6d  cs.microsoft.com
-00001ad0: 2f65 6e2d 7573 2f61 7a75 7265 2f61 6374  /en-us/azure/act
-00001ae0: 6976 652d 6469 7265 6374 6f72 792d 6232  ive-directory-b2
-00001af0: 632f 6f76 6572 7669 6577 290a 2a20 5b4f  c/overview).* [O
-00001b00: 6b74 615d 2868 7474 7073 3a2f 2f77 7777  kta](https://www
-00001b10: 2e6f 6b74 612e 636f 6d29 0a0a 5265 6665  .okta.com)..Refe
-00001b20: 7220 746f 2074 6865 2064 6f63 756d 656e  r to the documen
-00001b30: 7461 7469 6f6e 2066 6f72 206d 6f72 6520  tation for more 
-00001b40: 6465 7461 696c 7320 616e 6420 6578 616d  details and exam
-00001b50: 706c 6573 2e0a 0a23 2320 5765 6220 6672  ples...## Web fr
-00001b60: 616d 6577 6f72 6b20 6665 6174 7572 6573  amework features
-00001b70: 0a0a 2a20 5b41 5347 4920 636f 6d70 6174  ..* [ASGI compat
-00001b80: 6962 696c 6974 795d 2868 7474 7073 3a2f  ibility](https:/
-00001b90: 2f77 7777 2e6e 656f 7465 726f 692e 6465  /www.neoteroi.de
-00001ba0: 762f 626c 6163 6b73 6865 6570 2f61 7367  v/blacksheep/asg
-00001bb0: 692f 290a 2a20 5b52 6f75 7469 6e67 5d28  i/).* [Routing](
-00001bc0: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
-00001bd0: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
-00001be0: 6565 702f 726f 7574 696e 672f 290a 2a20  eep/routing/).* 
-00001bf0: 5265 7175 6573 7420 6861 6e64 6c65 7273  Request handlers
-00001c00: 2063 616e 2062 6520 5b64 6566 696e 6564   can be [defined
-00001c10: 2061 730a 2020 6675 6e63 7469 6f6e 735d   as.  functions]
-00001c20: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
-00001c30: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
-00001c40: 6865 6570 2f72 6571 7565 7374 2d68 616e  heep/request-han
-00001c50: 646c 6572 732f 292c 206f 7220 5b63 6c61  dlers/), or [cla
-00001c60: 7373 0a20 206d 6574 686f 6473 5d28 6874  ss.  methods](ht
-00001c70: 7470 733a 2f2f 7777 772e 6e65 6f74 6572  tps://www.neoter
-00001c80: 6f69 2e64 6576 2f62 6c61 636b 7368 6565  oi.dev/blackshee
-00001c90: 702f 636f 6e74 726f 6c6c 6572 732f 290a  p/controllers/).
-00001ca0: 2a20 5b4d 6964 646c 6577 6172 6573 5d28  * [Middlewares](
-00001cb0: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
-00001cc0: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
-00001cd0: 6565 702f 6d69 6464 6c65 7761 7265 732f  eep/middlewares/
-00001ce0: 290a 2a20 5b57 6562 536f 636b 6574 5d28  ).* [WebSocket](
-00001cf0: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
-00001d00: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
-00001d10: 6565 702f 7765 6273 6f63 6b65 742f 290a  eep/websocket/).
-00001d20: 2a20 5b42 7569 6c74 2d69 6e20 7375 7070  * [Built-in supp
-00001d30: 6f72 7420 666f 7220 6465 7065 6e64 656e  ort for dependen
-00001d40: 6379 0a20 2069 6e6a 6563 7469 6f6e 5d28  cy.  injection](
-00001d50: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
-00001d60: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
-00001d70: 6565 702f 6465 7065 6e64 656e 6379 2d69  eep/dependency-i
-00001d80: 6e6a 6563 7469 6f6e 2f29 0a2a 205b 5375  njection/).* [Su
-00001d90: 7070 6f72 7420 666f 7220 6175 746f 6d61  pport for automa
-00001da0: 7469 6320 6269 6e64 696e 6720 6f66 2072  tic binding of r
-00001db0: 6f75 7465 2061 6e64 2071 7565 7279 2070  oute and query p
-00001dc0: 6172 616d 6574 6572 7320 746f 2072 6571  arameters to req
-00001dd0: 7565 7374 0a20 2068 616e 646c 6572 7320  uest.  handlers 
-00001de0: 6d65 7468 6f64 730a 2020 6361 6c6c 735d  methods.  calls]
-00001df0: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
-00001e00: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
-00001e10: 6865 6570 2f67 6574 7469 6e67 2d73 7461  heep/getting-sta
-00001e20: 7274 6564 2f23 6861 6e64 6c69 6e67 2d72  rted/#handling-r
-00001e30: 6f75 7465 2d70 6172 616d 6574 6572 7329  oute-parameters)
-00001e40: 0a2a 205b 5374 7261 7465 6779 2074 6f20  .* [Strategy to 
-00001e50: 6861 6e64 6c65 0a20 2065 7863 6570 7469  handle.  excepti
-00001e60: 6f6e 735d 2868 7474 7073 3a2f 2f77 7777  ons](https://www
-00001e70: 2e6e 656f 7465 726f 692e 6465 762f 626c  .neoteroi.dev/bl
-00001e80: 6163 6b73 6865 6570 2f61 7070 6c69 6361  acksheep/applica
-00001e90: 7469 6f6e 2f23 636f 6e66 6967 7572 696e  tion/#configurin
-00001ea0: 672d 6578 6365 7074 696f 6e73 2d68 616e  g-exceptions-han
-00001eb0: 646c 6572 7329 0a2a 205b 5374 7261 7465  dlers).* [Strate
-00001ec0: 6779 2074 6f20 6861 6e64 6c65 2061 7574  gy to handle aut
-00001ed0: 6865 6e74 6963 6174 696f 6e20 616e 640a  hentication and.
-00001ee0: 2020 6175 7468 6f72 697a 6174 696f 6e5d    authorization]
-00001ef0: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
-00001f00: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
-00001f10: 6865 6570 2f61 7574 6865 6e74 6963 6174  heep/authenticat
-00001f20: 696f 6e2f 290a 2a20 5b42 7569 6c74 2d69  ion/).* [Built-i
-00001f30: 6e20 7375 7070 6f72 7420 666f 7220 4f70  n support for Op
-00001f40: 656e 4944 2043 6f6e 6e65 6374 2061 7574  enID Connect aut
-00001f50: 6865 6e74 6963 6174 696f 6e20 7573 696e  hentication usin
-00001f60: 6720 4f49 4443 0a20 2064 6973 636f 7665  g OIDC.  discove
-00001f70: 7279 5d28 6874 7470 733a 2f2f 7777 772e  ry](https://www.
-00001f80: 6e65 6f74 6572 6f69 2e64 6576 2f62 6c61  neoteroi.dev/bla
-00001f90: 636b 7368 6565 702f 6175 7468 656e 7469  cksheep/authenti
-00001fa0: 6361 7469 6f6e 2f23 6f69 6463 290a 2a20  cation/#oidc).* 
-00001fb0: 5b42 7569 6c74 2d69 6e20 7375 7070 6f72  [Built-in suppor
-00001fc0: 7420 666f 7220 4a57 5420 4265 6172 6572  t for JWT Bearer
-00001fd0: 2061 7574 6865 6e74 6963 6174 696f 6e20   authentication 
-00001fe0: 7573 696e 6720 4f49 4443 2064 6973 636f  using OIDC disco
-00001ff0: 7665 7279 2061 6e64 0a20 206f 7468 6572  very and.  other
-00002000: 2073 6f75 7263 6573 206f 660a 2020 4a57   sources of.  JW
-00002010: 4b53 5d28 6874 7470 733a 2f2f 7777 772e  KS](https://www.
-00002020: 6e65 6f74 6572 6f69 2e64 6576 2f62 6c61  neoteroi.dev/bla
-00002030: 636b 7368 6565 702f 6175 7468 656e 7469  cksheep/authenti
-00002040: 6361 7469 6f6e 2f23 6a77 742d 6265 6172  cation/#jwt-bear
-00002050: 6572 290a 2a20 5b48 616e 646c 6572 730a  er).* [Handlers.
-00002060: 2020 6e6f 726d 616c 697a 6174 696f 6e5d    normalization]
-00002070: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
-00002080: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
-00002090: 6865 6570 2f72 6571 7565 7374 2d68 616e  heep/request-han
-000020a0: 646c 6572 732f 290a 2a20 5b53 6572 7669  dlers/).* [Servi
-000020b0: 6e67 2073 7461 7469 630a 2020 6669 6c65  ng static.  file
-000020c0: 735d 2868 7474 7073 3a2f 2f77 7777 2e6e  s](https://www.n
-000020d0: 656f 7465 726f 692e 6465 762f 626c 6163  eoteroi.dev/blac
-000020e0: 6b73 6865 6570 2f73 7461 7469 632d 6669  ksheep/static-fi
-000020f0: 6c65 732f 290a 2a20 5b49 6e74 6567 7261  les/).* [Integra
-00002100: 7469 6f6e 2077 6974 680a 2020 4a69 6e6a  tion with.  Jinj
-00002110: 6132 5d28 6874 7470 733a 2f2f 7777 772e  a2](https://www.
-00002120: 6e65 6f74 6572 6f69 2e64 6576 2f62 6c61  neoteroi.dev/bla
-00002130: 636b 7368 6565 702f 7465 6d70 6c61 7469  cksheep/templati
-00002140: 6e67 2f29 0a2a 205b 5375 7070 6f72 7420  ng/).* [Support 
-00002150: 666f 7220 7365 7276 696e 6720 5350 4173  for serving SPAs
-00002160: 2074 6861 7420 7573 6520 4854 4d4c 3520   that use HTML5 
-00002170: 4869 7374 6f72 7920 4150 4920 666f 7220  History API for 
-00002180: 636c 6965 6e74 2073 6964 650a 2020 726f  client side.  ro
-00002190: 7574 696e 675d 2868 7474 7073 3a2f 2f77  uting](https://w
-000021a0: 7777 2e6e 656f 7465 726f 692e 6465 762f  ww.neoteroi.dev/
-000021b0: 626c 6163 6b73 6865 6570 2f73 7461 7469  blacksheep/stati
-000021c0: 632d 6669 6c65 732f 2368 6f77 2d74 6f2d  c-files/#how-to-
-000021d0: 7365 7276 652d 7370 6173 2d74 6861 742d  serve-spas-that-
-000021e0: 7573 652d 6874 6d6c 352d 6869 7374 6f72  use-html5-histor
-000021f0: 792d 6170 6929 0a2a 205b 5375 7070 6f72  y-api).* [Suppor
-00002200: 7420 666f 7220 6175 746f 6d61 7469 6320  t for automatic 
-00002210: 6765 6e65 7261 7469 6f6e 206f 6620 4f70  generation of Op
-00002220: 656e 4150 490a 2020 446f 6375 6d65 6e74  enAPI.  Document
-00002230: 6174 696f 6e5d 2868 7474 7073 3a2f 2f77  ation](https://w
-00002240: 7777 2e6e 656f 7465 726f 692e 6465 762f  ww.neoteroi.dev/
-00002250: 626c 6163 6b73 6865 6570 2f6f 7065 6e61  blacksheep/opena
-00002260: 7069 2f29 0a2a 205b 5374 7261 7465 6779  pi/).* [Strategy
-00002270: 2074 6f20 6861 6e64 6c65 2043 4f52 5320   to handle CORS 
-00002280: 7365 7474 696e 6773 5d28 6874 7470 733a  settings](https:
-00002290: 2f2f 7777 772e 6e65 6f74 6572 6f69 2e64  //www.neoteroi.d
-000022a0: 6576 2f62 6c61 636b 7368 6565 702f 636f  ev/blacksheep/co
-000022b0: 7273 2f29 0a2a 205b 5365 7373 696f 6e73  rs/).* [Sessions
-000022c0: 5d28 6874 7470 733a 2f2f 7777 772e 6e65  ](https://www.ne
-000022d0: 6f74 6572 6f69 2e64 6576 2f62 6c61 636b  oteroi.dev/black
-000022e0: 7368 6565 702f 7365 7373 696f 6e73 2f29  sheep/sessions/)
-000022f0: 0a2a 2053 7570 706f 7274 2066 6f72 2061  .* Support for a
-00002300: 7574 6f6d 6174 6963 2062 696e 6469 6e67  utomatic binding
-00002310: 206f 6620 6064 6174 6163 6c61 7373 6573   of `dataclasses
-00002320: 6020 616e 640a 2020 5b60 7079 6461 6e74  ` and.  [`pydant
-00002330: 6963 605d 2868 7474 7073 3a2f 2f70 7964  ic`](https://pyd
-00002340: 616e 7469 632d 646f 6373 2e68 656c 706d  antic-docs.helpm
-00002350: 616e 7561 6c2e 696f 2920 6d6f 6465 6c73  anual.io) models
-00002360: 2074 6f20 6861 6e64 6c65 2074 6865 0a20   to handle the. 
-00002370: 2072 6571 7565 7374 2062 6f64 7920 7061   request body pa
-00002380: 796c 6f61 6420 6578 7065 6374 6564 2062  yload expected b
-00002390: 7920 7265 7175 6573 7420 6861 6e64 6c65  y request handle
-000023a0: 7273 0a2a 205b 6054 6573 7443 6c69 656e  rs.* [`TestClien
-000023b0: 7460 2063 6c61 7373 2074 6f20 7369 6d70  t` class to simp
-000023c0: 6c69 6679 2074 6573 7469 6e67 206f 6620  lify testing of 
-000023d0: 6170 706c 6963 6174 696f 6e73 5d28 6874  applications](ht
-000023e0: 7470 733a 2f2f 7777 772e 6e65 6f74 6572  tps://www.neoter
-000023f0: 6f69 2e64 6576 2f62 6c61 636b 7368 6565  oi.dev/blackshee
-00002400: 702f 7465 7374 696e 672f 290a 2a20 5b41  p/testing/).* [A
-00002410: 6e74 6920 466f 7267 6572 7920 7661 6c69  nti Forgery vali
-00002420: 6461 7469 6f6e 5d28 6874 7470 733a 2f2f  dation](https://
-00002430: 7777 772e 6e65 6f74 6572 6f69 2e64 6576  www.neoteroi.dev
-00002440: 2f62 6c61 636b 7368 6565 702f 616e 7469  /blacksheep/anti
-00002450: 2d72 6571 7565 7374 2d66 6f72 6765 7279  -request-forgery
-00002460: 2920 746f 2070 726f 7465 6374 2061 6761  ) to protect aga
-00002470: 696e 7374 2043 726f 7373 2d53 6974 6520  inst Cross-Site 
-00002480: 5265 7175 6573 7420 466f 7267 6572 7920  Request Forgery 
-00002490: 2858 5352 462f 4353 5246 2920 6174 7461  (XSRF/CSRF) atta
-000024a0: 636b 730a 0a23 2320 436c 6965 6e74 2066  cks..## Client f
-000024b0: 6561 7475 7265 730a 0a42 6c61 636b 5368  eatures..BlackSh
-000024c0: 6565 7020 696e 636c 7564 6573 2061 6e20  eep includes an 
-000024d0: 4854 5450 2043 6c69 656e 742e 0a0a 2a2a  HTTP Client...**
-000024e0: 4578 616d 706c 653a 2a2a 0a60 6060 7079  Example:**.```py
-000024f0: 7468 6f6e 0a69 6d70 6f72 7420 6173 796e  thon.import asyn
-00002500: 6369 6f0a 0a66 726f 6d20 626c 6163 6b73  cio..from blacks
-00002510: 6865 6570 2e63 6c69 656e 7420 696d 706f  heep.client impo
-00002520: 7274 2043 6c69 656e 7453 6573 7369 6f6e  rt ClientSession
-00002530: 0a0a 0a61 7379 6e63 2064 6566 2063 6c69  ...async def cli
-00002540: 656e 745f 6578 616d 706c 6528 293a 0a20  ent_example():. 
-00002550: 2020 2061 7379 6e63 2077 6974 6820 436c     async with Cl
-00002560: 6965 6e74 5365 7373 696f 6e28 2920 6173  ientSession() as
-00002570: 2063 6c69 656e 743a 0a20 2020 2020 2020   client:.       
-00002580: 2072 6573 706f 6e73 6520 3d20 6177 6169   response = awai
-00002590: 7420 636c 6965 6e74 2e67 6574 2822 6874  t client.get("ht
-000025a0: 7470 733a 2f2f 646f 6373 2e70 7974 686f  tps://docs.pytho
-000025b0: 6e2e 6f72 672f 332f 2229 0a0a 2020 2020  n.org/3/")..    
-000025c0: 2020 2020 6173 7365 7274 2072 6573 706f      assert respo
-000025d0: 6e73 6520 6973 206e 6f74 204e 6f6e 650a  nse is not None.
-000025e0: 2020 2020 2020 2020 7465 7874 203d 2061          text = a
-000025f0: 7761 6974 2072 6573 706f 6e73 652e 7465  wait response.te
-00002600: 7874 2829 0a20 2020 2020 2020 2070 7269  xt().        pri
-00002610: 6e74 2874 6578 7429 0a0a 0a61 7379 6e63  nt(text)...async
-00002620: 696f 2e72 756e 2863 6c69 656e 745f 6578  io.run(client_ex
-00002630: 616d 706c 6528 2929 0a60 6060 0a0a 2323  ample()).```..##
-00002640: 2053 7570 706f 7274 6564 2070 6c61 7466   Supported platf
-00002650: 6f72 6d73 2061 6e64 2072 756e 7469 6d65  orms and runtime
-00002660: 730a 2a20 5079 7468 6f6e 3a20 616c 6c20  s.* Python: all 
-00002670: 7665 7273 696f 6e73 2069 6e63 6c75 6465  versions include
-00002680: 6420 696e 2074 6865 2062 7569 6c64 206d  d in the build m
-00002690: 6174 7269 780a 2a20 5562 756e 7475 0a2a  atrix.* Ubuntu.*
-000026a0: 2057 696e 646f 7773 2031 300a 2a20 6d61   Windows 10.* ma
-000026b0: 634f 530a 0a23 2320 446f 6375 6d65 6e74  cOS..## Document
-000026c0: 6174 696f 6e0a 506c 6561 7365 2072 6566  ation.Please ref
-000026d0: 6572 2074 6f20 7468 6520 5b64 6f63 756d  er to the [docum
-000026e0: 656e 7461 7469 6f6e 2077 6562 7369 7465  entation website
-000026f0: 5d28 6874 7470 733a 2f2f 7777 772e 6e65  ](https://www.ne
-00002700: 6f74 6572 6f69 2e64 6576 2f62 6c61 636b  oteroi.dev/black
-00002710: 7368 6565 702f 292e 0a0a 2323 2043 6f6d  sheep/)...## Com
-00002720: 6d75 6e69 6361 7469 6f6e 0a5b 426c 6163  munication.[Blac
-00002730: 6b53 6865 6570 2063 6f6d 6d75 6e69 7479  kSheep community
-00002740: 2069 6e20 4769 7474 6572 5d28 6874 7470   in Gitter](http
-00002750: 733a 2f2f 6769 7474 6572 2e69 6d2f 4e65  s://gitter.im/Ne
-00002760: 6f74 6572 6f69 2f42 6c61 636b 5368 6565  oteroi/BlackShee
-00002770: 7029 2e0a 0a23 2320 4272 616e 6368 6573  p)...## Branches
-00002780: 0a54 6865 205f 6d61 696e 5f20 6272 616e  .The _main_ bran
-00002790: 6368 2063 6f6e 7461 696e 7320 7468 6520  ch contains the 
-000027a0: 6375 7272 656e 746c 7920 6465 7665 6c6f  currently develo
-000027b0: 7065 6420 7665 7273 696f 6e2c 2077 6869  ped version, whi
-000027c0: 6368 2069 7320 7665 7273 696f 6e20 320a  ch is version 2.
-000027d0: 616c 7068 612e 2054 6865 205f 7631 5f20  alpha. The _v1_ 
-000027e0: 6272 616e 6368 2063 6f6e 7461 696e 7320  branch contains 
-000027f0: 7665 7273 696f 6e20 3120 6f66 2074 6865  version 1 of the
-00002800: 2077 6562 2066 7261 6d65 776f 726b 2c20   web framework, 
-00002810: 666f 7220 6275 6773 2066 6978 6573 0a61  for bugs fixes.a
-00002820: 6e64 206d 6169 6e74 656e 616e 6365 2e0a  nd maintenance..
+00000010: 3a20 322e 310d 0a4e 616d 653a 2062 6c61  : 2.1..Name: bla
+00000020: 636b 7368 6565 700d 0a56 6572 7369 6f6e  cksheep..Version
+00000030: 3a20 322e 3061 360d 0a53 756d 6d61 7279  : 2.0a6..Summary
+00000040: 3a20 4661 7374 2077 6562 2066 7261 6d65  : Fast web frame
+00000050: 776f 726b 2066 6f72 2050 7974 686f 6e20  work for Python 
+00000060: 6173 796e 6369 6f0d 0a41 7574 686f 722d  asyncio..Author-
+00000070: 656d 6169 6c3a 2052 6f62 6572 746f 2050  email: Roberto P
+00000080: 7265 7661 746f 203c 726f 6265 7274 6f2e  revato <roberto.
+00000090: 7072 6576 6174 6f40 676d 6169 6c2e 636f  prevato@gmail.co
+000000a0: 6d3e 0d0a 5072 6f6a 6563 742d 5552 4c3a  m>..Project-URL:
+000000b0: 2048 6f6d 6570 6167 652c 2068 7474 7073   Homepage, https
+000000c0: 3a2f 2f67 6974 6875 622e 636f 6d2f 4e65  ://github.com/Ne
+000000d0: 6f74 6572 6f69 2f42 6c61 636b 5368 6565  oteroi/BlackShee
+000000e0: 700d 0a50 726f 6a65 6374 2d55 524c 3a20  p..Project-URL: 
+000000f0: 4275 6720 5472 6163 6b65 722c 2068 7474  Bug Tracker, htt
+00000100: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+00000110: 4e65 6f74 6572 6f69 2f42 6c61 636b 5368  Neoteroi/BlackSh
+00000120: 6565 702f 6973 7375 6573 0d0a 4b65 7977  eep/issues..Keyw
+00000130: 6f72 6473 3a20 626c 6163 6b73 6865 6570  ords: blacksheep
+00000140: 2c77 6562 2066 7261 6d65 776f 726b 2c61  ,web framework,a
+00000150: 7379 6e63 696f 0d0a 436c 6173 7369 6669  syncio..Classifi
+00000160: 6572 3a20 4465 7665 6c6f 706d 656e 7420  er: Development 
+00000170: 5374 6174 7573 203a 3a20 3320 2d20 416c  Status :: 3 - Al
+00000180: 7068 610d 0a43 6c61 7373 6966 6965 723a  pha..Classifier:
+00000190: 204c 6963 656e 7365 203a 3a20 4f53 4920   License :: OSI 
+000001a0: 4170 7072 6f76 6564 203a 3a20 4d49 5420  Approved :: MIT 
+000001b0: 4c69 6365 6e73 650d 0a43 6c61 7373 6966  License..Classif
+000001c0: 6965 723a 2050 726f 6772 616d 6d69 6e67  ier: Programming
+000001d0: 204c 616e 6775 6167 6520 3a3a 2050 7974   Language :: Pyt
+000001e0: 686f 6e20 3a3a 2033 2e38 0d0a 436c 6173  hon :: 3.8..Clas
+000001f0: 7369 6669 6572 3a20 5072 6f67 7261 6d6d  sifier: Programm
+00000200: 696e 6720 4c61 6e67 7561 6765 203a 3a20  ing Language :: 
+00000210: 5079 7468 6f6e 203a 3a20 332e 390d 0a43  Python :: 3.9..C
+00000220: 6c61 7373 6966 6965 723a 2050 726f 6772  lassifier: Progr
+00000230: 616d 6d69 6e67 204c 616e 6775 6167 6520  amming Language 
+00000240: 3a3a 2050 7974 686f 6e20 3a3a 2033 2e31  :: Python :: 3.1
+00000250: 300d 0a43 6c61 7373 6966 6965 723a 2050  0..Classifier: P
+00000260: 726f 6772 616d 6d69 6e67 204c 616e 6775  rogramming Langu
+00000270: 6167 6520 3a3a 2050 7974 686f 6e20 3a3a  age :: Python ::
+00000280: 2033 2e31 310d 0a43 6c61 7373 6966 6965   3.11..Classifie
+00000290: 723a 2045 6e76 6972 6f6e 6d65 6e74 203a  r: Environment :
+000002a0: 3a20 5765 6220 456e 7669 726f 6e6d 656e  : Web Environmen
+000002b0: 740d 0a43 6c61 7373 6966 6965 723a 204f  t..Classifier: O
+000002c0: 7065 7261 7469 6e67 2053 7973 7465 6d20  perating System 
+000002d0: 3a3a 204f 5320 496e 6465 7065 6e64 656e  :: OS Independen
+000002e0: 740d 0a43 6c61 7373 6966 6965 723a 2046  t..Classifier: F
+000002f0: 7261 6d65 776f 726b 203a 3a20 4173 796e  ramework :: Asyn
+00000300: 6349 4f0d 0a52 6571 7569 7265 732d 5079  cIO..Requires-Py
+00000310: 7468 6f6e 3a20 3e3d 332e 370d 0a44 6573  thon: >=3.7..Des
+00000320: 6372 6970 7469 6f6e 2d43 6f6e 7465 6e74  cription-Content
+00000330: 2d54 7970 653a 2074 6578 742f 6d61 726b  -Type: text/mark
+00000340: 646f 776e 0d0a 5072 6f76 6964 6573 2d45  down..Provides-E
+00000350: 7874 7261 3a20 6a69 6e6a 610d 0a50 726f  xtra: jinja..Pro
+00000360: 7669 6465 732d 4578 7472 613a 2066 756c  vides-Extra: ful
+00000370: 6c0d 0a4c 6963 656e 7365 2d46 696c 653a  l..License-File:
+00000380: 204c 4943 454e 5345 0d0a 0d0a 5b21 5b42   LICENSE....[![B
+00000390: 7569 6c64 5d28 6874 7470 733a 2f2f 6769  uild](https://gi
+000003a0: 7468 7562 2e63 6f6d 2f4e 656f 7465 726f  thub.com/Neotero
+000003b0: 692f 426c 6163 6b53 6865 6570 2f77 6f72  i/BlackSheep/wor
+000003c0: 6b66 6c6f 7773 2f4d 6169 6e2f 6261 6467  kflows/Main/badg
+000003d0: 652e 7376 6729 5d28 6874 7470 733a 2f2f  e.svg)](https://
+000003e0: 6769 7468 7562 2e63 6f6d 2f4e 656f 7465  github.com/Neote
+000003f0: 726f 692f 426c 6163 6b53 6865 6570 2f61  roi/BlackSheep/a
+00000400: 6374 696f 6e73 290d 0a5b 215b 7079 7069  ctions)..[![pypi
+00000410: 5d28 6874 7470 733a 2f2f 696d 672e 7368  ](https://img.sh
+00000420: 6965 6c64 732e 696f 2f70 7970 692f 762f  ields.io/pypi/v/
+00000430: 426c 6163 6b53 6865 6570 2e73 7667 3f63  BlackSheep.svg?c
+00000440: 6f6c 6f72 3d62 6c75 6529 5d28 6874 7470  olor=blue)](http
+00000450: 733a 2f2f 7079 7069 2e6f 7267 2f70 726f  s://pypi.org/pro
+00000460: 6a65 6374 2f42 6c61 636b 5368 6565 702f  ject/BlackSheep/
+00000470: 290d 0a5b 215b 7665 7273 696f 6e73 5d28  )..[![versions](
+00000480: 6874 7470 733a 2f2f 696d 672e 7368 6965  https://img.shie
+00000490: 6c64 732e 696f 2f70 7970 692f 7079 7665  lds.io/pypi/pyve
+000004a0: 7273 696f 6e73 2f62 6c61 636b 7368 6565  rsions/blackshee
+000004b0: 702e 7376 6729 5d28 6874 7470 733a 2f2f  p.svg)](https://
+000004c0: 6769 7468 7562 2e63 6f6d 2f72 6f62 6572  github.com/rober
+000004d0: 746f 7072 6576 6174 6f2f 626c 6163 6b73  toprevato/blacks
+000004e0: 6865 6570 290d 0a5b 215b 636f 6465 636f  heep)..[![codeco
+000004f0: 765d 2868 7474 7073 3a2f 2f63 6f64 6563  v](https://codec
+00000500: 6f76 2e69 6f2f 6768 2f4e 656f 7465 726f  ov.io/gh/Neotero
+00000510: 692f 426c 6163 6b53 6865 6570 2f62 7261  i/BlackSheep/bra
+00000520: 6e63 682f 6d61 7374 6572 2f67 7261 7068  nch/master/graph
+00000530: 2f62 6164 6765 2e73 7667 3f74 6f6b 656e  /badge.svg?token
+00000540: 3d4e 7a69 3239 4c30 4567 3129 5d28 6874  =Nzi29L0Eg1)](ht
+00000550: 7470 733a 2f2f 636f 6465 636f 762e 696f  tps://codecov.io
+00000560: 2f67 682f 4e65 6f74 6572 6f69 2f42 6c61  /gh/Neoteroi/Bla
+00000570: 636b 5368 6565 7029 0d0a 5b21 5b6c 6963  ckSheep)..[![lic
+00000580: 656e 7365 5d28 6874 7470 733a 2f2f 696d  ense](https://im
+00000590: 672e 7368 6965 6c64 732e 696f 2f67 6974  g.shields.io/git
+000005a0: 6875 622f 6c69 6365 6e73 652f 4e65 6f74  hub/license/Neot
+000005b0: 6572 6f69 2f62 6c61 636b 7368 6565 702e  eroi/blacksheep.
+000005c0: 7376 6729 5d28 6874 7470 733a 2f2f 6769  svg)](https://gi
+000005d0: 7468 7562 2e63 6f6d 2f4e 656f 7465 726f  thub.com/Neotero
+000005e0: 692f 626c 6163 6b73 6865 6570 2f62 6c6f  i/blacksheep/blo
+000005f0: 622f 6d61 696e 2f4c 4943 454e 5345 2920  b/main/LICENSE) 
+00000600: 5b21 5b4a 6f69 6e20 7468 6520 6368 6174  [![Join the chat
+00000610: 2061 7420 6874 7470 733a 2f2f 6769 7474   at https://gitt
+00000620: 6572 2e69 6d2f 4e65 6f74 6572 6f69 2f42  er.im/Neoteroi/B
+00000630: 6c61 636b 5368 6565 705d 2868 7474 7073  lackSheep](https
+00000640: 3a2f 2f62 6164 6765 732e 6769 7474 6572  ://badges.gitter
+00000650: 2e69 6d2f 4e65 6f74 6572 6f69 2f42 6c61  .im/Neoteroi/Bla
+00000660: 636b 5368 6565 702e 7376 6729 5d28 6874  ckSheep.svg)](ht
+00000670: 7470 733a 2f2f 6769 7474 6572 2e69 6d2f  tps://gitter.im/
+00000680: 4e65 6f74 6572 6f69 2f42 6c61 636b 5368  Neoteroi/BlackSh
+00000690: 6565 703f 7574 6d5f 736f 7572 6365 3d62  eep?utm_source=b
+000006a0: 6164 6765 2675 746d 5f6d 6564 6975 6d3d  adge&utm_medium=
+000006b0: 6261 6467 6526 7574 6d5f 6361 6d70 6169  badge&utm_campai
+000006c0: 676e 3d70 722d 6261 6467 6526 7574 6d5f  gn=pr-badge&utm_
+000006d0: 636f 6e74 656e 743d 6261 6467 6529 205b  content=badge) [
+000006e0: 215b 646f 6375 6d65 6e74 6174 696f 6e5d  ![documentation]
+000006f0: 2868 7474 7073 3a2f 2f69 6d67 2e73 6869  (https://img.shi
+00000700: 656c 6473 2e69 6f2f 6261 6467 652f f09f  elds.io/badge/..
+00000710: 9396 2d64 6f63 732d 7075 7270 6c65 295d  ..-docs-purple)]
+00000720: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
+00000730: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
+00000740: 6865 6570 2f29 0d0a 0d0a 2320 426c 6163  heep/)....# Blac
+00000750: 6b53 6865 6570 0d0a 426c 6163 6b53 6865  kSheep..BlackShe
+00000760: 6570 2069 7320 616e 2061 7379 6e63 6872  ep is an asynchr
+00000770: 6f6e 6f75 7320 7765 6220 6672 616d 6577  onous web framew
+00000780: 6f72 6b20 746f 2062 7569 6c64 2065 7665  ork to build eve
+00000790: 6e74 2062 6173 6564 2077 6562 0d0a 6170  nt based web..ap
+000007a0: 706c 6963 6174 696f 6e73 2077 6974 6820  plications with 
+000007b0: 5079 7468 6f6e 2e20 4974 2069 7320 696e  Python. It is in
+000007c0: 7370 6972 6564 2062 790d 0a5b 466c 6173  spired by..[Flas
+000007d0: 6b5d 2868 7474 7073 3a2f 2f70 616c 6c65  k](https://palle
+000007e0: 7473 7072 6f6a 6563 7473 2e63 6f6d 2f70  tsprojects.com/p
+000007f0: 2f66 6c61 736b 2f29 2c20 5b41 5350 2e4e  /flask/), [ASP.N
+00000800: 4554 0d0a 436f 7265 5d28 6874 7470 733a  ET..Core](https:
+00000810: 2f2f 646f 6373 2e6d 6963 726f 736f 6674  //docs.microsoft
+00000820: 2e63 6f6d 2f65 6e2d 7573 2f61 7370 6e65  .com/en-us/aspne
+00000830: 742f 636f 7265 2f29 2c20 616e 6420 7468  t/core/), and th
+00000840: 6520 776f 726b 2062 7920 5b59 7572 790d  e work by [Yury.
+00000850: 0a53 656c 6976 616e 6f76 5d28 6874 7470  .Selivanov](http
+00000860: 733a 2f2f 6d61 6769 632e 696f 2f62 6c6f  s://magic.io/blo
+00000870: 672f 7576 6c6f 6f70 2d62 6c61 7a69 6e67  g/uvloop-blazing
+00000880: 2d66 6173 742d 7079 7468 6f6e 2d6e 6574  -fast-python-net
+00000890: 776f 726b 696e 672f 292e 0d0a 0d0a 3c70  working/).....<p
+000008a0: 2061 6c69 676e 3d22 6c65 6674 223e 0d0a   align="left">..
+000008b0: 2020 3c61 2068 7265 663d 2223 626c 6163    <a href="#blac
+000008c0: 6b73 6865 6570 223e 3c69 6d67 2077 6964  ksheep"><img wid
+000008d0: 7468 3d22 3332 3022 2068 6569 6768 743d  th="320" height=
+000008e0: 2232 3731 2220 7372 633d 2268 7474 7073  "271" src="https
+000008f0: 3a2f 2f77 7777 2e6e 656f 7465 726f 692e  ://www.neoteroi.
+00000900: 6465 762f 626c 6163 6b73 6865 6570 2f69  dev/blacksheep/i
+00000910: 6d67 2f62 6c61 636b 7368 6565 702e 706e  mg/blacksheep.pn
+00000920: 6722 2061 6c74 3d22 426c 6163 6b20 5368  g" alt="Black Sh
+00000930: 6565 7022 3e3c 2f61 3e0d 0a3c 2f70 3e0d  eep"></a>..</p>.
+00000940: 0a0d 0a60 6060 6261 7368 0d0a 7069 7020  ...```bash..pip 
+00000950: 696e 7374 616c 6c20 626c 6163 6b73 6865  install blackshe
+00000960: 6570 0d0a 6060 600d 0a0d 0a2d 2d2d 0d0a  ep..```....---..
+00000970: 0d0a 6060 6070 7974 686f 6e0d 0a66 726f  ..```python..fro
+00000980: 6d20 6461 7465 7469 6d65 2069 6d70 6f72  m datetime impor
+00000990: 7420 6461 7465 7469 6d65 0d0a 0d0a 6672  t datetime....fr
+000009a0: 6f6d 2062 6c61 636b 7368 6565 7020 696d  om blacksheep im
+000009b0: 706f 7274 2041 7070 6c69 6361 7469 6f6e  port Application
+000009c0: 0d0a 0d0a 0d0a 6170 7020 3d20 4170 706c  ......app = Appl
+000009d0: 6963 6174 696f 6e28 290d 0a0d 0a40 6170  ication()....@ap
+000009e0: 702e 726f 7574 6528 222f 2229 0d0a 6173  p.route("/")..as
+000009f0: 796e 6320 6465 6620 686f 6d65 2829 3a0d  ync def home():.
+00000a00: 0a20 2020 2072 6574 7572 6e20 6622 4865  .    return f"He
+00000a10: 6c6c 6f2c 2057 6f72 6c64 2120 7b64 6174  llo, World! {dat
+00000a20: 6574 696d 652e 7574 636e 6f77 2829 2e69  etime.utcnow().i
+00000a30: 736f 666f 726d 6174 2829 7d22 0d0a 0d0a  soformat()}"....
+00000a40: 6060 600d 0a0d 0a23 2320 4765 7474 696e  ```....## Gettin
+00000a50: 6720 7374 6172 7465 640d 0a0d 0a54 6865  g started....The
+00000a60: 2064 6f63 756d 656e 7461 7469 6f6e 206f   documentation o
+00000a70: 6666 6572 7320 6765 7474 696e 6720 7374  ffers getting st
+00000a80: 6172 7465 6420 7475 746f 7269 616c 733a  arted tutorials:
+00000a90: 0d0a 2a20 5b47 6574 7469 6e67 2073 7461  ..* [Getting sta
+00000aa0: 7274 6564 3a0d 0a20 2062 6173 6963 735d  rted:..  basics]
+00000ab0: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
+00000ac0: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
+00000ad0: 6865 6570 2f67 6574 7469 6e67 2d73 7461  heep/getting-sta
+00000ae0: 7274 6564 2f29 0d0a 2a20 5b47 6574 7469  rted/)..* [Getti
+00000af0: 6e67 2073 7461 7274 6564 3a20 7468 6520  ng started: the 
+00000b00: 4d56 4320 7072 6f6a 6563 740d 0a20 2074  MVC project..  t
+00000b10: 656d 706c 6174 655d 2868 7474 7073 3a2f  emplate](https:/
+00000b20: 2f77 7777 2e6e 656f 7465 726f 692e 6465  /www.neoteroi.de
+00000b30: 762f 626c 6163 6b73 6865 6570 2f6d 7663  v/blacksheep/mvc
+00000b40: 2d70 726f 6a65 6374 2d74 656d 706c 6174  -project-templat
+00000b50: 652f 290d 0a0d 0a54 6865 7365 2070 726f  e/)....These pro
+00000b60: 6a65 6374 2074 656d 706c 6174 6573 2063  ject templates c
+00000b70: 616e 2062 6520 7573 6564 2074 6f20 7374  an be used to st
+00000b80: 6172 7420 6e65 7720 6170 706c 6963 6174  art new applicat
+00000b90: 696f 6e73 2066 6173 7465 723a 0d0a 0d0a  ions faster:....
+00000ba0: 2a20 5b4d 5643 2070 726f 6a65 6374 0d0a  * [MVC project..
+00000bb0: 2020 7465 6d70 6c61 7465 5d28 6874 7470    template](http
+00000bc0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f4e  s://github.com/N
+00000bd0: 656f 7465 726f 692f 426c 6163 6b53 6865  eoteroi/BlackShe
+00000be0: 6570 4d56 4329 0d0a 2a20 5b45 6d70 7479  epMVC)..* [Empty
+00000bf0: 2070 726f 6a65 6374 0d0a 2020 7465 6d70   project..  temp
+00000c00: 6c61 7465 5d28 6874 7470 733a 2f2f 6769  late](https://gi
+00000c10: 7468 7562 2e63 6f6d 2f4e 656f 7465 726f  thub.com/Neotero
+00000c20: 692f 426c 6163 6b53 6865 6570 456d 7074  i/BlackSheepEmpt
+00000c30: 7950 726f 6a65 6374 290d 0a0d 0a23 2320  yProject)....## 
+00000c40: 5265 7175 6972 656d 656e 7473 0d0a 0d0a  Requirements....
+00000c50: 5b50 7974 686f 6e5d 2868 7474 7073 3a2f  [Python](https:/
+00000c60: 2f77 7777 2e70 7974 686f 6e2e 6f72 6729  /www.python.org)
+00000c70: 3a20 616e 7920 7665 7273 696f 6e20 6c69  : any version li
+00000c80: 7374 6564 2069 6e20 7468 6520 7072 6f6a  sted in the proj
+00000c90: 6563 7427 730d 0a63 6c61 7373 6966 6965  ect's..classifie
+00000ca0: 7273 2e20 5468 6520 6375 7272 656e 7420  rs. The current 
+00000cb0: 6c69 7374 2069 733a 0d0a 0d0a 5b21 5b76  list is:....[![v
+00000cc0: 6572 7369 6f6e 735d 2868 7474 7073 3a2f  ersions](https:/
+00000cd0: 2f69 6d67 2e73 6869 656c 6473 2e69 6f2f  /img.shields.io/
+00000ce0: 7079 7069 2f70 7976 6572 7369 6f6e 732f  pypi/pyversions/
+00000cf0: 626c 6163 6b73 6865 6570 2e73 7667 295d  blacksheep.svg)]
+00000d00: 2868 7474 7073 3a2f 2f67 6974 6875 622e  (https://github.
+00000d10: 636f 6d2f 726f 6265 7274 6f70 7265 7661  com/robertopreva
+00000d20: 746f 2f62 6c61 636b 7368 6565 7029 0d0a  to/blacksheep)..
+00000d30: 0d0a 0d0a 426c 6163 6b53 6865 6570 2062  ....BlackSheep b
+00000d40: 656c 6f6e 6773 2074 6f20 7468 6520 6361  elongs to the ca
+00000d50: 7465 676f 7279 206f 660d 0a5b 4153 4749  tegory of..[ASGI
+00000d60: 5d28 6874 7470 733a 2f2f 6173 6769 2e72  ](https://asgi.r
+00000d70: 6561 6474 6865 646f 6373 2e69 6f2f 656e  eadthedocs.io/en
+00000d80: 2f6c 6174 6573 742f 2920 7765 6220 6672  /latest/) web fr
+00000d90: 616d 6577 6f72 6b73 2c20 736f 2069 7420  ameworks, so it 
+00000da0: 7265 7175 6972 6573 0d0a 616e 2041 5347  requires..an ASG
+00000db0: 4920 4854 5450 2073 6572 7665 7220 746f  I HTTP server to
+00000dc0: 2072 756e 2c20 7375 6368 2061 7320 5b75   run, such as [u
+00000dd0: 7669 636f 726e 5d28 6874 7470 3a2f 2f77  vicorn](http://w
+00000de0: 7777 2e75 7669 636f 726e 2e6f 7267 2f29  ww.uvicorn.org/)
+00000df0: 2c20 6f72 0d0a 5b68 7970 6572 636f 726e  , or..[hypercorn
+00000e00: 5d28 6874 7470 733a 2f2f 7067 6a6f 6e65  ](https://pgjone
+00000e10: 732e 6769 746c 6162 2e69 6f2f 6879 7065  s.gitlab.io/hype
+00000e20: 7263 6f72 6e2f 292e 2046 6f72 2065 7861  rcorn/). For exa
+00000e30: 6d70 6c65 2c20 746f 2075 7365 2069 7420  mple, to use it 
+00000e40: 7769 7468 0d0a 7576 6963 6f72 6e3a 0d0a  with..uvicorn:..
+00000e50: 0d0a 6060 6062 6173 680d 0a24 2070 6970  ..```bash..$ pip
+00000e60: 2069 6e73 7461 6c6c 2075 7669 636f 726e   install uvicorn
+00000e70: 0d0a 6060 600d 0a0d 0a54 6f20 7275 6e20  ..```....To run 
+00000e80: 616e 2061 7070 6c69 6361 7469 6f6e 206c  an application l
+00000e90: 696b 6520 696e 2074 6865 2065 7861 6d70  ike in the examp
+00000ea0: 6c65 2061 626f 7665 2c20 7573 6520 7468  le above, use th
+00000eb0: 6520 6d65 7468 6f64 7320 7072 6f76 6964  e methods provid
+00000ec0: 6564 2062 790d 0a74 6865 2041 5347 4920  ed by..the ASGI 
+00000ed0: 4854 5450 2053 6572 7665 723a 0d0a 0d0a  HTTP Server:....
+00000ee0: 6060 6062 6173 680d 0a23 2069 6620 7468  ```bash..# if th
+00000ef0: 6520 426c 6163 6b53 6865 6570 2061 7070  e BlackSheep app
+00000f00: 2069 7320 6465 6669 6e65 6420 696e 2061   is defined in a
+00000f10: 2066 696c 6520 6073 6572 7665 722e 7079   file `server.py
+00000f20: 600d 0a0d 0a24 2075 7669 636f 726e 2073  `....$ uvicorn s
+00000f30: 6572 7665 723a 6170 700d 0a60 6060 0d0a  erver:app..```..
+00000f40: 0d0a 546f 2072 756e 2066 6f72 2070 726f  ..To run for pro
+00000f50: 6475 6374 696f 6e2c 2072 6566 6572 2074  duction, refer t
+00000f60: 6f20 7468 6520 646f 6375 6d65 6e74 6174  o the documentat
+00000f70: 696f 6e20 6f66 2074 6865 2063 686f 7365  ion of the chose
+00000f80: 6e20 4153 4749 2073 6572 7665 720d 0a28  n ASGI server..(
+00000f90: 692e 652e 2066 6f72 205b 7576 6963 6f72  i.e. for [uvicor
+00000fa0: 6e5d 2868 7474 7073 3a2f 2f77 7777 2e75  n](https://www.u
+00000fb0: 7669 636f 726e 2e6f 7267 2f23 7275 6e6e  vicorn.org/#runn
+00000fc0: 696e 672d 7769 7468 2d67 756e 6963 6f72  ing-with-gunicor
+00000fd0: 6e29 292e 0d0a 0d0a 2323 2041 7574 6f6d  n)).....## Autom
+00000fe0: 6174 6963 2062 696e 6469 6e67 7320 616e  atic bindings an
+00000ff0: 6420 6465 7065 6e64 656e 6379 2069 6e6a  d dependency inj
+00001000: 6563 7469 6f6e 0d0a 426c 6163 6b53 6865  ection..BlackShe
+00001010: 6570 2073 7570 706f 7274 7320 6175 746f  ep supports auto
+00001020: 6d61 7469 6320 6269 6e64 696e 6720 6f66  matic binding of
+00001030: 2076 616c 7565 7320 666f 7220 7265 7175   values for requ
+00001040: 6573 7420 6861 6e64 6c65 7273 2c20 6279  est handlers, by
+00001050: 2074 7970 650d 0a61 6e6e 6f74 6174 696f   type..annotatio
+00001060: 6e20 6f72 2062 7920 636f 6e76 656e 7469  n or by conventi
+00001070: 6f6e 732e 2053 6565 205b 6d6f 7265 0d0a  ons. See [more..
+00001080: 6865 7265 5d28 6874 7470 733a 2f2f 7777  here](https://ww
+00001090: 772e 6e65 6f74 6572 6f69 2e64 6576 2f62  w.neoteroi.dev/b
+000010a0: 6c61 636b 7368 6565 702f 7265 7175 6573  lacksheep/reques
+000010b0: 7473 2f29 2e0d 0a0d 0a60 6060 7079 7468  ts/).....```pyth
+000010c0: 6f6e 0d0a 6672 6f6d 2064 6174 6163 6c61  on..from datacla
+000010d0: 7373 6573 2069 6d70 6f72 7420 6461 7461  sses import data
+000010e0: 636c 6173 730d 0a0d 0a66 726f 6d20 626c  class....from bl
+000010f0: 6163 6b73 6865 6570 2069 6d70 6f72 7420  acksheep import 
+00001100: 4170 706c 6963 6174 696f 6e2c 2046 726f  Application, Fro
+00001110: 6d4a 534f 4e2c 2046 726f 6d51 7565 7279  mJSON, FromQuery
+00001120: 0d0a 0d0a 0d0a 6170 7020 3d20 4170 706c  ......app = Appl
+00001130: 6963 6174 696f 6e28 290d 0a0d 0a0d 0a40  ication()......@
+00001140: 6461 7461 636c 6173 730d 0a63 6c61 7373  dataclass..class
+00001150: 2043 7265 6174 6543 6174 496e 7075 743a   CreateCatInput:
+00001160: 0d0a 2020 2020 6e61 6d65 3a20 7374 720d  ..    name: str.
+00001170: 0a0d 0a0d 0a40 6170 702e 726f 7574 6572  .....@app.router
+00001180: 2e70 6f73 7428 222f 6170 692f 6361 7473  .post("/api/cats
+00001190: 2229 0d0a 6173 796e 6320 6465 6620 6578  ")..async def ex
+000011a0: 616d 706c 6528 6461 7461 3a20 4672 6f6d  ample(data: From
+000011b0: 4a53 4f4e 5b43 7265 6174 6543 6174 496e  JSON[CreateCatIn
+000011c0: 7075 745d 293a 0d0a 2020 2020 2320 696e  put]):..    # in
+000011d0: 2074 6869 7320 6578 616d 706c 652c 2064   this example, d
+000011e0: 6174 6120 6973 2062 6f75 6e64 2061 7574  ata is bound aut
+000011f0: 6f6d 6174 6963 616c 6c79 2072 6561 6469  omatically readi
+00001200: 6e67 2074 6865 204a 534f 4e0d 0a20 2020  ng the JSON..   
+00001210: 2023 2070 6179 6c6f 6164 2061 6e64 2063   # payload and c
+00001220: 7265 6174 696e 6720 616e 2069 6e73 7461  reating an insta
+00001230: 6e63 6520 6f66 2060 4372 6561 7465 4361  nce of `CreateCa
+00001240: 7449 6e70 7574 600d 0a20 2020 202e 2e2e  tInput`..    ...
+00001250: 0d0a 0d0a 0d0a 4061 7070 2e72 6f75 7465  ......@app.route
+00001260: 722e 6765 7428 222f 3a63 756c 7475 7265  r.get("/:culture
+00001270: 5f63 6f64 652f 3a61 7265 6122 290d 0a61  _code/:area")..a
+00001280: 7379 6e63 2064 6566 2068 6f6d 6528 6375  sync def home(cu
+00001290: 6c74 7572 655f 636f 6465 2c20 6172 6561  lture_code, area
+000012a0: 293a 0d0a 2020 2020 2320 696e 2074 6869  ):..    # in thi
+000012b0: 7320 6578 616d 706c 652c 2062 6f74 6820  s example, both 
+000012c0: 7061 7261 6d65 7465 7273 2061 7265 206f  parameters are o
+000012d0: 6274 6169 6e65 6420 6672 6f6d 2072 6f75  btained from rou
+000012e0: 7465 7320 7769 7468 0d0a 2020 2020 2320  tes with..    # 
+000012f0: 6d61 7463 6869 6e67 206e 616d 6573 0d0a  matching names..
+00001300: 2020 2020 7265 7475 726e 2066 2252 6571      return f"Req
+00001310: 7565 7374 2066 6f72 3a20 7b63 756c 7475  uest for: {cultu
+00001320: 7265 5f63 6f64 657d 207b 6172 6561 7d22  re_code} {area}"
+00001330: 0d0a 0d0a 0d0a 4061 7070 2e72 6f75 7465  ......@app.route
+00001340: 722e 6765 7428 222f 6170 692f 7072 6f64  r.get("/api/prod
+00001350: 7563 7473 2229 0d0a 6465 6620 6765 745f  ucts")..def get_
+00001360: 7072 6f64 7563 7473 280d 0a20 2020 2070  products(..    p
+00001370: 6167 653a 2069 6e74 203d 2031 2c0d 0a20  age: int = 1,.. 
+00001380: 2020 2073 697a 653a 2069 6e74 203d 2033     size: int = 3
+00001390: 302c 0d0a 2020 2020 7365 6172 6368 3a20  0,..    search: 
+000013a0: 7374 7220 3d20 2222 2c0d 0a29 3a0d 0a20  str = "",..):.. 
+000013b0: 2020 2023 2074 6869 7320 6578 616d 706c     # this exampl
+000013c0: 6520 696c 6c75 7374 7261 7465 7320 7375  e illustrates su
+000013d0: 7070 6f72 7420 666f 7220 696d 706c 6963  pport for implic
+000013e0: 6974 2071 7565 7279 2070 6172 616d 6574  it query paramet
+000013f0: 6572 7320 7769 7468 0d0a 2020 2020 2320  ers with..    # 
+00001400: 6465 6661 756c 7420 7661 6c75 6573 0d0a  default values..
+00001410: 2020 2020 2320 7369 6e63 6520 7468 6520      # since the 
+00001420: 736f 7572 6365 206f 6620 7061 6765 2c20  source of page, 
+00001430: 7369 7a65 2c20 616e 6420 7365 6172 6368  size, and search
+00001440: 2069 7320 6e6f 7420 7370 6563 6966 6965   is not specifie
+00001450: 6420 616e 6420 6e6f 0d0a 2020 2020 2320  d and no..    # 
+00001460: 726f 7574 6520 7061 7261 6d65 7465 7220  route parameter 
+00001470: 6d61 7463 6865 7320 7468 6569 7220 6e61  matches their na
+00001480: 6d65 2c20 7468 6579 2061 7265 206f 6274  me, they are obt
+00001490: 6169 6e65 6420 6672 6f6d 2071 7565 7279  ained from query
+000014a0: 2073 7472 696e 670d 0a20 2020 202e 2e2e   string..    ...
+000014b0: 0d0a 0d0a 0d0a 4061 7070 2e72 6f75 7465  ......@app.route
+000014c0: 722e 6765 7428 222f 6170 692f 7072 6f64  r.get("/api/prod
+000014d0: 7563 7473 3222 290d 0a64 6566 2067 6574  ucts2")..def get
+000014e0: 5f70 726f 6475 6374 7332 280d 0a20 2020  _products2(..   
+000014f0: 2070 6167 653a 2046 726f 6d51 7565 7279   page: FromQuery
+00001500: 5b69 6e74 5d20 3d20 4672 6f6d 5175 6572  [int] = FromQuer
+00001510: 7928 3129 2c0d 0a20 2020 2073 697a 653a  y(1),..    size:
+00001520: 2046 726f 6d51 7565 7279 5b69 6e74 5d20   FromQuery[int] 
+00001530: 3d20 4672 6f6d 5175 6572 7928 3330 292c  = FromQuery(30),
+00001540: 0d0a 2020 2020 7365 6172 6368 3a20 4672  ..    search: Fr
+00001550: 6f6d 5175 6572 795b 7374 725d 203d 2046  omQuery[str] = F
+00001560: 726f 6d51 7565 7279 2822 2229 2c0d 0a29  romQuery(""),..)
+00001570: 3a0d 0a20 2020 2023 2074 6869 7320 6578  :..    # this ex
+00001580: 616d 706c 6520 696c 6c75 7374 7261 7465  ample illustrate
+00001590: 7320 7375 7070 6f72 7420 666f 7220 6578  s support for ex
+000015a0: 706c 6963 6974 2071 7565 7279 2070 6172  plicit query par
+000015b0: 616d 6574 6572 7320 7769 7468 0d0a 2020  ameters with..  
+000015c0: 2020 2320 6465 6661 756c 7420 7661 6c75    # default valu
+000015d0: 6573 0d0a 2020 2020 2320 696e 2074 6869  es..    # in thi
+000015e0: 7320 6361 7365 2c20 7061 7261 6d65 7465  s case, paramete
+000015f0: 7273 2061 7265 2065 7870 6c69 6369 746c  rs are explicitl
+00001600: 7920 7265 6164 2066 726f 6d20 7175 6572  y read from quer
+00001610: 7920 7374 7269 6e67 0d0a 2020 2020 2e2e  y string..    ..
+00001620: 2e0d 0a0d 0a60 6060 0d0a 0d0a 4974 2061  .....```....It a
+00001630: 6c73 6f20 7375 7070 6f72 7473 205b 6465  lso supports [de
+00001640: 7065 6e64 656e 6379 0d0a 696e 6a65 6374  pendency..inject
+00001650: 696f 6e5d 2868 7474 7073 3a2f 2f77 7777  ion](https://www
+00001660: 2e6e 656f 7465 726f 692e 6465 762f 626c  .neoteroi.dev/bl
+00001670: 6163 6b73 6865 6570 2f64 6570 656e 6465  acksheep/depende
+00001680: 6e63 792d 696e 6a65 6374 696f 6e2f 292c  ncy-injection/),
+00001690: 2061 0d0a 6665 6174 7572 6520 7468 6174   a..feature that
+000016a0: 2070 726f 7669 6465 7320 6120 636f 6e73   provides a cons
+000016b0: 6973 7465 6e74 2061 6e64 2063 6c65 616e  istent and clean
+000016c0: 2077 6179 2074 6f20 7573 6520 6465 7065   way to use depe
+000016d0: 6e64 656e 6369 6573 2069 6e20 7265 7175  ndencies in requ
+000016e0: 6573 740d 0a68 616e 646c 6572 732e 0d0a  est..handlers...
+000016f0: 0d0a 2323 2047 656e 6572 6174 696f 6e20  ..## Generation 
+00001700: 6f66 204f 7065 6e41 5049 2044 6f63 756d  of OpenAPI Docum
+00001710: 656e 7461 7469 6f6e 0d0a 5b47 656e 6572  entation..[Gener
+00001720: 6174 696f 6e20 6f66 204f 7065 6e41 5049  ation of OpenAPI
+00001730: 2044 6f63 756d 656e 7461 7469 6f6e 5d28   Documentation](
+00001740: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
+00001750: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
+00001760: 6565 702f 6f70 656e 6170 692f 292e 0d0a  eep/openapi/)...
+00001770: 0d0a 2323 2053 7472 6174 6567 6965 7320  ..## Strategies 
+00001780: 746f 2068 616e 646c 6520 6175 7468 656e  to handle authen
+00001790: 7469 6361 7469 6f6e 2061 6e64 2061 7574  tication and aut
+000017a0: 686f 7269 7a61 7469 6f6e 0d0a 426c 6163  horization..Blac
+000017b0: 6b53 6865 6570 2069 6d70 6c65 6d65 6e74  kSheep implement
+000017c0: 7320 7374 7261 7465 6769 6573 2074 6f20  s strategies to 
+000017d0: 6861 6e64 6c65 2061 7574 6865 6e74 6963  handle authentic
+000017e0: 6174 696f 6e20 616e 6420 6175 7468 6f72  ation and author
+000017f0: 697a 6174 696f 6e2e 0d0a 5468 6573 6520  ization...These 
+00001800: 6665 6174 7572 6573 2061 7265 2064 6f63  features are doc
+00001810: 756d 656e 7465 6420 6865 7265 3a0d 0a0d  umented here:...
+00001820: 0a2a 205b 4175 7468 656e 7469 6361 7469  .* [Authenticati
+00001830: 6f6e 5d28 6874 7470 733a 2f2f 7777 772e  on](https://www.
+00001840: 6e65 6f74 6572 6f69 2e64 6576 2f62 6c61  neoteroi.dev/bla
+00001850: 636b 7368 6565 702f 6175 7468 656e 7469  cksheep/authenti
+00001860: 6361 7469 6f6e 2f29 0d0a 2a20 5b41 7574  cation/)..* [Aut
+00001870: 686f 7269 7a61 7469 6f6e 5d28 6874 7470  horization](http
+00001880: 733a 2f2f 7777 772e 6e65 6f74 6572 6f69  s://www.neoteroi
+00001890: 2e64 6576 2f62 6c61 636b 7368 6565 702f  .dev/blacksheep/
+000018a0: 6175 7468 6f72 697a 6174 696f 6e2f 290d  authorization/).
+000018b0: 0a0d 0a60 6060 7079 7468 6f6e 0d0a 6170  ...```python..ap
+000018c0: 702e 7573 655f 6175 7468 656e 7469 6361  p.use_authentica
+000018d0: 7469 6f6e 2829 5c0d 0a20 2020 202e 6164  tion()\..    .ad
+000018e0: 6428 4578 616d 706c 6541 7574 6865 6e74  d(ExampleAuthent
+000018f0: 6963 6174 696f 6e48 616e 646c 6572 2829  icationHandler()
+00001900: 290d 0a0d 0a0d 0a61 7070 2e75 7365 5f61  )......app.use_a
+00001910: 7574 686f 7269 7a61 7469 6f6e 2829 5c0d  uthorization()\.
+00001920: 0a20 2020 202e 6164 6428 4164 6d69 6e73  .    .add(Admins
+00001930: 506f 6c69 6379 2829 290d 0a0d 0a0d 0a40  Policy())......@
+00001940: 6175 7468 2822 6164 6d69 6e22 290d 0a40  auth("admin")..@
+00001950: 6170 702e 726f 7574 6572 2e67 6574 2822  app.router.get("
+00001960: 2f22 290d 0a61 7379 6e63 2064 6566 206f  /")..async def o
+00001970: 6e6c 795f 666f 725f 6164 6d69 6e73 2829  nly_for_admins()
+00001980: 3a0d 0a20 2020 202e 2e2e 0d0a 0d0a 0d0a  :..    .........
+00001990: 4061 7574 6828 290d 0a40 6170 702e 726f  @auth()..@app.ro
+000019a0: 7574 6572 2e67 6574 2822 2f22 290d 0a61  uter.get("/")..a
+000019b0: 7379 6e63 2064 6566 206f 6e6c 795f 666f  sync def only_fo
+000019c0: 725f 6175 7468 656e 7469 6361 7465 645f  r_authenticated_
+000019d0: 7573 6572 7328 293a 0d0a 2020 2020 2e2e  users():..    ..
+000019e0: 2e0d 0a60 6060 0d0a 0d0a 5369 6e63 6520  ...```....Since 
+000019f0: 7665 7273 696f 6e20 6031 2e32 2e31 602c  version `1.2.1`,
+00001a00: 2042 6c61 636b 5368 6565 7020 696d 706c   BlackSheep impl
+00001a10: 656d 656e 7473 3a0d 0a0d 0a2a 205b 4275  ements:....* [Bu
+00001a20: 696c 742d 696e 2073 7570 706f 7274 2066  ilt-in support f
+00001a30: 6f72 204f 7065 6e49 4420 436f 6e6e 6563  or OpenID Connec
+00001a40: 7420 6175 7468 656e 7469 6361 7469 6f6e  t authentication
+00001a50: 5d28 6874 7470 733a 2f2f 7777 772e 6e65  ](https://www.ne
+00001a60: 6f74 6572 6f69 2e64 6576 2f62 6c61 636b  oteroi.dev/black
+00001a70: 7368 6565 702f 6175 7468 656e 7469 6361  sheep/authentica
+00001a80: 7469 6f6e 2f23 6f69 6463 290d 0a2a 205b  tion/#oidc)..* [
+00001a90: 4275 696c 742d 696e 2073 7570 706f 7274  Built-in support
+00001aa0: 2066 6f72 204a 5754 2042 6561 7265 7220   for JWT Bearer 
+00001ab0: 6175 7468 656e 7469 6361 7469 6f6e 5d28  authentication](
+00001ac0: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
+00001ad0: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
+00001ae0: 6565 702f 6175 7468 656e 7469 6361 7469  eep/authenticati
+00001af0: 6f6e 2f23 6a77 742d 6265 6172 6572 290d  on/#jwt-bearer).
+00001b00: 0a0d 0a4d 6561 6e69 6e67 2074 6861 7420  ...Meaning that 
+00001b10: 6974 2069 7320 6561 7379 2074 6f20 696e  it is easy to in
+00001b20: 7465 6772 6174 6520 7769 7468 2073 6572  tegrate with ser
+00001b30: 7669 6365 7320 7375 6368 2061 733a 0d0a  vices such as:..
+00001b40: 2a20 5b41 7574 6830 5d28 6874 7470 733a  * [Auth0](https:
+00001b50: 2f2f 6175 7468 302e 636f 6d29 0d0a 2a20  //auth0.com)..* 
+00001b60: 5b41 7a75 7265 2041 6374 6976 6520 4469  [Azure Active Di
+00001b70: 7265 6374 6f72 795d 2868 7474 7073 3a2f  rectory](https:/
+00001b80: 2f61 7a75 7265 2e6d 6963 726f 736f 6674  /azure.microsoft
+00001b90: 2e63 6f6d 2f65 6e2d 7573 2f73 6572 7669  .com/en-us/servi
+00001ba0: 6365 732f 6163 7469 7665 2d64 6972 6563  ces/active-direc
+00001bb0: 746f 7279 2f29 0d0a 2a20 5b41 7a75 7265  tory/)..* [Azure
+00001bc0: 2041 6374 6976 6520 4469 7265 6374 6f72   Active Director
+00001bd0: 7920 4232 435d 2868 7474 7073 3a2f 2f64  y B2C](https://d
+00001be0: 6f63 732e 6d69 6372 6f73 6f66 742e 636f  ocs.microsoft.co
+00001bf0: 6d2f 656e 2d75 732f 617a 7572 652f 6163  m/en-us/azure/ac
+00001c00: 7469 7665 2d64 6972 6563 746f 7279 2d62  tive-directory-b
+00001c10: 3263 2f6f 7665 7276 6965 7729 0d0a 2a20  2c/overview)..* 
+00001c20: 5b4f 6b74 615d 2868 7474 7073 3a2f 2f77  [Okta](https://w
+00001c30: 7777 2e6f 6b74 612e 636f 6d29 0d0a 0d0a  ww.okta.com)....
+00001c40: 5265 6665 7220 746f 2074 6865 2064 6f63  Refer to the doc
+00001c50: 756d 656e 7461 7469 6f6e 2066 6f72 206d  umentation for m
+00001c60: 6f72 6520 6465 7461 696c 7320 616e 6420  ore details and 
+00001c70: 6578 616d 706c 6573 2e0d 0a0d 0a23 2320  examples.....## 
+00001c80: 5765 6220 6672 616d 6577 6f72 6b20 6665  Web framework fe
+00001c90: 6174 7572 6573 0d0a 0d0a 2a20 5b41 5347  atures....* [ASG
+00001ca0: 4920 636f 6d70 6174 6962 696c 6974 795d  I compatibility]
+00001cb0: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
+00001cc0: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
+00001cd0: 6865 6570 2f61 7367 692f 290d 0a2a 205b  heep/asgi/)..* [
+00001ce0: 526f 7574 696e 675d 2868 7474 7073 3a2f  Routing](https:/
+00001cf0: 2f77 7777 2e6e 656f 7465 726f 692e 6465  /www.neoteroi.de
+00001d00: 762f 626c 6163 6b73 6865 6570 2f72 6f75  v/blacksheep/rou
+00001d10: 7469 6e67 2f29 0d0a 2a20 5265 7175 6573  ting/)..* Reques
+00001d20: 7420 6861 6e64 6c65 7273 2063 616e 2062  t handlers can b
+00001d30: 6520 5b64 6566 696e 6564 2061 730d 0a20  e [defined as.. 
+00001d40: 2066 756e 6374 696f 6e73 5d28 6874 7470   functions](http
+00001d50: 733a 2f2f 7777 772e 6e65 6f74 6572 6f69  s://www.neoteroi
+00001d60: 2e64 6576 2f62 6c61 636b 7368 6565 702f  .dev/blacksheep/
+00001d70: 7265 7175 6573 742d 6861 6e64 6c65 7273  request-handlers
+00001d80: 2f29 2c20 6f72 205b 636c 6173 730d 0a20  /), or [class.. 
+00001d90: 206d 6574 686f 6473 5d28 6874 7470 733a   methods](https:
+00001da0: 2f2f 7777 772e 6e65 6f74 6572 6f69 2e64  //www.neoteroi.d
+00001db0: 6576 2f62 6c61 636b 7368 6565 702f 636f  ev/blacksheep/co
+00001dc0: 6e74 726f 6c6c 6572 732f 290d 0a2a 205b  ntrollers/)..* [
+00001dd0: 4d69 6464 6c65 7761 7265 735d 2868 7474  Middlewares](htt
+00001de0: 7073 3a2f 2f77 7777 2e6e 656f 7465 726f  ps://www.neotero
+00001df0: 692e 6465 762f 626c 6163 6b73 6865 6570  i.dev/blacksheep
+00001e00: 2f6d 6964 646c 6577 6172 6573 2f29 0d0a  /middlewares/)..
+00001e10: 2a20 5b57 6562 536f 636b 6574 5d28 6874  * [WebSocket](ht
+00001e20: 7470 733a 2f2f 7777 772e 6e65 6f74 6572  tps://www.neoter
+00001e30: 6f69 2e64 6576 2f62 6c61 636b 7368 6565  oi.dev/blackshee
+00001e40: 702f 7765 6273 6f63 6b65 742f 290d 0a2a  p/websocket/)..*
+00001e50: 205b 4275 696c 742d 696e 2073 7570 706f   [Built-in suppo
+00001e60: 7274 2066 6f72 2064 6570 656e 6465 6e63  rt for dependenc
+00001e70: 790d 0a20 2069 6e6a 6563 7469 6f6e 5d28  y..  injection](
+00001e80: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
+00001e90: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
+00001ea0: 6565 702f 6465 7065 6e64 656e 6379 2d69  eep/dependency-i
+00001eb0: 6e6a 6563 7469 6f6e 2f29 0d0a 2a20 5b53  njection/)..* [S
+00001ec0: 7570 706f 7274 2066 6f72 2061 7574 6f6d  upport for autom
+00001ed0: 6174 6963 2062 696e 6469 6e67 206f 6620  atic binding of 
+00001ee0: 726f 7574 6520 616e 6420 7175 6572 7920  route and query 
+00001ef0: 7061 7261 6d65 7465 7273 2074 6f20 7265  parameters to re
+00001f00: 7175 6573 740d 0a20 2068 616e 646c 6572  quest..  handler
+00001f10: 7320 6d65 7468 6f64 730d 0a20 2063 616c  s methods..  cal
+00001f20: 6c73 5d28 6874 7470 733a 2f2f 7777 772e  ls](https://www.
+00001f30: 6e65 6f74 6572 6f69 2e64 6576 2f62 6c61  neoteroi.dev/bla
+00001f40: 636b 7368 6565 702f 6765 7474 696e 672d  cksheep/getting-
+00001f50: 7374 6172 7465 642f 2368 616e 646c 696e  started/#handlin
+00001f60: 672d 726f 7574 652d 7061 7261 6d65 7465  g-route-paramete
+00001f70: 7273 290d 0a2a 205b 5374 7261 7465 6779  rs)..* [Strategy
+00001f80: 2074 6f20 6861 6e64 6c65 0d0a 2020 6578   to handle..  ex
+00001f90: 6365 7074 696f 6e73 5d28 6874 7470 733a  ceptions](https:
+00001fa0: 2f2f 7777 772e 6e65 6f74 6572 6f69 2e64  //www.neoteroi.d
+00001fb0: 6576 2f62 6c61 636b 7368 6565 702f 6170  ev/blacksheep/ap
+00001fc0: 706c 6963 6174 696f 6e2f 2363 6f6e 6669  plication/#confi
+00001fd0: 6775 7269 6e67 2d65 7863 6570 7469 6f6e  guring-exception
+00001fe0: 732d 6861 6e64 6c65 7273 290d 0a2a 205b  s-handlers)..* [
+00001ff0: 5374 7261 7465 6779 2074 6f20 6861 6e64  Strategy to hand
+00002000: 6c65 2061 7574 6865 6e74 6963 6174 696f  le authenticatio
+00002010: 6e20 616e 640d 0a20 2061 7574 686f 7269  n and..  authori
+00002020: 7a61 7469 6f6e 5d28 6874 7470 733a 2f2f  zation](https://
+00002030: 7777 772e 6e65 6f74 6572 6f69 2e64 6576  www.neoteroi.dev
+00002040: 2f62 6c61 636b 7368 6565 702f 6175 7468  /blacksheep/auth
+00002050: 656e 7469 6361 7469 6f6e 2f29 0d0a 2a20  entication/)..* 
+00002060: 5b42 7569 6c74 2d69 6e20 7375 7070 6f72  [Built-in suppor
+00002070: 7420 666f 7220 4f70 656e 4944 2043 6f6e  t for OpenID Con
+00002080: 6e65 6374 2061 7574 6865 6e74 6963 6174  nect authenticat
+00002090: 696f 6e20 7573 696e 6720 4f49 4443 0d0a  ion using OIDC..
+000020a0: 2020 6469 7363 6f76 6572 795d 2868 7474    discovery](htt
+000020b0: 7073 3a2f 2f77 7777 2e6e 656f 7465 726f  ps://www.neotero
+000020c0: 692e 6465 762f 626c 6163 6b73 6865 6570  i.dev/blacksheep
+000020d0: 2f61 7574 6865 6e74 6963 6174 696f 6e2f  /authentication/
+000020e0: 236f 6964 6329 0d0a 2a20 5b42 7569 6c74  #oidc)..* [Built
+000020f0: 2d69 6e20 7375 7070 6f72 7420 666f 7220  -in support for 
+00002100: 4a57 5420 4265 6172 6572 2061 7574 6865  JWT Bearer authe
+00002110: 6e74 6963 6174 696f 6e20 7573 696e 6720  ntication using 
+00002120: 4f49 4443 2064 6973 636f 7665 7279 2061  OIDC discovery a
+00002130: 6e64 0d0a 2020 6f74 6865 7220 736f 7572  nd..  other sour
+00002140: 6365 7320 6f66 0d0a 2020 4a57 4b53 5d28  ces of..  JWKS](
+00002150: 6874 7470 733a 2f2f 7777 772e 6e65 6f74  https://www.neot
+00002160: 6572 6f69 2e64 6576 2f62 6c61 636b 7368  eroi.dev/blacksh
+00002170: 6565 702f 6175 7468 656e 7469 6361 7469  eep/authenticati
+00002180: 6f6e 2f23 6a77 742d 6265 6172 6572 290d  on/#jwt-bearer).
+00002190: 0a2a 205b 4861 6e64 6c65 7273 0d0a 2020  .* [Handlers..  
+000021a0: 6e6f 726d 616c 697a 6174 696f 6e5d 2868  normalization](h
+000021b0: 7474 7073 3a2f 2f77 7777 2e6e 656f 7465  ttps://www.neote
+000021c0: 726f 692e 6465 762f 626c 6163 6b73 6865  roi.dev/blackshe
+000021d0: 6570 2f72 6571 7565 7374 2d68 616e 646c  ep/request-handl
+000021e0: 6572 732f 290d 0a2a 205b 5365 7276 696e  ers/)..* [Servin
+000021f0: 6720 7374 6174 6963 0d0a 2020 6669 6c65  g static..  file
+00002200: 735d 2868 7474 7073 3a2f 2f77 7777 2e6e  s](https://www.n
+00002210: 656f 7465 726f 692e 6465 762f 626c 6163  eoteroi.dev/blac
+00002220: 6b73 6865 6570 2f73 7461 7469 632d 6669  ksheep/static-fi
+00002230: 6c65 732f 290d 0a2a 205b 496e 7465 6772  les/)..* [Integr
+00002240: 6174 696f 6e20 7769 7468 0d0a 2020 4a69  ation with..  Ji
+00002250: 6e6a 6132 5d28 6874 7470 733a 2f2f 7777  nja2](https://ww
+00002260: 772e 6e65 6f74 6572 6f69 2e64 6576 2f62  w.neoteroi.dev/b
+00002270: 6c61 636b 7368 6565 702f 7465 6d70 6c61  lacksheep/templa
+00002280: 7469 6e67 2f29 0d0a 2a20 5b53 7570 706f  ting/)..* [Suppo
+00002290: 7274 2066 6f72 2073 6572 7669 6e67 2053  rt for serving S
+000022a0: 5041 7320 7468 6174 2075 7365 2048 544d  PAs that use HTM
+000022b0: 4c35 2048 6973 746f 7279 2041 5049 2066  L5 History API f
+000022c0: 6f72 2063 6c69 656e 7420 7369 6465 0d0a  or client side..
+000022d0: 2020 726f 7574 696e 675d 2868 7474 7073    routing](https
+000022e0: 3a2f 2f77 7777 2e6e 656f 7465 726f 692e  ://www.neoteroi.
+000022f0: 6465 762f 626c 6163 6b73 6865 6570 2f73  dev/blacksheep/s
+00002300: 7461 7469 632d 6669 6c65 732f 2368 6f77  tatic-files/#how
+00002310: 2d74 6f2d 7365 7276 652d 7370 6173 2d74  -to-serve-spas-t
+00002320: 6861 742d 7573 652d 6874 6d6c 352d 6869  hat-use-html5-hi
+00002330: 7374 6f72 792d 6170 6929 0d0a 2a20 5b53  story-api)..* [S
+00002340: 7570 706f 7274 2066 6f72 2061 7574 6f6d  upport for autom
+00002350: 6174 6963 2067 656e 6572 6174 696f 6e20  atic generation 
+00002360: 6f66 204f 7065 6e41 5049 0d0a 2020 446f  of OpenAPI..  Do
+00002370: 6375 6d65 6e74 6174 696f 6e5d 2868 7474  cumentation](htt
+00002380: 7073 3a2f 2f77 7777 2e6e 656f 7465 726f  ps://www.neotero
+00002390: 692e 6465 762f 626c 6163 6b73 6865 6570  i.dev/blacksheep
+000023a0: 2f6f 7065 6e61 7069 2f29 0d0a 2a20 5b53  /openapi/)..* [S
+000023b0: 7472 6174 6567 7920 746f 2068 616e 646c  trategy to handl
+000023c0: 6520 434f 5253 2073 6574 7469 6e67 735d  e CORS settings]
+000023d0: 2868 7474 7073 3a2f 2f77 7777 2e6e 656f  (https://www.neo
+000023e0: 7465 726f 692e 6465 762f 626c 6163 6b73  teroi.dev/blacks
+000023f0: 6865 6570 2f63 6f72 732f 290d 0a2a 205b  heep/cors/)..* [
+00002400: 5365 7373 696f 6e73 5d28 6874 7470 733a  Sessions](https:
+00002410: 2f2f 7777 772e 6e65 6f74 6572 6f69 2e64  //www.neoteroi.d
+00002420: 6576 2f62 6c61 636b 7368 6565 702f 7365  ev/blacksheep/se
+00002430: 7373 696f 6e73 2f29 0d0a 2a20 5375 7070  ssions/)..* Supp
+00002440: 6f72 7420 666f 7220 6175 746f 6d61 7469  ort for automati
+00002450: 6320 6269 6e64 696e 6720 6f66 2060 6461  c binding of `da
+00002460: 7461 636c 6173 7365 7360 2061 6e64 0d0a  taclasses` and..
+00002470: 2020 5b60 7079 6461 6e74 6963 605d 2868    [`pydantic`](h
+00002480: 7474 7073 3a2f 2f70 7964 616e 7469 632d  ttps://pydantic-
+00002490: 646f 6373 2e68 656c 706d 616e 7561 6c2e  docs.helpmanual.
+000024a0: 696f 2920 6d6f 6465 6c73 2074 6f20 6861  io) models to ha
+000024b0: 6e64 6c65 2074 6865 0d0a 2020 7265 7175  ndle the..  requ
+000024c0: 6573 7420 626f 6479 2070 6179 6c6f 6164  est body payload
+000024d0: 2065 7870 6563 7465 6420 6279 2072 6571   expected by req
+000024e0: 7565 7374 2068 616e 646c 6572 730d 0a2a  uest handlers..*
+000024f0: 205b 6054 6573 7443 6c69 656e 7460 2063   [`TestClient` c
+00002500: 6c61 7373 2074 6f20 7369 6d70 6c69 6679  lass to simplify
+00002510: 2074 6573 7469 6e67 206f 6620 6170 706c   testing of appl
+00002520: 6963 6174 696f 6e73 5d28 6874 7470 733a  ications](https:
+00002530: 2f2f 7777 772e 6e65 6f74 6572 6f69 2e64  //www.neoteroi.d
+00002540: 6576 2f62 6c61 636b 7368 6565 702f 7465  ev/blacksheep/te
+00002550: 7374 696e 672f 290d 0a2a 205b 416e 7469  sting/)..* [Anti
+00002560: 2046 6f72 6765 7279 2076 616c 6964 6174   Forgery validat
+00002570: 696f 6e5d 2868 7474 7073 3a2f 2f77 7777  ion](https://www
+00002580: 2e6e 656f 7465 726f 692e 6465 762f 626c  .neoteroi.dev/bl
+00002590: 6163 6b73 6865 6570 2f61 6e74 692d 7265  acksheep/anti-re
+000025a0: 7175 6573 742d 666f 7267 6572 7929 2074  quest-forgery) t
+000025b0: 6f20 7072 6f74 6563 7420 6167 6169 6e73  o protect agains
+000025c0: 7420 4372 6f73 732d 5369 7465 2052 6571  t Cross-Site Req
+000025d0: 7565 7374 2046 6f72 6765 7279 2028 5853  uest Forgery (XS
+000025e0: 5246 2f43 5352 4629 2061 7474 6163 6b73  RF/CSRF) attacks
+000025f0: 0d0a 0d0a 2323 2043 6c69 656e 7420 6665  ....## Client fe
+00002600: 6174 7572 6573 0d0a 0d0a 426c 6163 6b53  atures....BlackS
+00002610: 6865 6570 2069 6e63 6c75 6465 7320 616e  heep includes an
+00002620: 2048 5454 5020 436c 6965 6e74 2e0d 0a0d   HTTP Client....
+00002630: 0a2a 2a45 7861 6d70 6c65 3a2a 2a0d 0a60  .**Example:**..`
+00002640: 6060 7079 7468 6f6e 0d0a 696d 706f 7274  ``python..import
+00002650: 2061 7379 6e63 696f 0d0a 0d0a 6672 6f6d   asyncio....from
+00002660: 2062 6c61 636b 7368 6565 702e 636c 6965   blacksheep.clie
+00002670: 6e74 2069 6d70 6f72 7420 436c 6965 6e74  nt import Client
+00002680: 5365 7373 696f 6e0d 0a0d 0a0d 0a61 7379  Session......asy
+00002690: 6e63 2064 6566 2063 6c69 656e 745f 6578  nc def client_ex
+000026a0: 616d 706c 6528 293a 0d0a 2020 2020 6173  ample():..    as
+000026b0: 796e 6320 7769 7468 2043 6c69 656e 7453  ync with ClientS
+000026c0: 6573 7369 6f6e 2829 2061 7320 636c 6965  ession() as clie
+000026d0: 6e74 3a0d 0a20 2020 2020 2020 2072 6573  nt:..        res
+000026e0: 706f 6e73 6520 3d20 6177 6169 7420 636c  ponse = await cl
+000026f0: 6965 6e74 2e67 6574 2822 6874 7470 733a  ient.get("https:
+00002700: 2f2f 646f 6373 2e70 7974 686f 6e2e 6f72  //docs.python.or
+00002710: 672f 332f 2229 0d0a 0d0a 2020 2020 2020  g/3/")....      
+00002720: 2020 6173 7365 7274 2072 6573 706f 6e73    assert respons
+00002730: 6520 6973 206e 6f74 204e 6f6e 650d 0a20  e is not None.. 
+00002740: 2020 2020 2020 2074 6578 7420 3d20 6177         text = aw
+00002750: 6169 7420 7265 7370 6f6e 7365 2e74 6578  ait response.tex
+00002760: 7428 290d 0a20 2020 2020 2020 2070 7269  t()..        pri
+00002770: 6e74 2874 6578 7429 0d0a 0d0a 0d0a 6173  nt(text)......as
+00002780: 796e 6369 6f2e 7275 6e28 636c 6965 6e74  yncio.run(client
+00002790: 5f65 7861 6d70 6c65 2829 290d 0a60 6060  _example())..```
+000027a0: 0d0a 0d0a 2323 2053 7570 706f 7274 6564  ....## Supported
+000027b0: 2070 6c61 7466 6f72 6d73 2061 6e64 2072   platforms and r
+000027c0: 756e 7469 6d65 730d 0a2a 2050 7974 686f  untimes..* Pytho
+000027d0: 6e3a 2061 6c6c 2076 6572 7369 6f6e 7320  n: all versions 
+000027e0: 696e 636c 7564 6564 2069 6e20 7468 6520  included in the 
+000027f0: 6275 696c 6420 6d61 7472 6978 0d0a 2a20  build matrix..* 
+00002800: 5562 756e 7475 0d0a 2a20 5769 6e64 6f77  Ubuntu..* Window
+00002810: 7320 3130 0d0a 2a20 6d61 634f 530d 0a0d  s 10..* macOS...
+00002820: 0a23 2320 446f 6375 6d65 6e74 6174 696f  .## Documentatio
+00002830: 6e0d 0a50 6c65 6173 6520 7265 6665 7220  n..Please refer 
+00002840: 746f 2074 6865 205b 646f 6375 6d65 6e74  to the [document
+00002850: 6174 696f 6e20 7765 6273 6974 655d 2868  ation website](h
+00002860: 7474 7073 3a2f 2f77 7777 2e6e 656f 7465  ttps://www.neote
+00002870: 726f 692e 6465 762f 626c 6163 6b73 6865  roi.dev/blackshe
+00002880: 6570 2f29 2e0d 0a0d 0a23 2320 436f 6d6d  ep/).....## Comm
+00002890: 756e 6963 6174 696f 6e0d 0a5b 426c 6163  unication..[Blac
+000028a0: 6b53 6865 6570 2063 6f6d 6d75 6e69 7479  kSheep community
+000028b0: 2069 6e20 4769 7474 6572 5d28 6874 7470   in Gitter](http
+000028c0: 733a 2f2f 6769 7474 6572 2e69 6d2f 4e65  s://gitter.im/Ne
+000028d0: 6f74 6572 6f69 2f42 6c61 636b 5368 6565  oteroi/BlackShee
+000028e0: 7029 2e0d 0a0d 0a23 2320 4272 616e 6368  p).....## Branch
+000028f0: 6573 0d0a 5468 6520 5f6d 6169 6e5f 2062  es..The _main_ b
+00002900: 7261 6e63 6820 636f 6e74 6169 6e73 2074  ranch contains t
+00002910: 6865 2063 7572 7265 6e74 6c79 2064 6576  he currently dev
+00002920: 656c 6f70 6564 2076 6572 7369 6f6e 2c20  eloped version, 
+00002930: 7768 6963 6820 6973 2076 6572 7369 6f6e  which is version
+00002940: 2032 0d0a 616c 7068 612e 2054 6865 205f   2..alpha. The _
+00002950: 7631 5f20 6272 616e 6368 2063 6f6e 7461  v1_ branch conta
+00002960: 696e 7320 7665 7273 696f 6e20 3120 6f66  ins version 1 of
+00002970: 2074 6865 2077 6562 2066 7261 6d65 776f   the web framewo
+00002980: 726b 2c20 666f 7220 6275 6773 2066 6978  rk, for bugs fix
+00002990: 6573 0d0a 616e 6420 6d61 696e 7465 6e61  es..and maintena
+000029a0: 6e63 652e 0d0a                           nce...
```

### Comparing `blacksheep-2.0a5/blacksheep.egg-info/SOURCES.txt` & `blacksheep-2.0a6/blacksheep.egg-info/SOURCES.txt`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,11 @@
 LICENSE
 MANIFEST.in
 README.md
+pyproject.toml
 setup.py
 blacksheep/__init__.py
 blacksheep/asgi.pyi
 blacksheep/baseapp.c
 blacksheep/baseapp.pxd
 blacksheep/baseapp.pyi
 blacksheep/baseapp.pyx
@@ -40,15 +41,14 @@
 blacksheep/url.c
 blacksheep/url.pxd
 blacksheep/url.pyi
 blacksheep/url.pyx
 blacksheep.egg-info/PKG-INFO
 blacksheep.egg-info/SOURCES.txt
 blacksheep.egg-info/dependency_links.txt
-blacksheep.egg-info/not-zip-safe
 blacksheep.egg-info/requires.txt
 blacksheep.egg-info/top_level.txt
 blacksheep/client/__init__.py
 blacksheep/client/connection.py
 blacksheep/client/cookies.py
 blacksheep/client/exceptions.py
 blacksheep/client/pool.py
@@ -60,14 +60,15 @@
 blacksheep/common/files/info.py
 blacksheep/common/files/pathsutils.py
 blacksheep/includes/consts.pxi
 blacksheep/server/__init__.py
 blacksheep/server/application.py
 blacksheep/server/asgi.py
 blacksheep/server/bindings.py
+blacksheep/server/compression.py
 blacksheep/server/controllers.py
 blacksheep/server/cors.py
 blacksheep/server/csrf.py
 blacksheep/server/dataprotection.py
 blacksheep/server/di.py
 blacksheep/server/env.py
 blacksheep/server/errors.py
@@ -115,14 +116,15 @@
 blacksheep/testing/__init__.py
 blacksheep/testing/client.py
 blacksheep/testing/helpers.py
 blacksheep/testing/messages.py
 blacksheep/testing/simulator.py
 blacksheep/utils/__init__.py
 blacksheep/utils/aio.py
+blacksheep/utils/meta.py
 tests/test_application.py
 tests/test_auth.py
 tests/test_auth_cookie.py
 tests/test_bindings.py
 tests/test_caching.py
 tests/test_contents.py
 tests/test_controllers.py
@@ -130,14 +132,15 @@
 tests/test_cors.py
 tests/test_csrf.py
 tests/test_dataprotection.py
 tests/test_env.py
 tests/test_files_handler.py
 tests/test_files_serving.py
 tests/test_forwarding.py
+tests/test_gzip.py
 tests/test_headers.py
 tests/test_multipart.py
 tests/test_normalization.py
 tests/test_openapi_docstrings.py
 tests/test_openapi_v3.py
 tests/test_pathutils.py
 tests/test_ranges.py
```

### Comparing `blacksheep-2.0a5/tests/test_application.py` & `blacksheep-2.0a6/tests/test_application.py`

 * *Files 0% similar despite different names*

```diff
@@ -4086,15 +4086,15 @@
 
     @dataclass
     class Pet:
         name: str
         age: int | None
 
     @app.router.get("/pets")
-    def pets() -> list[Pet]:
+    def pets() -> List[Pet]:
         return [
             Pet(name="Ren", age=None),
             Pet(name="Stimpy", age=3),
         ]
 
     docs = OpenAPIHandler(info=Info(title="Example API", version="0.0.1"))
     docs.bind_app(app)
```

### Comparing `blacksheep-2.0a5/tests/test_auth.py` & `blacksheep-2.0a6/tests/test_auth.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_auth_cookie.py` & `blacksheep-2.0a6/tests/test_auth_cookie.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_bindings.py` & `blacksheep-2.0a6/tests/test_bindings.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_caching.py` & `blacksheep-2.0a6/tests/test_caching.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_contents.py` & `blacksheep-2.0a6/tests/test_contents.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_controllers.py` & `blacksheep-2.0a6/tests/test_controllers.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_cookies.py` & `blacksheep-2.0a6/tests/test_cookies.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_cors.py` & `blacksheep-2.0a6/tests/test_cors.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_csrf.py` & `blacksheep-2.0a6/tests/test_csrf.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_dataprotection.py` & `blacksheep-2.0a6/tests/test_dataprotection.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_files_handler.py` & `blacksheep-2.0a6/tests/test_files_handler.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_files_serving.py` & `blacksheep-2.0a6/tests/test_files_serving.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_forwarding.py` & `blacksheep-2.0a6/tests/test_forwarding.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_headers.py` & `blacksheep-2.0a6/tests/test_headers.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_multipart.py` & `blacksheep-2.0a6/tests/test_multipart.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_normalization.py` & `blacksheep-2.0a6/tests/test_normalization.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_openapi_docstrings.py` & `blacksheep-2.0a6/tests/test_openapi_docstrings.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_openapi_v3.py` & `blacksheep-2.0a6/tests/test_openapi_v3.py`

 * *Files 5% similar despite different names*

```diff
@@ -9,28 +9,30 @@
 from openapidocs.v3 import Info, Reference, Schema, ValueFormat, ValueType
 from pydantic import BaseModel, HttpUrl, validator
 from pydantic.generics import GenericModel
 from pydantic.types import NegativeFloat, PositiveInt, condecimal, confloat, conint
 
 from blacksheep.server.application import Application
 from blacksheep.server.bindings import FromForm
+from blacksheep.server.controllers import APIController
 from blacksheep.server.openapi.common import (
     ContentInfo,
     EndpointDocs,
     OpenAPIEndpointException,
     ResponseInfo,
 )
 from blacksheep.server.openapi.exceptions import (
     DuplicatedContentTypeDocsException,
     UnsupportedUnionTypeException,
 )
 from blacksheep.server.openapi.v3 import (
     DataClassTypeHandler,
     OpenAPIHandler,
     PydanticModelTypeHandler,
+    Tag,
     check_union,
 )
 from blacksheep.server.routing import RoutesRegistry
 
 T = TypeVar("T")
 U = TypeVar("U")
 
@@ -187,16 +189,15 @@
 def get_app() -> Application:
     app = Application()
     app.controllers_router = RoutesRegistry()
     return app
 
 
 def get_cats_api() -> Application:
-    app = Application()
-    app.controllers_router = RoutesRegistry()
+    app = get_app()
     get = app.router.get
     post = app.router.post
     delete = app.router.delete
 
     @get("/api/cats")
     def get_cats() -> PaginatedSet[Cat]:
         ...
@@ -235,15 +236,15 @@
 @pytest.fixture
 def serializer() -> Serializer:
     return Serializer()
 
 
 @pytest.mark.asyncio
 async def test_raises_for_started_app(docs):
-    app = Application()
+    app = get_app()
 
     await app.start()
 
     with pytest.raises(TypeError):
         docs.bind_app(app)
 
 
@@ -407,15 +408,15 @@
     docs.register_schema_for_type(DateTest)
 
     assert docs.components.schemas is not None
     schema = docs.components.schemas["DateTest"]
 
     assert isinstance(schema, Schema)
 
-    yaml = serializer.to_yaml(docs.generate_documentation(Application()))
+    yaml = serializer.to_yaml(docs.generate_documentation(get_app()))
 
     assert (
         yaml.strip()
         == """
 openapi: 3.0.3
 info:
     title: Example
@@ -433,29 +434,30 @@
                     type: string
                     format: date
                     nullable: false
                 two:
                     type: string
                     format: date-time
                     nullable: false
+tags: []
 """.strip()
     )
 
 
 def test_register_schema_for_generic_with_list(
     docs: OpenAPIHandler, serializer: Serializer
 ):
     docs.register_schema_for_type(PaginatedSet[Foo])
 
     assert docs.components.schemas is not None
     schema = docs.components.schemas["PaginatedSetOfFoo"]
 
     assert isinstance(schema, Schema)
 
-    yaml = serializer.to_yaml(docs.generate_documentation(Application()))
+    yaml = serializer.to_yaml(docs.generate_documentation(get_app()))
 
     assert (
         yaml.strip()
         == """
 openapi: 3.0.3
 info:
     title: Example
@@ -493,14 +495,15 @@
                     nullable: false
                     items:
                         $ref: '#/components/schemas/Foo'
                 total:
                     type: integer
                     format: int64
                     nullable: false
+tags: []
 """.strip()
     )
 
 
 def test_register_schema_for_multiple_generic_with_list(
     docs: OpenAPIHandler, serializer: Serializer
 ):
@@ -510,15 +513,15 @@
     assert docs.components.schemas is not None
     schema = docs.components.schemas["PaginatedSetOfFoo"]
     assert isinstance(schema, Schema)
 
     schema = docs.components.schemas["PaginatedSetOfUfo"]
     assert isinstance(schema, Schema)
 
-    yaml = serializer.to_yaml(docs.generate_documentation(Application()))
+    yaml = serializer.to_yaml(docs.generate_documentation(get_app()))
 
     assert (
         yaml.strip()
         == """
 openapi: 3.0.3
 info:
     title: Example
@@ -583,29 +586,30 @@
                     nullable: false
                     items:
                         $ref: '#/components/schemas/Ufo'
                 total:
                     type: integer
                     format: int64
                     nullable: false
+tags: []
 """.strip()
     )
 
 
 def test_register_schema_for_generic_with_property(
     docs: OpenAPIHandler, serializer: Serializer
 ):
     docs.register_schema_for_type(Validated[Foo])
 
     assert docs.components.schemas is not None
     schema = docs.components.schemas["ValidatedOfFoo"]
 
     assert isinstance(schema, Schema)
 
-    yaml = serializer.to_yaml(docs.generate_documentation(Application()))
+    yaml = serializer.to_yaml(docs.generate_documentation(get_app()))
 
     assert (
         yaml.strip()
         == """
 openapi: 3.0.3
 info:
     title: Example
@@ -639,14 +643,15 @@
             - error
             properties:
                 data:
                     $ref: '#/components/schemas/Foo'
                 error:
                     type: string
                     nullable: false
+tags: []
 """.strip()
     )
 
 
 def test_register_schema_for_generic_sub_property(
     docs: OpenAPIHandler, serializer: Serializer
 ):
@@ -654,15 +659,15 @@
     docs.register_schema_for_type(SubValidated[Foo])
 
     assert docs.components.schemas is not None
     schema = docs.components.schemas["SubValidatedOfFoo"]
 
     assert isinstance(schema, Schema)
 
-    yaml = serializer.to_yaml(docs.generate_documentation(Application()))
+    yaml = serializer.to_yaml(docs.generate_documentation(get_app()))
 
     assert (
         yaml.strip()
         == """
 openapi: 3.0.3
 info:
     title: Example
@@ -703,14 +708,15 @@
         SubValidatedOfFoo:
             type: object
             required:
             - sub
             properties:
                 sub:
                     $ref: '#/components/schemas/ValidatedOfFoo'
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_register_schema_for_multi_generic(
     docs: OpenAPIHandler, serializer: Serializer
@@ -784,33 +790,36 @@
             - item_one
             - item_two
             properties:
                 item_one:
                     $ref: '#/components/schemas/Cat'
                 item_two:
                     $ref: '#/components/schemas/Foo'
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_register_schema_for_generic_with_list_reusing_ref(
     docs: OpenAPIHandler, serializer: Serializer
 ):
     app = get_app()
+    docs.bind_app(app)
 
+    @docs(tags=["B tag"])
     @app.route("/one")
     def one() -> PaginatedSet[Cat]:
         ...
 
+    @docs(tags=["A tag"])
     @app.route("/two")
     def two() -> PaginatedSet[Cat]:
         ...
 
-    docs.bind_app(app)
     await app.start()
 
     yaml = serializer.to_yaml(docs.generate_documentation(app))
 
     assert (
         yaml.strip()
         == """
@@ -824,24 +833,28 @@
             responses:
                 '200':
                     description: Success response
                     content:
                         application/json:
                             schema:
                                 $ref: '#/components/schemas/PaginatedSetOfCat'
+            tags:
+            - B tag
             operationId: one
     /two:
         get:
             responses:
                 '200':
                     description: Success response
                     content:
                         application/json:
                             schema:
                                 $ref: '#/components/schemas/PaginatedSetOfCat'
+            tags:
+            - A tag
             operationId: two
 components:
     schemas:
         Cat:
             type: object
             required:
             - id
@@ -865,14 +878,17 @@
                     nullable: false
                     items:
                         $ref: '#/components/schemas/Cat'
                 total:
                     type: integer
                     format: int64
                     nullable: false
+tags:
+-   name: A tag
+-   name: B tag
 """.strip()
     )
 
 
 def test_get_type_name_raises_for_invalid_object_type(docs: OpenAPIHandler):
     with pytest.raises(ValueError):
         docs.get_type_name(10)
@@ -944,14 +960,15 @@
         ForwardRefExample:
             type: object
             required:
             - value
             properties:
                 value:
                     $ref: '#/components/schemas/PaginatedSetOfCat'
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_handling_of_normal_class(docs: OpenAPIHandler, serializer: Serializer):
     """
@@ -985,14 +1002,15 @@
                     description: Success response
                     content:
                         application/json:
                             schema:
                                 nullable: false
             operationId: plain_class
 components: {}
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_handling_of_pydantic_class_with_generic(
     docs: OpenAPIHandler, serializer: Serializer
@@ -1052,14 +1070,15 @@
                     nullable: false
                     items:
                         $ref: '#/components/schemas/PydCat'
                 total:
                     type: integer
                     format: int64
                     nullable: false
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_handling_of_pydantic_class_with_child_models(
     docs: OpenAPIHandler, serializer: Serializer
@@ -1140,14 +1159,15 @@
             - child
             - friend
             properties:
                 child:
                     $ref: '#/components/schemas/PydPaginatedSetOfCat'
                 friend:
                     $ref: '#/components/schemas/PydExampleWithSpecificTypes'
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_handling_of_pydantic_class_in_generic(
     docs: OpenAPIHandler, serializer: Serializer
@@ -1207,14 +1227,15 @@
                     nullable: false
                     items:
                         $ref: '#/components/schemas/PydCat'
                 total:
                     type: integer
                     format: int64
                     nullable: false
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_handling_of_sequence(docs: OpenAPIHandler, serializer: Serializer):
     app = get_app()
@@ -1260,14 +1281,15 @@
                 id:
                     type: integer
                     format: int64
                     nullable: false
                 name:
                     type: string
                     nullable: false
+tags: []
 """.strip()
     )
 
 
 def test_handling_of_generic_with_forward_references(docs: OpenAPIHandler):
     with pytest.warns(UserWarning):
         docs.register_schema_for_type(GenericWithForwardRefExample[Cat])
@@ -1423,14 +1445,15 @@
                 friends:
                     type: array
                     nullable: false
                     items:
                         type: integer
                         format: int64
                         nullable: false
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_cats_api_capital_operations_ids(
     capitalize_operation_id_docs: CapitalizeOperationDocs,
@@ -1586,14 +1609,15 @@
                 friends:
                     type: array
                     nullable: false
                     items:
                         type: integer
                         format: int64
                         nullable: false
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_handling_of_pydantic_types(docs: OpenAPIHandler, serializer: Serializer):
     app = get_app()
@@ -1634,14 +1658,15 @@
             properties:
                 url:
                     type: string
                     format: uri
                     maxLength: 2083
                     minLength: 1
                     nullable: false
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_pydantic_generic(docs: OpenAPIHandler, serializer: Serializer):
     app = get_app()
@@ -1707,14 +1732,15 @@
             - data
             - error
             properties:
                 data:
                     $ref: '#/components/schemas/PydCat'
                 error:
                     $ref: '#/components/schemas/Error'
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_pydantic_constrained_types(docs: OpenAPIHandler, serializer: Serializer):
     app = get_app()
@@ -1791,14 +1817,15 @@
                     minimum: 0
                     nullable: false
                 decimal_negative:
                     type: number
                     format: float
                     maximum: 0
                     nullable: false
+tags: []
 """.strip()
     )
 
 
 def test_pydantic_model_handler_does_not_raise_for_array_without_field_info():
     handler = PydanticModelTypeHandler()
     assert handler._open_api_v2_field_schema_to_type(None, {"type": "array"}) is list
@@ -1890,14 +1917,15 @@
                     minimum: 10
                     nullable: false
                 ufo:
                     type: string
                     maxLength: 10
                     minLength: 5
                     nullable: false
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_handles_ref_for_optional_type(
     docs: OpenAPIHandler, serializer: Serializer
@@ -2028,14 +2056,15 @@
                     nullable: false
                     items:
                         $ref: '#/components/schemas/Cat'
                 total:
                     type: integer
                     format: int64
                     nullable: false
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_handles_from_form_docs(docs: OpenAPIHandler, serializer: Serializer):
     app = get_app()
@@ -2113,14 +2142,15 @@
                 level:
                     type: integer
                     nullable: true
                     enum:
                     - 1
                     - 2
                     - 3
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_websockets_routes_are_ignored(
     docs: OpenAPIHandler, serializer: Serializer
@@ -2204,14 +2234,15 @@
                 level:
                     type: integer
                     nullable: true
                     enum:
                     - 1
                     - 2
                     - 3
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_mount_oad_generation(serializer: Serializer):
     """
@@ -2467,14 +2498,15 @@
             properties:
                 name:
                     type: string
                     nullable: false
                 email:
                     type: string
                     nullable: false
+tags: []
 """.strip()
     )
 
 
 @pytest.mark.asyncio
 async def test_mount_oad_generation_sub_children(serializer: Serializer):
     """
@@ -2483,34 +2515,41 @@
     parent.mount_registry.auto_events = True
     parent.mount_registry.handle_docs = True
     """
     parent = Application(show_error_details=True)
     parent.mount_registry.auto_events = True
     parent.mount_registry.handle_docs = True
 
-    docs = OpenAPIHandler(info=Info(title="Parent API", version="0.0.1"))
+    docs = OpenAPIHandler(
+        info=Info(title="Parent API", version="0.0.1"),
+        tags=[Tag(name="A Home")],
+    )
     docs.bind_app(parent)
 
+    @docs(tags=["A Home"])
     @parent.router.get("/")
     def a_home():
         """Parent root."""
         return "Hello, from the parent app - for information, navigate to /docs"
 
     child_1 = Application()
     child_2 = Application()
     child_3 = Application()
 
+    @docs(tags=["Child z Home"])
     @child_1.router.get("/")
     def child_1_home():
         return "Child 1 home."
 
+    @docs(tags=["Child y Home"])
     @child_2.router.get("/")
     def child_2_home():
         return "Child 2 home."
 
+    @docs(tags=["Child x Home"])
     @child_3.router.get("/")
     def child_3_home():
         return "Child 3 home."
 
     child_1.mount_registry.auto_events = True
     child_1.mount_registry.handle_docs = True
     child_2.mount_registry.auto_events = True
@@ -2531,25 +2570,216 @@
 info:
     title: Parent API
     version: 0.0.1
 paths:
     /:
         get:
             responses: {}
+            tags:
+            - A Home
             operationId: a_home
             summary: Parent root.
             description: Parent root.
     /child-1:
         get:
             responses: {}
+            tags:
+            - Child z Home
             operationId: child_1_home
     /child-1/child-2:
         get:
             responses: {}
+            tags:
+            - Child y Home
             operationId: child_2_home
     /child-1/child-2/child-3:
         get:
             responses: {}
+            tags:
+            - Child x Home
             operationId: child_3_home
 components: {}
+tags:
+-   name: A Home
+""".strip()
+    )
+
+
+@pytest.mark.asyncio
+async def test_sorting_api_controllers_tags(serializer: Serializer):
+    app = get_app()
+    get = app.controllers_router.get
+    post = app.controllers_router.post
+
+    docs = OpenAPIHandler(info=Info(title="Example API", version="0.0.1"))
+    docs.bind_app(app)
+
+    @dataclass
+    class Cat:
+        pass
+
+    @dataclass
+    class Dog:
+        pass
+
+    @dataclass
+    class Parrot:
+        pass
+
+    class Parrots(APIController):
+        @get()
+        def get_parrots(self) -> List[Parrot]:
+            """Return the list of configured Parrots."""
+
+        @post()
+        def create_parrot(self, parrot: Parrot) -> None:
+            """Add a Parrot to the system."""
+
+    class Dogs(APIController):
+        @get()
+        def get_dogs(self) -> List[Dog]:
+            """Return the list of configured dogs."""
+
+        @post()
+        def create_dog(self, dog: Dog) -> None:
+            """Add a Dog to the system."""
+
+    class Cats(APIController):
+        @get()
+        def get_cats(self) -> List[Cat]:
+            """Return the list of configured cats."""
+
+        @post()
+        def create_cat(self, cat: Cat) -> None:
+            """Add a Cat to the system."""
+
+    await app.start()
+
+    yaml = serializer.to_yaml(docs.generate_documentation(app))
+
+    assert (
+        yaml.strip()
+        == """
+openapi: 3.0.3
+info:
+    title: Example API
+    version: 0.0.1
+paths:
+    /api/parrots:
+        get:
+            responses:
+                '200':
+                    description: Success response
+                    content:
+                        application/json:
+                            schema:
+                                type: array
+                                nullable: false
+                                items:
+                                    $ref: '#/components/schemas/Parrot'
+            tags:
+            - Parrots
+            operationId: get_parrots
+            summary: Return the list of configured Parrots.
+            description: Return the list of configured Parrots.
+            parameters: []
+        post:
+            responses:
+                '204':
+                    description: Success response
+            tags:
+            - Parrots
+            operationId: create_parrot
+            summary: Add a Parrot to the system.
+            description: Add a Parrot to the system.
+            parameters: []
+            requestBody:
+                content:
+                    application/json:
+                        schema:
+                            $ref: '#/components/schemas/Parrot'
+                required: true
+    /api/dogs:
+        get:
+            responses:
+                '200':
+                    description: Success response
+                    content:
+                        application/json:
+                            schema:
+                                type: array
+                                nullable: false
+                                items:
+                                    $ref: '#/components/schemas/Dog'
+            tags:
+            - Dogs
+            operationId: get_dogs
+            summary: Return the list of configured dogs.
+            description: Return the list of configured dogs.
+            parameters: []
+        post:
+            responses:
+                '204':
+                    description: Success response
+            tags:
+            - Dogs
+            operationId: create_dog
+            summary: Add a Dog to the system.
+            description: Add a Dog to the system.
+            parameters: []
+            requestBody:
+                content:
+                    application/json:
+                        schema:
+                            $ref: '#/components/schemas/Dog'
+                required: true
+    /api/cats:
+        get:
+            responses:
+                '200':
+                    description: Success response
+                    content:
+                        application/json:
+                            schema:
+                                type: array
+                                nullable: false
+                                items:
+                                    $ref: '#/components/schemas/Cat'
+            tags:
+            - Cats
+            operationId: get_cats
+            summary: Return the list of configured cats.
+            description: Return the list of configured cats.
+            parameters: []
+        post:
+            responses:
+                '204':
+                    description: Success response
+            tags:
+            - Cats
+            operationId: create_cat
+            summary: Add a Cat to the system.
+            description: Add a Cat to the system.
+            parameters: []
+            requestBody:
+                content:
+                    application/json:
+                        schema:
+                            $ref: '#/components/schemas/Cat'
+                required: true
+components:
+    schemas:
+        Parrot:
+            type: object
+            properties: {}
+        Dog:
+            type: object
+            properties: {}
+        Cat:
+            type: object
+            properties: {}
+tags:
+-   name: Cats
+-   name: Dogs
+-   name: Parrots
 """.strip()
     )
```

### Comparing `blacksheep-2.0a5/tests/test_pathutils.py` & `blacksheep-2.0a6/tests/test_pathutils.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_ranges.py` & `blacksheep-2.0a6/tests/test_ranges.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_requests.py` & `blacksheep-2.0a6/tests/test_requests.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_responses.py` & `blacksheep-2.0a6/tests/test_responses.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_router.py` & `blacksheep-2.0a6/tests/test_router.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_sessions.py` & `blacksheep-2.0a6/tests/test_sessions.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_templating.py` & `blacksheep-2.0a6/tests/test_templating.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_testing.py` & `blacksheep-2.0a6/tests/test_testing.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_url.py` & `blacksheep-2.0a6/tests/test_url.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_utils.py` & `blacksheep-2.0a6/tests/test_utils.py`

 * *Files identical despite different names*

### Comparing `blacksheep-2.0a5/tests/test_websocket.py` & `blacksheep-2.0a6/tests/test_websocket.py`

 * *Files identical despite different names*

