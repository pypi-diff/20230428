# Comparing `tmp/neon_mq_connector-0.6.1a7-py3-none-any.whl.zip` & `tmp/neon_mq_connector-0.6.1a8-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,17 +1,17 @@
-Zip file size: 26064 bytes, number of entries: 15
--rw-r--r--  2.0 unx     1884 b- defN 23-Apr-21 23:13 neon_mq_connector/__init__.py
--rw-r--r--  2.0 unx     3558 b- defN 23-Apr-21 23:13 neon_mq_connector/config.py
--rw-r--r--  2.0 unx    32391 b- defN 23-Apr-21 23:13 neon_mq_connector/connector.py
--rw-r--r--  2.0 unx     2011 b- defN 23-Apr-21 23:13 neon_mq_connector/utils/__init__.py
--rw-r--r--  2.0 unx     6204 b- defN 23-Apr-21 23:13 neon_mq_connector/utils/client_utils.py
--rw-r--r--  2.0 unx     7636 b- defN 23-Apr-21 23:13 neon_mq_connector/utils/connection_utils.py
--rw-r--r--  2.0 unx     3215 b- defN 23-Apr-21 23:13 neon_mq_connector/utils/network_utils.py
--rw-r--r--  2.0 unx     3304 b- defN 23-Apr-21 23:13 neon_mq_connector/utils/rabbit_utils.py
--rw-r--r--  2.0 unx     2131 b- defN 23-Apr-21 23:13 neon_mq_connector/utils/thread_utils.py
--rw-r--r--  2.0 unx     1635 b- defN 23-Apr-21 23:13 neon_mq_connector-0.6.1a7.dist-info/LICENSE.md
--rw-r--r--  2.0 unx     3256 b- defN 23-Apr-21 23:13 neon_mq_connector-0.6.1a7.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Apr-21 23:13 neon_mq_connector-0.6.1a7.dist-info/WHEEL
--rw-r--r--  2.0 unx       18 b- defN 23-Apr-21 23:13 neon_mq_connector-0.6.1a7.dist-info/top_level.txt
--rw-r--r--  2.0 unx        1 b- defN 23-Apr-21 23:13 neon_mq_connector-0.6.1a7.dist-info/zip-safe
--rw-rw-r--  2.0 unx     1382 b- defN 23-Apr-21 23:13 neon_mq_connector-0.6.1a7.dist-info/RECORD
-15 files, 68718 bytes uncompressed, 23728 bytes compressed:  65.5%
+Zip file size: 26366 bytes, number of entries: 15
+-rw-r--r--  2.0 unx     1884 b- defN 23-Apr-27 21:58 neon_mq_connector/__init__.py
+-rw-r--r--  2.0 unx     3715 b- defN 23-Apr-27 21:58 neon_mq_connector/config.py
+-rw-r--r--  2.0 unx    32416 b- defN 23-Apr-27 21:58 neon_mq_connector/connector.py
+-rw-r--r--  2.0 unx     2011 b- defN 23-Apr-27 21:58 neon_mq_connector/utils/__init__.py
+-rw-r--r--  2.0 unx     6436 b- defN 23-Apr-27 21:58 neon_mq_connector/utils/client_utils.py
+-rw-r--r--  2.0 unx     7747 b- defN 23-Apr-27 21:58 neon_mq_connector/utils/connection_utils.py
+-rw-r--r--  2.0 unx     3215 b- defN 23-Apr-27 21:58 neon_mq_connector/utils/network_utils.py
+-rw-r--r--  2.0 unx     3304 b- defN 23-Apr-27 21:58 neon_mq_connector/utils/rabbit_utils.py
+-rw-r--r--  2.0 unx     2131 b- defN 23-Apr-27 21:58 neon_mq_connector/utils/thread_utils.py
+-rw-r--r--  2.0 unx     1635 b- defN 23-Apr-27 21:58 neon_mq_connector-0.6.1a8.dist-info/LICENSE.md
+-rw-r--r--  2.0 unx     3485 b- defN 23-Apr-27 21:58 neon_mq_connector-0.6.1a8.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-27 21:58 neon_mq_connector-0.6.1a8.dist-info/WHEEL
+-rw-r--r--  2.0 unx       18 b- defN 23-Apr-27 21:58 neon_mq_connector-0.6.1a8.dist-info/top_level.txt
+-rw-r--r--  2.0 unx        1 b- defN 23-Apr-27 21:58 neon_mq_connector-0.6.1a8.dist-info/zip-safe
+-rw-rw-r--  2.0 unx     1382 b- defN 23-Apr-27 21:58 neon_mq_connector-0.6.1a8.dist-info/RECORD
+15 files, 69472 bytes uncompressed, 24030 bytes compressed:  65.4%
```

## zipnote {}

```diff
@@ -21,26 +21,26 @@
 
 Filename: neon_mq_connector/utils/rabbit_utils.py
 Comment: 
 
 Filename: neon_mq_connector/utils/thread_utils.py
 Comment: 
 
-Filename: neon_mq_connector-0.6.1a7.dist-info/LICENSE.md
+Filename: neon_mq_connector-0.6.1a8.dist-info/LICENSE.md
 Comment: 
 
-Filename: neon_mq_connector-0.6.1a7.dist-info/METADATA
+Filename: neon_mq_connector-0.6.1a8.dist-info/METADATA
 Comment: 
 
-Filename: neon_mq_connector-0.6.1a7.dist-info/WHEEL
+Filename: neon_mq_connector-0.6.1a8.dist-info/WHEEL
 Comment: 
 
-Filename: neon_mq_connector-0.6.1a7.dist-info/top_level.txt
+Filename: neon_mq_connector-0.6.1a8.dist-info/top_level.txt
 Comment: 
 
-Filename: neon_mq_connector-0.6.1a7.dist-info/zip-safe
+Filename: neon_mq_connector-0.6.1a8.dist-info/zip-safe
 Comment: 
 
-Filename: neon_mq_connector-0.6.1a7.dist-info/RECORD
+Filename: neon_mq_connector-0.6.1a8.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## neon_mq_connector/config.py

```diff
@@ -25,46 +25,47 @@
 # LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 # NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 # SOFTWARE,  EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
 import os
 import json
 from typing import Optional
-# TODO: Implement ovos-config
+from ovos_utils.log import LOG
+from ovos_config.config import Configuration as _Config
+from ovos_config.locations import get_xdg_config_save_path
 
 
 def load_neon_mq_config():
     """
     Locates and loads global MQ configuration. Priority is as follows:
     NEON_MQ_CONFIG_PATH environment variable
     {NEON_CONFIG_PATH}/mq_config.json
     ~/.local/share/neon/credentials.json
     """
     valid_config_paths = (
         os.path.expanduser(os.environ.get('NEON_MQ_CONFIG_PATH', "")),
-        os.path.join(os.path.expanduser(os.environ.get("NEON_CONFIG_PATH",
-                                                       "~/.config/neon")),
-                     "mq_config.json"),
+        os.path.join(get_xdg_config_save_path("neon"), "mq_config.json"),
         os.path.expanduser("~/.local/share/neon/credentials.json")
     )
     config = None
     for conf in valid_config_paths:
         if conf and os.path.isfile(conf):
-            config = Configuration().from_file(conf).config_data
+            LOG.warning(f"Legacy configuration found at {conf}")
+            with open(conf) as f:
+                config = json.load(f)
             break
     if not config:
-        return
-    if "MQ" in config.keys():
-        return config["MQ"]
-    else:
-        return config
+        config = _Config()
+    return config.get("MQ", config)
 
 
 class Configuration:
     def __init__(self, file_path: Optional[str] = None):
+        LOG.warning("This class is deprecated. "
+                    "Parse configuration files to dict or use `ovos_config`")
         self._config_data = dict()
         if file_path:
             self.from_file(file_path)
 
     def from_file(self, file_path: str):
         with open(os.path.expanduser(file_path)) as input_file:
             self._config_data = json.load(input_file)
```

## neon_mq_connector/connector.py

```diff
@@ -256,15 +256,15 @@
 
     @property
     def mq_credentials(self):
         """
         Returns MQ Credentials object based on self.config values
         """
         if not self.service_config or self.service_config == dict():
-            raise Exception('Configuration is not set')
+            raise Exception(f'Configuration is not set for {self.service_name}')
         return pika.PlainCredentials(
             self.service_config.get('user', 'guest'),
             self.service_config.get('password', 'guest'))
 
     @property
     def testing_mode(self) -> bool:
         """
```

## neon_mq_connector/utils/client_utils.py

```diff
@@ -105,15 +105,19 @@
             response_data.update(api_output)
             response_event.set()
         else:
             channel.basic_nack(delivery_tag=method.delivery_tag)
             LOG.debug(f"Ignoring {api_output_msg_id} waiting for {message_id}")
 
     try:
-        config = dict(Configuration()).get('MQ') or _default_mq_config
+        config = Configuration().get('MQ') or _default_mq_config
+        if not config['users'].get('mq_handler'):
+            LOG.warning("mq_handler not configured, using default credentials")
+            config['users']['mq_handler'] = \
+                _default_mq_config['users']['mq_handler']
         neon_api_mq_handler = NeonMQHandler(config=config,
                                             service_name='mq_handler',
                                             vhost=vhost)
         if not neon_api_mq_handler.connection.is_open:
             raise ConnectionError("MQ Connection not established.")
 
         if expect_response:
@@ -134,9 +138,9 @@
                 LOG.error(f"Timeout waiting for response to: {message_id} on "
                           f"{response_queue}")
             neon_api_mq_handler.stop_consumers()
     except ProbableAccessDeniedError:
         raise ValueError(f"{vhost} is not a valid endpoint for "
                          f"{config.get('users').get('mq_handler').get('user')}")
     except Exception as ex:
-        LOG.error(f'Exception occurred while resolving Neon API: {ex}')
+        LOG.exception(f'Exception occurred while resolving Neon API: {ex}')
     return response_data
```

## neon_mq_connector/utils/connection_utils.py

```diff
@@ -142,12 +142,14 @@
     Wait up to `timeout` seconds for the MQ connection at `addr`:`port`
     to come online.
     :param addr: URL or IP address to monitor
     :param port: MQ port to query
     :param timeout: Max seconds to wait for connection to come online
     """
     stop_time = time.time() + timeout
+    LOG.debug(f"Waiting for MQ server at {addr}:{port} to come online")
     while not check_port_is_open(addr, port):
-        LOG.debug("Waiting for MQ server to come online")
         if time.time() > stop_time:
+            LOG.warning(f"Timed out waiting after {timeout}s")
             return False
+    LOG.info("MQ Server Started")
     return True
```

## Comparing `neon_mq_connector-0.6.1a7.dist-info/LICENSE.md` & `neon_mq_connector-0.6.1a8.dist-info/LICENSE.md`

 * *Files identical despite different names*

## Comparing `neon_mq_connector-0.6.1a7.dist-info/METADATA` & `neon_mq_connector-0.6.1a8.dist-info/METADATA`

 * *Files 12% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: neon-mq-connector
-Version: 0.6.1a7
+Version: 0.6.1a8
 Summary: MQ Connector for Neon Modules
 Home-page: https://github.com/NeonGeckoCom/neon_mq_connector
 Author: NeonGecko
 Author-email: developers@neon.ai
 License: BSD-3-Clause
 Classifier: Intended Audience :: Developers
 Classifier: Programming Language :: Python :: 3.6
@@ -14,14 +14,19 @@
 Requires-Dist: ovos-config (~=0.0.8)
 Requires-Dist: ovos-utils (~=0.0.32)
 
 # Neon MQ Connector
 The Neon MQ Connector is an MQ interface for microservices.
 
 ## Configuration
+By default, this package will use [ovos-config](https://github.com/openvoiceos/ovos-config)
+to read default configuration. In general, configuration should be passed to the
+`MQConnector` object at init.
+
+### Legacy Configuration
 A global configuration for the MQ Connector may be specified at `~/.config/neon/mq_config.json`. This configuration file 
 may contain the following keys:
  - `server`: The hostname or IP address of the MQ server to connect to. If left blank, this defaults to `"localhost"`
  - `port`: The port used by the MQ server. If left blank, this defaults to `5672`
  - `users`: A mapping of service names to credentials. Note that not all users will have permissions required to access each service.
 
 ```json
```

## Comparing `neon_mq_connector-0.6.1a7.dist-info/RECORD` & `neon_mq_connector-0.6.1a8.dist-info/RECORD`

 * *Files 18% similar despite different names*

```diff
@@ -1,15 +1,15 @@
 neon_mq_connector/__init__.py,sha256=WC23UcWdwM76Ii_a3AKfTkDxGFR8CbvfMy0XfJreRHs,1884
-neon_mq_connector/config.py,sha256=rHW9_IJaNiyecrdYak5Ejqw9hTict7TmNyHBwPhhexA,3558
-neon_mq_connector/connector.py,sha256=Zlligq-wjpYe3XhBQMt2cao5yuAzXZakPKA5f4o4bno,32391
+neon_mq_connector/config.py,sha256=dn4fhUoulW3iH9ngXSFkXRuZpyih-HX7csJXrXcRRqU,3715
+neon_mq_connector/connector.py,sha256=jB_pSSCl3WROuxGEraP9tVot1JO38-pqrznEI6bm3M4,32416
 neon_mq_connector/utils/__init__.py,sha256=qZ9lxm8PMtMf_kEiFaKPDwGhlQEa0kv_DJheWy4MnmU,2011
-neon_mq_connector/utils/client_utils.py,sha256=NGF3ZzUPLMfoHfeL90iYg0q-coIIkkpOAc9MD8ACMHw,6204
-neon_mq_connector/utils/connection_utils.py,sha256=p77q4CsyOee-wXUi5j32AaRdd9FAq4h-va10yOL9Ta8,7636
+neon_mq_connector/utils/client_utils.py,sha256=_zuMqXMPPCBDqa-2ba48MlLmyL0wr3kPuKNbdRuOosQ,6436
+neon_mq_connector/utils/connection_utils.py,sha256=eQrQOS6wDURXvyYEgru25VqQX80Uc6TsT5imzutf4Ds,7747
 neon_mq_connector/utils/network_utils.py,sha256=luK6hV-4URhxEcg3sLAXrliyRok9LAzfts7s1GL4W14,3215
 neon_mq_connector/utils/rabbit_utils.py,sha256=rDzbAHRd7-KF66hPlPuZ4kifxtnO48RTQt9omSYq3wI,3304
 neon_mq_connector/utils/thread_utils.py,sha256=LnF4H7bhU9jFkMbS2WDVbrc_qpaNaC2ZCHxOracdrfA,2131
-neon_mq_connector-0.6.1a7.dist-info/LICENSE.md,sha256=KxXbLh0XZkaLbNrj5ksC1Hl04EeiMbY-I0pGhKTPBRc,1635
-neon_mq_connector-0.6.1a7.dist-info/METADATA,sha256=lHBd0wmMgNM9qsY4pkKaki4Aol5LOw5mlxnWasWDR4M,3256
-neon_mq_connector-0.6.1a7.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-neon_mq_connector-0.6.1a7.dist-info/top_level.txt,sha256=7GVRwlmJO6V-WXJ_pATe174KQVc2l8xx_2KVDbehPxE,18
-neon_mq_connector-0.6.1a7.dist-info/zip-safe,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
-neon_mq_connector-0.6.1a7.dist-info/RECORD,,
+neon_mq_connector-0.6.1a8.dist-info/LICENSE.md,sha256=KxXbLh0XZkaLbNrj5ksC1Hl04EeiMbY-I0pGhKTPBRc,1635
+neon_mq_connector-0.6.1a8.dist-info/METADATA,sha256=MjeGEiQQGefDhsGA6f6A7GJfWHET8dUZ05KytTqDoi8,3485
+neon_mq_connector-0.6.1a8.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+neon_mq_connector-0.6.1a8.dist-info/top_level.txt,sha256=7GVRwlmJO6V-WXJ_pATe174KQVc2l8xx_2KVDbehPxE,18
+neon_mq_connector-0.6.1a8.dist-info/zip-safe,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
+neon_mq_connector-0.6.1a8.dist-info/RECORD,,
```

